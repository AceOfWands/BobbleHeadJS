var BobbleHead=function(t){var e={};function n(i){if(e[i])return e[i].exports;var r=e[i]={i:i,l:!1,exports:{}};return t[i].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=t,n.c=e,n.d=function(t,e,i){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)n.d(i,r,function(e){return t[e]}.bind(null,r));return i},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=44)}([function(t,e){t.exports=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}},function(t,e){function n(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}t.exports=function(t,e,i){return e&&n(t.prototype,e),i&&n(t,i),t}},function(t,e){function n(e){return t.exports=n=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},n(e)}t.exports=n},function(t,e,n){var i=n(29),r=n(14);t.exports=function(t,e){return!e||"object"!==i(e)&&"function"!=typeof e?r(t):e}},function(t,e,n){var i=n(16);t.exports=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&i(t,e)}},function(t,e,n){t.exports=n(27)},function(t,e){function n(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function i(t){return"function"==typeof t}function r(t){return"object"==typeof t&&null!==t}function o(t){return void 0===t}t.exports=n,n.EventEmitter=n,n.prototype._events=void 0,n.prototype._maxListeners=void 0,n.defaultMaxListeners=10,n.prototype.setMaxListeners=function(t){if("number"!=typeof t||t<0||isNaN(t))throw TypeError("n must be a positive number");return this._maxListeners=t,this},n.prototype.emit=function(t){var e,n,u,a,c,s;if(this._events||(this._events={}),"error"===t&&(!this._events.error||r(this._events.error)&&!this._events.error.length)){if((e=arguments[1])instanceof Error)throw e;var f=new Error('Uncaught, unspecified "error" event. ('+e+")");throw f.context=e,f}if(o(n=this._events[t]))return!1;if(i(n))switch(arguments.length){case 1:n.call(this);break;case 2:n.call(this,arguments[1]);break;case 3:n.call(this,arguments[1],arguments[2]);break;default:a=Array.prototype.slice.call(arguments,1),n.apply(this,a)}else if(r(n))for(a=Array.prototype.slice.call(arguments,1),u=(s=n.slice()).length,c=0;c<u;c++)s[c].apply(this,a);return!0},n.prototype.addListener=function(t,e){var u;if(!i(e))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",t,i(e.listener)?e.listener:e),this._events[t]?r(this._events[t])?this._events[t].push(e):this._events[t]=[this._events[t],e]:this._events[t]=e,r(this._events[t])&&!this._events[t].warned&&(u=o(this._maxListeners)?n.defaultMaxListeners:this._maxListeners)&&u>0&&this._events[t].length>u&&(this._events[t].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[t].length),"function"==typeof console.trace&&console.trace()),this},n.prototype.on=n.prototype.addListener,n.prototype.once=function(t,e){if(!i(e))throw TypeError("listener must be a function");var n=!1;function r(){this.removeListener(t,r),n||(n=!0,e.apply(this,arguments))}return r.listener=e,this.on(t,r),this},n.prototype.removeListener=function(t,e){var n,o,u,a;if(!i(e))throw TypeError("listener must be a function");if(!this._events||!this._events[t])return this;if(u=(n=this._events[t]).length,o=-1,n===e||i(n.listener)&&n.listener===e)delete this._events[t],this._events.removeListener&&this.emit("removeListener",t,e);else if(r(n)){for(a=u;a-- >0;)if(n[a]===e||n[a].listener&&n[a].listener===e){o=a;break}if(o<0)return this;1===n.length?(n.length=0,delete this._events[t]):n.splice(o,1),this._events.removeListener&&this.emit("removeListener",t,e)}return this},n.prototype.removeAllListeners=function(t){var e,n;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[t]&&delete this._events[t],this;if(0===arguments.length){for(e in this._events)"removeListener"!==e&&this.removeAllListeners(e);return this.removeAllListeners("removeListener"),this._events={},this}if(i(n=this._events[t]))this.removeListener(t,n);else if(n)for(;n.length;)this.removeListener(t,n[n.length-1]);return delete this._events[t],this},n.prototype.listeners=function(t){return this._events&&this._events[t]?i(this._events[t])?[this._events[t]]:this._events[t].slice():[]},n.prototype.listenerCount=function(t){if(this._events){var e=this._events[t];if(i(e))return 1;if(e)return e.length}return 0},n.listenerCount=function(t,e){return t.listenerCount(e)}},function(t,e){"function"==typeof Object.create?t.exports=function(t,e){t.super_=e,t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}})}:t.exports=function(t,e){t.super_=e;var n=function(){};n.prototype=e.prototype,t.prototype=new n,t.prototype.constructor=t}},function(t,e,n){"use strict";(function(e){var n,i,r=e.MutationObserver||e.WebKitMutationObserver;if(r){var o=0,u=new r(f),a=e.document.createTextNode("");u.observe(a,{characterData:!0}),n=function(){a.data=o=++o%2}}else if(e.setImmediate||void 0===e.MessageChannel)n="document"in e&&"onreadystatechange"in e.document.createElement("script")?function(){var t=e.document.createElement("script");t.onreadystatechange=function(){f(),t.onreadystatechange=null,t.parentNode.removeChild(t),t=null},e.document.documentElement.appendChild(t)}:function(){setTimeout(f,0)};else{var c=new e.MessageChannel;c.port1.onmessage=f,n=function(){c.port2.postMessage(0)}}var s=[];function f(){var t,e;i=!0;for(var n=s.length;n;){for(e=s,s=[],t=-1;++t<n;)e[t]();n=s.length}i=!1}t.exports=function(t){1!==s.push(t)||i||n()}}).call(this,n(13))},function(t,e,n){"use strict";t.exports=function(t){return function(){var e=arguments.length;if(e){for(var n=[],i=-1;++i<e;)n[i]=arguments[i];return t.call(this,n)}return t.call(this,[])}}},function(t,e,n){(function(e){t.exports=e.Sandbox=n(30)}).call(this,n(13))},function(t,e){function n(t,e,n,i,r,o,u){try{var a=t[o](u),c=a.value}catch(t){return void n(t)}a.done?e(c):Promise.resolve(c).then(i,r)}t.exports=function(t){return function(){var e=this,i=arguments;return new Promise(function(r,o){var u=t.apply(e,i);function a(t){n(u,r,o,a,c,"next",t)}function c(t){n(u,r,o,a,c,"throw",t)}a(void 0)})}}},function(t,e,n){var i,r;void 0===(r="function"==typeof(i=function(){function t(t,e){var u=t[0],a=t[1],c=t[2],s=t[3];u=n(u,a,c,s,e[0],7,-680876936),s=n(s,u,a,c,e[1],12,-389564586),c=n(c,s,u,a,e[2],17,606105819),a=n(a,c,s,u,e[3],22,-1044525330),u=n(u,a,c,s,e[4],7,-176418897),s=n(s,u,a,c,e[5],12,1200080426),c=n(c,s,u,a,e[6],17,-1473231341),a=n(a,c,s,u,e[7],22,-45705983),u=n(u,a,c,s,e[8],7,1770035416),s=n(s,u,a,c,e[9],12,-1958414417),c=n(c,s,u,a,e[10],17,-42063),a=n(a,c,s,u,e[11],22,-1990404162),u=n(u,a,c,s,e[12],7,1804603682),s=n(s,u,a,c,e[13],12,-40341101),c=n(c,s,u,a,e[14],17,-1502002290),a=n(a,c,s,u,e[15],22,1236535329),u=i(u,a,c,s,e[1],5,-165796510),s=i(s,u,a,c,e[6],9,-1069501632),c=i(c,s,u,a,e[11],14,643717713),a=i(a,c,s,u,e[0],20,-373897302),u=i(u,a,c,s,e[5],5,-701558691),s=i(s,u,a,c,e[10],9,38016083),c=i(c,s,u,a,e[15],14,-660478335),a=i(a,c,s,u,e[4],20,-405537848),u=i(u,a,c,s,e[9],5,568446438),s=i(s,u,a,c,e[14],9,-1019803690),c=i(c,s,u,a,e[3],14,-187363961),a=i(a,c,s,u,e[8],20,1163531501),u=i(u,a,c,s,e[13],5,-1444681467),s=i(s,u,a,c,e[2],9,-51403784),c=i(c,s,u,a,e[7],14,1735328473),a=i(a,c,s,u,e[12],20,-1926607734),u=r(u,a,c,s,e[5],4,-378558),s=r(s,u,a,c,e[8],11,-2022574463),c=r(c,s,u,a,e[11],16,1839030562),a=r(a,c,s,u,e[14],23,-35309556),u=r(u,a,c,s,e[1],4,-1530992060),s=r(s,u,a,c,e[4],11,1272893353),c=r(c,s,u,a,e[7],16,-155497632),a=r(a,c,s,u,e[10],23,-1094730640),u=r(u,a,c,s,e[13],4,681279174),s=r(s,u,a,c,e[0],11,-358537222),c=r(c,s,u,a,e[3],16,-722521979),a=r(a,c,s,u,e[6],23,76029189),u=r(u,a,c,s,e[9],4,-640364487),s=r(s,u,a,c,e[12],11,-421815835),c=r(c,s,u,a,e[15],16,530742520),a=r(a,c,s,u,e[2],23,-995338651),u=o(u,a,c,s,e[0],6,-198630844),s=o(s,u,a,c,e[7],10,1126891415),c=o(c,s,u,a,e[14],15,-1416354905),a=o(a,c,s,u,e[5],21,-57434055),u=o(u,a,c,s,e[12],6,1700485571),s=o(s,u,a,c,e[3],10,-1894986606),c=o(c,s,u,a,e[10],15,-1051523),a=o(a,c,s,u,e[1],21,-2054922799),u=o(u,a,c,s,e[8],6,1873313359),s=o(s,u,a,c,e[15],10,-30611744),c=o(c,s,u,a,e[6],15,-1560198380),a=o(a,c,s,u,e[13],21,1309151649),u=o(u,a,c,s,e[4],6,-145523070),s=o(s,u,a,c,e[11],10,-1120210379),c=o(c,s,u,a,e[2],15,718787259),a=o(a,c,s,u,e[9],21,-343485551),t[0]=f(u,t[0]),t[1]=f(a,t[1]),t[2]=f(c,t[2]),t[3]=f(s,t[3])}function e(t,e,n,i,r,o){return e=f(f(e,t),f(i,o)),f(e<<r|e>>>32-r,n)}function n(t,n,i,r,o,u,a){return e(n&i|~n&r,t,n,o,u,a)}function i(t,n,i,r,o,u,a){return e(n&r|i&~r,t,n,o,u,a)}function r(t,n,i,r,o,u,a){return e(n^i^r,t,n,o,u,a)}function o(t,n,i,r,o,u,a){return e(i^(n|~r),t,n,o,u,a)}function u(e){txt="";var n,i=e.length,r=[1732584193,-271733879,-1732584194,271733878];for(n=64;n<=e.length;n+=64)t(r,a(e.substring(n-64,n)));e=e.substring(n-64);var o=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(n=0;n<e.length;n++)o[n>>2]|=e.charCodeAt(n)<<(n%4<<3);if(o[n>>2]|=128<<(n%4<<3),n>55)for(t(r,o),n=0;16>n;n++)o[n]=0;return o[14]=8*i,t(r,o),r}function a(t){var e,n=[];for(e=0;64>e;e+=4)n[e>>2]=t.charCodeAt(e)+(t.charCodeAt(e+1)<<8)+(t.charCodeAt(e+2)<<16)+(t.charCodeAt(e+3)<<24);return n}function c(t){for(var e="",n=0;4>n;n++)e+=l[t>>8*n+4&15]+l[t>>8*n&15];return e}function s(t){return function(t){for(var e=0;e<t.length;e++)t[e]=c(t[e]);return t.join("")}(u(t))}function f(t,e){return t+e&4294967295}function f(t,e){var n=(65535&t)+(65535&e),i=(t>>16)+(e>>16)+(n>>16);return i<<16|65535&n}var l="0123456789abcdef".split("");return s("hello"),s})?i.call(e,n,e,t):i)||(t.exports=r)},function(t,e){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(t){"object"==typeof window&&(n=window)}t.exports=n},function(t,e){t.exports=function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}},function(t,e,n){t.exports=function(t){"use strict";var e=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];function n(t,e){var n=t[0],i=t[1],r=t[2],o=t[3];n+=(i&r|~i&o)+e[0]-680876936|0,o+=((n=(n<<7|n>>>25)+i|0)&i|~n&r)+e[1]-389564586|0,r+=((o=(o<<12|o>>>20)+n|0)&n|~o&i)+e[2]+606105819|0,i+=((r=(r<<17|r>>>15)+o|0)&o|~r&n)+e[3]-1044525330|0,n+=((i=(i<<22|i>>>10)+r|0)&r|~i&o)+e[4]-176418897|0,o+=((n=(n<<7|n>>>25)+i|0)&i|~n&r)+e[5]+1200080426|0,r+=((o=(o<<12|o>>>20)+n|0)&n|~o&i)+e[6]-1473231341|0,i+=((r=(r<<17|r>>>15)+o|0)&o|~r&n)+e[7]-45705983|0,n+=((i=(i<<22|i>>>10)+r|0)&r|~i&o)+e[8]+1770035416|0,o+=((n=(n<<7|n>>>25)+i|0)&i|~n&r)+e[9]-1958414417|0,r+=((o=(o<<12|o>>>20)+n|0)&n|~o&i)+e[10]-42063|0,i+=((r=(r<<17|r>>>15)+o|0)&o|~r&n)+e[11]-1990404162|0,n+=((i=(i<<22|i>>>10)+r|0)&r|~i&o)+e[12]+1804603682|0,o+=((n=(n<<7|n>>>25)+i|0)&i|~n&r)+e[13]-40341101|0,r+=((o=(o<<12|o>>>20)+n|0)&n|~o&i)+e[14]-1502002290|0,i+=((r=(r<<17|r>>>15)+o|0)&o|~r&n)+e[15]+1236535329|0,n+=((i=(i<<22|i>>>10)+r|0)&o|r&~o)+e[1]-165796510|0,o+=((n=(n<<5|n>>>27)+i|0)&r|i&~r)+e[6]-1069501632|0,r+=((o=(o<<9|o>>>23)+n|0)&i|n&~i)+e[11]+643717713|0,i+=((r=(r<<14|r>>>18)+o|0)&n|o&~n)+e[0]-373897302|0,n+=((i=(i<<20|i>>>12)+r|0)&o|r&~o)+e[5]-701558691|0,o+=((n=(n<<5|n>>>27)+i|0)&r|i&~r)+e[10]+38016083|0,r+=((o=(o<<9|o>>>23)+n|0)&i|n&~i)+e[15]-660478335|0,i+=((r=(r<<14|r>>>18)+o|0)&n|o&~n)+e[4]-405537848|0,n+=((i=(i<<20|i>>>12)+r|0)&o|r&~o)+e[9]+568446438|0,o+=((n=(n<<5|n>>>27)+i|0)&r|i&~r)+e[14]-1019803690|0,r+=((o=(o<<9|o>>>23)+n|0)&i|n&~i)+e[3]-187363961|0,i+=((r=(r<<14|r>>>18)+o|0)&n|o&~n)+e[8]+1163531501|0,n+=((i=(i<<20|i>>>12)+r|0)&o|r&~o)+e[13]-1444681467|0,o+=((n=(n<<5|n>>>27)+i|0)&r|i&~r)+e[2]-51403784|0,r+=((o=(o<<9|o>>>23)+n|0)&i|n&~i)+e[7]+1735328473|0,i+=((r=(r<<14|r>>>18)+o|0)&n|o&~n)+e[12]-1926607734|0,n+=((i=(i<<20|i>>>12)+r|0)^r^o)+e[5]-378558|0,o+=((n=(n<<4|n>>>28)+i|0)^i^r)+e[8]-2022574463|0,r+=((o=(o<<11|o>>>21)+n|0)^n^i)+e[11]+1839030562|0,i+=((r=(r<<16|r>>>16)+o|0)^o^n)+e[14]-35309556|0,n+=((i=(i<<23|i>>>9)+r|0)^r^o)+e[1]-1530992060|0,o+=((n=(n<<4|n>>>28)+i|0)^i^r)+e[4]+1272893353|0,r+=((o=(o<<11|o>>>21)+n|0)^n^i)+e[7]-155497632|0,i+=((r=(r<<16|r>>>16)+o|0)^o^n)+e[10]-1094730640|0,n+=((i=(i<<23|i>>>9)+r|0)^r^o)+e[13]+681279174|0,o+=((n=(n<<4|n>>>28)+i|0)^i^r)+e[0]-358537222|0,r+=((o=(o<<11|o>>>21)+n|0)^n^i)+e[3]-722521979|0,i+=((r=(r<<16|r>>>16)+o|0)^o^n)+e[6]+76029189|0,n+=((i=(i<<23|i>>>9)+r|0)^r^o)+e[9]-640364487|0,o+=((n=(n<<4|n>>>28)+i|0)^i^r)+e[12]-421815835|0,r+=((o=(o<<11|o>>>21)+n|0)^n^i)+e[15]+530742520|0,i+=((r=(r<<16|r>>>16)+o|0)^o^n)+e[2]-995338651|0,n+=(r^((i=(i<<23|i>>>9)+r|0)|~o))+e[0]-198630844|0,o+=(i^((n=(n<<6|n>>>26)+i|0)|~r))+e[7]+1126891415|0,r+=(n^((o=(o<<10|o>>>22)+n|0)|~i))+e[14]-1416354905|0,i+=(o^((r=(r<<15|r>>>17)+o|0)|~n))+e[5]-57434055|0,n+=(r^((i=(i<<21|i>>>11)+r|0)|~o))+e[12]+1700485571|0,o+=(i^((n=(n<<6|n>>>26)+i|0)|~r))+e[3]-1894986606|0,r+=(n^((o=(o<<10|o>>>22)+n|0)|~i))+e[10]-1051523|0,i+=(o^((r=(r<<15|r>>>17)+o|0)|~n))+e[1]-2054922799|0,n+=(r^((i=(i<<21|i>>>11)+r|0)|~o))+e[8]+1873313359|0,o+=(i^((n=(n<<6|n>>>26)+i|0)|~r))+e[15]-30611744|0,r+=(n^((o=(o<<10|o>>>22)+n|0)|~i))+e[6]-1560198380|0,i+=(o^((r=(r<<15|r>>>17)+o|0)|~n))+e[13]+1309151649|0,n+=(r^((i=(i<<21|i>>>11)+r|0)|~o))+e[4]-145523070|0,o+=(i^((n=(n<<6|n>>>26)+i|0)|~r))+e[11]-1120210379|0,r+=(n^((o=(o<<10|o>>>22)+n|0)|~i))+e[2]+718787259|0,i=((i+=(o^((r=(r<<15|r>>>17)+o|0)|~n))+e[9]-343485551|0)<<21|i>>>11)+r|0,t[0]=n+t[0]|0,t[1]=i+t[1]|0,t[2]=r+t[2]|0,t[3]=o+t[3]|0}function i(t){var e,n=[];for(e=0;e<64;e+=4)n[e>>2]=t.charCodeAt(e)+(t.charCodeAt(e+1)<<8)+(t.charCodeAt(e+2)<<16)+(t.charCodeAt(e+3)<<24);return n}function r(t){var e,n=[];for(e=0;e<64;e+=4)n[e>>2]=t[e]+(t[e+1]<<8)+(t[e+2]<<16)+(t[e+3]<<24);return n}function o(t){var e,r,o,u,a,c,s=t.length,f=[1732584193,-271733879,-1732584194,271733878];for(e=64;e<=s;e+=64)n(f,i(t.substring(e-64,e)));for(t=t.substring(e-64),r=t.length,o=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],e=0;e<r;e+=1)o[e>>2]|=t.charCodeAt(e)<<(e%4<<3);if(o[e>>2]|=128<<(e%4<<3),e>55)for(n(f,o),e=0;e<16;e+=1)o[e]=0;return u=(u=8*s).toString(16).match(/(.*?)(.{0,8})$/),a=parseInt(u[2],16),c=parseInt(u[1],16)||0,o[14]=a,o[15]=c,n(f,o),f}function u(t){var n,i="";for(n=0;n<4;n+=1)i+=e[t>>8*n+4&15]+e[t>>8*n&15];return i}function a(t){var e;for(e=0;e<t.length;e+=1)t[e]=u(t[e]);return t.join("")}function c(t){return/[\u0080-\uFFFF]/.test(t)&&(t=unescape(encodeURIComponent(t))),t}function s(t){var e,n=[],i=t.length;for(e=0;e<i-1;e+=2)n.push(parseInt(t.substr(e,2),16));return String.fromCharCode.apply(String,n)}function f(){this.reset()}return a(o("hello")),"undefined"==typeof ArrayBuffer||ArrayBuffer.prototype.slice||function(){function e(t,e){return(t=0|t||0)<0?Math.max(t+e,0):Math.min(t,e)}ArrayBuffer.prototype.slice=function(n,i){var r,o,u,a,c=this.byteLength,s=e(n,c),f=c;return i!==t&&(f=e(i,c)),s>f?new ArrayBuffer(0):(r=f-s,o=new ArrayBuffer(r),u=new Uint8Array(o),a=new Uint8Array(this,s,r),u.set(a),o)}}(),f.prototype.append=function(t){return this.appendBinary(c(t)),this},f.prototype.appendBinary=function(t){this._buff+=t,this._length+=t.length;var e,r=this._buff.length;for(e=64;e<=r;e+=64)n(this._hash,i(this._buff.substring(e-64,e)));return this._buff=this._buff.substring(e-64),this},f.prototype.end=function(t){var e,n,i=this._buff,r=i.length,o=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(e=0;e<r;e+=1)o[e>>2]|=i.charCodeAt(e)<<(e%4<<3);return this._finish(o,r),n=a(this._hash),t&&(n=s(n)),this.reset(),n},f.prototype.reset=function(){return this._buff="",this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},f.prototype.getState=function(){return{buff:this._buff,length:this._length,hash:this._hash}},f.prototype.setState=function(t){return this._buff=t.buff,this._length=t.length,this._hash=t.hash,this},f.prototype.destroy=function(){delete this._hash,delete this._buff,delete this._length},f.prototype._finish=function(t,e){var i,r,o,u=e;if(t[u>>2]|=128<<(u%4<<3),u>55)for(n(this._hash,t),u=0;u<16;u+=1)t[u]=0;i=(i=8*this._length).toString(16).match(/(.*?)(.{0,8})$/),r=parseInt(i[2],16),o=parseInt(i[1],16)||0,t[14]=r,t[15]=o,n(this._hash,t)},f.hash=function(t,e){return f.hashBinary(c(t),e)},f.hashBinary=function(t,e){var n=a(o(t));return e?s(n):n},f.ArrayBuffer=function(){this.reset()},f.ArrayBuffer.prototype.append=function(t){var e,i,o,u,a,c=(i=this._buff.buffer,o=t,u=!0,(a=new Uint8Array(i.byteLength+o.byteLength)).set(new Uint8Array(i)),a.set(new Uint8Array(o),i.byteLength),u?a:a.buffer),s=c.length;for(this._length+=t.byteLength,e=64;e<=s;e+=64)n(this._hash,r(c.subarray(e-64,e)));return this._buff=e-64<s?new Uint8Array(c.buffer.slice(e-64)):new Uint8Array(0),this},f.ArrayBuffer.prototype.end=function(t){var e,n,i=this._buff,r=i.length,o=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(e=0;e<r;e+=1)o[e>>2]|=i[e]<<(e%4<<3);return this._finish(o,r),n=a(this._hash),t&&(n=s(n)),this.reset(),n},f.ArrayBuffer.prototype.reset=function(){return this._buff=new Uint8Array(0),this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},f.ArrayBuffer.prototype.getState=function(){var t,e=f.prototype.getState.call(this);return e.buff=(t=e.buff,String.fromCharCode.apply(null,new Uint8Array(t))),e},f.ArrayBuffer.prototype.setState=function(t){return t.buff=function(t,e){var n,i=t.length,r=new ArrayBuffer(i),o=new Uint8Array(r);for(n=0;n<i;n+=1)o[n]=t.charCodeAt(n);return e?o:r}(t.buff,!0),f.prototype.setState.call(this,t)},f.ArrayBuffer.prototype.destroy=f.prototype.destroy,f.ArrayBuffer.prototype._finish=f.prototype._finish,f.ArrayBuffer.hash=function(t,e){var i=a(function(t){var e,i,o,u,a,c,s=t.length,f=[1732584193,-271733879,-1732584194,271733878];for(e=64;e<=s;e+=64)n(f,r(t.subarray(e-64,e)));for(t=e-64<s?t.subarray(e-64):new Uint8Array(0),i=t.length,o=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],e=0;e<i;e+=1)o[e>>2]|=t[e]<<(e%4<<3);if(o[e>>2]|=128<<(e%4<<3),e>55)for(n(f,o),e=0;e<16;e+=1)o[e]=0;return u=(u=8*s).toString(16).match(/(.*?)(.{0,8})$/),a=parseInt(u[2],16),c=parseInt(u[1],16)||0,o[14]=a,o[15]=c,n(f,o),f}(new Uint8Array(t)));return e?s(i):i},f}()},function(t,e){function n(e,i){return t.exports=n=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},n(e,i)}t.exports=n},function(t,e,n){"use strict";n.d(e,"a",function(){return i});class i{constructor(t){this.message=t}}},function(t,e,n){"use strict";(function(t){var i=n(25),r=n.n(i),o=n(9),u=n.n(o),a=n(8),c=n.n(a),s=n(6),f=n(7),l=n.n(f),h=n(19),d=n.n(h),v=n(20),p=n.n(v),y=n(15),g=n.n(y),b=n(21),w=n.n(b),m="function"==typeof Promise?Promise:r.a;function _(t){if(t instanceof ArrayBuffer)return function(t){if("function"==typeof t.slice)return t.slice(0);var e=new ArrayBuffer(t.byteLength),n=new Uint8Array(e),i=new Uint8Array(t);return n.set(i),e}(t);var e=t.size,n=t.type;return"function"==typeof t.slice?t.slice(0,e,n):t.webkitSlice(0,e,n)}var k,A,x=Function.prototype.toString,E=x.call(Object);function L(t){var e,n,i;if(!t||"object"!=typeof t)return t;if(Array.isArray(t)){for(e=[],n=0,i=t.length;n<i;n++)e[n]=L(t[n]);return e}if(t instanceof Date)return t.toISOString();if(function(t){return"undefined"!=typeof ArrayBuffer&&t instanceof ArrayBuffer||"undefined"!=typeof Blob&&t instanceof Blob}(t))return _(t);if(!function(t){var e=Object.getPrototypeOf(t);if(null===e)return!0;var n=e.constructor;return"function"==typeof n&&n instanceof n&&x.call(n)==E}(t))return t;for(n in e={},t)if(Object.prototype.hasOwnProperty.call(t,n)){var r=L(t[n]);void 0!==r&&(e[n]=r)}return e}function O(t){var e=!1;return u()(function(n){if(e)throw new Error("once called more than once");e=!0,t.apply(this,n)})}function M(t){return u()(function(e){e=L(e);var n=this,i="function"==typeof e[e.length-1]&&e.pop(),r=new m(function(i,r){var o;try{var u=O(function(t,e){t?r(t):i(e)});e.push(u),(o=t.apply(n,e))&&"function"==typeof o.then&&i(o)}catch(t){r(t)}});return i&&r.then(function(t){i(null,t)},i),r})}function T(t,e){return M(u()(function(n){if(this._closed)return m.reject(new Error("database is closed"));if(this._destroyed)return m.reject(new Error("database is destroyed"));var i=this;return function(t,e,n){if(t.constructor.listeners("debug").length){for(var i=["api",t.name,e],r=0;r<n.length-1;r++)i.push(n[r]);t.constructor.emit("debug",i);var o=n[n.length-1];n[n.length-1]=function(n,i){var r=["api",t.name,e];r=r.concat(n?["error",n]:["success",i]),t.constructor.emit("debug",r),o(n,i)}}}(i,t,n),this.taskqueue.isReady?e.apply(this,n):new m(function(e,r){i.taskqueue.addTask(function(o){o?r(o):e(i[t].apply(i,n))})})}))}function q(t){return"$"+t}function P(t){return t.substring(1)}function S(){this._store={}}function F(t){if(this._store=new S,t&&Array.isArray(t))for(var e=0,n=t.length;e<n;e++)this.add(t[e])}function j(t,e){for(var n={},i=0,r=e.length;i<r;i++){var o=e[i];o in t&&(n[o]=t[o])}return n}S.prototype.get=function(t){var e=q(t);return this._store[e]},S.prototype.set=function(t,e){var n=q(t);return this._store[n]=e,!0},S.prototype.has=function(t){return q(t)in this._store},S.prototype.delete=function(t){var e=q(t),n=e in this._store;return delete this._store[e],n},S.prototype.forEach=function(t){for(var e=Object.keys(this._store),n=0,i=e.length;n<i;n++){var r=e[n];t(this._store[r],r=P(r))}},Object.defineProperty(S.prototype,"size",{get:function(){return Object.keys(this._store).length}}),F.prototype.add=function(t){return this._store.set(t,!0)},F.prototype.has=function(t){return this._store.has(t)},F.prototype.forEach=function(t){this._store.forEach(function(e,n){t(n)})},Object.defineProperty(F.prototype,"size",{get:function(){return this._store.size}}),!function(){if("undefined"==typeof Symbol||"undefined"==typeof Map||"undefined"==typeof Set)return!1;var t=Object.getOwnPropertyDescriptor(Map,Symbol.species);return t&&"get"in t&&Map[Symbol.species]===Map}()?(k=F,A=S):(k=Set,A=Map);var U,D=6;function R(t){return t}function B(t){return[{ok:t}]}function C(t,e,n){var i=e.docs,r=new A;i.forEach(function(t){r.has(t.id)?r.get(t.id).push(t):r.set(t.id,[t])});var o=r.size,u=0,a=new Array(o);function c(){var t;++u===o&&(t=[],a.forEach(function(e){e.docs.forEach(function(n){t.push({id:e.id,docs:[n]})})}),n(null,{results:t}))}var s=[];r.forEach(function(t,e){s.push(e)});var f=0;function l(){if(!(f>=s.length)){var n=Math.min(f+D,s.length),i=s.slice(f,n);!function(n,i){n.forEach(function(n,o){var u=i+o,s=r.get(n),f=j(s[0],["atts_since","attachments"]);f.open_revs=s.map(function(t){return t.rev}),f.open_revs=f.open_revs.filter(R);var h=R;0===f.open_revs.length&&(delete f.open_revs,h=B),["revs","attachments","binary","ajax","latest"].forEach(function(t){t in e&&(f[t]=e[t])}),t.get(n,f,function(t,e){var i,r,o;i=t?[{error:t}]:h(e),r=n,o=i,a[u]={id:r,docs:o},c(),l()})})}(i,f),f+=i.length}}l()}function W(){return"undefined"!=typeof chrome&&void 0!==chrome.storage&&void 0!==chrome.storage.local}if(W())U=!1;else try{localStorage.setItem("_pouch_check_localstorage",1),U=!!localStorage.getItem("_pouch_check_localstorage")}catch(t){U=!1}function N(){return U}function $(){var t;s.EventEmitter.call(this),this._listeners={},t=this,W()?chrome.storage.onChanged.addListener(function(e){null!=e.db_name&&t.emit(e.dbName.newValue)}):N()&&("undefined"!=typeof addEventListener?addEventListener("storage",function(e){t.emit(e.key)}):window.attachEvent("storage",function(e){t.emit(e.key)}))}function J(t){if("undefined"!=typeof console&&"function"==typeof console[t]){var e=Array.prototype.slice.call(arguments,1);console[t].apply(console,e)}}function H(t){var e=0;return t||(e=2e3),function(t,e){return t=parseInt(t,10)||0,(e=parseInt(e,10))!=e||e<=t?e=(t||1)<<1:e+=1,e>6e5&&(t=3e5,e=6e5),~~((e-t)*Math.random()+t)}(t,e)}function X(t,e){J("info","The above "+t+" is totally normal. "+e)}l()($,s.EventEmitter),$.prototype.addListener=function(t,e,n,i){if(!this._listeners[e]){var r=this,o=!1;this._listeners[e]=u,this.on(t,u)}function u(){if(r._listeners[e])if(o)o="waiting";else{o=!0;var t=j(i,["style","include_docs","attachments","conflicts","filter","doc_ids","view","since","query_params","binary"]);n.changes(t).on("change",function(t){t.seq>i.since&&!i.cancelled&&(i.since=t.seq,i.onChange(t))}).on("complete",function(){"waiting"===o&&c()(u),o=!1}).on("error",function(){o=!1})}}},$.prototype.removeListener=function(t,e){e in this._listeners&&(s.EventEmitter.prototype.removeListener.call(this,t,this._listeners[e]),delete this._listeners[e])},$.prototype.notifyLocalWindows=function(t){W()?chrome.storage.local.set({dbName:t}):N()&&(localStorage[t]="a"===localStorage[t]?"b":"a")},$.prototype.notify=function(t){this.emit(t),this.notifyLocalWindows(t)};var K="function"==typeof Object.assign?Object.assign:function(t){for(var e=Object(t),n=1;n<arguments.length;n++){var i=arguments[n];if(null!=i)for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(e[r]=i[r])}return e};function G(t,e,n){Error.call(this,n),this.status=t,this.name=e,this.message=n,this.error=!0}l()(G,Error),G.prototype.toString=function(){return JSON.stringify({status:this.status,name:this.name,message:this.message,reason:this.reason})};new G(401,"unauthorized","Name or password is incorrect.");var Z=new G(400,"bad_request","Missing JSON list of 'docs'"),V=new G(404,"not_found","missing"),Y=new G(409,"conflict","Document update conflict"),z=new G(400,"bad_request","_id field must contain a string"),I=new G(412,"missing_id","_id is required for puts"),Q=new G(400,"bad_request","Only reserved document ids may start with underscore."),tt=(new G(412,"precondition_failed","Database not open"),new G(500,"unknown_error","Database encountered an unknown error")),et=new G(500,"badarg","Some query argument is invalid"),nt=(new G(400,"invalid_request","Request was invalid"),new G(400,"query_parse_error","Some query parameter is invalid")),it=new G(500,"doc_validation","Bad special document member"),rt=new G(400,"bad_request","Something wrong with the request"),ot=new G(400,"bad_request","Document must be a JSON object"),ut=(new G(404,"not_found","Database not found"),new G(500,"indexed_db_went_bad","unknown")),at=new G(500,"web_sql_went_bad","unknown"),ct=(new G(500,"levelDB_went_went_bad","unknown"),new G(403,"forbidden","Forbidden by design doc validate_doc_update function"),new G(400,"bad_request","Invalid rev format")),st=(new G(412,"file_exists","The database could not be created, the file already exists."),new G(412,"missing_stub","A pre-existing attachment stub wasn't found"));new G(413,"invalid_url","Provided URL is invalid");function ft(t,e){function n(e){for(var n in t)"function"!=typeof t[n]&&(this[n]=t[n]);void 0!==e&&(this.reason=e)}return n.prototype=G.prototype,new n(e)}function lt(t){if("object"!=typeof t){var e=t;(t=tt).data=e}return"error"in t&&"conflict"===t.error&&(t.name="conflict",t.status=409),"name"in t||(t.name=t.error||"unknown"),"status"in t||(t.status=500),"message"in t||(t.message=t.message||t.reason),t}function ht(t){var e={},n=t.filter&&"function"==typeof t.filter;return e.query=t.query_params,function(i){i.doc||(i.doc={});var r=n&&function(t,e,n){try{return!t(e,n)}catch(t){var i="Filter function threw: "+t.toString();return ft(rt,i)}}(t.filter,i.doc,e);if("object"==typeof r)return r;if(r)return!1;if(t.include_docs){if(!t.attachments)for(var o in i.doc._attachments)i.doc._attachments.hasOwnProperty(o)&&(i.doc._attachments[o].stub=!0)}else delete i.doc;return!0}}function dt(t){for(var e=[],n=0,i=t.length;n<i;n++)e=e.concat(t[n]);return e}function vt(t){var e;if(t?"string"!=typeof t?e=ft(z):/^_/.test(t)&&!/^_(design|local)/.test(t)&&(e=ft(Q)):e=ft(I),e)throw e}function pt(t){return"boolean"==typeof t._remote?t._remote:"function"==typeof t.type&&(J("warn","db.type() is deprecated and will be removed in a future version of PouchDB"),"http"===t.type())}function yt(t){if(!t)return null;var e=t.split("/");return 2===e.length?e:1===e.length?[t,t]:null}function gt(t){var e=yt(t);return e?e.join("/"):null}var bt=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],wt="queryKey",mt=/(?:^|&)([^&=]*)=?([^&]*)/g,_t=/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/;function kt(t){for(var e=_t.exec(t),n={},i=14;i--;){var r=bt[i],o=e[i]||"",u=-1!==["user","password"].indexOf(r);n[r]=u?decodeURIComponent(o):o}return n[wt]={},n[bt[12]].replace(mt,function(t,e,i){e&&(n[wt][e]=i)}),n}function At(t,e){var n=[],i=[];for(var r in e)e.hasOwnProperty(r)&&(n.push(r),i.push(e[r]));return n.push(t),Function.apply(null,n).apply(null,i)}function xt(t,e,n){return new m(function(i,r){t.get(e,function(o,u){if(o){if(404!==o.status)return r(o);u={}}var a=u._rev,c=n(u);if(!c)return i({updated:!1,rev:a});c._id=e,c._rev=a,i(function(t,e,n){return t.put(e).then(function(t){return{updated:!0,rev:t.rev}},function(i){if(409!==i.status)throw i;return xt(t,e._id,n)})}(t,c,n))})})}function Et(){return d.a.v4().replace(/-/g,"").toLowerCase()}var Lt=d.a.v4;function Ot(t){for(var e,n,i,r,o=t.rev_tree.slice();r=o.pop();){var u=r.ids,a=u[2],c=r.pos;if(a.length)for(var s=0,f=a.length;s<f;s++)o.push({pos:c+1,ids:a[s]});else{var l=!!u[1].deleted,h=u[0];e&&!(i!==l?i:n!==c?n<c:e<h)||(e=h,n=c,i=l)}}return n+"-"+e}function Mt(t,e){for(var n,i=t.slice();n=i.pop();)for(var r=n.pos,o=n.ids,u=o[2],a=e(0===u.length,r,o[0],n.ctx,o[1]),c=0,s=u.length;c<s;c++)i.push({pos:r+1,ids:u[c],ctx:a})}function Tt(t,e){return t.pos-e.pos}function qt(t){var e=[];Mt(t,function(t,n,i,r,o){t&&e.push({rev:n+"-"+i,pos:n,opts:o})}),e.sort(Tt).reverse();for(var n=0,i=e.length;n<i;n++)delete e[n].pos;return e}function Pt(t){for(var e=Ot(t),n=qt(t.rev_tree),i=[],r=0,o=n.length;r<o;r++){var u=n[r];u.rev===e||u.opts.deleted||i.push(u.rev)}return i}function St(t){var e=[];return Mt(t.rev_tree,function(t,n,i,r,o){"available"!==o.status||t||(e.push(n+"-"+i),o.status="missing")}),e}function Ft(t){for(var e,n=[],i=t.slice();e=i.pop();){var r=e.pos,o=e.ids,u=o[0],a=o[1],c=o[2],s=0===c.length,f=e.history?e.history.slice():[];f.push({id:u,opts:a}),s&&n.push({pos:r+1-f.length,ids:f});for(var l=0,h=c.length;l<h;l++)i.push({pos:r+1,ids:c[l],history:f})}return n.reverse()}function jt(t,e){return t.pos-e.pos}function Ut(t,e,n){var i=function(t,e,n){for(var i,r=0,o=t.length;r<o;)n(t[i=r+o>>>1],e)<0?r=i+1:o=i;return r}(t,e,n);t.splice(i,0,e)}function Dt(t,e){for(var n,i,r=e,o=t.length;r<o;r++){var u=t[r],a=[u.id,u.opts,[]];i?(i[2].push(a),i=a):n=i=a}return n}function Rt(t,e){return t[0]<e[0]?-1:1}function Bt(t,e){for(var n=[{tree1:t,tree2:e}],i=!1;n.length>0;){var r=n.pop(),o=r.tree1,u=r.tree2;(o[1].status||u[1].status)&&(o[1].status="available"===o[1].status||"available"===u[1].status?"available":"missing");for(var a=0;a<u[2].length;a++)if(o[2][0]){for(var c=!1,s=0;s<o[2].length;s++)o[2][s][0]===u[2][a][0]&&(n.push({tree1:o[2][s],tree2:u[2][a]}),c=!0);c||(i="new_branch",Ut(o[2],u[2][a],Rt))}else i="new_leaf",o[2][0]=u[2][a]}return{conflicts:i,tree:t}}function Ct(t,e,n){var i,r=[],o=!1,u=!1;if(!t.length)return{tree:[e],conflicts:"new_leaf"};for(var a=0,c=t.length;a<c;a++){var s=t[a];if(s.pos===e.pos&&s.ids[0]===e.ids[0])i=Bt(s.ids,e.ids),r.push({pos:s.pos,ids:i.tree}),o=o||i.conflicts,u=!0;else if(!0!==n){var f=s.pos<e.pos?s:e,l=s.pos<e.pos?e:s,h=l.pos-f.pos,d=[],v=[];for(v.push({ids:f.ids,diff:h,parent:null,parentIdx:null});v.length>0;){var p=v.pop();if(0!==p.diff)for(var y=p.ids[2],g=0,b=y.length;g<b;g++)v.push({ids:y[g],diff:p.diff-1,parent:p.ids,parentIdx:g});else p.ids[0]===l.ids[0]&&d.push(p)}var w=d[0];w?(i=Bt(w.ids,l.ids),w.parent[2][w.parentIdx]=i.tree,r.push({pos:f.pos,ids:f.ids}),o=o||i.conflicts,u=!0):r.push(s)}else r.push(s)}return u||r.push(e),r.sort(jt),{tree:r,conflicts:o||"internal_node"}}function Wt(t,e,n){var i=Ct(t,e),r=function(t,e){for(var n,i,r=Ft(t),o=0,u=r.length;o<u;o++){var a,c=r[o],s=c.ids;if(s.length>e){n||(n={});var f=s.length-e;a={pos:c.pos+f,ids:Dt(s,f)};for(var l=0;l<f;l++){var h=c.pos+l+"-"+s[l].id;n[h]=!0}}else a={pos:c.pos,ids:Dt(s,0)};i=i?Ct(i,a,!0).tree:[a]}return n&&Mt(i,function(t,e,i){delete n[e+"-"+i]}),{tree:i,revs:n?Object.keys(n):[]}}(i.tree,n);return{tree:r.tree,stemmedRevs:r.revs,conflicts:i.conflicts}}function Nt(t){return t.ids}function $t(t,e){e||(e=Ot(t));for(var n,i=e.substring(e.indexOf("-")+1),r=t.rev_tree.map(Nt);n=r.pop();){if(n[0]===i)return!!n[1].deleted;r=r.concat(n[2])}}function Jt(t){return/^_local/.test(t)}function Ht(t,e){for(var n,i=e.rev_tree.slice();n=i.pop();){var r=n.pos,o=n.ids,u=o[0],a=o[1],c=o[2],s=0===c.length,f=n.history?n.history.slice():[];if(f.push({id:u,pos:r,opts:a}),s)for(var l=0,h=f.length;l<h;l++){var d=f[l];if(d.pos+"-"+d.id===t)return r+"-"+u}for(var v=0,p=c.length;v<p;v++)i.push({pos:r+1,ids:c[v],history:f})}throw new Error("Unable to resolve latest revision for id "+e.id+", rev "+t)}function Xt(t,e,n){s.EventEmitter.call(this);var i=this;this.db=t;var r=(e=e?L(e):{}).complete=O(function(e,n){var r,u;e?(u="error",("listenerCount"in(r=i)?r.listenerCount(u):s.EventEmitter.listenerCount(r,u))>0&&i.emit("error",e)):i.emit("complete",n),i.removeAllListeners(),t.removeListener("destroyed",o)});function o(){i.cancel()}n&&(i.on("complete",function(t){n(null,t)}),i.on("error",n)),t.once("destroyed",o),e.onChange=function(t,e,n){i.isCancelled||function(t,e,n,i){try{t.emit("change",e,n,i)}catch(t){J("error",'Error in .on("change", function):',t)}}(i,t,e,n)};var u=new m(function(t,n){e.complete=function(e,i){e?n(e):t(i)}});i.once("cancel",function(){t.removeListener("destroyed",o),e.complete(null,{status:"cancelled"})}),this.then=u.then.bind(u),this.catch=u.catch.bind(u),this.then(function(t){r(null,t)},r),t.taskqueue.isReady?i.validateChanges(e):t.taskqueue.addTask(function(t){t?e.complete(t):i.isCancelled?i.emit("cancel"):i.validateChanges(e)})}function Kt(t,e,n){var i=[{rev:t._rev}];"all_docs"===n.style&&(i=qt(e.rev_tree).map(function(t){return{rev:t.rev}}));var r={id:e.id,changes:i,doc:t};return $t(e,t._rev)&&(r.deleted=!0),n.conflicts&&(r.doc._conflicts=Pt(e),r.doc._conflicts.length||delete r.doc._conflicts),r}function Gt(t,e){return t<e?-1:t>e?1:0}function Zt(t,e){return function(n,i){n||i[0]&&i[0].error?((n=n||i[0]).docId=e,t(n)):t(null,i.length?i[0]:i)}}function Vt(t,e){var n=Gt(t._id,e._id);return 0!==n?n:Gt(t._revisions?t._revisions.start:0,e._revisions?e._revisions.start:0)}function Yt(){s.EventEmitter.call(this)}function zt(){this.isReady=!1,this.failed=!1,this.queue=[]}function It(t,e){if(!(this instanceof It))return new It(t,e);var n=this;if(e=e||{},t&&"object"==typeof t&&(t=(e=t).name,delete e.name),this.__opts=e=L(e),n.auto_compaction=e.auto_compaction,n.prefix=It.prefix,"string"!=typeof t)throw new Error("Missing/invalid DB name");var i=function(t,e){var n=t.match(/([a-z-]*):\/\/(.*)/);if(n)return{name:/https?/.test(n[1])?n[1]+"://"+n[2]:n[2],adapter:n[1]};var i=It.adapters,r=It.preferredAdapters,o=It.prefix,u=e.adapter;if(!u)for(var a=0;a<r.length&&"idb"===(u=r[a])&&"websql"in i&&N()&&localStorage["_pouch__websqldb_"+o+t];++a)J("log",'PouchDB is downgrading "'+t+'" to WebSQL to avoid data loss, because it was already opened with WebSQL.');var c=i[u];return{name:c&&"use_prefix"in c&&!c.use_prefix?t:o+t,adapter:u}}((e.prefix||"")+t,e);if(e.name=i.name,e.adapter=e.adapter||i.adapter,n.name=t,n._adapter=e.adapter,It.emit("debug",["adapter","Picked adapter: ",e.adapter]),!It.adapters[e.adapter]||!It.adapters[e.adapter].valid())throw new Error("Invalid Adapter: "+e.adapter);Yt.call(n),n.taskqueue=new zt,n.adapter=e.adapter,It.adapters[e.adapter].call(n,e,function(t){if(t)return n.taskqueue.fail(t);!function(t){function e(e){t.removeListener("closed",n),e||t.constructor.emit("destroyed",t.name)}function n(){t.removeListener("destroyed",e),t.constructor.emit("unref",t)}t.once("destroyed",e),t.once("closed",n),t.constructor.emit("ref",t)}(n),n.emit("created",n),It.emit("created",n.name),n.taskqueue.ready(n)})}l()(Xt,s.EventEmitter),Xt.prototype.cancel=function(){this.isCancelled=!0,this.db.taskqueue.isReady&&this.emit("cancel")},Xt.prototype.validateChanges=function(t){var e=t.complete,n=this;It._changesFilterPlugin?It._changesFilterPlugin.validate(t,function(i){if(i)return e(i);n.doChanges(t)}):n.doChanges(t)},Xt.prototype.doChanges=function(t){var e=this,n=t.complete;if("live"in(t=L(t))&&!("continuous"in t)&&(t.continuous=t.live),t.processChange=Kt,"latest"===t.since&&(t.since="now"),t.since||(t.since=0),"now"!==t.since){if(It._changesFilterPlugin){if(It._changesFilterPlugin.normalize(t),It._changesFilterPlugin.shouldFilter(this,t))return It._changesFilterPlugin.filter(this,t)}else["doc_ids","filter","selector","view"].forEach(function(e){e in t&&J("warn",'The "'+e+'" option was passed in to changes/replicate, but pouchdb-changes-filter plugin is not installed, so it was ignored. Please install the plugin to enable filtering.')});"descending"in t||(t.descending=!1),t.limit=0===t.limit?1:t.limit,t.complete=n;var i=this.db._changes(t);if(i&&"function"==typeof i.cancel){var r=e.cancel;e.cancel=u()(function(t){i.cancel(),r.apply(this,t)})}}else this.db.info().then(function(i){e.isCancelled?n(null,{status:"cancelled"}):(t.since=i.update_seq,e.doChanges(t))},n)},l()(Yt,s.EventEmitter),Yt.prototype.post=T("post",function(t,e,n){if("function"==typeof e&&(n=e,e={}),"object"!=typeof t||Array.isArray(t))return n(ft(ot));this.bulkDocs({docs:[t]},e,Zt(n,t._id))}),Yt.prototype.put=T("put",function(t,e,n){if("function"==typeof e&&(n=e,e={}),"object"!=typeof t||Array.isArray(t))return n(ft(ot));if(vt(t._id),Jt(t._id)&&"function"==typeof this._putLocal)return t._deleted?this._removeLocal(t,n):this._putLocal(t,n);var i,r,o,u,a=this;function c(n){"function"==typeof a._put&&!1!==e.new_edits?a._put(t,e,n):a.bulkDocs({docs:[t]},e,Zt(n,t._id))}e.force&&t._rev?(i=t._rev.split("-"),r=i[1],o=parseInt(i[0],10)+1,u=Et(),t._revisions={start:o,ids:[u,r]},t._rev=o+"-"+u,e.new_edits=!1,c(function(e){var i=e?null:{ok:!0,id:t._id,rev:t._rev};n(e,i)})):c(n)}),Yt.prototype.putAttachment=T("putAttachment",function(t,e,n,i,r){var o=this;function u(t){var n="_rev"in t?parseInt(t._rev,10):0;return t._attachments=t._attachments||{},t._attachments[e]={content_type:r,data:i,revpos:++n},o.put(t)}return"function"==typeof r&&(r=i,i=n,n=null),void 0===r&&(r=i,i=n,n=null),r||J("warn","Attachment",e,"on document",t,"is missing content_type"),o.get(t).then(function(t){if(t._rev!==n)throw ft(Y);return u(t)},function(e){if(e.reason===V.message)return u({_id:t});throw e})}),Yt.prototype.removeAttachment=T("removeAttachment",function(t,e,n,i){var r=this;r.get(t,function(t,o){if(t)i(t);else if(o._rev===n){if(!o._attachments)return i();delete o._attachments[e],0===Object.keys(o._attachments).length&&delete o._attachments,r.put(o,i)}else i(ft(Y))})}),Yt.prototype.remove=T("remove",function(t,e,n,i){var r;"string"==typeof e?(r={_id:t,_rev:e},"function"==typeof n&&(i=n,n={})):(r=t,"function"==typeof e?(i=e,n={}):(i=n,n=e)),(n=n||{}).was_delete=!0;var o={_id:r._id,_rev:r._rev||n.rev,_deleted:!0};if(Jt(o._id)&&"function"==typeof this._removeLocal)return this._removeLocal(r,i);this.bulkDocs({docs:[o]},n,Zt(i,o._id))}),Yt.prototype.revsDiff=T("revsDiff",function(t,e,n){"function"==typeof e&&(n=e,e={});var i=Object.keys(t);if(!i.length)return n(null,{});var r=0,o=new A;function u(t,e){o.has(t)||o.set(t,{missing:[]}),o.get(t).missing.push(e)}i.map(function(e){this._getRevisionTree(e,function(a,c){if(a&&404===a.status&&"missing"===a.message)o.set(e,{missing:t[e]});else{if(a)return n(a);!function(e,n){var i=t[e].slice(0);Mt(n,function(t,n,r,o,a){var c=n+"-"+r,s=i.indexOf(c);-1!==s&&(i.splice(s,1),"available"!==a.status&&u(e,c))}),i.forEach(function(t){u(e,t)})}(e,c)}if(++r===i.length){var s={};return o.forEach(function(t,e){s[e]=t}),n(null,s)}})},this)}),Yt.prototype.bulkGet=T("bulkGet",function(t,e){C(this,t,e)}),Yt.prototype.compactDocument=T("compactDocument",function(t,e,n){var i=this;this._getRevisionTree(t,function(r,o){if(r)return n(r);var u=function(t){var e={},n=[];return Mt(t,function(t,i,r,o){var u=i+"-"+r;return t&&(e[u]=0),void 0!==o&&n.push({from:o,to:u}),u}),n.reverse(),n.forEach(function(t){void 0===e[t.from]?e[t.from]=1+e[t.to]:e[t.from]=Math.min(e[t.from],1+e[t.to])}),e}(o),a=[],c=[];Object.keys(u).forEach(function(t){u[t]>e&&a.push(t)}),Mt(o,function(t,e,n,i,r){var o=e+"-"+n;"available"===r.status&&-1!==a.indexOf(o)&&c.push(o)}),i._doCompaction(t,c,n)})}),Yt.prototype.compact=T("compact",function(t,e){"function"==typeof t&&(e=t,t={});t=t||{},this._compactionQueue=this._compactionQueue||[],this._compactionQueue.push({opts:t,callback:e}),1===this._compactionQueue.length&&function t(e){var n=e._compactionQueue[0],i=n.opts,r=n.callback;e.get("_local/compaction").catch(function(){return!1}).then(function(n){n&&n.last_seq&&(i.last_seq=n.last_seq),e._compact(i,function(n,i){n?r(n):r(null,i),c()(function(){e._compactionQueue.shift(),e._compactionQueue.length&&t(e)})})})}(this)}),Yt.prototype._compact=function(t,e){var n=this,i={return_docs:!1,last_seq:t.last_seq||0},r=[];n.changes(i).on("change",function(t){r.push(n.compactDocument(t.id,0))}).on("complete",function(t){var i=t.last_seq;m.all(r).then(function(){return xt(n,"_local/compaction",function(t){return(!t.last_seq||t.last_seq<i)&&(t.last_seq=i,t)})}).then(function(){e(null,{ok:!0})}).catch(e)}).on("error",e)},Yt.prototype.get=T("get",function(t,e,n){if("function"==typeof e&&(n=e,e={}),"string"!=typeof t)return n(ft(z));if(Jt(t)&&"function"==typeof this._getLocal)return this._getLocal(t,n);var i=[],r=this;function o(){var o=[],u=i.length;if(!u)return n(null,o);i.forEach(function(i){r.get(t,{rev:i,revs:e.revs,latest:e.latest,attachments:e.attachments,binary:e.binary},function(t,e){if(t)o.push({missing:i});else{for(var r,a=0,c=o.length;a<c;a++)if(o[a].ok&&o[a].ok._rev===e._rev){r=!0;break}r||o.push({ok:e})}--u||n(null,o)})})}if(!e.open_revs)return this._get(t,e,function(i,o){if(i)return i.docId=t,n(i);var u=o.doc,a=o.metadata,c=o.ctx;if(e.conflicts){var s=Pt(a);s.length&&(u._conflicts=s)}if($t(a,u._rev)&&(u._deleted=!0),e.revs||e.revs_info){for(var f=u._rev.split("-"),l=parseInt(f[0],10),h=f[1],d=Ft(a.rev_tree),v=null,p=0;p<d.length;p++){var y=d[p],g=y.ids.map(function(t){return t.id}).indexOf(h);(g===l-1||!v&&-1!==g)&&(v=y)}var b=v.ids.map(function(t){return t.id}).indexOf(u._rev.split("-")[1])+1,w=v.ids.length-b;if(v.ids.splice(b,w),v.ids.reverse(),e.revs&&(u._revisions={start:v.pos+v.ids.length-1,ids:v.ids.map(function(t){return t.id})}),e.revs_info){var m=v.pos+v.ids.length;u._revs_info=v.ids.map(function(t){return{rev:--m+"-"+t.id,status:t.opts.status}})}}if(e.attachments&&u._attachments){var _=u._attachments,k=Object.keys(_).length;if(0===k)return n(null,u);Object.keys(_).forEach(function(t){this._getAttachment(u._id,t,_[t],{rev:u._rev,binary:e.binary,ctx:c},function(e,i){var r=u._attachments[t];r.data=i,delete r.stub,delete r.length,--k||n(null,u)})},r)}else{if(u._attachments)for(var A in u._attachments)u._attachments.hasOwnProperty(A)&&(u._attachments[A].stub=!0);n(null,u)}});if("all"===e.open_revs)this._getRevisionTree(t,function(t,e){if(t)return n(t);i=qt(e).map(function(t){return t.rev}),o()});else{if(!Array.isArray(e.open_revs))return n(ft(tt,"function_clause"));i=e.open_revs;for(var u=0;u<i.length;u++){var a=i[u];if("string"!=typeof a||!/^\d+-/.test(a))return n(ft(ct))}o()}}),Yt.prototype.getAttachment=T("getAttachment",function(t,e,n,i){var r=this;n instanceof Function&&(i=n,n={}),this._get(t,n,function(o,u){return o?i(o):u.doc._attachments&&u.doc._attachments[e]?(n.ctx=u.ctx,n.binary=!0,void r._getAttachment(t,e,u.doc._attachments[e],n,i)):i(ft(V))})}),Yt.prototype.allDocs=T("allDocs",function(t,e){if("function"==typeof t&&(e=t,t={}),t.skip=void 0!==t.skip?t.skip:0,t.start_key&&(t.startkey=t.start_key),t.end_key&&(t.endkey=t.end_key),"keys"in t){if(!Array.isArray(t.keys))return e(new TypeError("options.keys must be an array"));var n=["startkey","endkey","key"].filter(function(e){return e in t})[0];if(n)return void e(ft(nt,"Query parameter `"+n+"` is not compatible with multi-get"));if(!pt(this)&&(function(t){var e="limit"in t?t.keys.slice(t.skip,t.limit+t.skip):t.skip>0?t.keys.slice(t.skip):t.keys;t.keys=e,t.skip=0,delete t.limit,t.descending&&(e.reverse(),t.descending=!1)}(t),0===t.keys.length))return this._allDocs({limit:0},e)}return this._allDocs(t,e)}),Yt.prototype.changes=function(t,e){return"function"==typeof t&&(e=t,t={}),new Xt(this,t,e)},Yt.prototype.close=T("close",function(t){return this._closed=!0,this.emit("closed"),this._close(t)}),Yt.prototype.info=T("info",function(t){var e=this;this._info(function(n,i){if(n)return t(n);i.db_name=i.db_name||e.name,i.auto_compaction=!(!e.auto_compaction||pt(e)),i.adapter=e.adapter,t(null,i)})}),Yt.prototype.id=T("id",function(t){return this._id(t)}),Yt.prototype.type=function(){return"function"==typeof this._type?this._type():this.adapter},Yt.prototype.bulkDocs=T("bulkDocs",function(t,e,n){if("function"==typeof e&&(n=e,e={}),e=e||{},Array.isArray(t)&&(t={docs:t}),!t||!t.docs||!Array.isArray(t.docs))return n(ft(Z));for(var i=0;i<t.docs.length;++i)if("object"!=typeof t.docs[i]||Array.isArray(t.docs[i]))return n(ft(ot));var r;if(t.docs.forEach(function(t){t._attachments&&Object.keys(t._attachments).forEach(function(e){r=r||function(t){return"_"===t.charAt(0)&&t+" is not a valid attachment name, attachment names cannot start with '_'"}(e),t._attachments[e].content_type||J("warn","Attachment",e,"on document",t._id,"is missing content_type")})}),r)return n(ft(rt,r));"new_edits"in e||(e.new_edits=!("new_edits"in t)||t.new_edits);var o=this;e.new_edits||pt(o)||t.docs.sort(Vt),function(t){for(var e=0;e<t.length;e++){var n=t[e];if(n._deleted)delete n._attachments;else if(n._attachments)for(var i=Object.keys(n._attachments),r=0;r<i.length;r++){var o=i[r];n._attachments[o]=j(n._attachments[o],["data","digest","content_type","length","revpos","stub"])}}}(t.docs);var u=t.docs.map(function(t){return t._id});return this._bulkDocs(t,e,function(t,i){if(t)return n(t);if(e.new_edits||(i=i.filter(function(t){return t.error})),!pt(o))for(var r=0,a=i.length;r<a;r++)i[r].id=i[r].id||u[r];n(null,i)})}),Yt.prototype.registerDependentDatabase=T("registerDependentDatabase",function(t,e){var n=new this.constructor(t,this.__opts);xt(this,"_local/_pouch_dependentDbs",function(e){return e.dependentDbs=e.dependentDbs||{},!e.dependentDbs[t]&&(e.dependentDbs[t]=!0,e)}).then(function(){e(null,{db:n})}).catch(e)}),Yt.prototype.destroy=T("destroy",function(t,e){"function"==typeof t&&(e=t,t={});var n=this,i=!("use_prefix"in n)||n.use_prefix;function r(){n._destroy(t,function(t,i){if(t)return e(t);n._destroyed=!0,n.emit("destroyed"),e(null,i||{ok:!0})})}if(pt(n))return r();n.get("_local/_pouch_dependentDbs",function(t,o){if(t)return 404!==t.status?e(t):r();var u=o.dependentDbs,a=n.constructor,c=Object.keys(u).map(function(t){var e=i?t.replace(new RegExp("^"+a.prefix),""):t;return new a(e,n.__opts).destroy()});m.all(c).then(r,e)})}),zt.prototype.execute=function(){var t;if(this.failed)for(;t=this.queue.shift();)t(this.failed);else for(;t=this.queue.shift();)t()},zt.prototype.fail=function(t){this.failed=t,this.execute()},zt.prototype.ready=function(t){this.isReady=!0,this.db=t,this.execute()},zt.prototype.addTask=function(t){this.queue.push(t),this.failed&&this.execute()},l()(It,Yt),It.adapters={},It.preferredAdapters=[],It.prefix="_pouch_";var Qt=new s.EventEmitter;!function(t){Object.keys(s.EventEmitter.prototype).forEach(function(e){"function"==typeof s.EventEmitter.prototype[e]&&(t[e]=Qt[e].bind(Qt))});var e=t._destructionListeners=new A;t.on("ref",function(t){e.has(t.name)||e.set(t.name,[]),e.get(t.name).push(t)}),t.on("unref",function(t){if(e.has(t.name)){var n=e.get(t.name),i=n.indexOf(t);i<0||(n.splice(i,1),n.length>1?e.set(t.name,n):e.delete(t.name))}}),t.on("destroyed",function(t){if(e.has(t)){var n=e.get(t);e.delete(t),n.forEach(function(t){t.emit("destroyed",!0)})}})}(It),It.adapter=function(t,e,n){e.valid()&&(It.adapters[t]=e,n&&It.preferredAdapters.push(t))},It.plugin=function(t){if("function"==typeof t)t(It);else{if("object"!=typeof t||0===Object.keys(t).length)throw new Error('Invalid plugin: got "'+t+'", expected an object or a function');Object.keys(t).forEach(function(e){It.prototype[e]=t[e]})}return this.__defaults&&(It.__defaults=K({},this.__defaults)),It},It.defaults=function(t){function e(t,n){if(!(this instanceof e))return new e(t,n);n=n||{},t&&"object"==typeof t&&(t=(n=t).name,delete n.name),n=K({},e.__defaults,n),It.call(this,t,n)}return l()(e,It),e.preferredAdapters=It.preferredAdapters.slice(),Object.keys(It).forEach(function(t){t in e||(e[t]=It[t])}),e.__defaults=K({},this.__defaults,t),e};function te(t,e){for(var n=t,i=0,r=e.length;i<r;i++){if(!(n=n[e[i]]))break}return n}function ee(t){for(var e=[],n="",i=0,r=t.length;i<r;i++){var o=t[i];"."===o?i>0&&"\\"===t[i-1]?n=n.substring(0,n.length-1)+".":(e.push(n),n=""):n+=o}return e.push(n),e}var ne=["$or","$nor","$not"];function ie(t){return ne.indexOf(t)>-1}function re(t){return Object.keys(t)[0]}function oe(t){var e={};return t.forEach(function(t){Object.keys(t).forEach(function(n){var i=t[n];if("object"!=typeof i&&(i={$eq:i}),ie(n))i instanceof Array?e[n]=i.map(function(t){return oe([t])}):e[n]=oe([i]);else{var r=e[n]=e[n]||{};Object.keys(i).forEach(function(t){var e=i[t];return"$gt"===t||"$gte"===t?function(t,e,n){if(void 0!==n.$eq)return;void 0!==n.$gte?"$gte"===t?e>n.$gte&&(n.$gte=e):e>=n.$gte&&(delete n.$gte,n.$gt=e):void 0!==n.$gt?"$gte"===t?e>n.$gt&&(delete n.$gt,n.$gte=e):e>n.$gt&&(n.$gt=e):n[t]=e}(t,e,r):"$lt"===t||"$lte"===t?function(t,e,n){if(void 0!==n.$eq)return;void 0!==n.$lte?"$lte"===t?e<n.$lte&&(n.$lte=e):e<=n.$lte&&(delete n.$lte,n.$lt=e):void 0!==n.$lt?"$lte"===t?e<n.$lt&&(delete n.$lt,n.$lte=e):e<n.$lt&&(n.$lt=e):n[t]=e}(t,e,r):"$ne"===t?function(t,e){"$ne"in e?e.$ne.push(t):e.$ne=[t]}(e,r):"$eq"===t?function(t,e){delete e.$gt,delete e.$gte,delete e.$lt,delete e.$lte,delete e.$ne,e.$eq=t}(e,r):void(r[t]=e)})}})}),e}var ue=-324,ae=3,ce="";function se(t,e){if(t===e)return 0;t=fe(t),e=fe(e);var n=pe(t),i=pe(e);if(n-i!=0)return n-i;switch(typeof t){case"number":return t-e;case"boolean":return t<e?-1:1;case"string":return function(t,e){return t===e?0:t>e?1:-1}(t,e)}return Array.isArray(t)?function(t,e){for(var n=Math.min(t.length,e.length),i=0;i<n;i++){var r=se(t[i],e[i]);if(0!==r)return r}return t.length===e.length?0:t.length>e.length?1:-1}(t,e):function(t,e){for(var n=Object.keys(t),i=Object.keys(e),r=Math.min(n.length,i.length),o=0;o<r;o++){var u=se(n[o],i[o]);if(0!==u)return u;if(0!==(u=se(t[n[o]],e[i[o]])))return u}return n.length===i.length?0:n.length>i.length?1:-1}(t,e)}function fe(t){switch(typeof t){case"undefined":return null;case"number":return t===1/0||t===-1/0||isNaN(t)?null:t;case"object":var e=t;if(Array.isArray(t)){var n=t.length;t=new Array(n);for(var i=0;i<n;i++)t[i]=fe(e[i])}else{if(t instanceof Date)return t.toJSON();if(null!==t)for(var r in t={},e)if(e.hasOwnProperty(r)){var o=e[r];void 0!==o&&(t[r]=fe(o))}}}return t}function le(t){if(null!==t)switch(typeof t){case"boolean":return t?1:0;case"number":return function(t){if(0===t)return"1";var e=t.toExponential().split(/e\+?/),n=parseInt(e[1],10),i=t<0,r=i?"0":"2",o=(u=((i?-n:n)-ue).toString(),a="0",c=ae,function(t,e,n){for(var i="",r=n-t.length;i.length<r;)i+=e;return i}(u,a,c)+u);var u,a,c;r+=ce+o;var s=Math.abs(parseFloat(e[0]));i&&(s=10-s);var f=s.toFixed(20);return f=f.replace(/\.?0+$/,""),r+=ce+f}(t);case"string":return t.replace(/\u0002/g,"").replace(/\u0001/g,"").replace(/\u0000/g,"");case"object":var e=Array.isArray(t),n=e?t:Object.keys(t),i=-1,r=n.length,o="";if(e)for(;++i<r;)o+=he(n[i]);else for(;++i<r;){var u=n[i];o+=he(u)+he(t[u])}return o}return""}function he(t){return pe(t=fe(t))+ce+le(t)+"\0"}function de(t,e){var n,i=e;if("1"===t[e])n=0,e++;else{var r="0"===t[e];e++;var o="",u=t.substring(e,e+ae),a=parseInt(u,10)+ue;for(r&&(a=-a),e+=ae;;){var c=t[e];if("\0"===c)break;o+=c,e++}n=1===(o=o.split(".")).length?parseInt(o,10):parseFloat(o[0]+"."+o[1]),r&&(n-=10),0!==a&&(n=parseFloat(n+"e"+a))}return{num:n,length:e-i}}function ve(t,e){var n=t.pop();if(e.length){var i=e[e.length-1];n===i.element&&(e.pop(),i=e[e.length-1]);var r=i.element,o=i.index;if(Array.isArray(r))r.push(n);else if(o===t.length-2){r[t.pop()]=n}else t.push(n)}}function pe(t){var e=["boolean","number","string","object"].indexOf(typeof t);return~e?null===t?1:Array.isArray(t)?5:e<3?e+2:e+3:Array.isArray(t)?5:void 0}function ye(t,e,n){if(t=t.filter(function(t){return ge(t.doc,e.selector,n)}),e.sort){var i=function(t){function e(e){return t.map(function(t){var n=ee(re(t));return te(e,n)})}return function(t,n){var i,r,o=se(e(t.doc),e(n.doc));return 0!==o?o:(i=t.doc._id,r=n.doc._id,i<r?-1:i>r?1:0)}}(e.sort);t=t.sort(i),"string"!=typeof e.sort[0]&&"desc"===(r=e.sort[0])[re(r)]&&(t=t.reverse())}var r;if("limit"in e||"skip"in e){var o=e.skip||0,u=("limit"in e?e.limit:t.length)+o;t=t.slice(o,u)}return t}function ge(t,e,n){return n.every(function(n){var i=e[n],r=ee(n),o=te(t,r);return ie(n)?function(t,e,n){if("$or"===t)return e.some(function(t){return ge(n,t,Object.keys(t))});if("$not"===t)return!ge(n,e,Object.keys(e));return!e.find(function(t){return ge(n,t,Object.keys(t))})}(n,i,t):be(i,t,r,o)})}function be(t,e,n,i){return!t||Object.keys(t).every(function(r){var o=t[r];return function(t,e,n,i,r){if(!ke[t])throw new Error('unknown operator "'+t+'" - should be one of $eq, $lte, $lt, $gt, $gte, $exists, $ne, $in, $nin, $size, $mod, $regex, $elemMatch, $type, $allMatch or $all');return ke[t](e,n,i,r)}(r,e,o,n,i)})}function we(t){return null!=t}function me(t){return void 0!==t}function _e(t,e){return e.some(function(e){return t instanceof Array?t.indexOf(e)>-1:t===e})}var ke={$elemMatch:function(t,e,n,i){return!!Array.isArray(i)&&(0!==i.length&&("object"==typeof i[0]?i.some(function(t){return ge(t,e,Object.keys(e))}):i.some(function(i){return be(e,t,n,i)})))},$allMatch:function(t,e,n,i){return!!Array.isArray(i)&&(0!==i.length&&("object"==typeof i[0]?i.every(function(t){return ge(t,e,Object.keys(e))}):i.every(function(i){return be(e,t,n,i)})))},$eq:function(t,e,n,i){return me(i)&&0===se(i,e)},$gte:function(t,e,n,i){return me(i)&&se(i,e)>=0},$gt:function(t,e,n,i){return me(i)&&se(i,e)>0},$lte:function(t,e,n,i){return me(i)&&se(i,e)<=0},$lt:function(t,e,n,i){return me(i)&&se(i,e)<0},$exists:function(t,e,n,i){return e?me(i):!me(i)},$mod:function(t,e,n,i){return we(i)&&function(t,e){var n=e[0],i=e[1];if(0===n)throw new Error("Bad divisor, cannot divide by zero");if(parseInt(n,10)!==n)throw new Error("Divisor is not an integer");if(parseInt(i,10)!==i)throw new Error("Modulus is not an integer");return parseInt(t,10)===t&&t%n===i}(i,e)},$ne:function(t,e,n,i){return e.every(function(t){return 0!==se(i,t)})},$in:function(t,e,n,i){return we(i)&&_e(i,e)},$nin:function(t,e,n,i){return we(i)&&!_e(i,e)},$size:function(t,e,n,i){return we(i)&&function(t,e){return t.length===e}(i,e)},$all:function(t,e,n,i){return Array.isArray(i)&&function(t,e){return e.every(function(e){return t.indexOf(e)>-1})}(i,e)},$regex:function(t,e,n,i){return we(i)&&function(t,e){return new RegExp(e).test(t)}(i,e)},$type:function(t,e,n,i){return function(t,e){switch(e){case"null":return null===t;case"boolean":return"boolean"==typeof t;case"number":return"number"==typeof t;case"string":return"string"==typeof t;case"array":return t instanceof Array;case"object":return"[object Object]"==={}.toString.call(t)}throw new Error(e+" not supported as a type.Please use one of object, string, array, number, boolean or null.")}(i,e)}};function Ae(t,e){if("object"!=typeof e)throw new Error("Selector error: expected a JSON object");var n=ye([{doc:t}],{selector:e=function(t){var e=L(t),n=!1;"$and"in e&&(e=oe(e.$and),n=!0),["$or","$nor"].forEach(function(t){t in e&&e[t].forEach(function(t){for(var e=Object.keys(t),n=0;n<e.length;n++){var i=e[n],r=t[i];"object"==typeof r&&null!==r||(t[i]={$eq:r})}})}),"$not"in e&&(e.$not=oe([e.$not]));for(var i=Object.keys(e),r=0;r<i.length;r++){var o=i[r],u=e[o];"object"!=typeof u||null===u?u={$eq:u}:"$ne"in u&&!n&&(u.$ne=[u.$ne]),e[o]=u}return e}(e)},Object.keys(e));return n&&1===n.length}function xe(t,e){if(t.selector&&t.filter&&"_selector"!==t.filter){var n="string"==typeof t.filter?t.filter:"function";return e(new Error('selector invalid for filter "'+n+'"'))}e()}function Ee(t){t.view&&!t.filter&&(t.filter="_view"),t.selector&&!t.filter&&(t.filter="_selector"),t.filter&&"string"==typeof t.filter&&("_view"===t.filter?t.view=gt(t.view):t.filter=gt(t.filter))}function Le(t,e){return e.filter&&"string"==typeof e.filter&&!e.doc_ids&&!pt(t.db)}function Oe(t,e){var n=e.complete;if("_view"===e.filter){if(!e.view||"string"!=typeof e.view){var i=ft(rt,"`view` filter parameter not found or invalid.");return n(i)}var r=yt(e.view);t.db.get("_design/"+r[0],function(i,o){if(t.isCancelled)return n(null,{status:"cancelled"});if(i)return n(lt(i));var u=o&&o.views&&o.views[r[1]]&&o.views[r[1]].map;if(!u)return n(ft(V,o.views?"missing json key: "+r[1]:"missing json key: views"));e.filter=At(["return function(doc) {",'  "use strict";',"  var emitted = false;","  var emit = function (a, b) {","    emitted = true;","  };","  var view = "+u+";","  view(doc);","  if (emitted) {","    return true;","  }","};"].join("\n"),{}),t.doChanges(e)})}else if(e.selector)e.filter=function(t){return Ae(t,e.selector)},t.doChanges(e);else{var o=yt(e.filter);t.db.get("_design/"+o[0],function(i,r){if(t.isCancelled)return n(null,{status:"cancelled"});if(i)return n(lt(i));var u=r&&r.filters&&r.filters[o[1]];if(!u)return n(ft(V,r&&r.filters?"missing json key: "+o[1]:"missing json key: filters"));e.filter=At('"use strict";\nreturn '+u+";",{}),t.doChanges(e)})}}function Me(t){return t.reduce(function(t,e){return t[e]=!0,t},{})}It.plugin(function(t){t.debug=p.a;var e={};t.on("debug",function(t){var n=t[0],i=t.slice(1);e[n]||(e[n]=p()("pouchdb:"+n)),e[n].apply(null,i)})}),It.plugin(function(t){t._changesFilterPlugin={validate:xe,normalize:Ee,shouldFilter:Le,filter:Oe}}),It.version="6.4.3";var Te=Me(["_id","_rev","_attachments","_deleted","_revisions","_revs_info","_conflicts","_deleted_conflicts","_local_seq","_rev_tree","_replication_id","_replication_state","_replication_state_time","_replication_state_reason","_replication_stats","_removed"]),qe=Me(["_attachments","_replication_id","_replication_state","_replication_state_time","_replication_state_reason","_replication_stats"]);function Pe(t){if(!/^\d+-./.test(t))return ft(ct);var e=t.indexOf("-"),n=t.substring(0,e),i=t.substring(e+1);return{prefix:parseInt(n,10),id:i}}function Se(t,e){var n,i,r,o={status:"available"};if(t._deleted&&(o.deleted=!0),e)if(t._id||(t._id=Lt()),i=Et(),t._rev){if((r=Pe(t._rev)).error)return r;t._rev_tree=[{pos:r.prefix,ids:[r.id,{status:"missing"},[[i,o,[]]]]}],n=r.prefix+1}else t._rev_tree=[{pos:1,ids:[i,o,[]]}],n=1;else if(t._revisions&&(t._rev_tree=function(t,e){for(var n=t.start-t.ids.length+1,i=t.ids,r=[i[0],e,[]],o=1,u=i.length;o<u;o++)r=[i[o],{status:"missing"},[r]];return[{pos:n,ids:r}]}(t._revisions,o),n=t._revisions.start,i=t._revisions.ids[0]),!t._rev_tree){if((r=Pe(t._rev)).error)return r;n=r.prefix,i=r.id,t._rev_tree=[{pos:n,ids:[i,o,[]]}]}vt(t._id),t._rev=n+"-"+i;var u={metadata:{},data:{}};for(var a in t)if(Object.prototype.hasOwnProperty.call(t,a)){var c="_"===a[0];if(c&&!Te[a]){var s=ft(it,a);throw s.message=it.message+": "+a,s}c&&!qe[a]?u.metadata[a.slice(1)]=t[a]:u.data[a]=t[a]}return u}var Fe=function(t){return atob(t)},je=function(t){return btoa(t)};function Ue(t,e){t=t||[],e=e||{};try{return new Blob(t,e)}catch(r){if("TypeError"!==r.name)throw r;for(var n=new("undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof MSBlobBuilder?MSBlobBuilder:"undefined"!=typeof MozBlobBuilder?MozBlobBuilder:WebKitBlobBuilder),i=0;i<t.length;i+=1)n.append(t[i]);return n.getBlob(e.type)}}function De(t){for(var e=t.length,n=new ArrayBuffer(e),i=new Uint8Array(n),r=0;r<e;r++)i[r]=t.charCodeAt(r);return n}function Re(t,e){return Ue([De(t)],{type:e})}function Be(t,e){return Re(Fe(t),e)}function Ce(t){for(var e="",n=new Uint8Array(t),i=n.byteLength,r=0;r<i;r++)e+=String.fromCharCode(n[r]);return e}function We(t,e){if("undefined"==typeof FileReader)return e(Ce((new FileReaderSync).readAsArrayBuffer(t)));var n=new FileReader,i="function"==typeof n.readAsBinaryString;n.onloadend=function(t){var n=t.target.result||"";if(i)return e(n);e(Ce(n))},i?n.readAsBinaryString(t):n.readAsArrayBuffer(t)}function Ne(t,e){We(t,function(t){e(t)})}function $e(t,e){Ne(t,function(t){e(je(t))})}function Je(t,e){if("undefined"==typeof FileReader)return e((new FileReaderSync).readAsArrayBuffer(t));var n=new FileReader;n.onloadend=function(t){var n=t.target.result||new ArrayBuffer(0);e(n)},n.readAsArrayBuffer(t)}var He=t.setImmediate||t.setTimeout,Xe=32768;function Ke(t,e,n,i,r){(n>0||i<e.size)&&(e=function(t,e,n){return t.webkitSlice?t.webkitSlice(e,n):t.slice(e,n)}(e,n,i)),Je(e,function(e){t.append(e),r()})}function Ge(t,e,n,i,r){(n>0||i<e.length)&&(e=e.substring(n,i)),t.appendBinary(e),r()}function Ze(t,e){var n="string"==typeof t,i=n?t.length:t.size,r=Math.min(Xe,i),o=Math.ceil(i/r),u=0,a=n?new g.a:new g.a.ArrayBuffer,c=n?Ge:Ke;function s(){He(l)}function f(){var t=function(t){return je(t)}(a.end(!0));e(t),a.destroy()}function l(){var e=u*r,n=e+r;c(a,t,e,n,++u<o?s:f)}l()}function Ve(t,e,n){var i=function(t){try{return Fe(t)}catch(t){return{error:ft(et,"Attachment is not a valid base64 string")}}}(t.data);if(i.error)return n(i.error);t.length=i.length,t.data="blob"===e?Re(i,t.content_type):"base64"===e?je(i):i,Ze(i,function(e){t.digest="md5-"+e,n()})}function Ye(t,e,n){if(t.stub)return n();"string"==typeof t.data?Ve(t,e,n):function(t,e,n){Ze(t.data,function(i){t.digest="md5-"+i,t.length=t.data.size||t.data.length||0,"binary"===e?Ne(t.data,function(e){t.data=e,n()}):"base64"===e?$e(t.data,function(e){t.data=e,n()}):n()})}(t,e,n)}function ze(t,e,n){if(!t.length)return n();var i,r=0;function o(){r++,t.length===r&&(i?n(i):n())}t.forEach(function(t){var n=t.data&&t.data._attachments?Object.keys(t.data._attachments):[],r=0;if(!n.length)return o();function u(t){i=t,++r===n.length&&o()}for(var a in t.data._attachments)t.data._attachments.hasOwnProperty(a)&&Ye(t.data._attachments[a],e,u)})}function Ie(t,e,n,i,r,o,u,a){if(function(t,e){for(var n,i=t.slice(),r=e.split("-"),o=parseInt(r[0],10),u=r[1];n=i.pop();){if(n.pos===o&&n.ids[0]===u)return!0;for(var a=n.ids[2],c=0,s=a.length;c<s;c++)i.push({pos:n.pos+1,ids:a[c]})}return!1}(e.rev_tree,n.metadata.rev))return i[r]=n,o();var c=e.winningRev||Ot(e),s="deleted"in e?e.deleted:$t(e,c),f="deleted"in n.metadata?n.metadata.deleted:$t(n.metadata),l=/^1-/.test(n.metadata.rev);if(s&&!f&&a&&l){var h=n.data;h._rev=c,h._id=n.metadata.id,n=Se(h,a)}var d=Wt(e.rev_tree,n.metadata.rev_tree[0],t);if(a&&(s&&f&&"new_leaf"!==d.conflicts||!s&&"new_leaf"!==d.conflicts||s&&!f&&"new_branch"===d.conflicts)){var v=ft(Y);return i[r]=v,o()}var p=n.metadata.rev;n.metadata.rev_tree=d.tree,n.stemmedRevs=d.stemmedRevs||[],e.rev_map&&(n.metadata.rev_map=e.rev_map);var y=Ot(n.metadata),g=$t(n.metadata,y),b=s===g?0:s<g?-1:1;u(n,y,g,p===y?g:$t(n.metadata,p),!0,b,r,o)}function Qe(t,e,n,i,r,o,u,a,c){t=t||1e3;var s=a.new_edits,f=new A,l=0,h=e.length;function d(){++l===h&&c&&c()}e.forEach(function(t,e){if(t._id&&Jt(t._id)){var i=t._deleted?"_removeLocal":"_putLocal";n[i](t,{ctx:r},function(t,n){o[e]=t||n,d()})}else{var u=t.metadata.id;f.has(u)?(h--,f.get(u).push([t,e])):f.set(u,[[t,e]])}}),f.forEach(function(e,n){var r=0;function c(){++r<e.length?f():d()}function f(){var f=e[r],l=f[0],h=f[1];if(i.has(n))Ie(t,i.get(n),l,o,h,c,u,s);else{var d=Wt([],l.metadata.rev_tree[0],t);l.metadata.rev_tree=d.tree,l.stemmedRevs=d.stemmedRevs||[],function(t,e,n){var i=Ot(t.metadata),r=$t(t.metadata,i);if("was_delete"in a&&r)return o[e]=ft(V,"deleted"),n();if(s&&function(t){return"missing"===t.metadata.rev_tree[0].ids[1].status}(t)){var c=ft(Y);return o[e]=c,n()}u(t,i,r,r,!1,r?0:1,e,n)}(l,h,c)}}f()})}var tn=5,en="document-store",nn="by-sequence",rn="attach-store",on="attach-seq-store",un="meta-store",an="local-store",cn="detect-blob-support";function sn(t){try{return JSON.parse(t)}catch(e){return w.a.parse(t)}}function fn(t){try{return JSON.stringify(t)}catch(e){return w.a.stringify(t)}}function ln(t){return function(e){var n="unknown_error";e.target&&e.target.error&&(n=e.target.error.name||e.target.error.message),t(ft(ut,n,e.type))}}function hn(t,e,n){return{data:fn(t),winningRev:e,deletedOrLocal:n?"1":"0",seq:t.seq,id:t.id}}function dn(t){if(!t)return null;var e=sn(t.data);return e.winningRev=t.winningRev,e.deleted="1"===t.deletedOrLocal,e.seq=t.seq,e}function vn(t){if(!t)return t;var e=t._doc_id_rev.lastIndexOf(":");return t._id=t._doc_id_rev.substring(0,e-1),t._rev=t._doc_id_rev.substring(e+1),delete t._doc_id_rev,t}function pn(t,e,n,i){n?i(t?"string"!=typeof t?t:Be(t,e):Ue([""],{type:e})):t?"string"!=typeof t?We(t,function(t){i(je(t))}):i(t):i("")}function yn(t,e,n,i){var r=Object.keys(t._attachments||{});if(!r.length)return i&&i();var o=0;function u(){++o===r.length&&i&&i()}r.forEach(function(i){e.attachments&&e.include_docs?function(t,e){var i=t._attachments[e],r=i.digest;n.objectStore(rn).get(r).onsuccess=function(t){i.body=t.target.result.body,u()}}(t,i):(t._attachments[i].stub=!0,u())})}function gn(t,e){return m.all(t.map(function(t){if(t.doc&&t.doc._attachments){var n=Object.keys(t.doc._attachments);return m.all(n.map(function(n){var i=t.doc._attachments[n];if("body"in i){var r=i.body,o=i.content_type;return new m(function(u){pn(r,o,e,function(e){t.doc._attachments[n]=K(j(i,["digest","content_type"]),{data:e}),u()})})}}))}}))}function bn(t,e,n){var i=[],r=n.objectStore(nn),o=n.objectStore(rn),u=n.objectStore(on),a=t.length;function c(){--a||function(){if(!i.length)return;i.forEach(function(t){var e=u.index("digestSeq").count(IDBKeyRange.bound(t+"::",t+"::￿",!1,!1));e.onsuccess=function(e){var n=e.target.result;n||o.delete(t)}})}()}t.forEach(function(t){var n=r.index("_doc_id_rev"),o=e+"::"+t;n.getKey(o).onsuccess=function(t){var e=t.target.result;if("number"!=typeof e)return c();r.delete(e),u.index("seq").openCursor(IDBKeyRange.only(e)).onsuccess=function(t){var e=t.target.result;if(e){var n=e.value.digestSeq.split("::")[0];i.push(n),u.delete(e.primaryKey),e.continue()}else c()}}})}function wn(t,e,n){try{return{txn:t.transaction(e,n)}}catch(t){return{error:t}}}var mn=new $;function _n(t,e,n,i,r,o){for(var u,a,c,s,f,l,h,d,v=e.docs,p=0,y=v.length;p<y;p++){var g=v[p];g._id&&Jt(g._id)||(g=v[p]=Se(g,n.new_edits)).error&&!h&&(h=g)}if(h)return o(h);var b=!1,w=0,m=new Array(v.length),_=new A,k=!1,x=i._meta.blobSupport?"blob":"base64";function E(){b=!0,L()}function L(){d&&b&&(d.docCount+=w,l.put(d))}function O(){k||(mn.notify(i._meta.name),o(null,m))}function M(t,e,n,i,r,o,u,a){t.metadata.winningRev=e,t.metadata.deleted=n;var c=t.data;if(c._id=t.metadata.id,c._rev=t.metadata.rev,i&&(c._deleted=!0),c._attachments&&Object.keys(c._attachments).length)return function(t,e,n,i,r,o){var u=t.data,a=0,c=Object.keys(u._attachments);function f(){a===c.length&&T(t,e,n,i,r,o)}function l(){a++,f()}c.forEach(function(n){var i=t.data._attachments[n];if(i.stub)a++,f();else{var r=i.data;delete i.data,i.revpos=parseInt(e,10);var o=i.digest;!function(t,e,n){s.count(t).onsuccess=function(i){var r=i.target.result;if(r)return n();var o={digest:t,body:e},u=s.put(o);u.onsuccess=n}}(o,r,l)}})}(t,e,n,r,u,a);w+=o,L(),T(t,e,n,r,u,a)}function T(t,e,n,r,o,s){var l=t.data,h=t.metadata;function d(o){var c=t.stemmedRevs||[];r&&i.auto_compaction&&(c=c.concat(St(t.metadata))),c&&c.length&&bn(c,t.metadata.id,u),h.seq=o.target.result;var s=hn(h,e,n);a.put(s).onsuccess=v}function v(){m[o]={ok:!0,id:h.id,rev:h.rev},_.set(t.metadata.id,t.metadata),function(t,e,n){var i=0,r=Object.keys(t.data._attachments||{});if(!r.length)return n();function o(){++i===r.length&&n()}function u(n){var i=t.data._attachments[n].digest,r=f.put({seq:e,digestSeq:i+"::"+e});r.onsuccess=o,r.onerror=function(t){t.preventDefault(),t.stopPropagation(),o()}}for(var a=0;a<r.length;a++)u(r[a])}(t,h.seq,s)}l._doc_id_rev=h.id+"::"+h.rev,delete l._id,delete l._rev;var p=c.put(l);p.onsuccess=d,p.onerror=function(t){t.preventDefault(),t.stopPropagation(),c.index("_doc_id_rev").getKey(l._doc_id_rev).onsuccess=function(t){c.put(l,t.target.result).onsuccess=d}}}ze(v,x,function(e){if(e)return o(e);!function(){var e=wn(r,[en,nn,rn,an,on,un],"readwrite");if(e.error)return o(e.error);(u=e.txn).onabort=ln(o),u.ontimeout=ln(o),u.oncomplete=O,a=u.objectStore(en),c=u.objectStore(nn),s=u.objectStore(rn),f=u.objectStore(on),(l=u.objectStore(un)).get(un).onsuccess=function(t){d=t.target.result,L()},function(t){var e=[];if(v.forEach(function(t){t.data&&t.data._attachments&&Object.keys(t.data._attachments).forEach(function(n){var i=t.data._attachments[n];i.stub&&e.push(i.digest)})}),!e.length)return t();var n,i=0;e.forEach(function(r){!function(t,e){s.get(t).onsuccess=function(n){if(n.target.result)e();else{var i=ft(st,"unknown stub attachment with digest "+t);i.status=412,e(i)}}}(r,function(r){r&&!n&&(n=r),++i===e.length&&t(n)})})}(function(e){if(e)return k=!0,o(e);!function(){if(!v.length)return;var e=0;function r(){++e===v.length&&Qe(t.revs_limit,v,i,_,u,m,M,n,E)}function o(t){var e=dn(t.target.result);e&&_.set(e.id,e),r()}for(var c=0,s=v.length;c<s;c++){var f=v[c];if(f._id&&Jt(f._id))r();else{var l=a.get(f.metadata.id);l.onsuccess=o}}}()})}()})}function kn(t,e,n,i,r){var o,u,a;function c(t){u=t.target.result,o&&r(o,u,a)}function s(t){o=t.target.result,u&&r(o,u,a)}function f(t){var e=t.target.result;if(!e)return r();r([e.key],[e.value],e)}"function"==typeof t.getAll&&"function"==typeof t.getAllKeys&&i>1&&!n?(a={continue:function(){if(!o.length)return r();var n,a=o[o.length-1];if(e&&e.upper)try{n=IDBKeyRange.bound(a,e.upper,!0,e.upperOpen)}catch(t){if("DataError"===t.name&&0===t.code)return r()}else n=IDBKeyRange.lowerBound(a,!0);e=n,o=null,u=null,t.getAll(e,i).onsuccess=c,t.getAllKeys(e,i).onsuccess=s}},t.getAll(e,i).onsuccess=c,t.getAllKeys(e,i).onsuccess=s):n?t.openCursor(e,"prev").onsuccess=f:t.openCursor(e).onsuccess=f}function An(t,e,n){var i,r,o="startkey"in t&&t.startkey,u="endkey"in t&&t.endkey,a="key"in t&&t.key,c="keys"in t&&t.keys,s=t.skip||0,f="number"==typeof t.limit?t.limit:-1,l=!1!==t.inclusive_end;if(!c&&(r=(i=function(t,e,n,i,r){try{if(t&&e)return r?IDBKeyRange.bound(e,t,!n,!1):IDBKeyRange.bound(t,e,!1,!n);if(t)return r?IDBKeyRange.upperBound(t):IDBKeyRange.lowerBound(t);if(e)return r?IDBKeyRange.lowerBound(e,!n):IDBKeyRange.upperBound(e,!n);if(i)return IDBKeyRange.only(i)}catch(t){return{error:t}}return null}(o,u,l,a,t.descending))&&i.error)&&("DataError"!==r.name||0!==r.code))return n(ft(ut,r.name,r.message));var h=[en,nn,un];t.attachments&&h.push(rn);var d=wn(e,h,"readonly");if(d.error)return n(d.error);var v=d.txn;v.oncomplete=function(){t.attachments?gn(_,t.binary).then(E):E()},v.onabort=ln(n);var p,y,g=v.objectStore(en),b=v.objectStore(nn),w=v.objectStore(un),m=b.index("_doc_id_rev"),_=[];function k(e,n){var i={id:n.id,key:n.id,value:{rev:e}};n.deleted?c&&(_.push(i),i.value.deleted=!0,i.doc=null):s--<=0&&(_.push(i),t.include_docs&&function(e,n,i){var r=e.id+"::"+i;m.get(r).onsuccess=function(i){if(n.doc=vn(i.target.result),t.conflicts){var r=Pt(e);r.length&&(n.doc._conflicts=r)}yn(n.doc,t,v)}}(n,i,e))}function A(t){for(var e=0,n=t.length;e<n&&_.length!==f;e++){var i=t[e];if(i.error&&c)_.push(i);else{var r=dn(i);k(r.winningRev,r)}}}function x(t,e,n){n&&(A(e),_.length<f&&n.continue())}function E(){var e={total_rows:p,offset:t.skip,rows:_};t.update_seq&&void 0!==y&&(e.update_seq=y),n(null,e)}return w.get(un).onsuccess=function(t){p=t.target.result.docCount},t.update_seq&&function(t,e){t.openCursor(null,"prev").onsuccess=function(t){var n=t.target.result,i=void 0;n&&n.key&&(i=n.key);return e({target:{result:[i]}})}}(b,function(t){t.target.result&&t.target.result.length>0&&(y=t.target.result[0])}),r||0===f?void 0:c?function(t,e,n){var i=[],r=0;t.forEach(function(o,u){e.get(o).onsuccess=function(e){e.target.result?i[u]=e.target.result:i[u]={key:o,error:"not_found"},++r===t.length&&n(t,i,{})}})}(t.keys,g,x):-1===f?function(t,e,n){if("function"!=typeof t.getAll){var i=[];t.openCursor(e).onsuccess=function(t){var e=t.target.result;e?(i.push(e.value),e.continue()):n({target:{result:i}})}}else t.getAll(e).onsuccess=n}(g,i,function(e){var n=e.target.result;t.descending&&(n=n.reverse()),A(n)}):void kn(g,i,t.descending,f+s,x)}var xn=!1,En=[];function Ln(){!xn&&En.length&&(xn=!0,En.shift()())}function On(t,e,n,i){if((t=L(t)).continuous){var r=n+":"+Lt();return mn.addListener(n,r,e,t),mn.notify(n),{cancel:function(){mn.removeListener(n,r)}}}var o=t.doc_ids&&new k(t.doc_ids);t.since=t.since||0;var u,a=t.since,c="limit"in t?t.limit:-1;0===c&&(c=1),u="return_docs"in t?t.return_docs:!("returnDocs"in t)||t.returnDocs;var s,f,l,h,d=[],v=0,p=ht(t),y=new A;function g(t,e,n,i){if(n.seq!==e)return i();if(n.winningRev===t._rev)return i(n,t);var r=t._id+"::"+n.winningRev;h.get(r).onsuccess=function(t){i(n,vn(t.target.result))}}function b(){t.complete(null,{results:d,last_seq:a})}var w=[en,nn];t.attachments&&w.push(rn);var m=wn(i,w,"readonly");if(m.error)return t.complete(m.error);(s=m.txn).onabort=ln(t.complete),s.oncomplete=function(){!t.continuous&&t.attachments?gn(d).then(b):b()},f=s.objectStore(nn),l=s.objectStore(en),h=f.index("_doc_id_rev"),kn(f,t.since&&!t.descending?IDBKeyRange.lowerBound(t.since,!0):null,t.descending,c,function(e,n,i){if(i&&e.length){var r=new Array(e.length),f=new Array(e.length),h=0;n.forEach(function(t,n){!function(t,e,n){if(o&&!o.has(t._id))return n();var i=y.get(t._id);if(i)return g(t,e,i,n);l.get(t._id).onsuccess=function(r){i=dn(r.target.result),y.set(t._id,i),g(t,e,i,n)}}(vn(t),e[n],function(t,o){f[n]=t,r[n]=o,++h===e.length&&function(){for(var t=0,e=r.length;t<e&&v!==c;t++){var n=r[t];n&&b(f[t],n)}v!==c&&i.continue()}()})})}function b(e,n){var i=t.processChange(n,e,t);a=i.seq=e.seq;var r=p(i);if("object"==typeof r)return t.complete(r);r&&(v++,u&&d.push(i),t.attachments&&t.include_docs?yn(n,t,s,function(){gn([i],t.binary).then(function(){t.onChange(i)})}):t.onChange(i))}})}var Mn,Tn=new A,qn=new A;function Pn(t,e){var n=this;!function(t,e,n){En.push(function(){t(function(t,i){!function(t,e,n,i){try{t(e,n)}catch(e){i.emit("error",e)}}(e,t,i,n),xn=!1,c()(function(){Ln()})})}),Ln()}(function(e){!function(t,e,n){var i=e.name,r=null;function o(t,e){var n=t.objectStore(en);n.createIndex("deletedOrLocal","deletedOrLocal",{unique:!1}),n.openCursor().onsuccess=function(t){var i=t.target.result;if(i){var r=i.value,o=$t(r);r.deletedOrLocal=o?"1":"0",n.put(r),i.continue()}else e()}}function u(t,e){var n=t.objectStore(an),i=t.objectStore(en),r=t.objectStore(nn),o=i.openCursor();o.onsuccess=function(t){var o=t.target.result;if(o){var u=o.value,a=u.id,c=Jt(a),s=Ot(u);if(c){var f=a+"::"+s,l=a+"::",h=a+"::~",d=r.index("_doc_id_rev"),v=IDBKeyRange.bound(l,h,!1,!1),p=d.openCursor(v);p.onsuccess=function(t){if(p=t.target.result){var e=p.value;e._doc_id_rev===f&&n.put(e),r.delete(p.primaryKey),p.continue()}else i.delete(o.primaryKey),o.continue()}}else o.continue()}else e&&e()}}function a(t,e){var n=t.objectStore(nn),i=t.objectStore(rn),r=t.objectStore(on),o=i.count();o.onsuccess=function(t){var i=t.target.result;if(!i)return e();n.openCursor().onsuccess=function(t){var n=t.target.result;if(!n)return e();for(var i=n.value,o=n.primaryKey,u=Object.keys(i._attachments||{}),a={},c=0;c<u.length;c++){var s=i._attachments[u[c]];a[s.digest]=!0}var f=Object.keys(a);for(c=0;c<f.length;c++){var l=f[c];r.put({seq:o,digestSeq:l+"::"+o})}n.continue()}}}function s(t){var e=t.objectStore(nn),n=t.objectStore(en),i=n.openCursor();i.onsuccess=function(t){var i=t.target.result;if(i){var r,o,u,a,c=function(t){if(!t.data)return t.deleted="1"===t.deletedOrLocal,t;return dn(t)}(i.value);if(c.winningRev=c.winningRev||Ot(c),c.seq)return s();r=c.id+"::",o=c.id+"::￿",u=e.index("_doc_id_rev").openCursor(IDBKeyRange.bound(r,o)),a=0,u.onsuccess=function(t){var e=t.target.result;if(!e)return c.seq=a,s();var n=e.primaryKey;n>a&&(a=n),e.continue()}}function s(){var t=hn(c,c.winningRev,c.deleted),e=n.put(t);e.onsuccess=function(){i.continue()}}}}t._meta=null,t._remote=!1,t.type=function(){return"idb"},t._id=M(function(e){e(null,t._meta.instanceId)}),t._bulkDocs=function(n,i,o){_n(e,n,i,t,r,o)},t._get=function(t,e,n){var i,o,u,a=e.ctx;if(!a){var c=wn(r,[en,nn,rn],"readonly");if(c.error)return n(c.error);a=c.txn}function s(){n(u,{doc:i,metadata:o,ctx:a})}a.objectStore(en).get(t).onsuccess=function(t){if(!(o=dn(t.target.result)))return u=ft(V,"missing"),s();var n;if(e.rev)n=e.latest?Ht(e.rev,o):e.rev;else{n=o.winningRev;var r=$t(o);if(r)return u=ft(V,"deleted"),s()}var c=a.objectStore(nn),f=o.id+"::"+n;c.index("_doc_id_rev").get(f).onsuccess=function(t){if((i=t.target.result)&&(i=vn(i)),!i)return u=ft(V,"missing"),s();s()}}},t._getAttachment=function(t,e,n,i,o){var u;if(i.ctx)u=i.ctx;else{var a=wn(r,[en,nn,rn],"readonly");if(a.error)return o(a.error);u=a.txn}var c=n.digest,s=n.content_type;u.objectStore(rn).get(c).onsuccess=function(t){var e=t.target.result.body;pn(e,s,i.binary,function(t){o(null,t)})}},t._info=function(e){var n,i,o=wn(r,[un,nn],"readonly");if(o.error)return e(o.error);var u=o.txn;u.objectStore(un).get(un).onsuccess=function(t){i=t.target.result.docCount},u.objectStore(nn).openCursor(null,"prev").onsuccess=function(t){var e=t.target.result;n=e?e.key:0},u.oncomplete=function(){e(null,{doc_count:i,update_seq:n,idb_attachment_format:t._meta.blobSupport?"binary":"base64"})}},t._allDocs=function(t,e){An(t,r,e)},t._changes=function(e){return On(e,t,i,r)},t._close=function(t){r.close(),Tn.delete(i),t()},t._getRevisionTree=function(t,e){var n=wn(r,[en],"readonly");if(n.error)return e(n.error);var i=n.txn,o=i.objectStore(en).get(t);o.onsuccess=function(t){var n=dn(t.target.result);n?e(null,n.rev_tree):e(ft(V))}},t._doCompaction=function(t,e,n){var i=[en,nn,rn,on],o=wn(r,i,"readwrite");if(o.error)return n(o.error);var u=o.txn,a=u.objectStore(en);a.get(t).onsuccess=function(n){var i=dn(n.target.result);Mt(i.rev_tree,function(t,n,i,r,o){var u=n+"-"+i;-1!==e.indexOf(u)&&(o.status="missing")}),bn(e,t,u);var r=i.winningRev,o=i.deleted;u.objectStore(en).put(hn(i,r,o))},u.onabort=ln(n),u.oncomplete=function(){n()}},t._getLocal=function(t,e){var n=wn(r,[an],"readonly");if(n.error)return e(n.error);var i=n.txn,o=i.objectStore(an).get(t);o.onerror=ln(e),o.onsuccess=function(t){var n=t.target.result;n?(delete n._doc_id_rev,e(null,n)):e(ft(V))}},t._putLocal=function(t,e,n){"function"==typeof e&&(n=e,e={}),delete t._revisions;var i=t._rev,o=t._id;t._rev=i?"0-"+(parseInt(i.split("-")[1],10)+1):"0-1";var u,a=e.ctx;if(!a){var c=wn(r,[an],"readwrite");if(c.error)return n(c.error);(a=c.txn).onerror=ln(n),a.oncomplete=function(){u&&n(null,u)}}var s,f=a.objectStore(an);i?(s=f.get(o)).onsuccess=function(r){var o=r.target.result;if(o&&o._rev===i){var a=f.put(t);a.onsuccess=function(){u={ok:!0,id:t._id,rev:t._rev},e.ctx&&n(null,u)}}else n(ft(Y))}:((s=f.add(t)).onerror=function(t){n(ft(Y)),t.preventDefault(),t.stopPropagation()},s.onsuccess=function(){u={ok:!0,id:t._id,rev:t._rev},e.ctx&&n(null,u)})},t._removeLocal=function(t,e,n){"function"==typeof e&&(n=e,e={});var i,o=e.ctx;if(!o){var u=wn(r,[an],"readwrite");if(u.error)return n(u.error);(o=u.txn).oncomplete=function(){i&&n(null,i)}}var a=t._id,c=o.objectStore(an),s=c.get(a);s.onerror=ln(n),s.onsuccess=function(r){var o=r.target.result;o&&o._rev===t._rev?(c.delete(a),i={ok:!0,id:a,rev:"0-0"},e.ctx&&n(null,i)):n(ft(V))}},t._destroy=function(t,e){mn.removeAllListeners(i);var n=qn.get(i);n&&n.result&&(n.result.close(),Tn.delete(i));var r=indexedDB.deleteDatabase(i);r.onsuccess=function(){qn.delete(i),N()&&i in localStorage&&delete localStorage[i],e(null,{ok:!0})},r.onerror=ln(e)};var f,l=Tn.get(i);if(l)return r=l.idb,t._meta=l.global,c()(function(){n(null,t)});f=e.storage?function(t,e){try{return indexedDB.open(t,{version:tn,storage:e})}catch(e){return indexedDB.open(t,tn)}}(i,e.storage):indexedDB.open(i,tn);qn.set(i,f),f.onupgradeneeded=function(t){var e=t.target.result;if(t.oldVersion<1)return function(t){var e=t.createObjectStore(en,{keyPath:"id"});t.createObjectStore(nn,{autoIncrement:!0}).createIndex("_doc_id_rev","_doc_id_rev",{unique:!0}),t.createObjectStore(rn,{keyPath:"digest"}),t.createObjectStore(un,{keyPath:"id",autoIncrement:!1}),t.createObjectStore(cn),e.createIndex("deletedOrLocal","deletedOrLocal",{unique:!1}),t.createObjectStore(an,{keyPath:"_id"});var n=t.createObjectStore(on,{autoIncrement:!0});n.createIndex("seq","seq"),n.createIndex("digestSeq","digestSeq",{unique:!0})}(e);var n=t.currentTarget.transaction;t.oldVersion<3&&function(t){t.createObjectStore(an,{keyPath:"_id"}).createIndex("_doc_id_rev","_doc_id_rev",{unique:!0})}(e),t.oldVersion<4&&function(t){var e=t.createObjectStore(on,{autoIncrement:!0});e.createIndex("seq","seq"),e.createIndex("digestSeq","digestSeq",{unique:!0})}(e);var i=[o,u,a,s],r=t.oldVersion;!function t(){var e=i[r-1];r++;e&&e(n,t)}()},f.onsuccess=function(e){(r=e.target.result).onversionchange=function(){r.close(),Tn.delete(i)},r.onabort=function(t){J("error","Database has a global failure",t.target.error),r.close(),Tn.delete(i)};var o,u,a,c,s=r.transaction([un,cn,en],"readwrite"),f=!1;function l(){void 0!==a&&f&&(t._meta={name:i,instanceId:c,blobSupport:a},Tn.set(i,{idb:r,global:t._meta}),n(null,t))}function h(){if(void 0!==u&&void 0!==o){var t=i+"_id";t in o?c=o[t]:o[t]=c=Lt(),o.docCount=u,s.objectStore(un).put(o)}}s.objectStore(un).get(un).onsuccess=function(t){o=t.target.result||{id:un},h()},function(t,e){t.objectStore(en).index("deletedOrLocal").count(IDBKeyRange.only("0")).onsuccess=function(t){e(t.target.result)}}(s,function(t){u=t,h()}),Mn||(Mn=function(t){return new m(function(e){var n=Ue([""]);t.objectStore(cn).put(n,"key").onsuccess=function(){var t=navigator.userAgent.match(/Chrome\/(\d+)/),n=navigator.userAgent.match(/Edge\//);e(n||!t||parseInt(t[1],10)>=43)},t.onabort=function(t){t.preventDefault(),t.stopPropagation(),e(!1)}}).catch(function(){return!1})}(s)),Mn.then(function(t){a=t,l()}),s.oncomplete=function(){f=!0,l()},s.onabort=ln(n)},f.onerror=function(){var t="Failed to open indexedDB, are you in private browsing mode?";J("error",t),n(ft(ut,t))}}(n,t,e)},e,n.constructor)}function Sn(t){return t<65?t-48:t-55}function Fn(t,e){return"UTF-8"===e?function(t){return decodeURIComponent(escape(t))}(function(t,e,n){for(var i="";e<n;)i+=String.fromCharCode(Sn(t.charCodeAt(e++))<<4|Sn(t.charCodeAt(e++)));return i}(t,0,t.length)):function(t,e,n){for(var i="";e<n;)i+=String.fromCharCode(Sn(t.charCodeAt(e+2))<<12|Sn(t.charCodeAt(e+3))<<8|Sn(t.charCodeAt(e))<<4|Sn(t.charCodeAt(e+1))),e+=4;return i}(t,0,t.length)}function jn(t){return"'"+t+"'"}Pn.valid=function(){var t="undefined"!=typeof openDatabase&&/(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&!/BlackBerry/.test(navigator.platform),e="function"==typeof fetch&&-1!==fetch.toString().indexOf("[native code");try{return(!t||e)&&"undefined"!=typeof indexedDB&&"undefined"!=typeof IDBKeyRange}catch(t){return!1}};var Un=7,Dn=jn("document-store"),Rn=jn("by-sequence"),Bn=jn("attach-store"),Cn=jn("local-store"),Wn=jn("metadata-store"),Nn=jn("attach-seq-store");function $n(t){return delete t._id,delete t._rev,JSON.stringify(t)}function Jn(t,e,n){return(t=JSON.parse(t))._id=e,t._rev=n,t}function Hn(t){for(var e="(";t--;)e+="?",t&&(e+=",");return e+")"}function Xn(t,e,n,i,r){return"SELECT "+t+" FROM "+("string"==typeof e?e:e.join(" JOIN "))+(n?" ON "+n:"")+(i?" WHERE "+("string"==typeof i?i:i.join(" AND ")):"")+(r?" ORDER BY "+r:"")}function Kn(t,e,n){if(t.length){var i=0,r=[];t.forEach(function(t){var i="SELECT seq FROM "+Rn+" WHERE doc_id=? AND rev=?";n.executeSql(i,[e,t],function(t,e){if(!e.rows.length)return o();var n=e.rows.item(0).seq;r.push(n),t.executeSql("DELETE FROM "+Rn+" WHERE seq=?",[n],o)})})}function o(){++i===t.length&&function(){if(!r.length)return;var t="SELECT DISTINCT digest AS digest FROM "+Nn+" WHERE seq IN "+Hn(r.length);n.executeSql(t,r,function(t,e){for(var n=[],i=0;i<e.rows.length;i++)n.push(e.rows.item(i).digest);if(n.length){var o="DELETE FROM "+Nn+" WHERE seq IN ("+r.map(function(){return"?"}).join(",")+")";t.executeSql(o,r,function(t){var e="SELECT digest FROM "+Nn+" WHERE digest IN ("+n.map(function(){return"?"}).join(",")+")";t.executeSql(e,n,function(t,e){for(var i=new k,r=0;r<e.rows.length;r++)i.add(e.rows.item(r).digest);n.forEach(function(e){i.has(e)||(t.executeSql("DELETE FROM "+Nn+" WHERE digest=?",[e]),t.executeSql("DELETE FROM "+Bn+" WHERE digest=?",[e]))})})})}})}()}}function Gn(t){return function(e){J("error","WebSQL threw an error",e);var n=e&&e.constructor.toString().match(/function ([^(]+)/),i=(n&&n[1]||e.type,e.target||e.message);t(ft(at,i))}}function Zn(t,e,n,i,r,o,u){var a,c=n.new_edits,s=e.docs.map(function(t){return t._id&&Jt(t._id)?t:Se(t,c)}),f=s.filter(function(t){return t.error});if(f.length)return u(f[0]);var l,h=new Array(s.length),d=new A;function v(){if(l)return u(l);o.notify(i._name),u(null,h)}function p(t){var e=[];if(s.forEach(function(t){t.data&&t.data._attachments&&Object.keys(t.data._attachments).forEach(function(n){var i=t.data._attachments[n];i.stub&&e.push(i.digest)})}),!e.length)return t();var n,i=0;e.forEach(function(r){!function(t,e){var n="SELECT count(*) as cnt FROM "+Bn+" WHERE digest=?";a.executeSql(n,[t],function(n,i){if(0===i.rows.item(0).cnt){var r=ft(st,"unknown stub attachment with digest "+t);e(r)}else e()})}(r,function(r){r&&!n&&(n=r),++i===e.length&&t(n)})})}function y(t,e,n,r,o,u,c,s){function f(){var e=t.data,n=r?1:0,i=e._id,o=e._rev,u=$n(e),c="INSERT INTO "+Rn+" (doc_id, rev, json, deleted) VALUES (?, ?, ?, ?);",s=[i,o,u,n];function f(t,n){var i,r,o,u=0,c=Object.keys(e._attachments||{});if(!c.length)return n();function s(){return++u===c.length&&n(),!1}for(var f=0;f<c.length;f++)i=c[f],r=void 0,o=void 0,r="INSERT INTO "+Nn+" (digest, seq) VALUES (?,?)",o=[e._attachments[i].digest,t],a.executeSql(r,o,s,s)}a.executeSql(c,s,function(t,e){var n=e.insertId;f(n,function(){b(t,n)})},function(){var t=Xn("seq",Rn,null,"doc_id=? AND rev=?");return a.executeSql(t,[i,o],function(t,e){var r=e.rows.item(0).seq,a="UPDATE "+Rn+" SET json=?, deleted=? WHERE doc_id=? AND rev=?;",c=[u,n,i,o];t.executeSql(a,c,function(t){f(r,function(){b(t,r)})})}),!1})}function l(t){v||(t?s(v=t):p===y.length&&f())}var v=null,p=0;t.data._id=t.metadata.id,t.data._rev=t.metadata.rev;var y=Object.keys(t.data._attachments||{});function g(t){p++,l(t)}function b(n,r){var u=t.metadata.id,a=t.stemmedRevs||[];o&&i.auto_compaction&&(a=St(t.metadata).concat(a)),a.length&&Kn(a,u,n),t.metadata.seq=r;var f=t.metadata.rev;delete t.metadata.rev;var l=o?"UPDATE "+Dn+" SET json=?, max_seq=?, winningseq=(SELECT seq FROM "+Rn+" WHERE doc_id="+Dn+".id AND rev=?) WHERE id=?":"INSERT INTO "+Dn+" (id, winningseq, max_seq, json) VALUES (?,?,?,?);",v=fn(t.metadata),p=o?[v,r,e,u]:[u,r,r,v];n.executeSql(l,p,function(){h[c]={ok:!0,id:t.metadata.id,rev:f},d.set(u,t.metadata),s()})}r&&(t.data._deleted=!0),y.forEach(function(n){var i=t.data._attachments[n];if(i.stub)p++,l();else{var r=i.data;delete i.data,i.revpos=parseInt(e,10),function(t,e,n){var i="SELECT digest FROM "+Bn+" WHERE digest=?";a.executeSql(i,[t],function(r,o){if(o.rows.length)return n();var u;i="INSERT INTO "+Bn+" (digest, body, escaped) VALUES (?,?,1)",r.executeSql(i,[t,(u=e,u.replace(/\u0002/g,"").replace(/\u0001/g,"").replace(/\u0000/g,""))],function(){n()},function(){return n(),!1})})}(i.digest,r,g)}}),y.length||f()}function g(){Qe(t.revs_limit,s,i,d,a,h,y,n)}ze(s,"binary",function(t){if(t)return u(t);r.transaction(function(t){a=t,p(function(t){t?l=t:function(t){if(!s.length)return t();var e=0;function n(){++e===s.length&&t()}s.forEach(function(t){if(t._id&&Jt(t._id))return n();var e=t.metadata.id;a.executeSql("SELECT json FROM "+Dn+" WHERE id = ?",[e],function(t,i){if(i.rows.length){var r=sn(i.rows.item(0).json);d.set(e,r)}n()})})}(g)})},Gn(u),v)})}var Vn=new A;function Yn(t){return t.websql(t.name,t.version,t.description,t.size)}function zn(t){var e=Vn.get(t.name);return e||(e=function(t){try{return{db:Yn(t)}}catch(t){return{error:t}}}(t),Vn.set(t.name,e)),e}var In=new $;function Qn(t,e,n,i,r){var o=Object.keys(t._attachments||{});if(!o.length)return r&&r();var u=0;function a(){++u===o.length&&r&&r()}o.forEach(function(r){e.attachments&&e.include_docs?function(t,r){var o=t._attachments[r],u={binary:e.binary,ctx:i};n._getAttachment(t._id,r,o,u,function(e,n){t._attachments[r]=K(j(o,["digest","content_type"]),{data:n}),a()})}(t,r):(t._attachments[r].stub=!0,a())})}var ti=1,ei="CREATE INDEX IF NOT EXISTS 'by-seq-deleted-idx' ON "+Rn+" (seq, deleted)",ni="CREATE UNIQUE INDEX IF NOT EXISTS 'by-seq-doc-id-rev' ON "+Rn+" (doc_id, rev)",ii="CREATE INDEX IF NOT EXISTS 'doc-winningseq-idx' ON "+Dn+" (winningseq)",ri="CREATE INDEX IF NOT EXISTS 'attach-seq-seq-idx' ON "+Nn+" (seq)",oi="CREATE UNIQUE INDEX IF NOT EXISTS 'attach-seq-digest-idx' ON "+Nn+" (digest, seq)",ui=Rn+".seq = "+Dn+".winningseq",ai=Rn+".seq AS seq, "+Rn+".deleted AS deleted, "+Rn+".json AS data, "+Rn+".rev AS rev, "+Dn+".json AS metadata";function ci(t,e){var n,i=this,r=null,o=function(t){return"size"in t?1e6*t.size:"undefined"!=typeof navigator&&/Android/.test(navigator.userAgent)?5e6:1}(t),u=[];i._name=t.name;var a=zn(K({},t,{version:ti,description:t.name,size:o}));if(a.error)return Gn(e)(a.error);var c=a.db;function s(){N()&&(window.localStorage["_pouch__websqldb_"+i._name]=!0),e(null,i)}function f(t,e){t.executeSql(ii),t.executeSql("ALTER TABLE "+Rn+" ADD COLUMN deleted TINYINT(1) DEFAULT 0",[],function(){t.executeSql(ei),t.executeSql("ALTER TABLE "+Dn+" ADD COLUMN local TINYINT(1) DEFAULT 0",[],function(){t.executeSql("CREATE INDEX IF NOT EXISTS 'doc-store-local-idx' ON "+Dn+" (local, id)");var n="SELECT "+Dn+".winningseq AS seq, "+Dn+".json AS metadata FROM "+Rn+" JOIN "+Dn+" ON "+Rn+".seq = "+Dn+".winningseq";t.executeSql(n,[],function(t,n){for(var i=[],r=[],o=0;o<n.rows.length;o++){var u=n.rows.item(o),a=u.seq,c=JSON.parse(u.metadata);$t(c)&&i.push(a),Jt(c.id)&&r.push(c.id)}t.executeSql("UPDATE "+Dn+"SET local = 1 WHERE id IN "+Hn(r.length),r,function(){t.executeSql("UPDATE "+Rn+" SET deleted = 1 WHERE seq IN "+Hn(i.length),i,e)})})})})}function l(t,e){var n="CREATE TABLE IF NOT EXISTS "+Cn+" (id UNIQUE, rev, json)";t.executeSql(n,[],function(){var n="SELECT "+Dn+".id AS id, "+Rn+".json AS data FROM "+Rn+" JOIN "+Dn+" ON "+Rn+".seq = "+Dn+".winningseq WHERE local = 1";t.executeSql(n,[],function(t,n){for(var i=[],r=0;r<n.rows.length;r++)i.push(n.rows.item(r));!function n(){if(!i.length)return e(t);var r=i.shift(),o=JSON.parse(r.data)._rev;t.executeSql("INSERT INTO "+Cn+" (id, rev, json) VALUES (?,?,?)",[r.id,o,r.data],function(t){t.executeSql("DELETE FROM "+Dn+" WHERE id=?",[r.id],function(t){t.executeSql("DELETE FROM "+Rn+" WHERE seq=?",[r.seq],function(){n()})})})}()})})}function h(t,e){function i(i){!function r(){if(!i.length)return e(t);var o=Fn(i.shift().hex,n),u=o.lastIndexOf("::"),a=o.substring(0,u),c=o.substring(u+2),s="UPDATE "+Rn+" SET doc_id=?, rev=? WHERE doc_id_rev=?";t.executeSql(s,[a,c,o],function(){r()})}()}var r="ALTER TABLE "+Rn+" ADD COLUMN doc_id";t.executeSql(r,[],function(t){var e="ALTER TABLE "+Rn+" ADD COLUMN rev";t.executeSql(e,[],function(t){t.executeSql(ni,[],function(t){var e="SELECT hex(doc_id_rev) as hex FROM "+Rn;t.executeSql(e,[],function(t,e){for(var n=[],r=0;r<e.rows.length;r++)n.push(e.rows.item(r));i(n)})})})})}function d(t,e){function n(t){var n="SELECT COUNT(*) AS cnt FROM "+Bn;t.executeSql(n,[],function(t,n){if(!n.rows.item(0).cnt)return e(t);var i=0,r=10;!function n(){var o=Xn(ai+", "+Dn+".id AS id",[Dn,Rn],ui,null,Dn+".id ");o+=" LIMIT "+r+" OFFSET "+i,i+=r,t.executeSql(o,[],function(t,i){if(!i.rows.length)return e(t);for(var r,o,u,a={},c=0;c<i.rows.length;c++)for(var s=i.rows.item(c),f=Jn(s.data,s.id,s.rev),l=Object.keys(f._attachments||{}),h=0;h<l.length;h++){var d=f._attachments[l[h]];r=d.digest,o=s.seq,u=void 0,-1===(u=a[r]=a[r]||[]).indexOf(o)&&u.push(o)}var v=[];if(Object.keys(a).forEach(function(t){a[t].forEach(function(e){v.push([t,e])})}),!v.length)return n();var p=0;v.forEach(function(e){var i="INSERT INTO "+Nn+" (digest, seq) VALUES (?,?)";t.executeSql(i,e,function(){++p===v.length&&n()})})})}()})}var i="CREATE TABLE IF NOT EXISTS "+Nn+" (digest, seq INTEGER)";t.executeSql(i,[],function(t){t.executeSql(oi,[],function(t){t.executeSql(ri,[],n)})})}function v(t,e){var n="ALTER TABLE "+Bn+" ADD COLUMN escaped TINYINT(1) DEFAULT 0";t.executeSql(n,[],e)}function p(t,e){var n="ALTER TABLE "+Dn+" ADD COLUMN max_seq INTEGER";t.executeSql(n,[],function(t){var n="UPDATE "+Dn+" SET max_seq=(SELECT MAX(seq) FROM "+Rn+" WHERE doc_id=id)";t.executeSql(n,[],function(t){var n="CREATE UNIQUE INDEX IF NOT EXISTS 'doc-max-seq-idx' ON "+Dn+" (max_seq)";t.executeSql(n,[],e)})})}function y(){for(;u.length>0;){u.pop()(null,r)}}function g(t,e){if(0===e){var n="CREATE TABLE IF NOT EXISTS "+Wn+" (dbid, db_version INTEGER)",i="CREATE TABLE IF NOT EXISTS "+Bn+" (digest UNIQUE, escaped TINYINT(1), body BLOB)",o="CREATE TABLE IF NOT EXISTS "+Nn+" (digest, seq INTEGER)",u="CREATE TABLE IF NOT EXISTS "+Dn+" (id unique, json, winningseq, max_seq INTEGER UNIQUE)",a="CREATE TABLE IF NOT EXISTS "+Rn+" (seq INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT, json, deleted TINYINT(1), doc_id, rev)",c="CREATE TABLE IF NOT EXISTS "+Cn+" (id UNIQUE, rev, json)";t.executeSql(i),t.executeSql(c),t.executeSql(o,[],function(){t.executeSql(ri),t.executeSql(oi)}),t.executeSql(u,[],function(){t.executeSql(ii),t.executeSql(a,[],function(){t.executeSql(ei),t.executeSql(ni),t.executeSql(n,[],function(){var e="INSERT INTO "+Wn+" (db_version, dbid) VALUES (?,?)";r=Lt();var n=[Un,r];t.executeSql(e,n,function(){y()})})})})}else{var s=[f,l,h,d,v,p,function(){e<Un&&t.executeSql("UPDATE "+Wn+" SET db_version = "+Un);var n="SELECT dbid FROM "+Wn;t.executeSql(n,[],function(t,e){r=e.rows.item(0).dbid,y()})}],g=e,b=function(t){s[g-1](t,b),g++};b(t)}}function b(t,e){var n="SELECT MAX(seq) AS seq FROM "+Rn;t.executeSql(n,[],function(t,n){var i=n.rows.item(0).seq||0;e(i)})}function w(t,e){var n=Xn("COUNT("+Dn+".id) AS 'num'",[Dn,Rn],ui,Rn+".deleted=0");t.executeSql(n,[],function(t,n){e(n.rows.item(0).num)})}"function"!=typeof c.readTransaction&&(c.readTransaction=c.transaction),c.transaction(function(t){!function(t,e){t.executeSql('SELECT HEX("a") AS hex',[],function(t,i){var r=i.rows.item(0).hex;n=2===r.length?"UTF-8":"UTF-16",e()})}(t,function(){!function(t){var e="SELECT sql FROM sqlite_master WHERE tbl_name = "+Wn;t.executeSql(e,[],function(t,e){e.rows.length?/db_version/.test(e.rows.item(0).sql)?t.executeSql("SELECT db_version FROM "+Wn,[],function(t,e){var n=e.rows.item(0).db_version;g(t,n)}):t.executeSql("ALTER TABLE "+Wn+" ADD COLUMN db_version INTEGER",[],function(){g(t,1)}):g(t,0)})}(t)})},Gn(e),s),i._remote=!1,i.type=function(){return"websql"},i._id=M(function(t){t(null,r)}),i._info=function(t){var e,i;c.readTransaction(function(t){b(t,function(t){e=t}),w(t,function(t){i=t})},Gn(t),function(){t(null,{doc_count:i,update_seq:e,websql_encoding:n})})},i._bulkDocs=function(e,n,r){Zn(t,e,n,i,c,In,r)},i._get=function(t,e,n){var r,o,u,a,s=e.ctx;if(!s)return c.readTransaction(function(r){i._get(t,K({ctx:r},e),n)});function f(t){n(t,{doc:r,metadata:o,ctx:s})}if(e.rev){if(e.latest)return void function(t,e,n,i,r){var o=Xn(ai,[Dn,Rn],ui,Dn+".id=?"),u=[e];t.executeSql(o,u,function(t,e){if(!e.rows.length){var o=ft(V,"missing");return r(o)}var u=sn(e.rows.item(0).metadata);i(Ht(n,u))})}(s,t,e.rev,function(r){e.latest=!1,e.rev=r,i._get(t,e,n)},f);u=Xn(ai,[Dn,Rn],Dn+".id="+Rn+".doc_id",[Rn+".doc_id=?",Rn+".rev=?"]),a=[t,e.rev]}else u=Xn(ai,[Dn,Rn],ui,Dn+".id=?"),a=[t];s.executeSql(u,a,function(t,n){if(!n.rows.length)return f(ft(V,"missing"));var i=n.rows.item(0);if(o=sn(i.metadata),i.deleted&&!e.rev)return f(ft(V,"deleted"));r=Jn(i.data,o.id,i.rev),f()})},i._allDocs=function(t,e){var n,r,o=[],u="startkey"in t&&t.startkey,a="endkey"in t&&t.endkey,s="key"in t&&t.key,f="keys"in t&&t.keys,l="descending"in t&&t.descending,h="limit"in t?t.limit:-1,d="skip"in t?t.skip:0,v=!1!==t.inclusive_end,p=[],y=[];if(f){var g=[],m="";f.forEach(function(t){-1===g.indexOf(t)&&(g.push(t),m+="?,")}),m=m.substring(0,m.length-1),y.push(Dn+".id IN ("+m+")"),p=p.concat(g)}else if(!1!==s)y.push(Dn+".id = ?"),p.push(s);else if(!1!==u||!1!==a){if(!1!==u&&(y.push(Dn+".id "+(l?"<=":">=")+" ?"),p.push(u)),!1!==a){var _=l?">":"<";v&&(_+="="),y.push(Dn+".id "+_+" ?"),p.push(a)}!1!==s&&(y.push(Dn+".id = ?"),p.push(s))}f||y.push(Rn+".deleted = 0"),c.readTransaction(function(e){if(w(e,function(t){n=t}),t.update_seq&&b(e,function(t){r=t}),0!==h){var u=Xn(ai,[Dn,Rn],ui,y,Dn+".id "+(l?"DESC":"ASC"));u+=" LIMIT "+h+" OFFSET "+d,e.executeSql(u,p,function(e,n){for(var r=0,u=n.rows.length;r<u;r++){var a=n.rows.item(r),c=sn(a.metadata),s=c.id,l=Jn(a.data,s,a.rev),h=l._rev,d={id:s,key:s,value:{rev:h}};if(t.include_docs){if(d.doc=l,d.doc._rev=h,t.conflicts){var v=Pt(c);v.length&&(d.doc._conflicts=v)}Qn(d.doc,t,i,e)}if(a.deleted){if(!f)continue;d.value.deleted=!0,d.doc=null}if(f){var p=f.indexOf(s,p);do{o[p]=d,p=f.indexOf(s,p+1)}while(p>-1&&p<f.length)}else o.push(d)}f&&f.forEach(function(t,e){o[e]||(o[e]={key:t,error:"not_found"})})})}},Gn(e),function(){var i={total_rows:n,offset:t.skip,rows:o};t.update_seq&&(i.update_seq=r),e(null,i)})},i._changes=function(t){if((t=L(t)).continuous){var e=i._name+":"+Lt();return In.addListener(i._name,e,i,t),In.notify(i._name),{cancel:function(){In.removeListener(i._name,e)}}}var n=t.descending;t.since=t.since&&!n?t.since:0;var r,o="limit"in t?t.limit:-1;0===o&&(o=1),r="return_docs"in t?t.return_docs:!("returnDocs"in t)||t.returnDocs;var u=[],a=0;!function(){var e=Dn+".json AS metadata, "+Dn+".max_seq AS maxSeq, "+Rn+".json AS winningDoc, "+Rn+".rev AS winningRev ",s=Dn+" JOIN "+Rn,f=Dn+".id="+Rn+".doc_id AND "+Dn+".winningseq="+Rn+".seq",l=["maxSeq > ?"],h=[t.since];t.doc_ids&&(l.push(Dn+".id IN "+Hn(t.doc_ids.length)),h=h.concat(t.doc_ids));var d=Xn(e,s,f,l,"maxSeq "+(n?"DESC":"ASC")),v=ht(t);t.view||t.filter||(d+=" LIMIT "+o);var p=t.since||0;c.readTransaction(function(e){e.executeSql(d,h,function(e,n){function c(e){return function(){t.onChange(e)}}for(var s=0,f=n.rows.length;s<f;s++){var l=n.rows.item(s),h=sn(l.metadata);p=l.maxSeq;var d=Jn(l.winningDoc,h.id,l.winningRev),y=t.processChange(d,h,t);y.seq=l.maxSeq;var g=v(y);if("object"==typeof g)return t.complete(g);if(g&&(a++,r&&u.push(y),t.attachments&&t.include_docs?Qn(d,t,i,e,c(y)):c(y)()),a===o)break}})},Gn(t.complete),function(){t.continuous||t.complete(null,{results:u,last_seq:p})})}()},i._close=function(t){t()},i._getAttachment=function(t,e,i,r,o){var u,a=r.ctx,c=i.digest,s=i.content_type,f="SELECT escaped, CASE WHEN escaped = 1 THEN body ELSE HEX(body) END AS body FROM "+Bn+" WHERE digest=?";a.executeSql(f,[c],function(t,e){var i=e.rows.item(0),a=i.escaped?i.body.replace(/\u0001\u0001/g,"\0").replace(/\u0001\u0002/g,"").replace(/\u0002\u0002/g,""):Fn(i.body,n);u=r.binary?Re(a,s):je(a),o(null,u)})},i._getRevisionTree=function(t,e){c.readTransaction(function(n){var i="SELECT json AS metadata FROM "+Dn+" WHERE id = ?";n.executeSql(i,[t],function(t,n){if(n.rows.length){var i=sn(n.rows.item(0).metadata);e(null,i.rev_tree)}else e(ft(V))})})},i._doCompaction=function(t,e,n){if(!e.length)return n();c.transaction(function(n){var i="SELECT json AS metadata FROM "+Dn+" WHERE id = ?";n.executeSql(i,[t],function(n,i){var r=sn(i.rows.item(0).metadata);Mt(r.rev_tree,function(t,n,i,r,o){var u=n+"-"+i;-1!==e.indexOf(u)&&(o.status="missing")});var o="UPDATE "+Dn+" SET json = ? WHERE id = ?";n.executeSql(o,[fn(r),t])}),Kn(e,t,n)},Gn(n),function(){n()})},i._getLocal=function(t,e){c.readTransaction(function(n){var i="SELECT json, rev FROM "+Cn+" WHERE id=?";n.executeSql(i,[t],function(n,i){if(i.rows.length){var r=i.rows.item(0),o=Jn(r.json,t,r.rev);e(null,o)}else e(ft(V))})})},i._putLocal=function(t,e,n){"function"==typeof e&&(n=e,e={}),delete t._revisions;var i,r=t._rev,o=t._id;i=t._rev=r?"0-"+(parseInt(r.split("-")[1],10)+1):"0-1";var u,a=$n(t);function s(t){var c,s;r?(c="UPDATE "+Cn+" SET rev=?, json=? WHERE id=? AND rev=?",s=[i,a,o,r]):(c="INSERT INTO "+Cn+" (id, rev, json) VALUES (?,?,?)",s=[o,i,a]),t.executeSql(c,s,function(t,r){r.rowsAffected?(u={ok:!0,id:o,rev:i},e.ctx&&n(null,u)):n(ft(Y))},function(){return n(ft(Y)),!1})}e.ctx?s(e.ctx):c.transaction(s,Gn(n),function(){u&&n(null,u)})},i._removeLocal=function(t,e,n){var i;function r(r){var o="DELETE FROM "+Cn+" WHERE id=? AND rev=?",u=[t._id,t._rev];r.executeSql(o,u,function(r,o){if(!o.rowsAffected)return n(ft(V));i={ok:!0,id:t._id,rev:"0-0"},e.ctx&&n(null,i)})}"function"==typeof e&&(n=e,e={}),e.ctx?r(e.ctx):c.transaction(r,Gn(n),function(){i&&n(null,i)})},i._destroy=function(t,e){In.removeAllListeners(i._name),c.transaction(function(t){[Dn,Rn,Bn,Wn,Cn,Nn].forEach(function(e){t.executeSql("DROP TABLE IF EXISTS "+e,[])})},Gn(e),function(){N()&&(delete window.localStorage["_pouch__websqldb_"+i._name],delete window.localStorage[i._name]),e(null,{ok:!0})})}}function si(){if("undefined"==typeof indexedDB||null===indexedDB||!/iP(hone|od|ad)/.test(navigator.userAgent))return!0;var t=N(),e="_pouch__websqldb_valid_"+navigator.userAgent;if(t&&localStorage[e])return"1"===localStorage[e];var n=function(){try{return openDatabase("_pouch_validate_websql",1,"",1),!0}catch(t){return!1}}();return t&&(localStorage[e]=n?"1":"0"),n}function fi(t,e,n,i){return openDatabase(t,e,n,i)}function li(t,e){J("warn","WebSQL is deprecated and will be removed in future releases of PouchDB. Please migrate to IndexedDB: https://pouchdb.com/2018/01/23/pouchdb-6.4.2.html");var n=K({websql:fi},t);ci.call(this,n,e)}function hi(t,e){var n,i,r,o=new Headers,u={method:t.method,credentials:"include",headers:o};return t.json&&(o.set("Accept","application/json"),o.set("Content-Type",t.headers["Content-Type"]||"application/json")),t.body&&t.processData&&"string"!=typeof t.body?u.body=JSON.stringify(t.body):u.body="body"in t?t.body:null,Object.keys(t.headers).forEach(function(e){t.headers.hasOwnProperty(e)&&o.set(e,t.headers[e])}),n=function(){for(var t={},e=new m(function(e,n){t.resolve=e,t.reject=n}),n=new Array(arguments.length),i=0;i<n.length;i++)n[i]=arguments[i];return t.promise=e,m.resolve().then(function(){return fetch.apply(null,n)}).then(function(e){t.resolve(e)}).catch(function(e){t.reject(e)}),t}(t.url,u),t.timeout>0&&(i=setTimeout(function(){n.reject(new Error("Load timeout for resource: "+t.url))},t.timeout)),n.promise.then(function(e){return r={statusCode:e.status},t.timeout>0&&clearTimeout(i),r.statusCode>=200&&r.statusCode<300?t.binary?e.blob():e.text():e.json()}).then(function(t){r.statusCode>=200&&r.statusCode<300?e(null,r,t):(t.status=r.statusCode,e(t))}).catch(function(t){t||(t=new Error("canceled")),e(t)}),{abort:n.reject}}li.valid=function(){return"function"==typeof openDatabase&&si()},li.use_prefix=!0;var di=function(){try{return new XMLHttpRequest,!0}catch(t){return!1}}();function vi(t,e){return di||t.xhr?function(t,e){var n,i,r=!1,o=function(){r=!0,n.abort(),a()},u={abort:function(){n.abort(),a()}},a=function(){clearTimeout(i),u.abort=function(){},n&&(n.onprogress=void 0,n.upload&&(n.upload.onprogress=void 0),n.onreadystatechange=void 0,n=void 0)};n=t.xhr?new t.xhr:new XMLHttpRequest;try{n.open(t.method,t.url)}catch(t){return e(new Error(t.name||"Url is invalid"))}for(var c in n.withCredentials=!("withCredentials"in t)||t.withCredentials,"GET"===t.method?delete t.headers["Content-Type"]:t.json&&(t.headers.Accept="application/json",t.headers["Content-Type"]=t.headers["Content-Type"]||"application/json",t.body&&t.processData&&"string"!=typeof t.body&&(t.body=JSON.stringify(t.body))),t.binary&&(n.responseType="arraybuffer"),"body"in t||(t.body=null),t.headers)t.headers.hasOwnProperty(c)&&n.setRequestHeader(c,t.headers[c]);return t.timeout>0&&(i=setTimeout(o,t.timeout),n.onprogress=function(){clearTimeout(i),4!==n.readyState&&(i=setTimeout(o,t.timeout))},void 0!==n.upload&&(n.upload.onprogress=n.onprogress)),n.onreadystatechange=function(){if(4===n.readyState){var i={statusCode:n.status};if(n.status>=200&&n.status<300){var o;o=t.binary?Ue([n.response||""],{type:n.getResponseHeader("Content-Type")}):n.responseText,e(null,i,o)}else{var u={};if(r)(u=new Error("ETIMEDOUT")).code="ETIMEDOUT";else if("string"==typeof n.response&&""!==n.response)try{u=JSON.parse(n.response)}catch(t){}u.status=n.status,e(u)}a()}},t.body&&t.body instanceof Blob?Je(t.body,function(t){n.send(t)}):n.send(t.body),u}(t,e):hi(t,e)}function pi(t,e){t=L(t);return(t=K({method:"GET",headers:{},json:!0,processData:!0,timeout:1e4,cache:!1},t)).json&&(t.binary||(t.headers.Accept="application/json"),t.headers["Content-Type"]=t.headers["Content-Type"]||"application/json"),t.binary&&(t.encoding=null,t.json=!1),t.processData||(t.json=!1),vi(t,function(n,i,r){if(n)return e(lt(n));var o,u=i.headers&&i.headers["content-type"],a=r||"";if(!t.binary&&(t.json||!t.processData)&&"object"!=typeof a&&(/json/.test(u)||/^[\s]*\{/.test(a)&&/\}[\s]*$/.test(a)))try{a=JSON.parse(a.toString())}catch(t){}i.statusCode>=200&&i.statusCode<300?function(e,n,i){if(!t.binary&&t.json&&"string"==typeof e)try{e=JSON.parse(e)}catch(t){return i(t)}Array.isArray(e)&&(e=e.map(function(t){return t.error||t.missing?lt(t):t})),t.binary,i(null,e,n)}(a,i,e):((o=lt(a)).status=i.statusCode,e(o))})}function yi(t,e){var n=navigator&&navigator.userAgent?navigator.userAgent.toLowerCase():"",i=-1!==n.indexOf("safari")&&-1===n.indexOf("chrome"),r=-1!==n.indexOf("msie"),o=-1!==n.indexOf("trident"),u=-1!==n.indexOf("edge"),a=i||(r||o||u)&&"GET"===t.method,c=!("cache"in t)||t.cache;if(!/^blob:/.test(t.url)&&(a||!c)){var s=-1!==t.url.indexOf("?");t.url+=(s?"&":"?")+"_nonce="+Date.now()}return pi(t,e)}var gi=25,bi=50,wi=5e3,mi=1e4,_i={};function ki(t){var e=(t.doc||t.ok)._attachments;e&&Object.keys(e).forEach(function(t){var n=e[t];n.data=Be(n.data,n.content_type)})}function Ai(t){return/^_design/.test(t)?"_design/"+encodeURIComponent(t.slice(8)):/^_local/.test(t)?"_local/"+encodeURIComponent(t.slice(7)):encodeURIComponent(t)}function xi(t){return t._attachments&&Object.keys(t._attachments)?m.all(Object.keys(t._attachments).map(function(e){var n=t._attachments[e];if(n.data&&"string"!=typeof n.data)return new m(function(t){$e(n.data,t)}).then(function(t){n.data=t})})):m.resolve()}function Ei(t,e){if(function(t){if(!t.prefix)return!1;var e=kt(t.prefix).protocol;return"http"===e||"https"===e}(e)){var n=e.name.substr(e.prefix.length);t=e.prefix+encodeURIComponent(n)}var i=kt(t);(i.user||i.password)&&(i.auth={username:i.user,password:i.password});var r=i.path.replace(/(^\/|\/$)/g,"").split("/");return i.db=r.pop(),-1===i.db.indexOf("%")&&(i.db=encodeURIComponent(i.db)),i.path=r.join("/"),i}function Li(t,e){return Oi(t,t.db+"/"+e)}function Oi(t,e){var n=t.path?"/":"";return t.protocol+"://"+t.host+(t.port?":"+t.port:"")+"/"+t.path+n+e}function Mi(t){return"?"+Object.keys(t).map(function(e){return e+"="+encodeURIComponent(t[e])}).join("&")}function Ti(t,e){var n,i=this,r=Ei(t.name,t),o=Li(r,""),a=(t=L(t)).ajax||{};if(t.auth||r.auth){var s=t.auth||r.auth,f=s.username+":"+s.password,l=je(unescape(encodeURIComponent(f)));a.headers=a.headers||{},a.headers.Authorization="Basic "+l}function h(t,e,n){var r=(t||{}).ajax||{},o=K(L(a),r,e),u=L(a.headers||{});return o.headers=K(u,r.headers,e.headers||{}),i.constructor.listeners("debug").length&&i.constructor.emit("debug",["http",o.method,o.url]),i._ajax(o,n)}function d(t,e){return new m(function(n,i){h(t,e,function(t,e){if(t)return i(t);n(e)})})}function v(t,e){return T(t,u()(function(t){p().then(function(){return e.apply(this,t)}).catch(function(e){t.pop()(e)})}))}function p(){return t.skipSetup||t.skip_setup?m.resolve():n||((n=d({},{method:"GET",url:o}).catch(function(t){return t&&t.status&&404===t.status?(X(404,"PouchDB is just detecting if the remote exists."),d({},{method:"PUT",url:o})):m.reject(t)}).catch(function(t){return!(!t||!t.status||412!==t.status)||m.reject(t)})).catch(function(){n=null}),n)}function y(t){return t.split("/").map(encodeURIComponent).join("/")}i._ajax=yi,c()(function(){e(null,i)}),i._remote=!0,i.type=function(){return"http"},i.id=v("id",function(t){h({},{method:"GET",url:Oi(r,"")},function(e,n){var i=n&&n.uuid?n.uuid+r.db:Li(r,"");t(null,i)})}),i.request=v("request",function(t,e){t.url=Li(r,t.url),h({},t,e)}),i.compact=v("compact",function(t,e){"function"==typeof t&&(e=t,t={}),h(t=L(t),{url:Li(r,"_compact"),method:"POST"},function(){!function n(){i.info(function(i,r){r&&!r.compact_running?e(null,{ok:!0}):setTimeout(n,t.interval||200)})}()})}),i.bulkGet=T("bulkGet",function(t,e){var n=this;function i(e){var n={};t.revs&&(n.revs=!0),t.attachments&&(n.attachments=!0),t.latest&&(n.latest=!0),h(t,{url:Li(r,"_bulk_get"+Mi(n)),method:"POST",body:{docs:t.docs}},function(n,i){!n&&t.attachments&&t.binary&&i.results.forEach(function(t){t.docs.forEach(ki)}),e(n,i)})}function o(){var i=bi,r=Math.ceil(t.docs.length/i),o=0,u=new Array(r);function c(t){return function(n,i){u[t]=i.results,++o===r&&e(null,{results:dt(u)})}}for(var s=0;s<r;s++){var f=j(t,["revs","attachments","binary","latest"]);f.ajax=a,f.docs=t.docs.slice(s*i,Math.min(t.docs.length,(s+1)*i)),C(n,f,c(s))}}var u=Oi(r,""),c=_i[u];"boolean"!=typeof c?i(function(t,n){t?(_i[u]=!1,X(t.status,"PouchDB is just detecting if the remote supports the _bulk_get API."),o()):(_i[u]=!0,e(null,n))}):c?i(e):o()}),i._info=function(t){p().then(function(){h({},{method:"GET",url:Li(r,"")},function(e,n){if(e)return t(e);n.host=Li(r,""),t(null,n)})}).catch(t)},i.get=v("get",function(t,e,n){"function"==typeof e&&(n=e,e={});var i={};(e=L(e)).revs&&(i.revs=!0),e.revs_info&&(i.revs_info=!0),e.latest&&(i.latest=!0),e.open_revs&&("all"!==e.open_revs&&(e.open_revs=JSON.stringify(e.open_revs)),i.open_revs=e.open_revs),e.rev&&(i.rev=e.rev),e.conflicts&&(i.conflicts=e.conflicts),e.update_seq&&(i.update_seq=e.update_seq),t=Ai(t);var o={method:"GET",url:Li(r,t+Mi(i))};function u(t){var n=t._attachments,i=n&&Object.keys(n);if(n&&i.length)return function(t,e){return new m(function(n,i){var r,o=0,u=0,a=0,c=t.length;function s(){++a===c?r?i(r):n():h()}function f(){o--,s()}function l(t){o--,r=r||t,s()}function h(){for(;o<e&&u<c;)o++,t[u++]().then(f,l)}h()})}(i.map(function(i){return function(){return function(i){var o=n[i],u=Ai(t._id)+"/"+y(i)+"?rev="+t._rev;return d(e,{method:"GET",url:Li(r,u),binary:!0}).then(function(t){return e.binary?t:new m(function(e){$e(t,e)})}).then(function(t){delete o.stub,delete o.length,o.data=t})}(i)}}),5)}d(e,o).then(function(t){return m.resolve().then(function(){if(e.attachments)return n=t,Array.isArray(n)?m.all(n.map(function(t){if(t.ok)return u(t.ok)})):u(n);var n}).then(function(){n(null,t)})}).catch(function(e){e.docId=t,n(e)})}),i.remove=v("remove",function(t,e,n,i){var o;"string"==typeof e?(o={_id:t,_rev:e},"function"==typeof n&&(i=n,n={})):(o=t,"function"==typeof e?(i=e,n={}):(i=n,n=e));var u=o._rev||n.rev;h(n,{method:"DELETE",url:Li(r,Ai(o._id))+"?rev="+u},i)}),i.getAttachment=v("getAttachment",function(t,e,n,i){"function"==typeof n&&(i=n,n={});var o=n.rev?"?rev="+n.rev:"";h(n,{method:"GET",url:Li(r,Ai(t))+"/"+y(e)+o,binary:!0},i)}),i.removeAttachment=v("removeAttachment",function(t,e,n,i){h({},{method:"DELETE",url:Li(r,Ai(t)+"/"+y(e))+"?rev="+n},i)}),i.putAttachment=v("putAttachment",function(t,e,n,i,o,u){"function"==typeof o&&(u=o,o=i,i=n,n=null);var c=Ai(t)+"/"+y(e),s=Li(r,c);if(n&&(s+="?rev="+n),"string"==typeof i){var f;try{f=Fe(i)}catch(t){return u(ft(et,"Attachment is not a valid base64 string"))}i=f?Re(f,o):""}h({},{headers:{"Content-Type":o},method:"PUT",url:s,processData:!1,body:i,timeout:a.timeout||6e4},u)}),i._bulkDocs=function(t,e,n){t.new_edits=e.new_edits,p().then(function(){return m.all(t.docs.map(xi))}).then(function(){h(e,{method:"POST",url:Li(r,"_bulk_docs"),timeout:e.timeout,body:t},function(t,e){if(t)return n(t);e.forEach(function(t){t.ok=!0}),n(null,e)})}).catch(n)},i._put=function(t,e,n){p().then(function(){return xi(t)}).then(function(){h(e,{method:"PUT",url:Li(r,Ai(t._id)),body:t},function(e,i){if(e)return e.docId=t&&t._id,n(e);n(null,i)})}).catch(n)},i.allDocs=v("allDocs",function(t,e){"function"==typeof t&&(e=t,t={});var n,i={},o="GET";(t=L(t)).conflicts&&(i.conflicts=!0),t.update_seq&&(i.update_seq=!0),t.descending&&(i.descending=!0),t.include_docs&&(i.include_docs=!0),t.attachments&&(i.attachments=!0),t.key&&(i.key=JSON.stringify(t.key)),t.start_key&&(t.startkey=t.start_key),t.startkey&&(i.startkey=JSON.stringify(t.startkey)),t.end_key&&(t.endkey=t.end_key),t.endkey&&(i.endkey=JSON.stringify(t.endkey)),void 0!==t.inclusive_end&&(i.inclusive_end=!!t.inclusive_end),void 0!==t.limit&&(i.limit=t.limit),void 0!==t.skip&&(i.skip=t.skip);var u=Mi(i);void 0!==t.keys&&(o="POST",n={keys:t.keys}),d(t,{method:o,url:Li(r,"_all_docs"+u),body:n}).then(function(n){t.include_docs&&t.attachments&&t.binary&&n.rows.forEach(ki),e(null,n)}).catch(e)}),i._changes=function(t){var e="batch_size"in t?t.batch_size:gi;!(t=L(t)).continuous||"heartbeat"in t||(t.heartbeat=mi);var n="timeout"in t?t.timeout:"timeout"in a?a.timeout:3e4;"timeout"in t&&t.timeout&&n-t.timeout<wi&&(n=t.timeout+wi),"heartbeat"in t&&t.heartbeat&&n-t.heartbeat<wi&&(n=t.heartbeat+wi);var i={};"timeout"in t&&t.timeout&&(i.timeout=t.timeout);var o,u=void 0!==t.limit&&t.limit;o="return_docs"in t?t.return_docs:!("returnDocs"in t)||t.returnDocs;var s=u;if(t.style&&(i.style=t.style),(t.include_docs||t.filter&&"function"==typeof t.filter)&&(i.include_docs=!0),t.attachments&&(i.attachments=!0),t.continuous&&(i.feed="longpoll"),t.seq_interval&&(i.seq_interval=t.seq_interval),t.conflicts&&(i.conflicts=!0),t.descending&&(i.descending=!0),t.update_seq&&(i.update_seq=!0),"heartbeat"in t&&t.heartbeat&&(i.heartbeat=t.heartbeat),t.filter&&"string"==typeof t.filter&&(i.filter=t.filter),t.view&&"string"==typeof t.view&&(i.filter="_view",i.view=t.view),t.query_params&&"object"==typeof t.query_params)for(var f in t.query_params)t.query_params.hasOwnProperty(f)&&(i[f]=t.query_params[f]);var l,d,v,y="GET";t.doc_ids?(i.filter="_doc_ids",y="POST",l={doc_ids:t.doc_ids}):t.selector&&(i.filter="_selector",y="POST",l={selector:t.selector});var g=function(o,a){if(!t.aborted){i.since=o,"object"==typeof i.since&&(i.since=JSON.stringify(i.since)),t.descending?u&&(i.limit=s):i.limit=!u||s>e?e:s;var c={method:y,url:Li(r,"_changes"+Mi(i)),timeout:n,body:l};v=o,t.aborted||p().then(function(){d=h(t,c,a)}).catch(a)}},b={results:[]},w=function(n,i){if(!t.aborted){var r=0;if(i&&i.results){r=i.results.length,b.last_seq=i.last_seq;var a=null,f=null;"number"==typeof i.pending&&(a=i.pending),"string"!=typeof b.last_seq&&"number"!=typeof b.last_seq||(f=b.last_seq);t.query_params,i.results=i.results.filter(function(e){s--;var n=ht(t)(e);return n&&(t.include_docs&&t.attachments&&t.binary&&ki(e),o&&b.results.push(e),t.onChange(e,a,f)),n})}else if(n)return t.aborted=!0,void t.complete(n);i&&i.last_seq&&(v=i.last_seq);var l=u&&s<=0||i&&r<e||t.descending;(!t.continuous||u&&s<=0)&&l?t.complete(null,b):c()(function(){g(v,w)})}};return g(t.since||0,w),{cancel:function(){t.aborted=!0,d&&d.abort()}}},i.revsDiff=v("revsDiff",function(t,e,n){"function"==typeof e&&(n=e,e={}),h(e,{method:"POST",url:Li(r,"_revs_diff"),body:t},n)}),i._close=function(t){t()},i._destroy=function(t,e){h(t,{url:Li(r,""),method:"DELETE"},function(t,n){if(t&&t.status&&404!==t.status)return e(t);e(null,n)})}}function qi(t){this.status=400,this.name="query_parse_error",this.message=t,this.error=!0;try{Error.captureStackTrace(this,qi)}catch(t){}}function Pi(t){this.status=404,this.name="not_found",this.message=t,this.error=!0;try{Error.captureStackTrace(this,Pi)}catch(t){}}function Si(t){this.status=500,this.name="invalid_value",this.message=t,this.error=!0;try{Error.captureStackTrace(this,Si)}catch(t){}}function Fi(t,e){return e&&t.then(function(t){c()(function(){e(null,t)})},function(t){c()(function(){e(t)})}),t}function ji(t,e){return function(){var n=arguments,i=this;return t.add(function(){return e.apply(i,n)})}}function Ui(t){var e=new k(t),n=new Array(e.size),i=-1;return e.forEach(function(t){n[++i]=t}),n}function Di(t){var e=new Array(t.size),n=-1;return t.forEach(function(t,i){e[++n]=i}),e}function Ri(t){return new Si("builtin "+t+" function requires map values to be numbers or number arrays")}function Bi(t){for(var e=0,n=0,i=t.length;n<i;n++){var r=t[n];if("number"!=typeof r){if(!Array.isArray(r))throw Ri("_sum");e="number"==typeof e?[e]:e;for(var o=0,u=r.length;o<u;o++){var a=r[o];if("number"!=typeof a)throw Ri("_sum");void 0===e[o]?e.push(a):e[o]+=a}}else"number"==typeof e?e+=r:e[0]+=r}return e}Ti.valid=function(){return!0},l()(qi,Error),l()(Pi,Error),l()(Si,Error);var Ci=J.bind(null,"log"),Wi=Array.isArray,Ni=JSON.parse;function $i(t,e){return At("return ("+t.replace(/;\s*$/,"")+");",{emit:e,sum:Bi,log:Ci,isArray:Wi,toJSON:Ni})}function Ji(){this.promise=new m(function(t){t()})}function Hi(t){if(!t)return"undefined";switch(typeof t){case"function":case"string":return t.toString();default:return JSON.stringify(t)}}function Xi(t,e,n,i,r,o){var u,a=function(t,e){return Hi(t)+Hi(e)+"undefined"}(n,i);if(!r&&(u=t._cachedViews=t._cachedViews||{})[a])return u[a];var c=t.info().then(function(c){var s,f=c.db_name+"-mrview-"+(r?"temp":(s=a,g.a.hash(s)));return xt(t,"_local/"+o,function(t){t.views=t.views||{};var n=e;-1===n.indexOf("/")&&(n=e+"/"+e);var i=t.views[n]=t.views[n]||{};if(!i[f])return i[f]=!0,t}).then(function(){return t.registerDependentDatabase(f).then(function(e){var r=e.db;r.auto_compaction=!0;var o={name:f,db:r,sourceDB:t,adapter:t.adapter,mapFun:n,reduceFun:i};return o.db.get("_local/lastSeq").catch(function(t){if(404!==t.status)throw t}).then(function(t){return o.seq=t?t.seq:0,u&&o.db.once("destroyed",function(){delete u[a]}),o})})})});return u&&(u[a]=c),c}Ji.prototype.add=function(t){return this.promise=this.promise.catch(function(){}).then(function(){return t()}),this.promise},Ji.prototype.finish=function(){return this.promise};var Ki={},Gi=new Ji,Zi=50;function Vi(t){return-1===t.indexOf("/")?[t,t]:t.split("/")}function Yi(t,e){try{t.emit("error",e)}catch(t){J("error","The user's map/reduce function threw an uncaught error.\nYou can debug this error by doing:\nmyDatabase.on('error', function (err) { debugger; });\nPlease double-check your map/reduce function."),J("error",e)}}var zi={_sum:function(t,e){return Bi(e)},_count:function(t,e){return e.length},_stats:function(t,e){return{sum:Bi(e),min:Math.min.apply(null,e),max:Math.max.apply(null,e),count:e.length,sumsqr:function(t){for(var e=0,n=0,i=t.length;n<i;n++){var r=t[n];e+=r*r}return e}(e)}}};var Ii=function(t,e,n,i){function r(t,e,n){try{e(n)}catch(e){Yi(t,e)}}function o(t,e,n,i,r){try{return{output:e(n,i,r)}}catch(e){return Yi(t,e),{error:e}}}function a(t,e){var n=se(t.key,e.key);return 0!==n?n:se(t.value,e.value)}function s(t,e,n){return n=n||0,"number"==typeof e?t.slice(n,e+n):n>0?t.slice(n):t}function f(t){var e=t.value;return e&&"object"==typeof e&&e._id||t.id}function l(t){return function(e){return t.include_docs&&t.attachments&&t.binary&&function(t){t.rows.forEach(function(t){var e=t.doc&&t.doc._attachments;e&&Object.keys(e).forEach(function(t){var n=e[t];e[t].data=Be(n.data,n.content_type)})})}(e),e}}function h(t,e,n,i){var r=e[t];void 0!==r&&(i&&(r=encodeURIComponent(JSON.stringify(r))),n.push(t+"="+r))}function d(t){if(void 0!==t){var e=Number(t);return isNaN(e)||e!==parseInt(t,10)?t:e}}function v(t,e){var n=t.descending?"endkey":"startkey",i=t.descending?"startkey":"endkey";if(void 0!==t[n]&&void 0!==t[i]&&se(t[n],t[i])>0)throw new qi("No rows can match your key range, reverse your start_key and end_key or set {descending : true}");if(e.reduce&&!1!==t.reduce){if(t.include_docs)throw new qi("{include_docs:true} is invalid for reduce");if(t.keys&&t.keys.length>1&&!t.group&&!t.group_level)throw new qi("Multi-key fetches for reduce views must use {group: true}")}["group_level","limit","skip"].forEach(function(e){var n=function(t){if(t){if("number"!=typeof t)return new qi('Invalid value for integer: "'+t+'"');if(t<0)return new qi('Invalid value for positive integer: "'+t+'"')}}(t[e]);if(n)throw n})}function p(t){return function(e){if(404===e.status)return t;throw e}}function y(t,e,n){var i="_local/doc_"+t,r={_id:i,keys:[]},o=n.get(t),u=o[0];return(function(t){return 1===t.length&&/^1-/.test(t[0].rev)}(o[1])?m.resolve(r):e.db.get(i).catch(p(r))).then(function(t){return function(t){return t.keys.length?e.db.allDocs({keys:t.keys,include_docs:!0}):m.resolve({rows:[]})}(t).then(function(e){return function(t,e){for(var n=[],i=new k,r=0,o=e.rows.length;r<o;r++){var a=e.rows[r].doc;if(a&&(n.push(a),i.add(a._id),a._deleted=!u.has(a._id),!a._deleted)){var c=u.get(a._id);"value"in c&&(a.value=c.value)}}var s=Di(u);return s.forEach(function(t){if(!i.has(t)){var e={_id:t},r=u.get(t);"value"in r&&(e.value=r.value),n.push(e)}}),t.keys=Ui(s.concat(t.keys)),n.push(t),n}(t,e)})})}function g(t){var e="string"==typeof t?t:t.name,n=Ki[e];return n||(n=Ki[e]=new Ji),n}function b(t){return ji(g(t),function(){return function(t){var n,i,o=e(t.mapFun,function(t,e){var r={id:i._id,key:fe(t)};null!=e&&(r.value=fe(e)),n.push(r)}),u=t.seq||0;function c(e,n){return function(){return function(t,e,n){return t.db.get("_local/lastSeq").catch(p({_id:"_local/lastSeq",seq:0})).then(function(i){var r=Di(e);return m.all(r.map(function(n){return y(n,t,e)})).then(function(e){var r=dt(e);return i.seq=n,r.push(i),t.db.bulkDocs({docs:r})})})}(t,e,n)}}var s=new Ji;function f(){return t.sourceDB.changes({conflicts:!0,include_docs:!0,style:"all_docs",since:u,limit:Zi}).then(l)}function l(e){var l=e.results;if(l.length){var d=function(e){for(var c=new A,s=0,f=e.length;s<f;s++){var l=e[s];if("_"!==l.doc._id[0]){n=[],(i=l.doc)._deleted||r(t.sourceDB,o,i),n.sort(a);var d=h(n);c.set(l.doc._id,[d,l.changes])}u=l.seq}return c}(l);if(s.add(c(d,u)),!(l.length<Zi))return f()}}function h(t){for(var e,n=new A,i=0,r=t.length;i<r;i++){var o=t[i],u=[o.key,o.id];i>0&&0===se(o.key,e)&&u.push(i),n.set(he(u),o),e=o.key}return n}return f().then(function(){return s.finish()}).then(function(){t.seq=u})}(t)})()}function w(t,e){return ji(g(t),function(){return function(t,e){var i,r=t.reduceFun&&!1!==e.reduce,u=e.skip||0;function a(e){return e.include_docs=!0,t.db.allDocs(e).then(function(t){return i=t.total_rows,t.rows.map(function(t){if("value"in t.doc&&"object"==typeof t.doc.value&&null!==t.doc.value){var e=Object.keys(t.doc.value).sort(),n=["id","key","value"];if(!(e<n||e>n))return t.doc.value}var i=function(t){for(var e=[],n=[],i=0;;){var r=t[i++];if("\0"!==r)switch(r){case"1":e.push(null);break;case"2":e.push("1"===t[i]),i++;break;case"3":var o=de(t,i);e.push(o.num),i+=o.length;break;case"4":for(var u="";;){var a=t[i];if("\0"===a)break;u+=a,i++}u=u.replace(/\u0001\u0001/g,"\0").replace(/\u0001\u0002/g,"").replace(/\u0002\u0002/g,""),e.push(u);break;case"5":var c={element:[],index:e.length};e.push(c.element),n.push(c);break;case"6":var s={element:{},index:e.length};e.push(s.element),n.push(s);break;default:throw new Error("bad collationIndex or unexpectedly reached end of input: "+r)}else{if(1===e.length)return e.pop();ve(e,n)}}}(t.doc._id);return{key:i[0],id:i[1],value:"value"in t.doc?t.doc.value:null}})})}function c(a){var c;if(c=r?function(t,e,i){0===i.group_level&&delete i.group_level;var r=i.group||i.group_level,u=n(t.reduceFun),a=[],c=isNaN(i.group_level)?Number.POSITIVE_INFINITY:i.group_level;e.forEach(function(t){var e=a[a.length-1],n=r?t.key:null;if(r&&Array.isArray(n)&&(n=n.slice(0,c)),e&&0===se(e.groupKey,n))return e.keys.push([t.key,t.id]),void e.values.push(t.value);a.push({keys:[[t.key,t.id]],values:[t.value],groupKey:n})}),e=[];for(var f=0,l=a.length;f<l;f++){var h=a[f],d=o(t.sourceDB,u,h.keys,h.values,!1);if(d.error&&d.error instanceof Si)throw d.error;e.push({value:d.error?null:d.output,key:h.groupKey})}return{rows:s(e,i.limit,i.skip)}}(t,a,e):{total_rows:i,offset:u,rows:a},e.update_seq&&(c.update_seq=t.seq),e.include_docs){var l=Ui(a.map(f));return t.sourceDB.allDocs({keys:l,include_docs:!0,conflicts:e.conflicts,attachments:e.attachments,binary:e.binary}).then(function(t){var e=new A;return t.rows.forEach(function(t){e.set(t.id,t.doc)}),a.forEach(function(t){var n=f(t),i=e.get(n);i&&(t.doc=i)}),c})}return c}if(void 0===e.keys||e.keys.length||(e.limit=0,delete e.keys),void 0!==e.keys){var l=e.keys,h=l.map(function(t){var n={startkey:he([t]),endkey:he([t,{}])};return e.update_seq&&(n.update_seq=!0),a(n)});return m.all(h).then(dt).then(c)}var d,v,p={descending:e.descending};if(e.update_seq&&(p.update_seq=!0),"start_key"in e&&(d=e.start_key),"startkey"in e&&(d=e.startkey),"end_key"in e&&(v=e.end_key),"endkey"in e&&(v=e.endkey),void 0!==d&&(p.startkey=e.descending?he([d,{}]):he([d])),void 0!==v){var y=!1!==e.inclusive_end;e.descending&&(y=!y),p.endkey=he(y?[v,{}]:[v])}if(void 0!==e.key){var g=he([e.key]),b=he([e.key,{}]);p.descending?(p.endkey=g,p.startkey=b):(p.startkey=g,p.endkey=b)}return r||("number"==typeof e.limit&&(p.limit=e.limit),p.skip=u),a(p).then(c)}(t,e)})()}function _(e,n,r){if("function"==typeof e._query)return function(t,e,n){return new m(function(i,r){t._query(e,n,function(t,e){if(t)return r(t);i(e)})})}(e,n,r);if(pt(e))return function(t,e,n){var i,r=[],o="GET";if(h("reduce",n,r),h("include_docs",n,r),h("attachments",n,r),h("limit",n,r),h("descending",n,r),h("group",n,r),h("group_level",n,r),h("skip",n,r),h("stale",n,r),h("conflicts",n,r),h("startkey",n,r,!0),h("start_key",n,r,!0),h("endkey",n,r,!0),h("end_key",n,r,!0),h("inclusive_end",n,r),h("key",n,r,!0),h("update_seq",n,r),r=""===(r=r.join("&"))?"":"?"+r,void 0!==n.keys){var u="keys="+encodeURIComponent(JSON.stringify(n.keys));u.length+r.length+1<=2e3?r+=("?"===r[0]?"&":"?")+u:(o="POST","string"==typeof e?i={keys:n.keys}:e.keys=n.keys)}if("string"==typeof e){var a=Vi(e);return t.request({method:o,url:"_design/"+a[0]+"/_view/"+a[1]+r,body:i}).then(function(t){return t.rows.forEach(function(t){if(t.value&&t.value.error&&"builtin_reduce_error"===t.value.error)throw new Error(t.reason)}),t}).then(l(n))}return i=i||{},Object.keys(e).forEach(function(t){Array.isArray(e[t])?i[t]=e[t]:i[t]=e[t].toString()}),t.request({method:"POST",url:"_temp_view"+r,body:i}).then(l(n))}(e,n,r);if("string"!=typeof n)return v(r,n),Gi.add(function(){return Xi(e,"temp_view/temp_view",n.map,n.reduce,!0,t).then(function(t){return e=b(t).then(function(){return w(t,r)}),n=function(){return t.db.destroy()},e.then(function(t){return n().then(function(){return t})},function(t){return n().then(function(){throw t})});var e,n})}),Gi.finish();var o=n,u=Vi(o),a=u[0],s=u[1];return e.get("_design/"+a).then(function(n){var u=n.views&&n.views[s];if(!u)throw new Pi("ddoc "+n._id+" has no view named "+s);return i(n,s),v(r,u),Xi(e,o,u.map,u.reduce,!1,t).then(function(t){return"ok"===r.stale||"update_after"===r.stale?("update_after"===r.stale&&c()(function(){b(t)}),w(t,r)):b(t).then(function(){return w(t,r)})})})}var x;return{query:function(t,e,n){var i=this;"function"==typeof e&&(n=e,e={}),e=e?function(t){return t.group_level=d(t.group_level),t.limit=d(t.limit),t.skip=d(t.skip),t}(e):{},"function"==typeof t&&(t={map:t});var r=m.resolve().then(function(){return _(i,t,e)});return Fi(r,n),r},viewCleanup:(x=function(){var e=this;return"function"==typeof e._viewCleanup?function(t){return new m(function(e,n){t._viewCleanup(function(t,i){if(t)return n(t);e(i)})})}(e):pt(e)?function(t){return t.request({method:"POST",url:"_view_cleanup"})}(e):function(e){return e.get("_local/"+t).then(function(t){var n=new A;Object.keys(t.views).forEach(function(t){var e=Vi(t),i="_design/"+e[0],r=e[1],o=n.get(i);o||(o=new k,n.set(i,o)),o.add(r)});var i={keys:Di(n),include_docs:!0};return e.allDocs(i).then(function(i){var r={};i.rows.forEach(function(e){var i=e.key.substring(8);n.get(e.key).forEach(function(n){var o=i+"/"+n;t.views[o]||(o=n);var u=Object.keys(t.views[o]),a=e.doc&&e.doc.views&&e.doc.views[n];u.forEach(function(t){r[t]=r[t]||a})})});var o=Object.keys(r).filter(function(t){return!r[t]}).map(function(t){return ji(g(t),function(){return new e.constructor(t,e.__opts).destroy()})()});return m.all(o).then(function(){return{ok:!0}})})},p({ok:!0}))}(e)},u()(function(t){var e=t.pop(),n=x.apply(this,t);return"function"==typeof e&&Fi(n,e),n}))}}("mrviews",function(t,e){if("function"==typeof t&&2===t.length){var n=t;return function(t){return n(t,e)}}return $i(t.toString(),e)},function(t){var e=t.toString(),n=function(t){if(/^_sum/.test(t))return zi._sum;if(/^_count/.test(t))return zi._count;if(/^_stats/.test(t))return zi._stats;if(/^_/.test(t))throw new Error(t+" is not a supported reduce function.")}(e);return n||$i(e)},function(t,e){var n=t.views&&t.views[e];if("string"!=typeof n.map)throw new Pi("ddoc "+t._id+" has no string view named "+e+", instead found object of type: "+typeof n.map)});var Qi={query:function(t,e,n){return Ii.query.call(this,t,e,n)},viewCleanup:function(t){return Ii.viewCleanup.call(this,t)}};function tr(t){return/^1-/.test(t)}function er(t,e){var n=Object.keys(e._attachments);return m.all(n.map(function(n){return t.getAttachment(e._id,n,{rev:e._rev})}))}function nr(t,e,n,i){n=L(n);var r=[],o=!0;function u(e){return t.allDocs({keys:e,include_docs:!0,conflicts:!0}).then(function(t){if(i.cancelled)throw new Error("cancelled");t.rows.forEach(function(t){var e;t.deleted||!t.doc||!tr(t.value.rev)||(e=t.doc,e._attachments&&Object.keys(e._attachments).length>0)||function(t){return t._conflicts&&t._conflicts.length>0}(t.doc)||(t.doc._conflicts&&delete t.doc._conflicts,r.push(t.doc),delete n[t.id])})})}return m.resolve().then(function(){var t=Object.keys(n).filter(function(t){var e=n[t].missing;return 1===e.length&&tr(e[0])});if(t.length>0)return u(t)}).then(function(){var u=function(t){var e=[];return Object.keys(t).forEach(function(n){t[n].missing.forEach(function(t){e.push({id:n,rev:t})})}),{docs:e,revs:!0,latest:!0}}(n);if(u.docs.length)return t.bulkGet(u).then(function(n){if(i.cancelled)throw new Error("cancelled");return m.all(n.results.map(function(n){return m.all(n.docs.map(function(n){var i=n.ok;return n.error&&(o=!1),i&&i._attachments?function(t,e,n){var i=pt(e)&&!pt(t),r=Object.keys(n._attachments);return i?t.get(n._id).then(function(i){return m.all(r.map(function(r){return function(t,e,n){return!t._attachments||!t._attachments[n]||t._attachments[n].digest!==e._attachments[n].digest}(i,n,r)?e.getAttachment(n._id,r):t.getAttachment(i._id,r)}))}).catch(function(t){if(404!==t.status)throw t;return er(e,n)}):er(e,n)}(e,t,i).then(function(t){var e=Object.keys(i._attachments);return t.forEach(function(t,n){var r=i._attachments[e[n]];delete r.stub,delete r.length,r.data=t}),i}):i}))})).then(function(t){r=r.concat(dt(t).filter(Boolean))})})}).then(function(){return{ok:o,docs:r}})}var ir=1,rr="pouchdb",or=5,ur=0;function ar(t,e,n,i,r){return t.get(e).catch(function(n){if(404===n.status)return"http"!==t.adapter&&"https"!==t.adapter||X(404,"PouchDB is just checking if a remote checkpoint exists."),{session_id:i,_id:e,history:[],replicator:rr,version:ir};throw n}).then(function(o){if(!r.cancelled&&o.last_seq!==n)return o.history=(o.history||[]).filter(function(t){return t.session_id!==i}),o.history.unshift({last_seq:n,session_id:i}),o.history=o.history.slice(0,or),o.version=ir,o.replicator=rr,o.session_id=i,o.last_seq=n,t.put(o).catch(function(o){if(409===o.status)return ar(t,e,n,i,r);throw o})})}function cr(t,e,n,i,r){this.src=t,this.target=e,this.id=n,this.returnValue=i,this.opts=r||{}}cr.prototype.writeCheckpoint=function(t,e){var n=this;return this.updateTarget(t,e).then(function(){return n.updateSource(t,e)})},cr.prototype.updateTarget=function(t,e){return this.opts.writeTargetCheckpoint?ar(this.target,this.id,t,e,this.returnValue):m.resolve(!0)},cr.prototype.updateSource=function(t,e){if(this.opts.writeSourceCheckpoint){var n=this;return ar(this.src,this.id,t,e,this.returnValue).catch(function(t){if(lr(t))return n.opts.writeSourceCheckpoint=!1,!0;throw t})}return m.resolve(!0)};var sr={undefined:function(t,e){return 0===se(t.last_seq,e.last_seq)?e.last_seq:0},1:function(t,e){return function(t,e){if(t.session_id===e.session_id)return{last_seq:t.last_seq,history:t.history};return function t(e,n){var i=e[0];var r=e.slice(1);var o=n[0];var u=n.slice(1);if(!i||0===n.length)return{last_seq:ur,history:[]};var a=i.session_id;if(fr(a,n))return{last_seq:i.last_seq,history:e};var c=o.session_id;if(fr(c,r))return{last_seq:o.last_seq,history:u};return t(r,u)}(t.history,e.history)}(e,t).last_seq}};function fr(t,e){var n=e[0],i=e.slice(1);return!(!t||0===e.length)&&(t===n.session_id||fr(t,i))}function lr(t){return"number"==typeof t.status&&4===Math.floor(t.status/100)}cr.prototype.getCheckpoint=function(){var t=this;return t.opts&&t.opts.writeSourceCheckpoint&&!t.opts.writeTargetCheckpoint?t.src.get(t.id).then(function(t){return t.last_seq||ur}).catch(function(t){if(404!==t.status)throw t;return ur}):t.target.get(t.id).then(function(e){return t.opts&&t.opts.writeTargetCheckpoint&&!t.opts.writeSourceCheckpoint?e.last_seq||ur:t.src.get(t.id).then(function(t){return e.version!==t.version?ur:(n=e.version?e.version.toString():"undefined")in sr?sr[n](e,t):ur;var n},function(n){if(404===n.status&&e.last_seq)return t.src.put({_id:t.id,last_seq:ur}).then(function(){return ur},function(n){return lr(n)?(t.opts.writeSourceCheckpoint=!1,e.last_seq):ur});throw n})}).catch(function(t){if(404!==t.status)throw t;return ur})};var hr=0;function dr(t,e,n){var i=n.doc_ids?n.doc_ids.sort(se):"",r=n.filter?n.filter.toString():"",o="",u="",a="";return n.selector&&(a=JSON.stringify(n.selector)),n.filter&&n.query_params&&(o=JSON.stringify(function(t){return Object.keys(t).sort(se).reduce(function(e,n){return e[n]=t[n],e},{})}(n.query_params))),n.filter&&"_view"===n.filter&&(u=n.view.toString()),m.all([t.id(),e.id()]).then(function(t){var e=t[0]+t[1]+r+u+o+i+a;return new m(function(t){Ze(e,t)})}).then(function(t){return"_local/"+(t=t.replace(/\//g,".").replace(/\+/g,"_"))})}function vr(t,e,n,i,r){var o,u,a,c=[],s={seq:0,changes:[],docs:[]},f=!1,l=!1,h=!1,d=0,v=n.continuous||n.live||!1,p=n.batch_size||100,y=n.batches_limit||10,g=!1,b=n.doc_ids,w=n.selector,_=[],k=Lt(),A=n.seq_interval;r=r||{ok:!0,start_time:new Date,docs_read:0,docs_written:0,doc_write_failures:0,errors:[]};var x={};function E(){return a?m.resolve():dr(t,e,n).then(function(r){u=r;var o={};o=!1===n.checkpoint?{writeSourceCheckpoint:!1,writeTargetCheckpoint:!1}:"source"===n.checkpoint?{writeSourceCheckpoint:!0,writeTargetCheckpoint:!1}:"target"===n.checkpoint?{writeSourceCheckpoint:!1,writeTargetCheckpoint:!0}:{writeSourceCheckpoint:!0,writeTargetCheckpoint:!0},a=new cr(t,e,u,i,o)})}function O(){if(_=[],0!==o.docs.length){var t=o.docs,u={timeout:n.timeout};return e.bulkDocs({docs:t,new_edits:!1},u).then(function(e){if(i.cancelled)throw F(),new Error("cancelled");var n=Object.create(null);e.forEach(function(t){t.error&&(n[t.id]=t)});var o=Object.keys(n).length;r.doc_write_failures+=o,r.docs_written+=t.length-o,t.forEach(function(t){var e=n[t._id];if(e){r.errors.push(e);var o=(e.name||"").toLowerCase();if("unauthorized"!==o&&"forbidden"!==o)throw e;i.emit("denied",L(e))}else _.push(t)})},function(e){throw r.doc_write_failures+=t.length,e})}}function M(){if(o.error)throw new Error("There was a problem getting docs.");r.last_seq=d=o.seq;var t=L(r);return _.length&&(t.docs=_,"number"==typeof o.pending&&(t.pending=o.pending,delete o.pending),i.emit("change",t)),f=!0,a.writeCheckpoint(o.seq,k).then(function(){if(f=!1,i.cancelled)throw F(),new Error("cancelled");o=void 0,R()}).catch(function(t){throw C(t),t})}function T(){return nr(t,e,o.diffs,i).then(function(t){o.error=!t.ok,t.docs.forEach(function(t){delete o.diffs[t._id],r.docs_read++,o.docs.push(t)})})}function q(){var t;i.cancelled||o||(0!==c.length?(o=c.shift(),(t={},o.changes.forEach(function(e){"_user/"!==e.id&&(t[e.id]=e.changes.map(function(t){return t.rev}))}),e.revsDiff(t).then(function(t){if(i.cancelled)throw F(),new Error("cancelled");o.diffs=t})).then(T).then(O).then(M).then(q).catch(function(t){S("batch processing terminated with error",t)})):P(!0))}function P(t){0!==s.changes.length?(t||l||s.changes.length>=p)&&(c.push(s),s={seq:0,changes:[],docs:[]},"pending"!==i.state&&"stopped"!==i.state||(i.state="active",i.emit("active")),q()):0!==c.length||o||((v&&x.live||l)&&(i.state="pending",i.emit("paused")),l&&F())}function S(t,e){h||(e.message||(e.message=t),r.ok=!1,r.status="aborting",c=[],s={seq:0,changes:[],docs:[]},F(e))}function F(o){if(!(h||i.cancelled&&(r.status="cancelled",f)))if(r.status=r.status||"complete",r.end_time=new Date,r.last_seq=d,h=!0,o){(o=ft(o)).result=r;var u=(o.name||"").toLowerCase();"unauthorized"===u||"forbidden"===u?(i.emit("error",o),i.removeAllListeners()):function(t,e,n,i){if(!1===t.retry)return e.emit("error",n),void e.removeAllListeners();if("function"!=typeof t.back_off_function&&(t.back_off_function=H),e.emit("requestError",n),"active"===e.state||"pending"===e.state){e.emit("paused",n),e.state="stopped";var r=function(){t.current_back_off=hr};e.once("paused",function(){e.removeListener("active",r)}),e.once("active",r)}t.current_back_off=t.current_back_off||hr,t.current_back_off=t.back_off_function(t.current_back_off),setTimeout(i,t.current_back_off)}(n,i,o,function(){vr(t,e,n,i)})}else i.emit("complete",r),i.removeAllListeners()}function j(t,e,r){if(i.cancelled)return F();"number"==typeof e&&(s.pending=e),ht(n)(t)&&(s.seq=t.seq||r,s.changes.push(t),P(0===c.length&&x.live))}function U(t){if(g=!1,i.cancelled)return F();if(t.results.length>0)x.since=t.last_seq,R(),P(!0);else{var e=function(){v?(x.live=!0,R()):l=!0,P(!0)};o||0!==t.results.length?e():(f=!0,a.writeCheckpoint(t.last_seq,k).then(function(){f=!1,r.last_seq=d=t.last_seq,e()}).catch(C))}}function D(t){if(g=!1,i.cancelled)return F();S("changes rejected",t)}function R(){if(!g&&!l&&c.length<y){g=!0,i._changes&&(i.removeListener("cancel",i._abortChanges),i._changes.cancel()),i.once("cancel",r);var e=t.changes(x).on("change",j);e.then(o,o),e.then(U).catch(D),n.retry&&(i._changes=e,i._abortChanges=r)}function r(){e.cancel()}function o(){i.removeListener("cancel",r)}}function B(){E().then(function(){if(!i.cancelled)return a.getCheckpoint().then(function(t){x={since:d=t,limit:p,batch_size:p,style:"all_docs",doc_ids:b,selector:w,return_docs:!0},!1!==A&&(x.seq_interval=A||p),n.filter&&("string"!=typeof n.filter?x.include_docs=!0:x.filter=n.filter),"heartbeat"in n&&(x.heartbeat=n.heartbeat),"timeout"in n&&(x.timeout=n.timeout),n.query_params&&(x.query_params=n.query_params),n.view&&(x.view=n.view),R()});F()}).catch(function(t){S("getCheckpoint rejected with ",t)})}function C(t){f=!1,S("writeCheckpoint completed with error",t)}i.ready(t,e),i.cancelled?F():(i._addedListeners||(i.once("cancel",F),"function"==typeof n.complete&&(i.once("error",n.complete),i.once("complete",function(t){n.complete(null,t)})),i._addedListeners=!0),void 0===n.since?B():E().then(function(){return f=!0,a.writeCheckpoint(n.since,k)}).then(function(){f=!1,i.cancelled?F():(d=n.since,B())}).catch(C))}function pr(){s.EventEmitter.call(this),this.cancelled=!1,this.state="pending";var t=this,e=new m(function(e,n){t.once("complete",e),t.once("error",n)});t.then=function(t,n){return e.then(t,n)},t.catch=function(t){return e.catch(t)},t.catch(function(){})}function yr(t,e){var n=e.PouchConstructor;return"string"==typeof t?new n(t,e):t}function gr(t,e,n,i){if("function"==typeof n&&(i=n,n={}),void 0===n&&(n={}),n.doc_ids&&!Array.isArray(n.doc_ids))throw ft(rt,"`doc_ids` filter parameter is not a list.");n.complete=i,(n=L(n)).continuous=n.continuous||n.live,n.retry="retry"in n&&n.retry,n.PouchConstructor=n.PouchConstructor||this;var r=new pr(n);return vr(yr(t,n),yr(e,n),n,r),r}function br(t,e,n,i){return"function"==typeof n&&(i=n,n={}),void 0===n&&(n={}),(n=L(n)).PouchConstructor=n.PouchConstructor||this,new wr(t=yr(t,n),e=yr(e,n),n,i)}function wr(t,e,n,i){var r=this;this.canceled=!1;var o=n.push?K({},n,n.push):n,u=n.pull?K({},n,n.pull):n;function a(t){r.emit("change",{direction:"pull",change:t})}function c(t){r.emit("change",{direction:"push",change:t})}function s(t){r.emit("denied",{direction:"push",doc:t})}function f(t){r.emit("denied",{direction:"pull",doc:t})}function l(){r.pushPaused=!0,r.pullPaused&&r.emit("paused")}function h(){r.pullPaused=!0,r.pushPaused&&r.emit("paused")}function d(){r.pushPaused=!1,r.pullPaused&&r.emit("active",{direction:"push"})}function v(){r.pullPaused=!1,r.pushPaused&&r.emit("active",{direction:"pull"})}this.push=gr(t,e,o),this.pull=gr(e,t,u),this.pushPaused=!0,this.pullPaused=!0;var p={};function y(t){return function(e,n){("change"===e&&(n===a||n===c)||"denied"===e&&(n===f||n===s)||"paused"===e&&(n===h||n===l)||"active"===e&&(n===v||n===d))&&(e in p||(p[e]={}),p[e][t]=!0,2===Object.keys(p[e]).length&&r.removeAllListeners(e))}}function g(t,e,n){-1==t.listeners(e).indexOf(n)&&t.on(e,n)}n.live&&(this.push.on("complete",r.pull.cancel.bind(r.pull)),this.pull.on("complete",r.push.cancel.bind(r.push))),this.on("newListener",function(t){"change"===t?(g(r.pull,"change",a),g(r.push,"change",c)):"denied"===t?(g(r.pull,"denied",f),g(r.push,"denied",s)):"active"===t?(g(r.pull,"active",v),g(r.push,"active",d)):"paused"===t&&(g(r.pull,"paused",h),g(r.push,"paused",l))}),this.on("removeListener",function(t){"change"===t?(r.pull.removeListener("change",a),r.push.removeListener("change",c)):"denied"===t?(r.pull.removeListener("denied",f),r.push.removeListener("denied",s)):"active"===t?(r.pull.removeListener("active",v),r.push.removeListener("active",d)):"paused"===t&&(r.pull.removeListener("paused",h),r.push.removeListener("paused",l))}),this.pull.on("removeListener",y("pull")),this.push.on("removeListener",y("push"));var b=m.all([this.push,this.pull]).then(function(t){var e={push:t[0],pull:t[1]};return r.emit("complete",e),i&&i(null,e),r.removeAllListeners(),e},function(t){if(r.cancel(),i?i(t):r.emit("error",t),r.removeAllListeners(),i)throw t});this.then=function(t,e){return b.then(t,e)},this.catch=function(t){return b.catch(t)}}l()(pr,s.EventEmitter),pr.prototype.cancel=function(){this.cancelled=!0,this.state="cancelled",this.emit("cancel")},pr.prototype.ready=function(t,e){var n=this;function i(){n.cancel()}n._readyCalled||(n._readyCalled=!0,t.once("destroyed",i),e.once("destroyed",i),n.once("complete",function(){t.removeListener("destroyed",i),e.removeListener("destroyed",i)}))},l()(wr,s.EventEmitter),wr.prototype.cancel=function(){this.canceled||(this.canceled=!0,this.push.cancel(),this.pull.cancel())},It.plugin(function(t){t.adapter("idb",Pn,!0)}).plugin(function(t){t.adapter("websql",li,!0)}).plugin(function(t){t.adapter("http",Ti,!1),t.adapter("https",Ti,!1)}).plugin(Qi).plugin(function(t){t.replicate=gr,t.sync=br,Object.defineProperty(t.prototype,"replicate",{get:function(){var t=this;return void 0===this.replicateMethods&&(this.replicateMethods={from:function(e,n,i){return t.constructor.replicate(e,t,n,i)},to:function(e,n,i){return t.constructor.replicate(t,e,n,i)}}),this.replicateMethods}}),t.prototype.sync=function(t,e,n){return this.constructor.sync(this,t,e,n)}}),e.a=It}).call(this,n(13))},function(t,e,n){var i=n(31),r=n(32),o=r;o.v1=i,o.v4=r,t.exports=o},function(t,e,n){(function(i){function r(){var t;try{t=e.storage.debug}catch(t){}return!t&&void 0!==i&&"env"in i&&(t=i.env.DEBUG),t}(e=t.exports=n(34)).log=function(){return"object"==typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)},e.formatArgs=function(t){var n=this.useColors;if(t[0]=(n?"%c":"")+this.namespace+(n?" %c":" ")+t[0]+(n?"%c ":" ")+"+"+e.humanize(this.diff),!n)return;var i="color: "+this.color;t.splice(1,0,i,"color: inherit");var r=0,o=0;t[0].replace(/%[a-zA-Z%]/g,function(t){"%%"!==t&&(r++,"%c"===t&&(o=r))}),t.splice(o,0,i)},e.save=function(t){try{null==t?e.storage.removeItem("debug"):e.storage.debug=t}catch(t){}},e.load=r,e.useColors=function(){if("undefined"!=typeof window&&window.process&&"renderer"===window.process.type)return!0;if("undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;return"undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},e.storage="undefined"!=typeof chrome&&void 0!==chrome.storage?chrome.storage.local:function(){try{return window.localStorage}catch(t){}}(),e.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],e.formatters.j=function(t){try{return JSON.stringify(t)}catch(t){return"[UnexpectedJSONParseError]: "+t.message}},e.enable(r())}).call(this,n(33))},function(t,e,n){"use strict";function i(t,e,n){var i=n[n.length-1];t===i.element&&(n.pop(),i=n[n.length-1]);var r=i.element,o=i.index;if(Array.isArray(r))r.push(t);else if(o===e.length-2){r[e.pop()]=t}else e.push(t)}e.stringify=function(t){var e=[];e.push({obj:t});for(var n,i,r,o,u,a,c,s,f,l,h="";n=e.pop();)if(i=n.obj,h+=n.prefix||"",r=n.val||"")h+=r;else if("object"!=typeof i)h+=void 0===i?null:JSON.stringify(i);else if(null===i)h+="null";else if(Array.isArray(i)){for(e.push({val:"]"}),o=i.length-1;o>=0;o--)u=0===o?"":",",e.push({obj:i[o],prefix:u});e.push({val:"["})}else{for(c in a=[],i)i.hasOwnProperty(c)&&a.push(c);for(e.push({val:"}"}),o=a.length-1;o>=0;o--)f=i[s=a[o]],l=o>0?",":"",l+=JSON.stringify(s)+":",e.push({obj:f,prefix:l});e.push({val:"{"})}return h},e.parse=function(t){for(var e,n,r,o,u,a,c,s,f,l=[],h=[],d=0;;)if("}"!==(e=t[d++])&&"]"!==e&&void 0!==e)switch(e){case" ":case"\t":case"\n":case":":case",":break;case"n":d+=3,i(null,l,h);break;case"t":d+=3,i(!0,l,h);break;case"f":d+=4,i(!1,l,h);break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":case"-":for(n="",d--;;){if(r=t[d++],!/[\d\.\-e\+]/.test(r)){d--;break}n+=r}i(parseFloat(n),l,h);break;case'"':for(o="",u=void 0,a=0;'"'!==(c=t[d++])||"\\"===u&&a%2==1;)o+=c,"\\"===(u=c)?a++:a=0;i(JSON.parse('"'+o+'"'),l,h);break;case"[":s={element:[],index:l.length},l.push(s.element),h.push(s);break;case"{":f={element:{},index:l.length},l.push(f.element),h.push(f);break;default:throw new Error("unexpectedly reached end of input: "+e)}else{if(1===l.length)return l.pop();i(l.pop(),l,h)}}},function(t,e,n){(function(e){t.exports=e.Mustache=n(38)}).call(this,n(13))},function(t,e){var n="undefined"!=typeof crypto&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&msCrypto.getRandomValues.bind(msCrypto);if(n){var i=new Uint8Array(16);t.exports=function(){return n(i),i}}else{var r=new Array(16);t.exports=function(){for(var t,e=0;e<16;e++)0==(3&e)&&(t=4294967296*Math.random()),r[e]=t>>>((3&e)<<3)&255;return r}}},function(t,e){for(var n=[],i=0;i<256;++i)n[i]=(i+256).toString(16).substr(1);t.exports=function(t,e){var i=e||0,r=n;return r[t[i++]]+r[t[i++]]+r[t[i++]]+r[t[i++]]+"-"+r[t[i++]]+r[t[i++]]+"-"+r[t[i++]]+r[t[i++]]+"-"+r[t[i++]]+r[t[i++]]+"-"+r[t[i++]]+r[t[i++]]+r[t[i++]]+r[t[i++]]+r[t[i++]]+r[t[i++]]}},function(t,e,n){"use strict";var i=n(8);function r(){}var o={},u=["REJECTED"],a=["FULFILLED"],c=["PENDING"];function s(t){if("function"!=typeof t)throw new TypeError("resolver must be a function");this.state=c,this.queue=[],this.outcome=void 0,t!==r&&d(this,t)}function f(t,e,n){this.promise=t,"function"==typeof e&&(this.onFulfilled=e,this.callFulfilled=this.otherCallFulfilled),"function"==typeof n&&(this.onRejected=n,this.callRejected=this.otherCallRejected)}function l(t,e,n){i(function(){var i;try{i=e(n)}catch(e){return o.reject(t,e)}i===t?o.reject(t,new TypeError("Cannot resolve promise with itself")):o.resolve(t,i)})}function h(t){var e=t&&t.then;if(t&&("object"==typeof t||"function"==typeof t)&&"function"==typeof e)return function(){e.apply(t,arguments)}}function d(t,e){var n=!1;function i(e){n||(n=!0,o.reject(t,e))}function r(e){n||(n=!0,o.resolve(t,e))}var u=v(function(){e(r,i)});"error"===u.status&&i(u.value)}function v(t,e){var n={};try{n.value=t(e),n.status="success"}catch(t){n.status="error",n.value=t}return n}t.exports=s,s.prototype.catch=function(t){return this.then(null,t)},s.prototype.then=function(t,e){if("function"!=typeof t&&this.state===a||"function"!=typeof e&&this.state===u)return this;var n=new this.constructor(r);this.state!==c?l(n,this.state===a?t:e,this.outcome):this.queue.push(new f(n,t,e));return n},f.prototype.callFulfilled=function(t){o.resolve(this.promise,t)},f.prototype.otherCallFulfilled=function(t){l(this.promise,this.onFulfilled,t)},f.prototype.callRejected=function(t){o.reject(this.promise,t)},f.prototype.otherCallRejected=function(t){l(this.promise,this.onRejected,t)},o.resolve=function(t,e){var n=v(h,e);if("error"===n.status)return o.reject(t,n.value);var i=n.value;if(i)d(t,i);else{t.state=a,t.outcome=e;for(var r=-1,u=t.queue.length;++r<u;)t.queue[r].callFulfilled(e)}return t},o.reject=function(t,e){t.state=u,t.outcome=e;for(var n=-1,i=t.queue.length;++n<i;)t.queue[n].callRejected(e);return t},s.resolve=function(t){if(t instanceof this)return t;return o.resolve(new this(r),t)},s.reject=function(t){var e=new this(r);return o.reject(e,t)},s.all=function(t){var e=this;if("[object Array]"!==Object.prototype.toString.call(t))return this.reject(new TypeError("must be an array"));var n=t.length,i=!1;if(!n)return this.resolve([]);var u=new Array(n),a=0,c=-1,s=new this(r);for(;++c<n;)f(t[c],c);return s;function f(t,r){e.resolve(t).then(function(t){u[r]=t,++a!==n||i||(i=!0,o.resolve(s,u))},function(t){i||(i=!0,o.reject(s,t))})}},s.race=function(t){var e=this;if("[object Array]"!==Object.prototype.toString.call(t))return this.reject(new TypeError("must be an array"));var n=t.length,i=!1;if(!n)return this.resolve([]);var u=-1,a=new this(r);for(;++u<n;)c=t[u],e.resolve(c).then(function(t){i||(i=!0,o.resolve(a,t))},function(t){i||(i=!0,o.reject(a,t))});var c;return a}},function(t,e,n){var i=n(2),r=n(16),o=n(36),u=n(37);function a(e){var n="function"==typeof Map?new Map:void 0;return t.exports=a=function(t){if(null===t||!o(t))return t;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==n){if(n.has(t))return n.get(t);n.set(t,e)}function e(){return u(t,arguments,i(this).constructor)}return e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),r(e,t)},a(e)}t.exports=a},function(t,e,n){var i=function(){return this||"object"==typeof self&&self}()||Function("return this")(),r=i.regeneratorRuntime&&Object.getOwnPropertyNames(i).indexOf("regeneratorRuntime")>=0,o=r&&i.regeneratorRuntime;if(i.regeneratorRuntime=void 0,t.exports=n(28),r)i.regeneratorRuntime=o;else try{delete i.regeneratorRuntime}catch(t){i.regeneratorRuntime=void 0}},function(t,e){!function(e){"use strict";var n,i=Object.prototype,r=i.hasOwnProperty,o="function"==typeof Symbol?Symbol:{},u=o.iterator||"@@iterator",a=o.asyncIterator||"@@asyncIterator",c=o.toStringTag||"@@toStringTag",s="object"==typeof t,f=e.regeneratorRuntime;if(f)s&&(t.exports=f);else{(f=e.regeneratorRuntime=s?t.exports:{}).wrap=m;var l="suspendedStart",h="suspendedYield",d="executing",v="completed",p={},y={};y[u]=function(){return this};var g=Object.getPrototypeOf,b=g&&g(g(P([])));b&&b!==i&&r.call(b,u)&&(y=b);var w=x.prototype=k.prototype=Object.create(y);A.prototype=w.constructor=x,x.constructor=A,x[c]=A.displayName="GeneratorFunction",f.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===A||"GeneratorFunction"===(e.displayName||e.name))},f.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,x):(t.__proto__=x,c in t||(t[c]="GeneratorFunction")),t.prototype=Object.create(w),t},f.awrap=function(t){return{__await:t}},E(L.prototype),L.prototype[a]=function(){return this},f.AsyncIterator=L,f.async=function(t,e,n,i){var r=new L(m(t,e,n,i));return f.isGeneratorFunction(e)?r:r.next().then(function(t){return t.done?t.value:r.next()})},E(w),w[c]="Generator",w[u]=function(){return this},w.toString=function(){return"[object Generator]"},f.keys=function(t){var e=[];for(var n in t)e.push(n);return e.reverse(),function n(){for(;e.length;){var i=e.pop();if(i in t)return n.value=i,n.done=!1,n}return n.done=!0,n}},f.values=P,q.prototype={constructor:q,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=n,this.done=!1,this.delegate=null,this.method="next",this.arg=n,this.tryEntries.forEach(T),!t)for(var e in this)"t"===e.charAt(0)&&r.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=n)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function i(i,r){return a.type="throw",a.arg=t,e.next=i,r&&(e.method="next",e.arg=n),!!r}for(var o=this.tryEntries.length-1;o>=0;--o){var u=this.tryEntries[o],a=u.completion;if("root"===u.tryLoc)return i("end");if(u.tryLoc<=this.prev){var c=r.call(u,"catchLoc"),s=r.call(u,"finallyLoc");if(c&&s){if(this.prev<u.catchLoc)return i(u.catchLoc,!0);if(this.prev<u.finallyLoc)return i(u.finallyLoc)}else if(c){if(this.prev<u.catchLoc)return i(u.catchLoc,!0)}else{if(!s)throw new Error("try statement without catch or finally");if(this.prev<u.finallyLoc)return i(u.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===t||"continue"===t)&&o.tryLoc<=e&&e<=o.finallyLoc&&(o=null);var u=o?o.completion:{};return u.type=t,u.arg=e,o?(this.method="next",this.next=o.finallyLoc,p):this.complete(u)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),p},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),T(n),p}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var i=n.completion;if("throw"===i.type){var r=i.arg;T(n)}return r}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,i){return this.delegate={iterator:P(t),resultName:e,nextLoc:i},"next"===this.method&&(this.arg=n),p}}}function m(t,e,n,i){var r=e&&e.prototype instanceof k?e:k,o=Object.create(r.prototype),u=new q(i||[]);return o._invoke=function(t,e,n){var i=l;return function(r,o){if(i===d)throw new Error("Generator is already running");if(i===v){if("throw"===r)throw o;return S()}for(n.method=r,n.arg=o;;){var u=n.delegate;if(u){var a=O(u,n);if(a){if(a===p)continue;return a}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(i===l)throw i=v,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);i=d;var c=_(t,e,n);if("normal"===c.type){if(i=n.done?v:h,c.arg===p)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(i=v,n.method="throw",n.arg=c.arg)}}}(t,n,u),o}function _(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}function k(){}function A(){}function x(){}function E(t){["next","throw","return"].forEach(function(e){t[e]=function(t){return this._invoke(e,t)}})}function L(t){var e;this._invoke=function(n,i){function o(){return new Promise(function(e,o){!function e(n,i,o,u){var a=_(t[n],t,i);if("throw"!==a.type){var c=a.arg,s=c.value;return s&&"object"==typeof s&&r.call(s,"__await")?Promise.resolve(s.__await).then(function(t){e("next",t,o,u)},function(t){e("throw",t,o,u)}):Promise.resolve(s).then(function(t){c.value=t,o(c)},function(t){return e("throw",t,o,u)})}u(a.arg)}(n,i,e,o)})}return e=e?e.then(o,o):o()}}function O(t,e){var i=t.iterator[e.method];if(i===n){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=n,O(t,e),"throw"===e.method))return p;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return p}var r=_(i,t.iterator,e.arg);if("throw"===r.type)return e.method="throw",e.arg=r.arg,e.delegate=null,p;var o=r.arg;return o?o.done?(e[t.resultName]=o.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=n),e.delegate=null,p):o:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,p)}function M(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function T(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function q(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(M,this),this.reset(!0)}function P(t){if(t){var e=t[u];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var i=-1,o=function e(){for(;++i<t.length;)if(r.call(t,i))return e.value=t[i],e.done=!1,e;return e.value=n,e.done=!0,e};return o.next=o}}return{next:S}}function S(){return{value:n,done:!0}}}(function(){return this||"object"==typeof self&&self}()||Function("return this")())},function(t,e){function n(t){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function i(e){return"function"==typeof Symbol&&"symbol"===n(Symbol.iterator)?t.exports=i=function(t){return n(t)}:t.exports=i=function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":n(t)},i(e)}t.exports=i},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"default",function(){return Sandbox});var _SandboxException_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(17);class Sandbox{constructor(t=null,e=null){this.globalContext=e||{},this.dom=t||document,this.superDetectRegex=/super\.([^(]+)(\(?)/gm,this.ownerDocDetectRegex=/.ownerDocument/gm,this.domProxy=new Proxy(this.dom,{get:function(t,e){if("body"==e)return t;if("rootNode"==e)return t;var n;if(n="nodeName"==e||"nodeType"==e||"ownerDocument"==e||"parentElement"==e||"parentNode"==e?document[e]:e in t?t[e]:document[e],!(e in t)&&n instanceof Function)n=function(t){for(var e=[],n=0;n+1<arguments.length;n++)e[n]=arguments[n+1];return t.apply(this,e)}.bind(document,n);else if(n instanceof Function){var i=function(t){for(var e=[],n=0;n+1<arguments.length;n++)e[n]=arguments[n+1];return t.apply(this,e)}.bind(t,n);n="getElementsByTagName"==e?function(t,e){return"body"==e?[this]:t.call(this,e)}.bind(t,i):i}return n}.bind(document),set:function(t,e,n){return function(){this[e]=n}.bind(t)(),!0}}),this.globalContextProxy=new Proxy(this.globalContext,{get:function(t,e,n){if("document"==n)return t.domProxy;var i=n in e?e[n]:window[n];return!(n in e)&&i instanceof Function&&(i=function(t){for(var e=[],n=0;n+1<arguments.length;n++)e[n]=arguments[n+1];return t.apply(this,e)}.bind(window,i)),i}.bind(window,this)})}execCode(code,newcontext=this.globalContext){return code=code.replace(this.ownerDocDetectRegex,".s_ownerDocument"),function(window,document,code){var globalScopeInit="";for(var x in window)globalScopeInit+="var "+x+' = window["'+x+'"];';return Node.prototype.s_ownerDocument=document,eval(globalScopeInit+code)}.bind(newcontext)(this.globalContextProxy,this.domProxy,code)}execFunction(func,args,newcontext=this.globalContext){if(!(func instanceof Function)&&"function"!=typeof func)throw new _SandboxException_js__WEBPACK_IMPORTED_MODULE_0__.a("Object passed is not a function");return function(window,document,owDocRegEx,func,args){var globalScopeInit="";for(var x in window)globalScopeInit+="var "+x+' = window["'+x+'"];';var func_str=func.toString();return func_str.startsWith("function")||(func_str="function "+func_str),Node.prototype.s_ownerDocument=document,func_str=func_str.replace(owDocRegEx,".s_ownerDocument"),eval(globalScopeInit+"("+func_str+".bind(this)).apply(this,args)")}.bind(newcontext)(this.globalContextProxy,this.domProxy,this.ownerDocDetectRegex,func,args)}execMethod(meth,args,obj){if(!(obj[meth]instanceof Function)&&"function"!=typeof obj[meth])throw new _SandboxException_js__WEBPACK_IMPORTED_MODULE_0__.a(meth+" is not a method");var func_str=obj[meth].toString();return func_str.startsWith("function")||(func_str="function "+func_str),func_str=func_str.replace(this.superDetectRegex,function(t,e,n){return"__super__."+e+".bind(this)"+n}),func_str=func_str.replace(this.ownerDocDetectRegex,".s_ownerDocument"),function(window,document,func_str,args){var globalScopeInit="";for(var x in window)globalScopeInit+="var "+x+' = window["'+x+'"];';globalScopeInit+="var __super__ = Object.getPrototypeOf(Object.getPrototypeOf(this));";var indx=func_str.indexOf("{")+1;return Node.prototype.s_ownerDocument=document,eval("("+[func_str.slice(0,indx),globalScopeInit,func_str.slice(indx)].join("")+").apply(this,args)")}.bind(obj)(this.globalContextProxy,this.domProxy,func_str,args)}}},function(t,e,n){var i,r,o=n(23),u=n(24),a=0,c=0;t.exports=function(t,e,n){var s=e&&n||0,f=e||[],l=(t=t||{}).node||i,h=void 0!==t.clockseq?t.clockseq:r;if(null==l||null==h){var d=o();null==l&&(l=i=[1|d[0],d[1],d[2],d[3],d[4],d[5]]),null==h&&(h=r=16383&(d[6]<<8|d[7]))}var v=void 0!==t.msecs?t.msecs:(new Date).getTime(),p=void 0!==t.nsecs?t.nsecs:c+1,y=v-a+(p-c)/1e4;if(y<0&&void 0===t.clockseq&&(h=h+1&16383),(y<0||v>a)&&void 0===t.nsecs&&(p=0),p>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");a=v,c=p,r=h;var g=(1e4*(268435455&(v+=122192928e5))+p)%4294967296;f[s++]=g>>>24&255,f[s++]=g>>>16&255,f[s++]=g>>>8&255,f[s++]=255&g;var b=v/4294967296*1e4&268435455;f[s++]=b>>>8&255,f[s++]=255&b,f[s++]=b>>>24&15|16,f[s++]=b>>>16&255,f[s++]=h>>>8|128,f[s++]=255&h;for(var w=0;w<6;++w)f[s+w]=l[w];return e||u(f)}},function(t,e,n){var i=n(23),r=n(24);t.exports=function(t,e,n){var o=e&&n||0;"string"==typeof t&&(e="binary"===t?new Array(16):null,t=null);var u=(t=t||{}).random||(t.rng||i)();if(u[6]=15&u[6]|64,u[8]=63&u[8]|128,e)for(var a=0;a<16;++a)e[o+a]=u[a];return e||r(u)}},function(t,e){var n,i,r=t.exports={};function o(){throw new Error("setTimeout has not been defined")}function u(){throw new Error("clearTimeout has not been defined")}function a(t){if(n===setTimeout)return setTimeout(t,0);if((n===o||!n)&&setTimeout)return n=setTimeout,setTimeout(t,0);try{return n(t,0)}catch(e){try{return n.call(null,t,0)}catch(e){return n.call(this,t,0)}}}!function(){try{n="function"==typeof setTimeout?setTimeout:o}catch(t){n=o}try{i="function"==typeof clearTimeout?clearTimeout:u}catch(t){i=u}}();var c,s=[],f=!1,l=-1;function h(){f&&c&&(f=!1,c.length?s=c.concat(s):l=-1,s.length&&d())}function d(){if(!f){var t=a(h);f=!0;for(var e=s.length;e;){for(c=s,s=[];++l<e;)c&&c[l].run();l=-1,e=s.length}c=null,f=!1,function(t){if(i===clearTimeout)return clearTimeout(t);if((i===u||!i)&&clearTimeout)return i=clearTimeout,clearTimeout(t);try{i(t)}catch(e){try{return i.call(null,t)}catch(e){return i.call(this,t)}}}(t)}}function v(t,e){this.fun=t,this.array=e}function p(){}r.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];s.push(new v(t,e)),1!==s.length||f||a(d)},v.prototype.run=function(){this.fun.apply(null,this.array)},r.title="browser",r.browser=!0,r.env={},r.argv=[],r.version="",r.versions={},r.on=p,r.addListener=p,r.once=p,r.off=p,r.removeListener=p,r.removeAllListeners=p,r.emit=p,r.prependListener=p,r.prependOnceListener=p,r.listeners=function(t){return[]},r.binding=function(t){throw new Error("process.binding is not supported")},r.cwd=function(){return"/"},r.chdir=function(t){throw new Error("process.chdir is not supported")},r.umask=function(){return 0}},function(t,e,n){function i(t){var n;function i(){if(i.enabled){var t=i,r=+new Date,o=r-(n||r);t.diff=o,t.prev=n,t.curr=r,n=r;for(var u=new Array(arguments.length),a=0;a<u.length;a++)u[a]=arguments[a];u[0]=e.coerce(u[0]),"string"!=typeof u[0]&&u.unshift("%O");var c=0;u[0]=u[0].replace(/%([a-zA-Z%])/g,function(n,i){if("%%"===n)return n;c++;var r=e.formatters[i];if("function"==typeof r){var o=u[c];n=r.call(t,o),u.splice(c,1),c--}return n}),e.formatArgs.call(t,u),(i.log||e.log||console.log.bind(console)).apply(t,u)}}return i.namespace=t,i.enabled=e.enabled(t),i.useColors=e.useColors(),i.color=function(t){var n,i=0;for(n in t)i=(i<<5)-i+t.charCodeAt(n),i|=0;return e.colors[Math.abs(i)%e.colors.length]}(t),i.destroy=r,"function"==typeof e.init&&e.init(i),e.instances.push(i),i}function r(){var t=e.instances.indexOf(this);return-1!==t&&(e.instances.splice(t,1),!0)}(e=t.exports=i.debug=i.default=i).coerce=function(t){return t instanceof Error?t.stack||t.message:t},e.disable=function(){e.enable("")},e.enable=function(t){var n;e.save(t),e.names=[],e.skips=[];var i=("string"==typeof t?t:"").split(/[\s,]+/),r=i.length;for(n=0;n<r;n++)i[n]&&("-"===(t=i[n].replace(/\*/g,".*?"))[0]?e.skips.push(new RegExp("^"+t.substr(1)+"$")):e.names.push(new RegExp("^"+t+"$")));for(n=0;n<e.instances.length;n++){var o=e.instances[n];o.enabled=e.enabled(o.namespace)}},e.enabled=function(t){if("*"===t[t.length-1])return!0;var n,i;for(n=0,i=e.skips.length;n<i;n++)if(e.skips[n].test(t))return!1;for(n=0,i=e.names.length;n<i;n++)if(e.names[n].test(t))return!0;return!1},e.humanize=n(35),e.instances=[],e.names=[],e.skips=[],e.formatters={}},function(t,e){var n=1e3,i=60*n,r=60*i,o=24*r,u=365.25*o;function a(t,e,n){if(!(t<e))return t<1.5*e?Math.floor(t/e)+" "+n:Math.ceil(t/e)+" "+n+"s"}t.exports=function(t,e){e=e||{};var c,s=typeof t;if("string"===s&&t.length>0)return function(t){if((t=String(t)).length>100)return;var e=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(t);if(!e)return;var a=parseFloat(e[1]);switch((e[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return a*u;case"days":case"day":case"d":return a*o;case"hours":case"hour":case"hrs":case"hr":case"h":return a*r;case"minutes":case"minute":case"mins":case"min":case"m":return a*i;case"seconds":case"second":case"secs":case"sec":case"s":return a*n;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return a;default:return}}(t);if("number"===s&&!1===isNaN(t))return e.long?a(c=t,o,"day")||a(c,r,"hour")||a(c,i,"minute")||a(c,n,"second")||c+" ms":function(t){if(t>=o)return Math.round(t/o)+"d";if(t>=r)return Math.round(t/r)+"h";if(t>=i)return Math.round(t/i)+"m";if(t>=n)return Math.round(t/n)+"s";return t+"ms"}(t);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(t))}},function(t,e){t.exports=function(t){return-1!==Function.toString.call(t).indexOf("[native code]")}},function(t,e,n){var i=n(16);function r(e,n,o){return!function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}()?t.exports=r=function(t,e,n){var r=[null];r.push.apply(r,e);var o=new(Function.bind.apply(t,r));return n&&i(o,n.prototype),o}:t.exports=r=Reflect.construct,r.apply(null,arguments)}t.exports=r},function(t,e,n){var i,r,o,u;
/*!
 * mustache.js - Logic-less {{mustache}} templates with JavaScript
 * http://github.com/janl/mustache.js
 */
/*!
 * mustache.js - Logic-less {{mustache}} templates with JavaScript
 * http://github.com/janl/mustache.js
 */
u=function(t){var e=Object.prototype.toString,n=Array.isArray||function(t){return"[object Array]"===e.call(t)};function i(t){return"function"==typeof t}function r(t){return t.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function o(t,e){return null!=t&&"object"==typeof t&&e in t}var u=RegExp.prototype.test,a=/\S/;function c(t){return!function(t,e){return u.call(t,e)}(a,t)}var s={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"},f=/\s*/,l=/\s+/,h=/\s*=/,d=/\s*\}/,v=/#|\^|\/|>|\{|&|=|!/;function p(t){this.string=t,this.tail=t,this.pos=0}function y(t,e){this.view=t,this.cache={".":this.view},this.parent=e}function g(){this.cache={}}p.prototype.eos=function(){return""===this.tail},p.prototype.scan=function(t){var e=this.tail.match(t);if(!e||0!==e.index)return"";var n=e[0];return this.tail=this.tail.substring(n.length),this.pos+=n.length,n},p.prototype.scanUntil=function(t){var e,n=this.tail.search(t);switch(n){case-1:e=this.tail,this.tail="";break;case 0:e="";break;default:e=this.tail.substring(0,n),this.tail=this.tail.substring(n)}return this.pos+=e.length,e},y.prototype.push=function(t){return new y(t,this)},y.prototype.lookup=function(t){var e,n=this.cache;if(n.hasOwnProperty(t))e=n[t];else{for(var r,u,a=this,c=!1;a;){if(t.indexOf(".")>0)for(e=a.view,r=t.split("."),u=0;null!=e&&u<r.length;)u===r.length-1&&(c=o(e,r[u])),e=e[r[u++]];else e=a.view[t],c=o(a.view,t);if(c)break;a=a.parent}n[t]=e}return i(e)&&(e=e.call(this.view)),e},g.prototype.clearCache=function(){this.cache={}},g.prototype.parse=function(e,i){var o=this.cache,u=o[e];return null==u&&(u=o[e]=function(e,i){if(!e)return[];var o,u,a,s=[],y=[],g=[],b=!1,w=!1;function m(){if(b&&!w)for(;g.length;)delete y[g.pop()];else g=[];b=!1,w=!1}function _(t){if("string"==typeof t&&(t=t.split(l,2)),!n(t)||2!==t.length)throw new Error("Invalid tags: "+t);o=new RegExp(r(t[0])+"\\s*"),u=new RegExp("\\s*"+r(t[1])),a=new RegExp("\\s*"+r("}"+t[1]))}_(i||t.tags);for(var k,A,x,E,L,O,M=new p(e);!M.eos();){if(k=M.pos,x=M.scanUntil(o))for(var T=0,q=x.length;T<q;++T)c(E=x.charAt(T))?g.push(y.length):w=!0,y.push(["text",E,k,k+1]),k+=1,"\n"===E&&m();if(!M.scan(o))break;if(b=!0,A=M.scan(v)||"name",M.scan(f),"="===A?(x=M.scanUntil(h),M.scan(h),M.scanUntil(u)):"{"===A?(x=M.scanUntil(a),M.scan(d),M.scanUntil(u),A="&"):x=M.scanUntil(u),!M.scan(u))throw new Error("Unclosed tag at "+M.pos);if(L=[A,x,k,M.pos],y.push(L),"#"===A||"^"===A)s.push(L);else if("/"===A){if(!(O=s.pop()))throw new Error('Unopened section "'+x+'" at '+k);if(O[1]!==x)throw new Error('Unclosed section "'+O[1]+'" at '+k)}else"name"===A||"{"===A||"&"===A?w=!0:"="===A&&_(x)}if(O=s.pop())throw new Error('Unclosed section "'+O[1]+'" at '+M.pos);return function(t){for(var e,n=[],i=n,r=[],o=0,u=t.length;o<u;++o)switch((e=t[o])[0]){case"#":case"^":i.push(e),r.push(e),i=e[4]=[];break;case"/":r.pop()[5]=e[2],i=r.length>0?r[r.length-1][4]:n;break;default:i.push(e)}return n}(function(t){for(var e,n,i=[],r=0,o=t.length;r<o;++r)(e=t[r])&&("text"===e[0]&&n&&"text"===n[0]?(n[1]+=e[1],n[3]=e[3]):(i.push(e),n=e));return i}(y))}(e,i)),u},g.prototype.render=function(t,e,n){var i=this.parse(t),r=e instanceof y?e:new y(e);return this.renderTokens(i,r,n,t)},g.prototype.renderTokens=function(t,e,n,i){for(var r,o,u,a="",c=0,s=t.length;c<s;++c)u=void 0,"#"===(o=(r=t[c])[0])?u=this.renderSection(r,e,n,i):"^"===o?u=this.renderInverted(r,e,n,i):">"===o?u=this.renderPartial(r,e,n,i):"&"===o?u=this.unescapedValue(r,e):"name"===o?u=this.escapedValue(r,e):"text"===o&&(u=this.rawValue(r)),void 0!==u&&(a+=u);return a},g.prototype.renderSection=function(t,e,r,o){var u=this,a="",c=e.lookup(t[1]);if(c){if(n(c))for(var s=0,f=c.length;s<f;++s)a+=this.renderTokens(t[4],e.push(c[s]),r,o);else if("object"==typeof c||"string"==typeof c||"number"==typeof c)a+=this.renderTokens(t[4],e.push(c),r,o);else if(i(c)){if("string"!=typeof o)throw new Error("Cannot use higher-order sections without the original template");null!=(c=c.call(e.view,o.slice(t[3],t[5]),function(t){return u.render(t,e,r)}))&&(a+=c)}else a+=this.renderTokens(t[4],e,r,o);return a}},g.prototype.renderInverted=function(t,e,i,r){var o=e.lookup(t[1]);if(!o||n(o)&&0===o.length)return this.renderTokens(t[4],e,i,r)},g.prototype.renderPartial=function(t,e,n){if(n){var r=i(n)?n(t[1]):n[t[1]];return null!=r?this.renderTokens(this.parse(r),e,n,r):void 0}},g.prototype.unescapedValue=function(t,e){var n=e.lookup(t[1]);if(null!=n)return n},g.prototype.escapedValue=function(e,n){var i=n.lookup(e[1]);if(null!=i)return t.escape(i)},g.prototype.rawValue=function(t){return t[1]},t.name="mustache.js",t.version="2.3.2",t.tags=["{{","}}"];var b=new g;return t.clearCache=function(){return b.clearCache()},t.parse=function(t,e){return b.parse(t,e)},t.render=function(t,e,i){if("string"!=typeof t)throw new TypeError('Invalid template! Template should be a "string" but "'+(n(r=t)?"array":typeof r)+'" was given as the first argument for mustache#render(template, view, partials)');var r;return b.render(t,e,i)},t.to_html=function(e,n,r,o){var u=t.render(e,n,r);if(!i(o))return u;o(u)},t.escape=function(t){return String(t).replace(/[&<>"'`=\/]/g,function(t){return s[t]})},t.Scanner=p,t.Context=y,t.Writer=g,t},e&&"string"!=typeof e.nodeName?u(e):(r=[e],void 0===(o="function"==typeof(i=u)?i.apply(e,r):i)||(t.exports=o))},function(t,e,n){var i=n(40);"string"==typeof i&&(i=[[t.i,i,""]]);var r={hmr:!0,transform:void 0,insertInto:void 0};n(42)(i,r);i.locals&&(t.exports=i.locals)},function(t,e,n){(t.exports=n(41)(!1)).push([t.i,".bbh-page{\r\n\tfloat: none;\r\n\tposition: static;\r\n}\r\n\r\n.bbh-page.bbh-new{\r\n\twidth: 100%;\r\n\tfloat: left;\r\n\tposition: absolute;\r\n}\r\n\r\n.bbh-page.bbh-vanish{\r\n\topacity: 1;\r\n\ttransition: opacity 0.5s ease-in-out, display 0.5s ease-in-out;\r\n}\r\n\r\n.bbh-page.bbh-vanish.bbh-hide{\r\n\topacity: 0;\r\n}\r\n\r\n.bbh-page.bbh-new.bbh-slide{\r\n\tz-index: 51;\r\n\tborder-radius: 15px;\r\n\twidth: 98vw;\r\n\tbox-shadow: 0 5px 20px 7px rgba(0,0,0,0.3);\r\n\tpadding: 15px;\r\n}\r\n\r\n.bbh-page.bbh-slide-under{\r\n\tz-index: 50;\r\n}\r\n\r\n.bbh-page.bbh-slide{\r\n\tleft: 1vw;\r\n\ttop: 1.5vw;\r\n\ttransition: left 2s ease-in-out;\r\n\tposition: fixed;\r\n\tmin-height: 98.5vh;\r\n\tmax-height: 98.5vh;\r\n\tbackground: #fff;\r\n}\r\n\r\n.bbh-page.bbh-slide.bbh-hide{\r\n\tleft: 100vw;\r\n}",""])},function(t,e){t.exports=function(t){var e=[];return e.toString=function(){return this.map(function(e){var n=function(t,e){var n=t[1]||"",i=t[3];if(!i)return n;if(e&&"function"==typeof btoa){var r=(u=i,"/*# sourceMappingURL=data:application/json;charset=utf-8;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(u))))+" */"),o=i.sources.map(function(t){return"/*# sourceURL="+i.sourceRoot+t+" */"});return[n].concat(o).concat([r]).join("\n")}var u;return[n].join("\n")}(e,t);return e[2]?"@media "+e[2]+"{"+n+"}":n}).join("")},e.i=function(t,n){"string"==typeof t&&(t=[[null,t,""]]);for(var i={},r=0;r<this.length;r++){var o=this[r][0];"number"==typeof o&&(i[o]=!0)}for(r=0;r<t.length;r++){var u=t[r];"number"==typeof u[0]&&i[u[0]]||(n&&!u[2]?u[2]=n:n&&(u[2]="("+u[2]+") and ("+n+")"),e.push(u))}},e}},function(t,e,n){var i,r,o={},u=(i=function(){return window&&document&&document.all&&!window.atob},function(){return void 0===r&&(r=i.apply(this,arguments)),r}),a=function(t){var e={};return function(t){if("function"==typeof t)return t();if(void 0===e[t]){var n=function(t){return document.querySelector(t)}.call(this,t);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(t){n=null}e[t]=n}return e[t]}}(),c=null,s=0,f=[],l=n(43);function h(t,e){for(var n=0;n<t.length;n++){var i=t[n],r=o[i.id];if(r){r.refs++;for(var u=0;u<r.parts.length;u++)r.parts[u](i.parts[u]);for(;u<i.parts.length;u++)r.parts.push(b(i.parts[u],e))}else{var a=[];for(u=0;u<i.parts.length;u++)a.push(b(i.parts[u],e));o[i.id]={id:i.id,refs:1,parts:a}}}}function d(t,e){for(var n=[],i={},r=0;r<t.length;r++){var o=t[r],u=e.base?o[0]+e.base:o[0],a={css:o[1],media:o[2],sourceMap:o[3]};i[u]?i[u].parts.push(a):n.push(i[u]={id:u,parts:[a]})}return n}function v(t,e){var n=a(t.insertInto);if(!n)throw new Error("Couldn't find a style target. This probably means that the value for the 'insertInto' parameter is invalid.");var i=f[f.length-1];if("top"===t.insertAt)i?i.nextSibling?n.insertBefore(e,i.nextSibling):n.appendChild(e):n.insertBefore(e,n.firstChild),f.push(e);else if("bottom"===t.insertAt)n.appendChild(e);else{if("object"!=typeof t.insertAt||!t.insertAt.before)throw new Error("[Style Loader]\n\n Invalid value for parameter 'insertAt' ('options.insertAt') found.\n Must be 'top', 'bottom', or Object.\n (https://github.com/webpack-contrib/style-loader#insertat)\n");var r=a(t.insertInto+" "+t.insertAt.before);n.insertBefore(e,r)}}function p(t){if(null===t.parentNode)return!1;t.parentNode.removeChild(t);var e=f.indexOf(t);e>=0&&f.splice(e,1)}function y(t){var e=document.createElement("style");return void 0===t.attrs.type&&(t.attrs.type="text/css"),g(e,t.attrs),v(t,e),e}function g(t,e){Object.keys(e).forEach(function(n){t.setAttribute(n,e[n])})}function b(t,e){var n,i,r,o;if(e.transform&&t.css){if(!(o=e.transform(t.css)))return function(){};t.css=o}if(e.singleton){var u=s++;n=c||(c=y(e)),i=_.bind(null,n,u,!1),r=_.bind(null,n,u,!0)}else t.sourceMap&&"function"==typeof URL&&"function"==typeof URL.createObjectURL&&"function"==typeof URL.revokeObjectURL&&"function"==typeof Blob&&"function"==typeof btoa?(n=function(t){var e=document.createElement("link");return void 0===t.attrs.type&&(t.attrs.type="text/css"),t.attrs.rel="stylesheet",g(e,t.attrs),v(t,e),e}(e),i=function(t,e,n){var i=n.css,r=n.sourceMap,o=void 0===e.convertToAbsoluteUrls&&r;(e.convertToAbsoluteUrls||o)&&(i=l(i));r&&(i+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(r))))+" */");var u=new Blob([i],{type:"text/css"}),a=t.href;t.href=URL.createObjectURL(u),a&&URL.revokeObjectURL(a)}.bind(null,n,e),r=function(){p(n),n.href&&URL.revokeObjectURL(n.href)}):(n=y(e),i=function(t,e){var n=e.css,i=e.media;i&&t.setAttribute("media",i);if(t.styleSheet)t.styleSheet.cssText=n;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(n))}}.bind(null,n),r=function(){p(n)});return i(t),function(e){if(e){if(e.css===t.css&&e.media===t.media&&e.sourceMap===t.sourceMap)return;i(t=e)}else r()}}t.exports=function(t,e){if("undefined"!=typeof DEBUG&&DEBUG&&"object"!=typeof document)throw new Error("The style-loader cannot be used in a non-browser environment");(e=e||{}).attrs="object"==typeof e.attrs?e.attrs:{},e.singleton||"boolean"==typeof e.singleton||(e.singleton=u()),e.insertInto||(e.insertInto="head"),e.insertAt||(e.insertAt="bottom");var n=d(t,e);return h(n,e),function(t){for(var i=[],r=0;r<n.length;r++){var u=n[r];(a=o[u.id]).refs--,i.push(a)}t&&h(d(t,e),e);for(r=0;r<i.length;r++){var a;if(0===(a=i[r]).refs){for(var c=0;c<a.parts.length;c++)a.parts[c]();delete o[a.id]}}}};var w,m=(w=[],function(t,e){return w[t]=e,w.filter(Boolean).join("\n")});function _(t,e,n,i){var r=n?"":i.css;if(t.styleSheet)t.styleSheet.cssText=m(e,r);else{var o=document.createTextNode(r),u=t.childNodes;u[e]&&t.removeChild(u[e]),u.length?t.insertBefore(o,u[e]):t.appendChild(o)}}},function(t,e){t.exports=function(t){var e="undefined"!=typeof window&&window.location;if(!e)throw new Error("fixUrls requires window.location");if(!t||"string"!=typeof t)return t;var n=e.protocol+"//"+e.host,i=n+e.pathname.replace(/\/[^\/]*$/,"/");return t.replace(/url\s*\(((?:[^)(]|\((?:[^)(]+|\([^)(]*\))*\))*)\)/gi,function(t,e){var r,o=e.trim().replace(/^"(.*)"$/,function(t,e){return e}).replace(/^'(.*)'$/,function(t,e){return e});return/^(#|data:|http:\/\/|https:\/\/|file:\/\/\/|\s*$)/i.test(o)?t:(r=0===o.indexOf("//")?o:0===o.indexOf("/")?n+o:i+o.replace(/^\.\//,""),"url("+JSON.stringify(r)+")")})}},function(t,e,n){"use strict";n.r(e);var i={};n.r(i),n.d(i,"log",function(){return m}),n.d(i,"defaultCallback",function(){return _}),n.d(i,"isRemoteURIPattern",function(){return k}),n.d(i,"vidInURIPattern",function(){return A}),n.d(i,"strInURIPattern",function(){return x}),n.d(i,"getClassFromName",function(){return E}),n.d(i,"absoluteURL",function(){return L}),n.d(i,"execFuncWithArgList",function(){return O}),n.d(i,"serializeFormData",function(){return M}),n.d(i,"Heap",function(){return l}),n.d(i,"HeapNode",function(){return h}),n.d(i,"ReverseHeap",function(){return w});var r=n(0),o=n.n(r),u=n(1),a=n.n(u),c=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;o()(this,t),this.info=e,this.user=n}return a()(t,[{key:"getInfo",value:function(){return this.info}},{key:"getUser",value:function(){return this.user}}]),t}(),s=n(5),f=n.n(s),l=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;o()(this,t),e?this.build(e):this.array=[]}return a()(t,[{key:"sx",value:function(t){return 2*t}},{key:"dx",value:function(t){return 2*t+1}},{key:"father",value:function(t){return parseInt(t/2)}},{key:"heapify",value:function(t){var e=this.sx(t),n=this.dx(t),i=t;if(e<this.array.length&&this.array[e].getKey()>this.array[t].getKey()&&(i=e),n<this.array.length&&this.array[n].getKey()>this.array[i].getKey()&&(i=n),i!=t){var r=this.array[t];this.array[t]=this.array[i],this.array[i]=r,this.heapify(i)}}},{key:"build",value:function(t){this.array=t,this.reheap()}},{key:"reheap",value:function(){for(var t=parseInt(this.array.length/2);t>=0;t--)this.heapify(t)}},{key:"addNode",value:function(t){this.array.push(t),this.reheap()}},{key:"pop",value:function(){if(0==this.array.length)return null;var t=this.array[0];return this.array[0]=this.array[this.array.length-1],this.array.length=this.array.length-1,this.heapify(0),t}},{key:"getFirst",value:function(){return 0==this.array.length?null:this.array[0]}},{key:"findByValue",value:function(t){return new Promise(function(e,n){for(var i=0,r=this.array.length;i<r;i++){var o=this.array[i].getValue().equal(t);!0===o&&e(this.array[i]),o instanceof Promise&&o.then(function(t,e,n,i){if(!0===o&&e(t),!1===o&&n(),o instanceof Array)for(var r=0;r<o.length;r++)!1===o[r]&&n();e(t)}.bind(this,this.array[i],e,n))}n()}.bind(this))}},{key:"getNodes",value:f.a.mark(function t(){var e,n;return f.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:e=0,n=this.array.length;case 1:if(!(e<n)){t.next=7;break}return t.next=4,this.array[e];case 4:e++,t.next=1;break;case 7:case"end":return t.stop()}},t,this)})}]),t}(),h=function(){function t(e,n){o()(this,t),this.key=e,this.value=n}return a()(t,[{key:"getKey",value:function(){return this.key}},{key:"incKey",value:function(){this.key++}},{key:"decKey",value:function(){this.key--}},{key:"increaseKey",value:function(t){this.key+=t}},{key:"reduceKey",value:function(t){this.key-=t}},{key:"getValue",value:function(){return this.value}},{key:"setValue",value:function(t){this.value=t}}]),t}(),d=n(3),v=n.n(d),p=n(2),y=n.n(p),g=n(4),b=n.n(g),w=function(t){function e(){return o()(this,e),v()(this,y()(e).apply(this,arguments))}return b()(e,t),a()(e,[{key:"heapify",value:function(t){var e=this.sx(t),n=this.dx(t),i=t;if(e<this.array.length&&this.array[e].getKey()<this.array[t].getKey()&&(i=e),n<this.array.length&&this.array[n].getKey()<this.array[i].getKey()&&(i=n),i!=t){var r=this.array[t];this.array[t]=this.array[i],this.array[i]=r,this.heapify(i)}}}]),e}(l);function m(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(null!=e){for(var n=arguments.length,i=new Array(n>2?n-2:0),r=2;r<n;r++)i[r-2]=arguments[r];parseInt(e)>1?console.error("["+t+"] ",i):console.log("["+t+"] ",i)}else console.log(t)}function _(){arguments.length>0&&m(arguments)}var k=/^http[s]?:\/\//i,A=/^([0-9]+|back)\/?/,x=/^([\w]+)\/?/;function E(t){for(var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:window,n=t.split("."),i=0;i<n.length;i++)e=e[n[i]];return e}function L(t,e){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],i=t.split("/"),r=e.split("/");n&&i.pop();for(var o=0;o<r.length;o++)"."!=r[o]&&(".."==r[o]?i.pop():i.push(r[o]));return i.join("/")}function O(t,e){var n=[t].concat(e);return t.bind.apply(t,n)}function M(t){var e=[],n=!0,i=!1,r=void 0;try{for(var o,u=t.entries()[Symbol.iterator]();!(n=(o=u.next()).done);n=!0){var a=o.value;e.push(a[0]+"="+a[1])}}catch(t){i=!0,r=t}finally{try{n||null==u.return||u.return()}finally{if(i)throw r}}return e.join("&")}var T=function(){function t(){o()(this,t)}return a()(t,null,[{key:"getUser",value:function(e){return t.users[e]}},{key:"addUser",value:function(e){try{t.users[e.username]=e}catch(t){m(t)}}}]),t}();T.users={};var q=function(){function t(e,n,i){o()(this,t),this.username=e,this.password=n,this.roles=i}return a()(t,[{key:"getRoles",value:function(){return this.roles}},{key:"hasRole",value:function(t){return-1!=this.roles.indexOf(t)}},{key:"giveRole",value:function(t){this.roles.push(t)}}]),t}(),P=function t(e){o()(this,t),this.name},S=function(){function t(){o()(this,t)}return a()(t,null,[{key:"getRole",value:function(e){return t.roles[e]||(t.roles[e]=new P(e)),t.roles[e]}}]),t}();S.roles={};var F=function t(e,n,i){o()(this,t),this.code=e,this.status=n,this.content=i},j=function(){function t(e,n,i){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},u=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;for(var a in o()(this,t),this.method=e,this.uri=n,null!=i?this.setData(i):this.data=null,this.headers=r,this.headers)this.headers[a]&&"string"!=typeof this.headers[a]&&(this.headers[a]=this.headers[a].toString());this.response_type=u&&"string"!=typeof u?u.toString():u}return a()(t,[{key:"setHeader",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;null==this.headers&&(this.headers={}),e&&"string"!=typeof e&&(e=e.toString()),this.headers[t]=e}},{key:"getData",value:function(){return this.data}},{key:"getMethod",value:function(){return this.method}},{key:"getUri",value:function(){return this.uri}},{key:"getResponseType",value:function(){return this.response_type||"json"}},{key:"getHeaders",value:f.a.mark(function t(){var e,n;return f.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:t.t0=f.a.keys(this.headers);case 1:if((t.t1=t.t0()).done){t.next=8;break}return e=t.t1.value,n=this.headers[e],t.next=6,{name:e,value:n};case 6:t.next=1;break;case 8:case"end":return t.stop()}},t,this)})}]),t}(),U=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};o()(this,t),this.properties=e||{}}return a()(t,[{key:"getProperties",value:f.a.mark(function t(){var e,n;return f.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:t.t0=f.a.keys(this.properties);case 1:if((t.t1=t.t0()).done){t.next=8;break}return e=t.t1.value,n=this.properties[e],t.next=6,{x:e,v:n};case 6:t.next=1;break;case 8:case"end":return t.stop()}},t,this)})},{key:"getProperty",value:function(t){return this.properties[t]||null}}]),t}(),D=function(){function t(e){o()(this,t),this.name=e}return a()(t,[{key:"fetch",value:function(t){}},{key:"get",value:function(t){}},{key:"search",value:function(t){}},{key:"update",value:function(t){}},{key:"save",value:function(t){}},{key:"destroy",value:function(t){}}]),t}(),R=function t(e,n){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];o()(this,t),this.id=e,this.model=n,this.change=null!=i?i.bind(this):null,this.allowEdit=r},B=function(){function t(){o()(this,t)}return a()(t,null,[{key:"getModels",value:function(){return t.models}},{key:"getModel",value:function(e){return t.models[e]}},{key:"addModel",value:function(e){try{t.models[e.name]=new Proxy(e,{get:function(t,e){return e in t?t[e]:t.get(e)}})}catch(t){m(t)}}}]),t}();B.models={};var C=function t(e){o()(this,t),this.name="FrameworkException",this.message=e},W=function(t){function e(){return o()(this,e),v()(this,y()(e).apply(this,arguments))}return b()(e,t),e}(C),N=function(){function t(e,n){if(o()(this,t),!e.startsWith("app://")||!n.startsWith("app://"))throw new W;var i={};this.uri1=new RegExp("^"+e.replace(/:[^\s\/]+/g,function(t,e){return t.i+=1,this[e.substring(1)]=t.i,"([\\w-]+)"}.bind(i,{i:0}))+"$"),this.uri2=n.replace(/:[^\s\/]+/g,function(t){var e=this[t.substring(1)];return e?"$"+e:t}.bind(i))}return a()(t,[{key:"match",value:function(t){return this.uri1.test(t)}},{key:"route",value:function(t){return this.match(t)?t.replace(this.uri1,this.uri2):null}}]),t}(),$=function(){function t(){o()(this,t)}return a()(t,null,[{key:"route",value:function(e){for(var n=t.routes,i=0;i<n.length;i++){var r=n[i].route(e);if(r)return r}return e}},{key:"addRoute",value:function(e){try{t.routes.push(e)}catch(t){m(t)}}}]),t}();$.routes=[];var J=function t(e,n,i){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,u=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,a=arguments.length>5&&void 0!==arguments[5]&&arguments[5],c=arguments.length>6&&void 0!==arguments[6]&&arguments[6],s=arguments.length>7&&void 0!==arguments[7]&&arguments[7],f=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;o()(this,t),this.path=e,this.vid=n,this.lock=i,this.configuration=r,this.modules=u,this.roles=f,this.keepLive=a,this.allowDuplicate=c,this.ghostPage=s},H=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};for(var n in o()(this,t),e)this[n]=e[n]}return a()(t,[{key:"clone",value:function(){return new t(this)}}],[{key:"getGlobal",value:function(){return t.globalContext||(t.globalContext=new t),t.globalContext}}]),t}();H.globalContext=null;var X=n(10),K=n.n(X),G=function t(e){o()(this,t);var n=H.getGlobal();for(var i in n)this[i]=n[i];return new K.a(e,this)},Z=n(18),V=function(){function t(){o()(this,t)}return a()(t,null,[{key:"getInstance",value:function(){return arguments.length>0&&void 0!==arguments[0]&&arguments[0]?(null==t.systemInstance&&(t.systemInstance=new Z.a("bobblehead_core")),t.systemInstance):(null==t.instance&&(t.instance=new Z.a("bobblehead")),t.instance)}}]),t}();V.instance=null,V.systemInstance=null;var Y=function(){function t(){o()(this,t),this.session=null}return a()(t,[{key:"processRequest",value:function(){arguments.length>0&&void 0!==arguments[0]&&arguments[0]}},{key:"processPage",value:function(){arguments.length>0&&void 0!==arguments[0]&&arguments[0]}},{key:"processVirtualPage",value:function(){arguments.length>0&&void 0!==arguments[0]&&arguments[0]}},{key:"getCurrentSession",value:function(){return this.session}},{key:"replaceCurrentSession",value:function(t){this.session=t}},{key:"getCurrentUser",value:function(){return this.session?this.session.getUser():null}}]),t}(),z=function(t){function e(){return o()(this,e),v()(this,y()(e).apply(this,arguments))}return b()(e,t),e}(C),I=function(){function t(){o()(this,t)}return a()(t,null,[{key:"addMethod",value:function(e,n){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;t.methods[e]=[n,i]}},{key:"getMethod",value:function(e){var n=t.methods[e];return n?new(O(n[0],n[1])):null}}]),t}();I.methods={},I.NoneAuthentication=function(t){function e(){return o()(this,e),v()(this,y()(e).apply(this,arguments))}return b()(e,t),e}(Y),I.addMethod("none",I.NoneAuthentication),I.BasicAuthentication=function(t){function e(){return o()(this,e),v()(this,y()(e).apply(this,arguments))}return b()(e,t),a()(e,[{key:"login",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(t.name&&t.password){var e=new q(t.name,t.password,["user"]);this.session=new c({user:e})}else m("BasicAuthentication",1,"Invalid user");return null}},{key:"logout",value:function(){return this.replaceCurrentSession(null),null}},{key:"processRequest",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(t&&this.session){var e=this.session.getInfo().user;t.setHeader("Authorization","Basic "+btoa(e.name+":"+e.password))}}},{key:"processPage",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(t&&t.roles)if(this.session){for(var e=this.session.getInfo().user,n=!1,i=0;i<t.roles.length;i++)-1!=e.roles.indexOf(t.roles[i])&&(n=!0);if(!n)throw new z}else if(t.roles.length>0)throw new z}}]),e}(Y),I.addMethod("basic",I.BasicAuthentication);var Q=function(t){function e(){return o()(this,e),v()(this,y()(e).apply(this,arguments))}return b()(e,t),e}(C),tt=n(26),et=function(t){function e(){return o()(this,e),v()(this,y()(e).apply(this,arguments))}return b()(e,t),e}(n.n(tt)()(Event)),nt=function(t){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return o()(this,e),v()(this,y()(e).call(this,"acloaded",t))}return b()(e,t),e}(et),it=function(){function t(){o()(this,t)}return a()(t,[{key:"getCurrentSession",value:function(){if(this.currentAuthMethod){var t=this.currentAuthMethod.getCurrentSession();return(this.controllerData.session&&t!=this.controllerData.session||!this.controllerData.session&&t)&&this.saveSession(t),t}return this.controllerData.session}},{key:"getCurrentUser",value:function(){return this.currentAuthMethod?this.currentAuthMethod.getCurrentUser():null}},{key:"saveSession",value:function(t){var e=V.getInstance(!0);t._id="session",this.controllerData.session&&(t._rev=this.controllerData.session._rev),this.controllerData.session=t,e.put(t,{rev:!0}).then(function(t){this.controllerData.session._rev=t.rev,m("Saved local session",0,t)}.bind(this)).catch(function(t){m("Cannot save local session",1,t)})}},{key:"processRequest",value:function(t){this.currentAuthMethod&&this.currentAuthMethod.processRequest(t)}},{key:"processPage",value:function(t){if(this.currentAuthMethod){var e=this.getCurrentUser();if(e){var n=!1;if(t.roles&&t.roles.length>0){for(var i=0;i<t.roles.length;i++)if(e.hasRole(t.roles[i])){n=!0;break}}else n=!0;if(!n)throw new z;this.currentAuthMethod.processPage(t)}else{if(t.roles&&t.roles.length>0)throw new z;this.currentAuthMethod.processPage(t)}}}},{key:"processVirtualPage",value:function(t){this.currentAuthMethod&&this.currentAuthMethod.processVirtualPage(t)}},{key:"init",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"none";return new Promise(function(e,n){if(this.currentAuthMethod=I.getMethod(t)||I.getMethod("none"),!(this.currentAuthMethod instanceof Y))throw new Q;var i=V.getInstance(!0);this.controllerData={},i.get("session").then(function(t){this.controllerData.session=new c(t.info),this.controllerData.session._id=t._id,this.controllerData.session._rev=t._rev,this.currentAuthMethod.replaceCurrentSession(this.controllerData.session),m("Fetched local session",0,this.controllerData.session),document.dispatchEvent(new nt),e()}.bind(this)).catch(function(t){this.controllerData.session=null,m("Cannot retrive local session",1,t),document.dispatchEvent(new nt),e()}.bind(this))}.bind(this)).catch(function(t){m(t)})}}]),t}(),rt=function(){function t(e){o()(this,t),this.name=e,this.configuration={},this.__controllers={}}return a()(t,[{key:"controller",value:function(t,e){return this.__controllers[t]=e.bind(this),this}},{key:"getController",value:function(t){return this.__controllers[t]}},{key:"init",value:function(t){this.configuration=t}},{key:"manipulate",value:function(){}}]),t}(),ot=function(){function t(){o()(this,t)}return a()(t,null,[{key:"getModules",value:f.a.mark(function e(){var n;return f.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=f.a.keys(t.modules);case 1:if((e.t1=e.t0()).done){e.next=8;break}if(n=e.t1.value,!(t.modules[n]instanceof rt)){e.next=6;break}return e.next=6,t.modules[n];case 6:e.next=1;break;case 8:case"end":return e.stop()}},e,this)})},{key:"getModule",value:function(e){return t.modules[e]}},{key:"getModulePermissions",value:function(e){return t.modulePerms[e]}},{key:"addModule",value:function(e,n){try{t.modules[e.name]=e,t.modulePerms[e.name]=n}catch(t){m(t)}}}]),t}();ot.modules={},ot.modulePerms={};var ut=function(t){function e(){return o()(this,e),v()(this,y()(e).apply(this,arguments))}return b()(e,t),e}(C),at=function(){function t(){o()(this,t)}return a()(t,[{key:"doRequest",value:function(t){return new Promise(function(e,n){if(t.uri.startsWith("app://"))try{var i=$.route(t.uri).substring(6);if(i.startsWith("page/")){var r=A.exec(i.substring(5));if(r){var o=r[1],u=H.getGlobal();"back"==o?u.pageBuilder.pageBack():u.pageBuilder.buildPage(parseInt(o),t.getDataAsObject()).then(e).catch(n)}}else if(i.startsWith("module/")){var a=i.substring(7),c=a.indexOf("/"),s=null;s=c>=0?a.substring(0,c):a;var f=ot.getModule(s),l=a.substring(c+1);c=l.indexOf("/");var h=null;h=c>=0?l.substring(0,c):l;var d=f.getController(h);null!=d?d(t.getData(),e,n):n(new ut)}}catch(t){n(t)}})}}],[{key:"getInstance",value:function(){return t.instance||(t.instance=new t),t.instance}}]),t}();at.instance=null;var ct=n(11),st=n.n(ct),ft=n(14),lt=n.n(ft),ht=n(12),dt=n.n(ht),vt=function(t){function e(t,n,i){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},u=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;return o()(this,e),v()(this,y()(e).call(this,t,n,i,r,u))}return b()(e,t),a()(e,[{key:"getDataAsObject",value:function(){var t=null;if(null!=this.data){t={};var e=!0,n=!1,i=void 0;try{for(var r,o=this.data.entries()[Symbol.iterator]();!(e=(r=o.next()).done);e=!0){var u=r.value;t[u[0]]=u[1]}}catch(t){n=!0,i=t}finally{try{e||null==o.return||o.return()}finally{if(n)throw i}}}return t}},{key:"setData",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(null==t)this.data=null;else if(t instanceof FormData)this.data=t;else if(null!=e&&"string"==typeof t)null==this.data&&(this.data=new FormData),this.data.set(t,e);else if("string"==typeof t)this.data=t;else for(var n in t)this.setData(n,t[n])}},{key:"equal",value:function(t){if(!(t instanceof j))return!1;if(this.method!=t.getMethod())return!1;if(this.uri!=t.getUri())return!1;if(this.getResponseType()!=t.getResponseType())return!1;var n=t.getData();if(null!=n&&null!=this.data){var i=0;if(t instanceof e){var r=0,o=!0,u=!1,a=void 0;try{for(var c,s=n.keys()[Symbol.iterator]();!(o=(c=s.next()).done);o=!0){c.value;r++}}catch(t){u=!0,a=t}finally{try{o||null==s.return||s.return()}finally{if(u)throw a}}if(r!=i)return!1;var f=!0,l=!1,h=void 0;try{for(var d,v=this.data[Symbol.iterator]();!(f=(d=v.next()).done);f=!0){var p=d.value;if(n.get(p[0])!=p[1])return!1;i++}}catch(t){l=!0,h=t}finally{try{f||null==v.return||v.return()}finally{if(l)throw h}}}else if(t instanceof pt){var y=!0,g=!1,b=void 0;try{for(var w,m=this.data[Symbol.iterator]();!(y=(w=m.next()).done);y=!0){if((p=w.value)[1]instanceof Blob)null.push(new Promise(function(t,e){var i=new FileReader;i.onload=function(){t(n[p[0]]==dt()(i.result))}.bind(this),i.readAsText(p[1])}));else if(n[p[0]]!=p[1])return!1;i++}}catch(t){g=!0,b=t}finally{try{y||null==m.return||m.return()}finally{if(g)throw b}}if(Object.keys(n).length!=i)return!1}}else if(n!==this.data)return!1;return!0}},{key:"toCacherRequest",value:function(){return new pt(this.method,this.uri,this.data,this.headers,this.response_type)}}]),e}(j),pt=function(t){function e(t,n,i){var r,u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;o()(this,e);var c=(r=v()(this,y()(e).call(this,t,n,i,u,a))).promise;return delete r.promise,v()(r,c||lt()(lt()(r)))}return b()(e,t),a()(e,[{key:"setData",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(this.promise=null,t instanceof FormData){this.data={};var n=!0,i=!1,r=void 0;try{for(var o,u=t.entries()[Symbol.iterator]();!(n=(o=u.next()).done);n=!0){var a=o.value;a[1]instanceof Blob?(null==this.promise&&(this.promise=[]),this.promise.push(new Promise(function(t,e,n){var i=new FileReader;i.onload=function(){this.data[t]=dt()(i.result),e(this)}.bind(this),i.readAsText(a[1])}.bind(this,a[0])))):this.data[a[0]]=a[1]}}catch(t){i=!0,r=t}finally{try{n||null==u.return||u.return()}finally{if(i)throw r}}}else null!=e&&"string"==typeof t?(null==this.data&&(this.data={}),this.data[t]=e):this.data=t}},{key:"toRequest",value:function(){var t=null;if(null!=this.data)for(var e in t=new FormData,this.data)t.append(e,this.data[e]);return new vt(this.method,this.uri,t,this.headers,this.response_type)}},{key:"equal",value:function(t){if(!(t instanceof j))return!1;if(this.method!=t.getMethod())return!1;if(this.uri!=t.getUri())return!1;if(this.getResponseType()!=t.getResponseType())return!1;var n=t.getData();if(null!=n&&null!=this.data)if(t instanceof vt){var i=Object.keys(this.data).length,r=0,o=!0,u=!1,a=void 0;try{for(var c,s=n[Symbol.iterator]();!(o=(c=s.next()).done);o=!0){if((f=c.value)[1]instanceof Blob)null.push(new Promise(function(t,e){var n=new FileReader;n.onload=function(){t(this.data[f[0]]==dt()(n.result))}.bind(this),n.readAsText(f[1])}.bind(this)));else if(this.data[f[0]]!=f[1])return!1;r++}}catch(t){u=!0,a=t}finally{try{o||null==s.return||s.return()}finally{if(u)throw a}}if(r!=i)return!1}else if(t instanceof e){if(Object.keys(n).length!=Object.keys(this.data).length)return!1;for(var f in this.data)if(n[f]!=this.data[f])return!1}else if(n!==this.data)return!1;return!0}}],[{key:"fromObject",value:function(t){return"method"in t&&"uri"in t&&"data"in t?new e(t.method,t.uri,t.data,t.headers||void 0,t.response_type||void 0):null}}]),e}(j),yt=function(t){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return o()(this,e),v()(this,y()(e).call(this,"cacherloaded",t))}return b()(e,t),e}(et),gt=function(){function t(){o()(this,t)}return a()(t,null,[{key:"init",value:function(e,n,i,r){return new Promise(function(o,u){var a=V.getInstance(!0);a.get("cacheMap").then(function(e){e?t.cacheMap=e:(t.cacheMap={_id:"cacheMap",length:0},m("Cacher",0,"Cacher map not found")),a.get("cacheHeap").then(function(e){if(e){var n=[];for(var i in e.array){var r=e.array[i].value,u=new pt(r.method,r.uri,r.data,r.headers,r.response_type);n.push(new h(e.array[i].key,u))}var a=e._rev;(e=new w(n))._id="cacheHeap",e._rev=a;var c=e.getFirst();if(null!=c){var s=c.getKey()-1;if(s>0){var f=!0,l=!1,d=void 0;try{for(var v,p=e.getNodes()[Symbol.iterator]();!(f=(v=p.next()).done);f=!0){v.value.reduceKey(s)}}catch(t){l=!0,d=t}finally{try{f||null==p.return||p.return()}finally{if(l)throw d}}}}t.cacheHeap=e}else t.cacheHeap=new w,t.cacheHeap._id="cacheHeap",m("Cacher",0,"Cacher heap not found");document.dispatchEvent(new yt),o()}).catch(function(e){t.cacheHeap=new w,t.cacheHeap._id="cacheHeap",m("Cacher heap not found",1,e),document.dispatchEvent(new yt),o()})}).catch(function(e){t.cacheMap={_id:"cacheMap",length:0},t.cacheHeap=new w,t.cacheHeap._id="cacheHeap",m("Cacher map not found",1,e),document.dispatchEvent(new yt),o()}),t.whitelist=i,t.blacklist=r,t.maxCached=n,t.cacheDefault=e}.bind(this)).catch(function(t){m(t)})}},{key:"parseUri",value:function(t){for(var e=btoa(t),n=0,i=e.length-1;i>=0&&"="==e[i];i--)n++;return n>0?e.substring(0,e.length-n):e}},{key:"cache",value:function(e,n){var i=e.toCacherRequest(),r=function(e,n){var i=n.pop();if(-1==t.blacklist.indexOf(i.uri)){var r=V.getInstance(!0),o=t.parseUri(i.uri),u=-1;if(t.cacheMap[i.method]&&t.cacheMap[i.method][o])for(var a in t.cacheMap[i.method][o])if(t.cacheMap[i.method][o][a][0]instanceof pt||(t.cacheMap[i.method][o][a][0]=pt.fromObject(t.cacheMap[i.method][o][a][0])),i.equal(t.cacheMap[i.method][o][a][0])){u=a;break}if(-1!=u){null!=(c=t.cacheHeap.findByValue(i))&&c.then(function(n,r){r.incKey(),t.cacheHeap.reheap(),n.put(t.cacheHeap,{rev:!0}).then(function(e){t.cacheHeap._rev=e.rev,m("Saved Cacher heap",0,e)}).catch(function(t){m("Cannot save Cacher heap",1,t)}),t.cacheMap[i.method][o][u][1]=e}.bind(this,r)).catch(function(){m("URL in whitelist",0,"Cannot retrive node from Cacher heap")})}else if(t.cacheDefault||t.whitelist.indexOf(i.uri)>-1){if(t.cacheMap.length>t.maxCached)for(a=t.nodesPartNum;a>0;a--)for(var c,s=(c=t.cacheHeap.pop()).getValue(),f=t.parseUri(s.uri),l=t.cacheMap[s.method][f].length;l>0;l--){var d=t.cacheMap[s.method][f].shift();if(s.equal(d[0])){t.cacheMap.length--;break}d[0]instanceof pt||(d[0]=pt.fromObject(d[0])),t.cacheMap[s.method][f].push(d)}if(-1==t.whitelist.indexOf(i.uri)){var v=new h(1,i);t.cacheHeap.addNode(v),r.put(t.cacheHeap,{rev:!0}).then(function(e){t.cacheHeap._rev=e.rev,m("Saved Cacher heap",0,e)}).catch(function(t){m("Cannot save Cacher heap",1,t)})}t.cacheMap[i.method]||(t.cacheMap[i.method]={}),t.cacheMap[i.method][o]||(t.cacheMap[i.method][o]=[]),t.cacheMap[i.method][o].push([i,e]),t.cacheMap.length++,r.put(t.cacheMap,{rev:!0}).then(function(e){t.cacheMap._rev=e.rev,m("Saved Cacher map",0,e)}).catch(function(t){m("Cannot save Cacher map",1,t)})}}};i instanceof pt?r.bind(this)(n,[i]):Promise.all(i).then(r.bind(this,n))}},{key:"getCached",value:function(e){var n=t.parseUri(e.uri),i=[];if(t.cacheMap[e.method]&&t.cacheMap[e.method][n])for(var r in t.cacheMap[e.method][n]){t.cacheMap[e.method][n][r][0]instanceof pt||(t.cacheMap[e.method][n][r][0]=pt.fromObject(t.cacheMap[e.method][n][r][0]));var o=e.equal(t.cacheMap[e.method][n][r][0]);if(o instanceof Promise)i.push(o.then(function(t,e,n,i){return i?this[t][e][n][1]:null}.bind(t.cacheMap,e.method,n,r)));else if(1==o)return t.cacheMap[e.method][n][r][1]}return i.length>0?Promise.all(i).then(function(t){for(var e=0;e<t.length;e++)if(null!=t[e])return t[e]}):null}}]),t}();gt.cacheHeap=null,gt.cacheMap=null,gt.whitelist=null,gt.blacklist=null,gt.maxCached=1e3,gt.cacheDefault=!0,gt.nodesPartNum=3;var bt=function(){function t(){o()(this,t)}return a()(t,[{key:"doRequest",value:function(t){return new Promise(function(e,n){var i=new XMLHttpRequest,r=encodeURI(t.uri);if("get"==t.method&&null!=t.getData()){var o="",u=!0,a=!1,c=void 0;try{for(var s,l=t.getData().entries()[Symbol.iterator]();!(u=(s=l.next()).done);u=!0){var h=s.value;h[0]&&(h[1]||0===h[1])&&(o+=h[0]+"="+h[1].toString().trim()+"&")}}catch(t){a=!0,c=t}finally{try{u||null==l.return||l.return()}finally{if(a)throw c}}r+="?"+(o=o.slice(0,-1))}i.open(t.getMethod(),r,!0);var d=!0,v=!1,p=void 0;try{for(var y,g=t.getHeaders()[Symbol.iterator]();!(d=(y=g.next()).done);d=!0){var b=y.value;i.setRequestHeader(b.name,b.value)}}catch(t){v=!0,p=t}finally{try{d||null==g.return||g.return()}finally{if(v)throw p}}i.responseType=t.getResponseType(),i.onreadystatechange=st()(f.a.mark(function r(){var o,u,a;return f.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(o=new F,i.readyState!==XMLHttpRequest.DONE){r.next=19;break}if(u=null,o.code=0,o.status=i.status,200===i.status){r.next=15;break}if(4==Math.floor(i.status/100)){r.next=14;break}if(!((u=gt.getCached(t))instanceof Promise)){r.next=14;break}return a=u,r.next=13,a;case 13:u=r.sent;case 14:u||(o.code=-10,o.content={error:"Connection Error"});case 15:u||(u=i.response),u?o.content=u:200===i.status&&(o.code=-11,o.content={error:"No data response"}),200===i.status&&gt.cache(t,u),0==o.code?e(o):n(o);case 19:case"end":return r.stop()}},r,this)})),i.send(t.getData())})}}],[{key:"getInstance",value:function(){return t.instance||(t.instance=new t),t.instance}}]),t}();bt.instance=null;var wt=function(){function t(){o()(this,t)}return a()(t,[{key:"request",value:function(t){var e=k.test(t.uri);return H.getGlobal().accessController.processRequest(t),(e?bt.getInstance():at.getInstance()).doRequest(t)}}]),t}(),mt=function(){function t(){o()(this,t)}return a()(t,null,[{key:"getPage",value:function(e){return t.pages[e]}},{key:"addPage",value:function(e){try{t.pages[e.vid]=e}catch(t){m(t)}}}]),t}();mt.pages={};var _t=function t(e,n,i,r,u){o()(this,t),this.page=e,this.data=n,this.context=i,this.success=r,this.fail=u},kt=function(t){function e(){return o()(this,e),v()(this,y()(e).apply(this,arguments))}return b()(e,t),e}(C),At=function(t){function e(t){var n,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return o()(this,e),(n=v()(this,y()(e).call(this))).vid=t,n.data=i,n}return b()(e,t),e}(C),xt=function(t){function e(t){return o()(this,e),v()(this,y()(e).call(this,t+" model not found!"))}return b()(e,t),e}(C),Et=function(t){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return o()(this,e),v()(this,y()(e).call(this,"pageready",t))}return b()(e,t),e}(et),Lt=n(22),Ot=n.n(Lt),Mt=(n(39),function(){function t(){var e;o()(this,t),this.pageStack=[],this.container=null,this.documentProxy=null,this.currentPage=null,this.transition=null,(e=window.Node).prototype.__addEventListener=e.prototype.addEventListener,e.prototype.addEventListener=function(t,e,n){return this!=document&&(this.__listners||(this.__listners={}),t.split(" ").forEach(function(t,e,n){this.__listners[n]||(this.__listners[n]=[]),this.__listners[n].push({ls:t,uc:e})}.bind(this,e,n))),this.__addEventListener(t,e,n)},e.prototype.__removeEventListener=e.prototype.removeEventListener,e.prototype.removeEventListener=function(t,e){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return this.__listners&&t.split(" ").forEach(function(t,e,n){if(this.__listners&&this.__listners[n])for(var i=this.__listners[n].length,r=0;r<i;r++){var o=this.__listners[n].shift();if(o.ls==t&&o.uc==e)break;this.__listners[n].push(o)}}.bind(this,e,n)),this.__removeEventListener(t,e,n)},e.prototype.__renewListeners=function(){if(this.hasChildNodes())for(var t=this.childNodes,e=0;e<t.length;e++)t[e].__renewListeners();if(this.__listners)for(var n in this.__listners)for(var i=0;i<this.__listners[n].length;i++)this.__addEventListener(n,this.__listners[n][i].ls,this.__listners[n][i].uc)}}return a()(t,[{key:"checkPage",value:function(t){H.getGlobal().accessController.processPage(t)}},{key:"checkVirtualPage",value:function(t){H.getGlobal().accessController.processVirtualPage(t)}},{key:"pageHop",value:function(){document.getElementById(this.container).classList.remove("bbh-new")}},{key:"setDefaultListener",value:function(t,e){if(e instanceof Element){if("A"==e.tagName.toUpperCase())var n=[e];else n=e.getElementsByTagName("a");for(var i=0;i<n.length;i++)n[i].hasAttribute("bbh-ignore")||!n[i].getAttribute("href")||"#"==n[i].getAttribute("href")||k.test(n[i].getAttribute("href"))||(n[i].onclick=function(t){var e=new vt("GET",this.getAttribute("href"),null);return t.request(e),!1}.bind(n[i],t.defaultConnector));if("FORM"==e.tagName.toUpperCase())var r=[e];else r=e.getElementsByTagName("form");for(i=0;i<r.length;i++)r[i].hasAttribute("bbh-ignore")||(r[i].onsubmit=function(t){var e=!0,n=!1,i=void 0;try{for(var r,o=this.querySelectorAll("[name]")[Symbol.iterator]();!(e=(r=o.next()).done);e=!0){var u=r.value;if(!u.checkValidity())return void u.reportValidity()}}catch(t){n=!0,i=t}finally{try{e||null==o.return||o.return()}finally{if(n)throw i}}var a=new FormData(this),c=new vt(this.getAttribute("method"),this.getAttribute("action"),a);return t.request(c),!1}.bind(r[i],t.defaultConnector))}}},{key:"makeTransition",value:function(t,e,n){var i=null;"vanish"==n?(e.classList.add("bbh-vanish"),e.classList.add("bbh-hide"),window.getComputedStyle(e).opacity,i=new Promise(function(e,n){t.classList.add("bbh-vanish"),window.getComputedStyle(t).opacity,t.addEventListener("transitionend",i=function(){t.removeEventListener("transitionend",i),e()}),t.classList.add("bbh-hide");var i=null})):"slide"==n&&(t.classList.add("bbh-slide-under"),e.classList.remove("bbh-slide-under"),e.classList.add("bbh-slide"),e.classList.add("bbh-hide"),e.style.display="block",window.getComputedStyle(t).height,i=new Promise(function(t,n){var i=null;e.addEventListener("transitionend",i=function(){e.removeEventListener("transitionend",i),e.classList.remove("bbh-slide"),t()}),e.classList.remove("bbh-hide")}));var r=null;return e.addEventListener("pageready",r=function(){"vanish"==n&&e.classList.remove("bbh-hide"),e.removeEventListener("pageready",r)}),i}},{key:"waitNremove",value:function(t,e){if(t){for(var n=e.querySelectorAll("*[id]"),i=0;i<n.length;i++)n[i].id+="-toDelete";t=t.then(function(){document.body.removeChild(e)}).catch(function(){document.body.removeChild(e)})}else document.body.removeChild(e);return t}},{key:"getNewContainer",value:function(t){var e=document.getElementById(this.container);e.setAttribute("id",this.container+"-toDelete");var n=document.createElement("div");n.setAttribute("id",this.container),n.classList.add("bbh-page"),n.classList.add("bbh-new"),document.body.appendChild(n);var i=this.makeTransition(e,n,this.transition);if(t){var r=function(){var t=document.querySelectorAll('*[id^="historyPage-"]').length;e.setAttribute("id","historyPage-"+t),e.style.display="none";for(var n=e.querySelectorAll("*[id]"),i=0;i<n.length;i++)n[i].id+="-history"+t};i?i=i.then(r):r()}else this.waitNremove(i,e);return i?i.then(function(){return n}):n}},{key:"buildPage",value:function(t,e){return new Promise(function(n,i){var r=mt.getPage(t);if(r){var o=!1,u=!1;this.currentPage&&this.currentPage.page.ghostPage&&(this.currentPage=this.pageStack.pop()||null,u=!0),r.lock||null==this.currentPage||r.vid==this.currentPage.page.vid&&!r.allowDuplicate||(!u&&this.currentPage.page.keepLive&&(o=!0),this.pageStack.push(this.currentPage)),r.lock&&(this.pageStack=[]);var a=this.getNewContainer(o),c=function(t){var o=new G(t);this.currentPage=new _t(r,e,o,n,i),this.checkVirtualPage(this.currentPage),this.buildPageByObject(r,e,o,n,i),this.pageHop()}.bind(this);a instanceof Promise?a.then(c):c(a)}else i(new kt)}.bind(this)).catch(function(t){m(t)})}},{key:"buildPageFromHistory",value:function(t){var e=document.getElementById(this.container);e.setAttribute("id",this.container+"-toDelete");var n=document.getElementById("historyPage-"+t);n.classList.add("bbh-new");var i=this.waitNremove(this.makeTransition(e,n,this.transition),e),r=function(){n.setAttribute("id",this.container),n.style.display="block";for(var e=n.querySelectorAll("*[id]"),i=("-history"+t).length,r=0;r<e.length;r++)e[r].id=e[r].id.substring(0,e[r].id.length-i),e[r].__renewListeners();document.dispatchEvent(new Et),n.dispatchEvent(new Et)}.bind(this);return i?i.then(r):(r(),null)}},{key:"buildPageByText",value:function(t,e,n,i,r,o,u){var a=H.getGlobal(),c=document.getElementById(this.container),s=[],l=!0,h=!1,d=void 0;try{for(var v,p=Ot.a.parse(t)[Symbol.iterator]();!(l=(v=p.next()).done);l=!0){"text"!=(b=v.value)[0]&&s.push(b)}}catch(t){h=!0,d=t}finally{try{l||null==p.return||p.return()}finally{if(h)throw d}}for(var y=[],g=B.getModels();s.length>0;){var b;if((b=s.shift())[4]instanceof Array){var w=!0,_=!1,k=void 0;try{for(var A,x=b[4][Symbol.iterator]();!(w=(A=x.next()).done);w=!0){var E=A.value;"text"!=E[0]&&"name"!=E[0]&&s.push(E)}}catch(t){_=!0,k=t}finally{try{w||null==x.return||x.return()}finally{if(_)throw k}}}if(b[1].startsWith("models.")){var L=b[1].split(".");if(!g[L[1]])throw new xt(L[1]);try{var O=i.execMethod("fetch",[L[2]],g[L[1]]);O instanceof Promise&&y.push(O)}catch(t){throw new C("Invalid access to models by Mustache on page.")}}}Promise.all(y).then(st()(f.a.mark(function u(){var s,l,h,d,v,p,y,b,w,_,k,A,x,E,L,O,M,T,q,P,S;return f.a.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:c.innerHTML=Ot.a.render(t,{pageData:e,models:g,pageConf:n.properties}),new MutationObserver(function(t,e){var n=!0,i=!1,r=void 0;try{for(var o,u=e[Symbol.iterator]();!(n=(o=u.next()).done);n=!0){var a=o.value;if("childList"==a.type){var c=!0,s=!1,f=void 0;try{for(var l,h=a.addedNodes[Symbol.iterator]();!(c=(l=h.next()).done);c=!0){var d=l.value;this.setDefaultListener(t,d)}}catch(t){s=!0,f=t}finally{try{c||null==h.return||h.return()}finally{if(s)throw f}}}}}catch(t){i=!0,r=t}finally{try{n||null==u.return||u.return()}finally{if(i)throw r}}}.bind(this,a)).observe(c,{subtree:!0,childList:!0}),s=c.getElementsByTagName("script"),l=null,h=0;case 6:if(!(h<s.length)){u.next=21;break}if(d=s[h].getAttribute("async"),""==s[h].getAttribute("src")||null==s[h].getAttribute("src")){u.next=17;break}if(v=s[h].getAttribute("src"),"true"==d||null==l){u.next=13;break}return u.next=13,l;case 13:p=new Promise(function(t,e){var n=new XMLHttpRequest;n.open("get",v,!0),n.responseType="text",n.onreadystatechange=function(e,i){if(n.readyState===XMLHttpRequest.DONE){try{e.execCode(n.response)}catch(t){m("Execution of scriptfile: "+i,3,t)}t()}}.bind(this,i,v),n.send()}).catch(function(t){m(t)}),"true"!=d&&(l=p),u.next=18;break;case 17:try{i.execCode(s[h].innerHTML)}catch(t){m("Execution of script code",3,t)}case 18:h++,u.next=6;break;case 21:this.setDefaultListener(a,c),y=null==l?[]:[l],b=!0,w=!1,_=void 0,u.prev=26,k=ot.getModules()[Symbol.iterator]();case 28:if(b=(A=k.next()).done){u.next=71;break}if(x=A.value,!(null!=r&&r.indexOf(x.name)>-1)){u.next=68;break}E=!0,L=!1,O=void 0,u.prev=34,M=c.querySelectorAll('[bbh-module*="'+x.name+'"]')[Symbol.iterator]();case 36:if(E=(T=M.next()).done){u.next=54;break}if((q=T.value).setAttribute("bbh-manipulating","true"),P=new K.a(q,a.clone()),void 0===(S=P.execMethod("manipulate",[],x))){u.next=49;break}if(!(S instanceof Promise)){u.next=46;break}S.then(function(){q.setAttribute("bbh-manipulating","false")}),u.next=47;break;case 46:throw new C(x.name+" manipulate has not returned a promise");case 47:u.next=50;break;case 49:q.setAttribute("bbh-manipulating","false");case 50:y.push(S);case 51:E=!0,u.next=36;break;case 54:u.next=60;break;case 56:u.prev=56,u.t0=u.catch(34),L=!0,O=u.t0;case 60:u.prev=60,u.prev=61,E||null==M.return||M.return();case 63:if(u.prev=63,!L){u.next=66;break}throw O;case 66:return u.finish(63);case 67:return u.finish(60);case 68:b=!0,u.next=28;break;case 71:u.next=77;break;case 73:u.prev=73,u.t1=u.catch(26),w=!0,_=u.t1;case 77:u.prev=77,u.prev=78,b||null==k.return||k.return();case 80:if(u.prev=80,!w){u.next=83;break}throw _;case 83:return u.finish(80);case 84:return u.finish(77);case 85:Promise.all(y).then(function(){document.dispatchEvent(new Et),c.dispatchEvent(new Et),o()});case 86:case"end":return u.stop()}},u,this,[[26,73,77,85],[34,56,60,68],[61,,63,67],[78,,80,84]])})).bind(this))}},{key:"buildPageByObject",value:function(t,e,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:_,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:_;try{this.checkPage(t);var o=new XMLHttpRequest;o.open("GET",t.path,!0),o.onreadystatechange=function(){var t=st()(f.a.mark(function t(e,n,i,r,u,a){return f.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:o.readyState===XMLHttpRequest.DONE&&404===o.status?a(new kt):o.readyState===XMLHttpRequest.DONE&&this.buildPageByText(o.response,e,n,i,r,u,a);case 1:case"end":return t.stop()}},t,this)}));return function(e,n,i,r,o,u){return t.apply(this,arguments)}}().bind(this,e,t.configuration,n,t.modules,i,r),o.send(null)}catch(t){r(t),t instanceof At&&(-1==t.vid?this.pageBack():this.buildPage(t.vid,t.data))}}},{key:"pageBack",value:function(){var t=this.pageStack.pop();if(!t)throw new kt;if(this.currentPage=t,this.checkVirtualPage(t),t.page.keepLive){var e=document.querySelectorAll('*[id^="historyPage-"]').length,n=this.buildPageFromHistory(e-1,t.page.path);n&&n.then(function(){this.pageHop()}.bind(this))}else{this.getNewContainer(!1);var i=function(){this.buildPageByObject(t.page,t.data,t.context,t.success,t.fail),this.pageHop()}.bind(this);domcontainer instanceof Promise?domcontainer.then(i):i()}}}]),t}()),Tt=function(){function t(){o()(this,t)}return a()(t,null,[{key:"getDOMParser",value:function(){return null==t.domParser&&(t.domParser=new DOMParser),t.domParser}},{key:"parseUrl",value:function(t,e){var n=new XMLHttpRequest;n.open("get",t,!0),n.responseType="text",n.onreadystatechange=function(t){n.readyState===XMLHttpRequest.DONE&&t(this.parseString(n.response))}.bind(this,e),n.send()}},{key:"parseString",value:function(e){var n=null;window.DOMParser?n=t.getDOMParser().parseFromString(e,"application/xml"):((n=new ActiveXObject("Microsoft.XMLDOM")).async=!1,n.loadXML(e));return n}}]),t}();Tt.domParser=null;var qt=function(t){function e(){return o()(this,e),v()(this,y()(e).apply(this,arguments))}return b()(e,t),e}(U),Pt=function(t){function e(){return o()(this,e),v()(this,y()(e).apply(this,arguments))}return b()(e,t),e}(U),St=function t(e){o()(this,t),this.name="FrameworkError",this.message=e},Ft=function(t){function e(){return o()(this,e),v()(this,y()(e).call(this,"Current Javascript Engine doesn't support the framework."))}return b()(e,t),e}(St),jt=function(){function t(e){o()(this,t),this.moduleOnLoad=[],this.initialization=!0,Tt.parseUrl(e,this.processConf.bind(this))}return a()(t,[{key:"registerModel",value:function(t){B.addModel(t)}},{key:"registerModule",value:function(t){this.initialization?this.moduleOnLoad.push(t):ot.addModule(t)}},{key:"registerRoute",value:function(t){$.addRoute(t)}},{key:"addToGlobalContext",value:function(t,e){var n=H.getGlobal();if(t in n)throw new C("A module tried to edit global context!");n[t]=e}},{key:"processConf",value:function(e){if(e){var n={};try{var i=e.getElementsByTagName("configuration")[0];if(n.container=i.getElementsByTagName("container")[0].textContent,i.getElementsByTagName("base_url").length>0)n.base_url=i.getElementsByTagName("base_url")[0].textContent;else{var r=document.location.pathname.split("/");r.pop(),n.base_url=document.location.protocol+"//"+document.location.host+r.join("/")}var o=i.getElementsByTagName("pageBuilder")[0],u=[],a=[],c=1e3,s=!0,f=i.getElementsByTagName("cacher")[0];if(f){if(f.getAttribute("max-cached")&&(c=parseInt(f.getAttribute("max-cached"))),f.getElementsByTagName("block")){var l=!0,h=!1,d=void 0;try{for(var v,p=f.getElementsByTagName("block")[Symbol.iterator]();!(l=(v=p.next()).done);l=!0){var y=v.value;a.push(y.getAttribute("url"))}}catch(t){h=!0,d=t}finally{try{l||null==p.return||p.return()}finally{if(h)throw d}}}if(f.getElementsByTagName("persist")){var g=!0,b=!1,w=void 0;try{for(var _,k=f.getElementsByTagName("persist")[Symbol.iterator]();!(g=(_=k.next()).done);g=!0){var A=_.value;u.push(A.getAttribute("url"))}}catch(t){b=!0,w=t}finally{try{g||null==k.return||k.return()}finally{if(b)throw w}}}f.getAttribute("default")&&"nocache"==f.getAttribute("default")&&(s=!1)}var x=gt.init(s,c,u,a),O=i.getElementsByTagName("pages")[0],M=O.getElementsByTagName("index")[0],T=O.getAttribute("path"),q=O.getAttribute("transition")||null,P=!0,S=!1,F=void 0;try{for(var j,D=O.getElementsByTagName("page")[Symbol.iterator]();!(P=(j=D.next()).done);P=!0){A=j.value;var R=null,B=null;A.getAttribute("modulesAllowed")&&(R=A.getAttribute("modulesAllowed").split(",")),A.getAttribute("rolesAllowed")&&(B=A.getAttribute("rolesAllowed").split(","));var W={};if(A.getElementsByTagName("configuration")&&A.getElementsByTagName("configuration").length>0){var $=!0,X=!1,G=void 0;try{for(var Z,Y=A.getElementsByTagName("configuration")[0].childNodes[Symbol.iterator]();!($=(Z=Y.next()).done);$=!0){var z=Z.value;z instanceof Element&&(W[z.tagName]=z.textContent)}}catch(t){X=!0,G=t}finally{try{$||null==Y.return||Y.return()}finally{if(X)throw G}}}var I=new qt(W),Q=new J(A.getAttribute("path"),parseInt(A.getAttribute("vid")),"true"==A.getAttribute("noback"),I,R,A.hasAttribute("keepLive")?"true"==A.getAttribute("keepLive"):void 0,A.hasAttribute("allowDuplicate")?"true"==A.getAttribute("allowDuplicate"):void 0,A.hasAttribute("ghostPage")?"true"==A.getAttribute("ghostPage"):void 0,B);mt.addPage(Q)}}catch(t){S=!0,F=t}finally{try{P||null==D.return||D.return()}finally{if(S)throw F}}t.configuration=new U(n);var tt=i.getElementsByTagName("routes")[0];if(tt){var et=!0,nt=!1,rt=void 0;try{for(var ut,at=tt.getElementsByTagName("route")[Symbol.iterator]();!(et=(ut=at.next()).done);et=!0){var ct=ut.value;this.registerRoute(new N(ct.getAttribute("entry"),ct.getAttribute("destination")))}}catch(t){nt=!0,rt=t}finally{try{et||null==at.return||at.return()}finally{if(nt)throw rt}}}var st=i.getElementsByTagName("modules")[0],ft=null;if(st){var lt=st.getAttribute("path");lt.startsWith(n.base_url)||(lt=L(n.base_url,lt,!1));var ht={},dt=document.createElement("iframe");for(var vt in dt.style.display="none",document.body.appendChild(dt),window)vt in dt.contentWindow||(dt.contentWindow[vt]=window[vt]);dt.contentWindow.Promise=window.Promise,dt.contentWindow.Array=window.Array,dt.contentWindow.Element=window.Element,dt.contentWindow._document=new Proxy(document,{container:document.getElementById(n.container),whiteList:["querySelector","getElementById","dispatchEvent","createElement"],get:function(t,e){var n="function"!=typeof t[e]||-1!=this.whiteList.indexOf(e)?t[e]:void 0;return"function"==typeof n&&"createElement"!=e&&(n=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];var i=t.apply(document,e);if(i instanceof Node){for(var r=i;r=r.parentNode;)if(r==this)return i;return this}}.bind(this.container,n)),n.bind(t)},set:function(t,e,n){return!1}});var pt=!0,yt=!1,bt=void 0;try{for(var _t,kt=st.getElementsByTagName("module")[Symbol.iterator]();!(pt=(_t=kt.next()).done);pt=!0){var At=_t.value;if("true"==At.getAttribute("enabled")){var xt,Et=At.getAttribute("permissions")?At.getAttribute("permissions").split(","):[];xt=function t(e){var n={},i=!0,r=!1,o=void 0;try{for(var u,a=e.childNodes[Symbol.iterator]();!(i=(u=a.next()).done);i=!0){var c=u.value;c instanceof Element&&(c.hasChildNodes()?1==c.childNodes.length&&c.childNodes[0].nodeType==Node.TEXT_NODE?n[c.tagName]=c.textContent:n[c.tagName]=t(c):n[c.tagName]=c.textContent)}}catch(t){r=!0,o=t}finally{try{i||null==a.return||a.return()}finally{if(r)throw o}}return n}(At.getElementsByTagName("configuration")[0]);var Lt=new Pt(xt);ft=new Promise(function(t,e,n,i,r){var o=function(t,e,n){var i=document.createElement("script");if(i.src=lt+At.getAttribute("path"),i.type="module",i.onload=function(t,e,n,i){for(;t.length>0;){var r=t.shift();ht[r.name]=e,ot.addModule(r,n)}i()}.bind(i,this.moduleOnLoad,t,e,n),lt.startsWith("file:")){var r=new XMLHttpRequest;r.onload=function(t,e,n,i){var o=r.response,u=new Blob([o],{type:"text/javascript"});e.src=URL.createObjectURL(u),n.contentDocument.head.appendChild(e)}.bind(this,At,i,dt),r.open("get",lt+At.getAttribute("path")),r.responseType="blob",r.send()}else dt.contentDocument.head.appendChild(i)}.bind(this,t,e,i);null!=n?n.then(o):o()}.bind(this,Lt,Et,ft)).catch(function(t){m(t)})}}}catch(t){yt=!0,bt=t}finally{try{pt||null==kt.return||kt.return()}finally{if(yt)throw bt}}}var Ot=document.createElement("base");Ot.setAttribute("href",T),document.getElementsByTagName("head")[0].appendChild(Ot);var Tt=dt.contentDocument.createElement("base");Tt.setAttribute("href",n.base_url+"/"+T),dt.contentDocument.getElementsByTagName("head")[0].appendChild(Tt),Promise.all([x,ft]).then(function(){var t=H.getGlobal();if(t.BobbleHead=new Proxy(BobbleHead,{whiteList:["User","Role","Session","Response","Request","ConnectorRequest","Model","ModelInstance","Route","Page","PageContext","AuthenticationMethod","AuthenticationMethods","PageFactory","VirtualPage","Exceptions","Errors","Events","Util"],get:function(t,e){return e in t&&-1!=this.whiteList.indexOf(e)?t[e]:null}}),o){o=o.textContent;try{var e=E(o)||E(o,dt.contentWindow);if(!e)throw new C(o+" isn't a valid PageBuilder");t.pageBuilder=o?new e:new Mt}catch(e){m(e),t.pageBuilder=new Mt}}else t.pageBuilder=new Mt;t.pageBuilder.container=n.container,t.pageBuilder.transition=q;var r=i.getElementsByTagName("defaultConnector")[0];if(r){r=r.textContent;try{var u=E(r)||E(r,dt.contentWindow);if(!u)throw new C(r+" isn't a valid GenericConnector");t.defaultConnector=r?new u:new wt}catch(e){m(e),t.defaultConnector=new wt}}else t.defaultConnector=new wt;var a=i.getElementsByTagName("accessController")[0],c=null;if(a){var s=a.textContent;try{if(s){var f=E(s)||E(s,dt.contentWindow);if(!f)throw new C(s+" isn't a valid AccessController")}t.accessController=s?new f:new it,c=t.accessController.init(a.getAttribute("method"))}catch(e){m(e),t.accessController=new it,c=t.accessController.init(a.getAttribute("method")||"none")}}else t.accessController=new it,c=t.accessController.init("none");t.localDatabase=V.getInstance(),c.then(function(){var e=[],i=!0,r=!1,o=void 0;try{for(var u,a=ot.getModules()[Symbol.iterator]();!(i=(u=a.next()).done);i=!0){var c=u.value,s=t.clone(),f=[],l=!0,h=!1,d=void 0;try{for(var v,p=ot.getModulePermissions(c.name)[Symbol.iterator]();!(l=(v=p.next()).done);l=!0){var y=v.value;"pages"==y?f=f.concat(["PageFactory","PageConfiguration"]):"users"==y?f=f.concat(["UserPool","RolePool"]):"models"==y&&(f=f.concat(["ModelPool"]))}}catch(t){h=!0,d=t}finally{try{l||null==p.return||p.return()}finally{if(h)throw d}}s.BobbleHead=new Proxy(BobbleHead,{whiteList:["User","Role","Session","Response","Request","ConnectorRequest","Model","ModelInstance","Route","Page","PageContext","AuthenticationMethod","AuthenticationMethods","VirtualPage","Exceptions","Errors","Events","Util","XMLParser"].concat(f),moduleName:c.name,get:function(t,e){if(e in t&&-1!=this.whiteList.indexOf(e))return t[e];throw new C("Unpermitted access to "+e+" from "+this.moduleName)}});var g=new K.a(document.getElementById(n.container),s).execMethod("init",[ht[c.name]],c);g instanceof Promise&&e.push(g)}}catch(t){r=!0,o=t}finally{try{i||null==a.return||a.return()}finally{if(r)throw o}}if(M){n.index=parseInt(M.getAttribute("vid"));var b=null;if(M.getElementsByTagName("data")[0]){b={};var w=!0,m=!1,_=void 0;try{for(var k,A=M.getElementsByTagName("data")[0].childNodes[Symbol.iterator]();!(w=(k=A.next()).done);w=!0){var x=k.value;x instanceof Element&&(b[x.tagName]=x.textContent)}}catch(t){m=!0,_=t}finally{try{w||null==A.return||A.return()}finally{if(m)throw _}}}Promise.all(e).then(function(t,e){this.pageBuilder.buildPage(t,e)}.bind(t,n.index,b))}this.initialization=!1}.bind(this))}.bind(this))}catch(t){throw m(t),new Ft}}}}],[{key:"getConf",value:function(e){return t.configuration?t.configuration.getProperty(e):null}}]),t}();jt.configuration=null;var Ut=function(t){function e(){return o()(this,e),v()(this,y()(e).apply(this,arguments))}return b()(e,t),e}(C),Dt=function(t){function e(t){return o()(this,e),v()(this,y()(e).call(this,t))}return b()(e,t),e}(C);e.default=function(){var t={};return Object.defineProperties(t,{UserPool:{value:T,writable:!1},User:{value:q,writable:!1},Role:{value:P,writable:!1},RolePool:{value:S,writable:!1},Session:{value:c,writable:!1},Response:{value:F,writable:!1},Request:{value:j,writable:!1},ConnectorRequest:{value:vt,writable:!1},CacherRequest:{value:pt,writable:!1},GenericConfiguration:{value:U,writable:!1},ModuleConfiguration:{value:Pt,writable:!1},PageConfiguration:{value:qt,writable:!1},Model:{value:D,writable:!1},ModelInstance:{value:R,writable:!1},ModelPool:{value:B,writable:!1},Route:{value:N,writable:!1},Router:{value:$,writable:!1},Page:{value:J,writable:!1},PageContext:{value:G,writable:!1},AccessController:{value:it,writable:!1},AuthenticationMethod:{value:Y,writable:!1},AuthenticationMethods:{value:I,writable:!1},InternalConnector:{value:at,writable:!1},ExternalConnector:{value:bt,writable:!1},GenericConnector:{value:wt,writable:!1},Cacher:{value:gt,writable:!1},PageBuilder:{value:Mt,writable:!1},PageFactory:{value:mt,writable:!1},Module:{value:rt,writable:!1},ModulePool:{value:ot,writable:!1},VirtualPage:{value:_t,writable:!1},Database:{value:V,writable:!1},AppController:{value:jt,writable:!1},XMLParser:{value:Tt,writable:!1},Context:{value:H,writable:!1},defaultCallback:{value:_,writable:!1},Exceptions:{value:{get FrameworkException(){return C},set FrameworkException(t){},get GenericModuleException(){return Dt},set GenericModuleException(t){},get PageNotFoundException(){return kt},set PageNotFoundException(t){},get RedirectException(){return At},set RedirectException(t){},get NotSupportedException(){return Ut},set NotSupportedException(t){},get UnauthorizedException(){return z},set UnauthorizedException(t){},get InvalidRouteException(){return W},set InvalidRouteException(t){},get ControllerNotFoundException(){return ut},set ControllerNotFoundException(t){},get ModelNotFoundException(){return xt},set ModelNotFoundException(t){},get InvalidAuthenticationMethodException(){return Q},set InvalidAuthenticationMethodException(t){}},writable:!1},Errors:{value:{FrameworkError:St,NotSupportedEngineError:Ft},writable:!1},Events:{value:{get FrameworkEvent(){return et},set FrameworkEvent(t){},get CacherLoadedEvent(){return yt},set CacherLoadedEvent(t){},get AccessControllerLoadedEvent(){return nt},set AccessControllerLoadedEvent(t){},get PageReadyEvent(){return Et},set PageReadyEvent(t){}},writable:!1},Util:{value:i,writable:!1},init:{value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"./app.xml";if(t.app)throw new C("BobbleHead is already running");return Object.defineProperty(t,"app",{value:new t.AppController(e),writable:!1}),t.app},writable:!1}}),t}()}]).default;