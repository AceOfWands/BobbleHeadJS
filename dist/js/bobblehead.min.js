var BobbleHead=function(t){var n={};function e(i){if(n[i])return n[i].exports;var r=n[i]={i:i,l:!1,exports:{}};return t[i].call(r.exports,r,r.exports,e),r.l=!0,r.exports}return e.m=t,e.c=n,e.d=function(t,n,i){e.o(t,n)||Object.defineProperty(t,n,{enumerable:!0,get:i})},e.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},e.t=function(t,n){if(1&n&&(t=e(t)),8&n)return t;if(4&n&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(e.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&n&&"string"!=typeof t)for(var r in t)e.d(i,r,function(n){return t[n]}.bind(null,r));return i},e.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,"a",n),n},e.o=function(t,n){return Object.prototype.hasOwnProperty.call(t,n)},e.p="",e(e.s=44)}([function(t,n){t.exports=function(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}},function(t,n){function e(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}t.exports=function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}},function(t,n){function e(n){return t.exports=e=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},e(n)}t.exports=e},function(t,n,e){var i=e(29),r=e(14);t.exports=function(t,n){return!n||"object"!==i(n)&&"function"!=typeof n?r(t):n}},function(t,n,e){var i=e(16);t.exports=function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(n&&n.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),n&&i(t,n)}},function(t,n,e){t.exports=e(27)},function(t,n){function e(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function i(t){return"function"==typeof t}function r(t){return"object"==typeof t&&null!==t}function o(t){return void 0===t}t.exports=e,e.EventEmitter=e,e.prototype._events=void 0,e.prototype._maxListeners=void 0,e.defaultMaxListeners=10,e.prototype.setMaxListeners=function(t){if("number"!=typeof t||t<0||isNaN(t))throw TypeError("n must be a positive number");return this._maxListeners=t,this},e.prototype.emit=function(t){var n,e,u,a,c,s;if(this._events||(this._events={}),"error"===t&&(!this._events.error||r(this._events.error)&&!this._events.error.length)){if((n=arguments[1])instanceof Error)throw n;var f=new Error('Uncaught, unspecified "error" event. ('+n+")");throw f.context=n,f}if(o(e=this._events[t]))return!1;if(i(e))switch(arguments.length){case 1:e.call(this);break;case 2:e.call(this,arguments[1]);break;case 3:e.call(this,arguments[1],arguments[2]);break;default:a=Array.prototype.slice.call(arguments,1),e.apply(this,a)}else if(r(e))for(a=Array.prototype.slice.call(arguments,1),u=(s=e.slice()).length,c=0;c<u;c++)s[c].apply(this,a);return!0},e.prototype.addListener=function(t,n){var u;if(!i(n))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",t,i(n.listener)?n.listener:n),this._events[t]?r(this._events[t])?this._events[t].push(n):this._events[t]=[this._events[t],n]:this._events[t]=n,r(this._events[t])&&!this._events[t].warned&&(u=o(this._maxListeners)?e.defaultMaxListeners:this._maxListeners)&&u>0&&this._events[t].length>u&&(this._events[t].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[t].length),"function"==typeof console.trace&&console.trace()),this},e.prototype.on=e.prototype.addListener,e.prototype.once=function(t,n){if(!i(n))throw TypeError("listener must be a function");var e=!1;function r(){this.removeListener(t,r),e||(e=!0,n.apply(this,arguments))}return r.listener=n,this.on(t,r),this},e.prototype.removeListener=function(t,n){var e,o,u,a;if(!i(n))throw TypeError("listener must be a function");if(!this._events||!this._events[t])return this;if(u=(e=this._events[t]).length,o=-1,e===n||i(e.listener)&&e.listener===n)delete this._events[t],this._events.removeListener&&this.emit("removeListener",t,n);else if(r(e)){for(a=u;a-- >0;)if(e[a]===n||e[a].listener&&e[a].listener===n){o=a;break}if(o<0)return this;1===e.length?(e.length=0,delete this._events[t]):e.splice(o,1),this._events.removeListener&&this.emit("removeListener",t,n)}return this},e.prototype.removeAllListeners=function(t){var n,e;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[t]&&delete this._events[t],this;if(0===arguments.length){for(n in this._events)"removeListener"!==n&&this.removeAllListeners(n);return this.removeAllListeners("removeListener"),this._events={},this}if(i(e=this._events[t]))this.removeListener(t,e);else if(e)for(;e.length;)this.removeListener(t,e[e.length-1]);return delete this._events[t],this},e.prototype.listeners=function(t){return this._events&&this._events[t]?i(this._events[t])?[this._events[t]]:this._events[t].slice():[]},e.prototype.listenerCount=function(t){if(this._events){var n=this._events[t];if(i(n))return 1;if(n)return n.length}return 0},e.listenerCount=function(t,n){return t.listenerCount(n)}},function(t,n){"function"==typeof Object.create?t.exports=function(t,n){t.super_=n,t.prototype=Object.create(n.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}})}:t.exports=function(t,n){t.super_=n;var e=function(){};e.prototype=n.prototype,t.prototype=new e,t.prototype.constructor=t}},function(t,n,e){"use strict";(function(n){var e,i,r=n.MutationObserver||n.WebKitMutationObserver;if(r){var o=0,u=new r(f),a=n.document.createTextNode("");u.observe(a,{characterData:!0}),e=function(){a.data=o=++o%2}}else if(n.setImmediate||void 0===n.MessageChannel)e="document"in n&&"onreadystatechange"in n.document.createElement("script")?function(){var t=n.document.createElement("script");t.onreadystatechange=function(){f(),t.onreadystatechange=null,t.parentNode.removeChild(t),t=null},n.document.documentElement.appendChild(t)}:function(){setTimeout(f,0)};else{var c=new n.MessageChannel;c.port1.onmessage=f,e=function(){c.port2.postMessage(0)}}var s=[];function f(){var t,n;i=!0;for(var e=s.length;e;){for(n=s,s=[],t=-1;++t<e;)n[t]();e=s.length}i=!1}t.exports=function(t){1!==s.push(t)||i||e()}}).call(this,e(13))},function(t,n,e){"use strict";t.exports=function(t){return function(){var n=arguments.length;if(n){for(var e=[],i=-1;++i<n;)e[i]=arguments[i];return t.call(this,e)}return t.call(this,[])}}},function(t,n,e){(function(n){t.exports=n.Sandbox=e(30)}).call(this,e(13))},function(t,n){function e(t,n,e,i,r,o,u){try{var a=t[o](u),c=a.value}catch(t){return void e(t)}a.done?n(c):Promise.resolve(c).then(i,r)}t.exports=function(t){return function(){var n=this,i=arguments;return new Promise(function(r,o){var u=t.apply(n,i);function a(t){e(u,r,o,a,c,"next",t)}function c(t){e(u,r,o,a,c,"throw",t)}a(void 0)})}}},function(t,n,e){var i,r;void 0===(r="function"==typeof(i=function(){function t(t,n){var u=t[0],a=t[1],c=t[2],s=t[3];u=e(u,a,c,s,n[0],7,-680876936),s=e(s,u,a,c,n[1],12,-389564586),c=e(c,s,u,a,n[2],17,606105819),a=e(a,c,s,u,n[3],22,-1044525330),u=e(u,a,c,s,n[4],7,-176418897),s=e(s,u,a,c,n[5],12,1200080426),c=e(c,s,u,a,n[6],17,-1473231341),a=e(a,c,s,u,n[7],22,-45705983),u=e(u,a,c,s,n[8],7,1770035416),s=e(s,u,a,c,n[9],12,-1958414417),c=e(c,s,u,a,n[10],17,-42063),a=e(a,c,s,u,n[11],22,-1990404162),u=e(u,a,c,s,n[12],7,1804603682),s=e(s,u,a,c,n[13],12,-40341101),c=e(c,s,u,a,n[14],17,-1502002290),a=e(a,c,s,u,n[15],22,1236535329),u=i(u,a,c,s,n[1],5,-165796510),s=i(s,u,a,c,n[6],9,-1069501632),c=i(c,s,u,a,n[11],14,643717713),a=i(a,c,s,u,n[0],20,-373897302),u=i(u,a,c,s,n[5],5,-701558691),s=i(s,u,a,c,n[10],9,38016083),c=i(c,s,u,a,n[15],14,-660478335),a=i(a,c,s,u,n[4],20,-405537848),u=i(u,a,c,s,n[9],5,568446438),s=i(s,u,a,c,n[14],9,-1019803690),c=i(c,s,u,a,n[3],14,-187363961),a=i(a,c,s,u,n[8],20,1163531501),u=i(u,a,c,s,n[13],5,-1444681467),s=i(s,u,a,c,n[2],9,-51403784),c=i(c,s,u,a,n[7],14,1735328473),a=i(a,c,s,u,n[12],20,-1926607734),u=r(u,a,c,s,n[5],4,-378558),s=r(s,u,a,c,n[8],11,-2022574463),c=r(c,s,u,a,n[11],16,1839030562),a=r(a,c,s,u,n[14],23,-35309556),u=r(u,a,c,s,n[1],4,-1530992060),s=r(s,u,a,c,n[4],11,1272893353),c=r(c,s,u,a,n[7],16,-155497632),a=r(a,c,s,u,n[10],23,-1094730640),u=r(u,a,c,s,n[13],4,681279174),s=r(s,u,a,c,n[0],11,-358537222),c=r(c,s,u,a,n[3],16,-722521979),a=r(a,c,s,u,n[6],23,76029189),u=r(u,a,c,s,n[9],4,-640364487),s=r(s,u,a,c,n[12],11,-421815835),c=r(c,s,u,a,n[15],16,530742520),a=r(a,c,s,u,n[2],23,-995338651),u=o(u,a,c,s,n[0],6,-198630844),s=o(s,u,a,c,n[7],10,1126891415),c=o(c,s,u,a,n[14],15,-1416354905),a=o(a,c,s,u,n[5],21,-57434055),u=o(u,a,c,s,n[12],6,1700485571),s=o(s,u,a,c,n[3],10,-1894986606),c=o(c,s,u,a,n[10],15,-1051523),a=o(a,c,s,u,n[1],21,-2054922799),u=o(u,a,c,s,n[8],6,1873313359),s=o(s,u,a,c,n[15],10,-30611744),c=o(c,s,u,a,n[6],15,-1560198380),a=o(a,c,s,u,n[13],21,1309151649),u=o(u,a,c,s,n[4],6,-145523070),s=o(s,u,a,c,n[11],10,-1120210379),c=o(c,s,u,a,n[2],15,718787259),a=o(a,c,s,u,n[9],21,-343485551),t[0]=f(u,t[0]),t[1]=f(a,t[1]),t[2]=f(c,t[2]),t[3]=f(s,t[3])}function n(t,n,e,i,r,o){return n=f(f(n,t),f(i,o)),f(n<<r|n>>>32-r,e)}function e(t,e,i,r,o,u,a){return n(e&i|~e&r,t,e,o,u,a)}function i(t,e,i,r,o,u,a){return n(e&r|i&~r,t,e,o,u,a)}function r(t,e,i,r,o,u,a){return n(e^i^r,t,e,o,u,a)}function o(t,e,i,r,o,u,a){return n(i^(e|~r),t,e,o,u,a)}function u(n){txt="";var e,i=n.length,r=[1732584193,-271733879,-1732584194,271733878];for(e=64;e<=n.length;e+=64)t(r,a(n.substring(e-64,e)));n=n.substring(e-64);var o=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(e=0;e<n.length;e++)o[e>>2]|=n.charCodeAt(e)<<(e%4<<3);if(o[e>>2]|=128<<(e%4<<3),e>55)for(t(r,o),e=0;16>e;e++)o[e]=0;return o[14]=8*i,t(r,o),r}function a(t){var n,e=[];for(n=0;64>n;n+=4)e[n>>2]=t.charCodeAt(n)+(t.charCodeAt(n+1)<<8)+(t.charCodeAt(n+2)<<16)+(t.charCodeAt(n+3)<<24);return e}function c(t){for(var n="",e=0;4>e;e++)n+=l[t>>8*e+4&15]+l[t>>8*e&15];return n}function s(t){return function(t){for(var n=0;n<t.length;n++)t[n]=c(t[n]);return t.join("")}(u(t))}function f(t,n){return t+n&4294967295}function f(t,n){var e=(65535&t)+(65535&n),i=(t>>16)+(n>>16)+(e>>16);return i<<16|65535&e}var l="0123456789abcdef".split("");return s("hello"),s})?i.call(n,e,n,t):i)||(t.exports=r)},function(t,n){var e;e=function(){return this}();try{e=e||new Function("return this")()}catch(t){"object"==typeof window&&(e=window)}t.exports=e},function(t,n){t.exports=function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}},function(t,n,e){t.exports=function(t){"use strict";var n=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];function e(t,n){var e=t[0],i=t[1],r=t[2],o=t[3];e+=(i&r|~i&o)+n[0]-680876936|0,o+=((e=(e<<7|e>>>25)+i|0)&i|~e&r)+n[1]-389564586|0,r+=((o=(o<<12|o>>>20)+e|0)&e|~o&i)+n[2]+606105819|0,i+=((r=(r<<17|r>>>15)+o|0)&o|~r&e)+n[3]-1044525330|0,e+=((i=(i<<22|i>>>10)+r|0)&r|~i&o)+n[4]-176418897|0,o+=((e=(e<<7|e>>>25)+i|0)&i|~e&r)+n[5]+1200080426|0,r+=((o=(o<<12|o>>>20)+e|0)&e|~o&i)+n[6]-1473231341|0,i+=((r=(r<<17|r>>>15)+o|0)&o|~r&e)+n[7]-45705983|0,e+=((i=(i<<22|i>>>10)+r|0)&r|~i&o)+n[8]+1770035416|0,o+=((e=(e<<7|e>>>25)+i|0)&i|~e&r)+n[9]-1958414417|0,r+=((o=(o<<12|o>>>20)+e|0)&e|~o&i)+n[10]-42063|0,i+=((r=(r<<17|r>>>15)+o|0)&o|~r&e)+n[11]-1990404162|0,e+=((i=(i<<22|i>>>10)+r|0)&r|~i&o)+n[12]+1804603682|0,o+=((e=(e<<7|e>>>25)+i|0)&i|~e&r)+n[13]-40341101|0,r+=((o=(o<<12|o>>>20)+e|0)&e|~o&i)+n[14]-1502002290|0,i+=((r=(r<<17|r>>>15)+o|0)&o|~r&e)+n[15]+1236535329|0,e+=((i=(i<<22|i>>>10)+r|0)&o|r&~o)+n[1]-165796510|0,o+=((e=(e<<5|e>>>27)+i|0)&r|i&~r)+n[6]-1069501632|0,r+=((o=(o<<9|o>>>23)+e|0)&i|e&~i)+n[11]+643717713|0,i+=((r=(r<<14|r>>>18)+o|0)&e|o&~e)+n[0]-373897302|0,e+=((i=(i<<20|i>>>12)+r|0)&o|r&~o)+n[5]-701558691|0,o+=((e=(e<<5|e>>>27)+i|0)&r|i&~r)+n[10]+38016083|0,r+=((o=(o<<9|o>>>23)+e|0)&i|e&~i)+n[15]-660478335|0,i+=((r=(r<<14|r>>>18)+o|0)&e|o&~e)+n[4]-405537848|0,e+=((i=(i<<20|i>>>12)+r|0)&o|r&~o)+n[9]+568446438|0,o+=((e=(e<<5|e>>>27)+i|0)&r|i&~r)+n[14]-1019803690|0,r+=((o=(o<<9|o>>>23)+e|0)&i|e&~i)+n[3]-187363961|0,i+=((r=(r<<14|r>>>18)+o|0)&e|o&~e)+n[8]+1163531501|0,e+=((i=(i<<20|i>>>12)+r|0)&o|r&~o)+n[13]-1444681467|0,o+=((e=(e<<5|e>>>27)+i|0)&r|i&~r)+n[2]-51403784|0,r+=((o=(o<<9|o>>>23)+e|0)&i|e&~i)+n[7]+1735328473|0,i+=((r=(r<<14|r>>>18)+o|0)&e|o&~e)+n[12]-1926607734|0,e+=((i=(i<<20|i>>>12)+r|0)^r^o)+n[5]-378558|0,o+=((e=(e<<4|e>>>28)+i|0)^i^r)+n[8]-2022574463|0,r+=((o=(o<<11|o>>>21)+e|0)^e^i)+n[11]+1839030562|0,i+=((r=(r<<16|r>>>16)+o|0)^o^e)+n[14]-35309556|0,e+=((i=(i<<23|i>>>9)+r|0)^r^o)+n[1]-1530992060|0,o+=((e=(e<<4|e>>>28)+i|0)^i^r)+n[4]+1272893353|0,r+=((o=(o<<11|o>>>21)+e|0)^e^i)+n[7]-155497632|0,i+=((r=(r<<16|r>>>16)+o|0)^o^e)+n[10]-1094730640|0,e+=((i=(i<<23|i>>>9)+r|0)^r^o)+n[13]+681279174|0,o+=((e=(e<<4|e>>>28)+i|0)^i^r)+n[0]-358537222|0,r+=((o=(o<<11|o>>>21)+e|0)^e^i)+n[3]-722521979|0,i+=((r=(r<<16|r>>>16)+o|0)^o^e)+n[6]+76029189|0,e+=((i=(i<<23|i>>>9)+r|0)^r^o)+n[9]-640364487|0,o+=((e=(e<<4|e>>>28)+i|0)^i^r)+n[12]-421815835|0,r+=((o=(o<<11|o>>>21)+e|0)^e^i)+n[15]+530742520|0,i+=((r=(r<<16|r>>>16)+o|0)^o^e)+n[2]-995338651|0,e+=(r^((i=(i<<23|i>>>9)+r|0)|~o))+n[0]-198630844|0,o+=(i^((e=(e<<6|e>>>26)+i|0)|~r))+n[7]+1126891415|0,r+=(e^((o=(o<<10|o>>>22)+e|0)|~i))+n[14]-1416354905|0,i+=(o^((r=(r<<15|r>>>17)+o|0)|~e))+n[5]-57434055|0,e+=(r^((i=(i<<21|i>>>11)+r|0)|~o))+n[12]+1700485571|0,o+=(i^((e=(e<<6|e>>>26)+i|0)|~r))+n[3]-1894986606|0,r+=(e^((o=(o<<10|o>>>22)+e|0)|~i))+n[10]-1051523|0,i+=(o^((r=(r<<15|r>>>17)+o|0)|~e))+n[1]-2054922799|0,e+=(r^((i=(i<<21|i>>>11)+r|0)|~o))+n[8]+1873313359|0,o+=(i^((e=(e<<6|e>>>26)+i|0)|~r))+n[15]-30611744|0,r+=(e^((o=(o<<10|o>>>22)+e|0)|~i))+n[6]-1560198380|0,i+=(o^((r=(r<<15|r>>>17)+o|0)|~e))+n[13]+1309151649|0,e+=(r^((i=(i<<21|i>>>11)+r|0)|~o))+n[4]-145523070|0,o+=(i^((e=(e<<6|e>>>26)+i|0)|~r))+n[11]-1120210379|0,r+=(e^((o=(o<<10|o>>>22)+e|0)|~i))+n[2]+718787259|0,i=((i+=(o^((r=(r<<15|r>>>17)+o|0)|~e))+n[9]-343485551|0)<<21|i>>>11)+r|0,t[0]=e+t[0]|0,t[1]=i+t[1]|0,t[2]=r+t[2]|0,t[3]=o+t[3]|0}function i(t){var n,e=[];for(n=0;n<64;n+=4)e[n>>2]=t.charCodeAt(n)+(t.charCodeAt(n+1)<<8)+(t.charCodeAt(n+2)<<16)+(t.charCodeAt(n+3)<<24);return e}function r(t){var n,e=[];for(n=0;n<64;n+=4)e[n>>2]=t[n]+(t[n+1]<<8)+(t[n+2]<<16)+(t[n+3]<<24);return e}function o(t){var n,r,o,u,a,c,s=t.length,f=[1732584193,-271733879,-1732584194,271733878];for(n=64;n<=s;n+=64)e(f,i(t.substring(n-64,n)));for(t=t.substring(n-64),r=t.length,o=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],n=0;n<r;n+=1)o[n>>2]|=t.charCodeAt(n)<<(n%4<<3);if(o[n>>2]|=128<<(n%4<<3),n>55)for(e(f,o),n=0;n<16;n+=1)o[n]=0;return u=(u=8*s).toString(16).match(/(.*?)(.{0,8})$/),a=parseInt(u[2],16),c=parseInt(u[1],16)||0,o[14]=a,o[15]=c,e(f,o),f}function u(t){var e,i="";for(e=0;e<4;e+=1)i+=n[t>>8*e+4&15]+n[t>>8*e&15];return i}function a(t){var n;for(n=0;n<t.length;n+=1)t[n]=u(t[n]);return t.join("")}function c(t){return/[\u0080-\uFFFF]/.test(t)&&(t=unescape(encodeURIComponent(t))),t}function s(t){var n,e=[],i=t.length;for(n=0;n<i-1;n+=2)e.push(parseInt(t.substr(n,2),16));return String.fromCharCode.apply(String,e)}function f(){this.reset()}return a(o("hello")),"undefined"==typeof ArrayBuffer||ArrayBuffer.prototype.slice||function(){function n(t,n){return(t=0|t||0)<0?Math.max(t+n,0):Math.min(t,n)}ArrayBuffer.prototype.slice=function(e,i){var r,o,u,a,c=this.byteLength,s=n(e,c),f=c;return i!==t&&(f=n(i,c)),s>f?new ArrayBuffer(0):(r=f-s,o=new ArrayBuffer(r),u=new Uint8Array(o),a=new Uint8Array(this,s,r),u.set(a),o)}}(),f.prototype.append=function(t){return this.appendBinary(c(t)),this},f.prototype.appendBinary=function(t){this._buff+=t,this._length+=t.length;var n,r=this._buff.length;for(n=64;n<=r;n+=64)e(this._hash,i(this._buff.substring(n-64,n)));return this._buff=this._buff.substring(n-64),this},f.prototype.end=function(t){var n,e,i=this._buff,r=i.length,o=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(n=0;n<r;n+=1)o[n>>2]|=i.charCodeAt(n)<<(n%4<<3);return this._finish(o,r),e=a(this._hash),t&&(e=s(e)),this.reset(),e},f.prototype.reset=function(){return this._buff="",this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},f.prototype.getState=function(){return{buff:this._buff,length:this._length,hash:this._hash}},f.prototype.setState=function(t){return this._buff=t.buff,this._length=t.length,this._hash=t.hash,this},f.prototype.destroy=function(){delete this._hash,delete this._buff,delete this._length},f.prototype._finish=function(t,n){var i,r,o,u=n;if(t[u>>2]|=128<<(u%4<<3),u>55)for(e(this._hash,t),u=0;u<16;u+=1)t[u]=0;i=(i=8*this._length).toString(16).match(/(.*?)(.{0,8})$/),r=parseInt(i[2],16),o=parseInt(i[1],16)||0,t[14]=r,t[15]=o,e(this._hash,t)},f.hash=function(t,n){return f.hashBinary(c(t),n)},f.hashBinary=function(t,n){var e=a(o(t));return n?s(e):e},f.ArrayBuffer=function(){this.reset()},f.ArrayBuffer.prototype.append=function(t){var n,i,o,u,a,c=(i=this._buff.buffer,o=t,u=!0,(a=new Uint8Array(i.byteLength+o.byteLength)).set(new Uint8Array(i)),a.set(new Uint8Array(o),i.byteLength),u?a:a.buffer),s=c.length;for(this._length+=t.byteLength,n=64;n<=s;n+=64)e(this._hash,r(c.subarray(n-64,n)));return this._buff=n-64<s?new Uint8Array(c.buffer.slice(n-64)):new Uint8Array(0),this},f.ArrayBuffer.prototype.end=function(t){var n,e,i=this._buff,r=i.length,o=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(n=0;n<r;n+=1)o[n>>2]|=i[n]<<(n%4<<3);return this._finish(o,r),e=a(this._hash),t&&(e=s(e)),this.reset(),e},f.ArrayBuffer.prototype.reset=function(){return this._buff=new Uint8Array(0),this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},f.ArrayBuffer.prototype.getState=function(){var t,n=f.prototype.getState.call(this);return n.buff=(t=n.buff,String.fromCharCode.apply(null,new Uint8Array(t))),n},f.ArrayBuffer.prototype.setState=function(t){return t.buff=function(t,n){var e,i=t.length,r=new ArrayBuffer(i),o=new Uint8Array(r);for(e=0;e<i;e+=1)o[e]=t.charCodeAt(e);return n?o:r}(t.buff,!0),f.prototype.setState.call(this,t)},f.ArrayBuffer.prototype.destroy=f.prototype.destroy,f.ArrayBuffer.prototype._finish=f.prototype._finish,f.ArrayBuffer.hash=function(t,n){var i=a(function(t){var n,i,o,u,a,c,s=t.length,f=[1732584193,-271733879,-1732584194,271733878];for(n=64;n<=s;n+=64)e(f,r(t.subarray(n-64,n)));for(t=n-64<s?t.subarray(n-64):new Uint8Array(0),i=t.length,o=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],n=0;n<i;n+=1)o[n>>2]|=t[n]<<(n%4<<3);if(o[n>>2]|=128<<(n%4<<3),n>55)for(e(f,o),n=0;n<16;n+=1)o[n]=0;return u=(u=8*s).toString(16).match(/(.*?)(.{0,8})$/),a=parseInt(u[2],16),c=parseInt(u[1],16)||0,o[14]=a,o[15]=c,e(f,o),f}(new Uint8Array(t)));return n?s(i):i},f}()},function(t,n){function e(n,i){return t.exports=e=Object.setPrototypeOf||function(t,n){return t.__proto__=n,t},e(n,i)}t.exports=e},function(t,n,e){"use strict";e.d(n,"a",function(){return i});class i{constructor(t){this.message=t}}},function(t,n,e){"use strict";(function(t){var i=e(25),r=e.n(i),o=e(9),u=e.n(o),a=e(8),c=e.n(a),s=e(6),f=e(7),l=e.n(f),h=e(19),d=e.n(h),v=e(20),p=e.n(v),y=e(15),g=e.n(y),b=e(21),w=e.n(b),m="function"==typeof Promise?Promise:r.a;function _(t){if(t instanceof ArrayBuffer)return function(t){if("function"==typeof t.slice)return t.slice(0);var n=new ArrayBuffer(t.byteLength),e=new Uint8Array(n),i=new Uint8Array(t);return e.set(i),n}(t);var n=t.size,e=t.type;return"function"==typeof t.slice?t.slice(0,n,e):t.webkitSlice(0,n,e)}var k,A,x=Function.prototype.toString,E=x.call(Object);function L(t){var n,e,i;if(!t||"object"!=typeof t)return t;if(Array.isArray(t)){for(n=[],e=0,i=t.length;e<i;e++)n[e]=L(t[e]);return n}if(t instanceof Date)return t.toISOString();if(function(t){return"undefined"!=typeof ArrayBuffer&&t instanceof ArrayBuffer||"undefined"!=typeof Blob&&t instanceof Blob}(t))return _(t);if(!function(t){var n=Object.getPrototypeOf(t);if(null===n)return!0;var e=n.constructor;return"function"==typeof e&&e instanceof e&&x.call(e)==E}(t))return t;for(e in n={},t)if(Object.prototype.hasOwnProperty.call(t,e)){var r=L(t[e]);void 0!==r&&(n[e]=r)}return n}function O(t){var n=!1;return u()(function(e){if(n)throw new Error("once called more than once");n=!0,t.apply(this,e)})}function M(t){return u()(function(n){n=L(n);var e=this,i="function"==typeof n[n.length-1]&&n.pop(),r=new m(function(i,r){var o;try{var u=O(function(t,n){t?r(t):i(n)});n.push(u),(o=t.apply(e,n))&&"function"==typeof o.then&&i(o)}catch(t){r(t)}});return i&&r.then(function(t){i(null,t)},i),r})}function T(t,n){return M(u()(function(e){if(this._closed)return m.reject(new Error("database is closed"));if(this._destroyed)return m.reject(new Error("database is destroyed"));var i=this;return function(t,n,e){if(t.constructor.listeners("debug").length){for(var i=["api",t.name,n],r=0;r<e.length-1;r++)i.push(e[r]);t.constructor.emit("debug",i);var o=e[e.length-1];e[e.length-1]=function(e,i){var r=["api",t.name,n];r=r.concat(e?["error",e]:["success",i]),t.constructor.emit("debug",r),o(e,i)}}}(i,t,e),this.taskqueue.isReady?n.apply(this,e):new m(function(n,r){i.taskqueue.addTask(function(o){o?r(o):n(i[t].apply(i,e))})})}))}function q(t){return"$"+t}function P(t){return t.substring(1)}function S(){this._store={}}function F(t){if(this._store=new S,t&&Array.isArray(t))for(var n=0,e=t.length;n<e;n++)this.add(t[n])}function j(t,n){for(var e={},i=0,r=n.length;i<r;i++){var o=n[i];o in t&&(e[o]=t[o])}return e}S.prototype.get=function(t){var n=q(t);return this._store[n]},S.prototype.set=function(t,n){var e=q(t);return this._store[e]=n,!0},S.prototype.has=function(t){return q(t)in this._store},S.prototype.delete=function(t){var n=q(t),e=n in this._store;return delete this._store[n],e},S.prototype.forEach=function(t){for(var n=Object.keys(this._store),e=0,i=n.length;e<i;e++){var r=n[e];t(this._store[r],r=P(r))}},Object.defineProperty(S.prototype,"size",{get:function(){return Object.keys(this._store).length}}),F.prototype.add=function(t){return this._store.set(t,!0)},F.prototype.has=function(t){return this._store.has(t)},F.prototype.forEach=function(t){this._store.forEach(function(n,e){t(e)})},Object.defineProperty(F.prototype,"size",{get:function(){return this._store.size}}),!function(){if("undefined"==typeof Symbol||"undefined"==typeof Map||"undefined"==typeof Set)return!1;var t=Object.getOwnPropertyDescriptor(Map,Symbol.species);return t&&"get"in t&&Map[Symbol.species]===Map}()?(k=F,A=S):(k=Set,A=Map);var U,D=6;function R(t){return t}function B(t){return[{ok:t}]}function C(t,n,e){var i=n.docs,r=new A;i.forEach(function(t){r.has(t.id)?r.get(t.id).push(t):r.set(t.id,[t])});var o=r.size,u=0,a=new Array(o);function c(){var t;++u===o&&(t=[],a.forEach(function(n){n.docs.forEach(function(e){t.push({id:n.id,docs:[e]})})}),e(null,{results:t}))}var s=[];r.forEach(function(t,n){s.push(n)});var f=0;function l(){if(!(f>=s.length)){var e=Math.min(f+D,s.length),i=s.slice(f,e);!function(e,i){e.forEach(function(e,o){var u=i+o,s=r.get(e),f=j(s[0],["atts_since","attachments"]);f.open_revs=s.map(function(t){return t.rev}),f.open_revs=f.open_revs.filter(R);var h=R;0===f.open_revs.length&&(delete f.open_revs,h=B),["revs","attachments","binary","ajax","latest"].forEach(function(t){t in n&&(f[t]=n[t])}),t.get(e,f,function(t,n){var i,r,o;i=t?[{error:t}]:h(n),r=e,o=i,a[u]={id:r,docs:o},c(),l()})})}(i,f),f+=i.length}}l()}function W(){return"undefined"!=typeof chrome&&void 0!==chrome.storage&&void 0!==chrome.storage.local}if(W())U=!1;else try{localStorage.setItem("_pouch_check_localstorage",1),U=!!localStorage.getItem("_pouch_check_localstorage")}catch(t){U=!1}function N(){return U}function $(){var t;s.EventEmitter.call(this),this._listeners={},t=this,W()?chrome.storage.onChanged.addListener(function(n){null!=n.db_name&&t.emit(n.dbName.newValue)}):N()&&("undefined"!=typeof addEventListener?addEventListener("storage",function(n){t.emit(n.key)}):window.attachEvent("storage",function(n){t.emit(n.key)}))}function J(t){if("undefined"!=typeof console&&"function"==typeof console[t]){var n=Array.prototype.slice.call(arguments,1);console[t].apply(console,n)}}function H(t){var n=0;return t||(n=2e3),function(t,n){return t=parseInt(t,10)||0,(n=parseInt(n,10))!=n||n<=t?n=(t||1)<<1:n+=1,n>6e5&&(t=3e5,n=6e5),~~((n-t)*Math.random()+t)}(t,n)}function X(t,n){J("info","The above "+t+" is totally normal. "+n)}l()($,s.EventEmitter),$.prototype.addListener=function(t,n,e,i){if(!this._listeners[n]){var r=this,o=!1;this._listeners[n]=u,this.on(t,u)}function u(){if(r._listeners[n])if(o)o="waiting";else{o=!0;var t=j(i,["style","include_docs","attachments","conflicts","filter","doc_ids","view","since","query_params","binary"]);e.changes(t).on("change",function(t){t.seq>i.since&&!i.cancelled&&(i.since=t.seq,i.onChange(t))}).on("complete",function(){"waiting"===o&&c()(u),o=!1}).on("error",function(){o=!1})}}},$.prototype.removeListener=function(t,n){n in this._listeners&&(s.EventEmitter.prototype.removeListener.call(this,t,this._listeners[n]),delete this._listeners[n])},$.prototype.notifyLocalWindows=function(t){W()?chrome.storage.local.set({dbName:t}):N()&&(localStorage[t]="a"===localStorage[t]?"b":"a")},$.prototype.notify=function(t){this.emit(t),this.notifyLocalWindows(t)};var K="function"==typeof Object.assign?Object.assign:function(t){for(var n=Object(t),e=1;e<arguments.length;e++){var i=arguments[e];if(null!=i)for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(n[r]=i[r])}return n};function G(t,n,e){Error.call(this,e),this.status=t,this.name=n,this.message=e,this.error=!0}l()(G,Error),G.prototype.toString=function(){return JSON.stringify({status:this.status,name:this.name,message:this.message,reason:this.reason})};new G(401,"unauthorized","Name or password is incorrect.");var Z=new G(400,"bad_request","Missing JSON list of 'docs'"),V=new G(404,"not_found","missing"),Y=new G(409,"conflict","Document update conflict"),z=new G(400,"bad_request","_id field must contain a string"),I=new G(412,"missing_id","_id is required for puts"),Q=new G(400,"bad_request","Only reserved document ids may start with underscore."),tt=(new G(412,"precondition_failed","Database not open"),new G(500,"unknown_error","Database encountered an unknown error")),nt=new G(500,"badarg","Some query argument is invalid"),et=(new G(400,"invalid_request","Request was invalid"),new G(400,"query_parse_error","Some query parameter is invalid")),it=new G(500,"doc_validation","Bad special document member"),rt=new G(400,"bad_request","Something wrong with the request"),ot=new G(400,"bad_request","Document must be a JSON object"),ut=(new G(404,"not_found","Database not found"),new G(500,"indexed_db_went_bad","unknown")),at=new G(500,"web_sql_went_bad","unknown"),ct=(new G(500,"levelDB_went_went_bad","unknown"),new G(403,"forbidden","Forbidden by design doc validate_doc_update function"),new G(400,"bad_request","Invalid rev format")),st=(new G(412,"file_exists","The database could not be created, the file already exists."),new G(412,"missing_stub","A pre-existing attachment stub wasn't found"));new G(413,"invalid_url","Provided URL is invalid");function ft(t,n){function e(n){for(var e in t)"function"!=typeof t[e]&&(this[e]=t[e]);void 0!==n&&(this.reason=n)}return e.prototype=G.prototype,new e(n)}function lt(t){if("object"!=typeof t){var n=t;(t=tt).data=n}return"error"in t&&"conflict"===t.error&&(t.name="conflict",t.status=409),"name"in t||(t.name=t.error||"unknown"),"status"in t||(t.status=500),"message"in t||(t.message=t.message||t.reason),t}function ht(t){var n={},e=t.filter&&"function"==typeof t.filter;return n.query=t.query_params,function(i){i.doc||(i.doc={});var r=e&&function(t,n,e){try{return!t(n,e)}catch(t){var i="Filter function threw: "+t.toString();return ft(rt,i)}}(t.filter,i.doc,n);if("object"==typeof r)return r;if(r)return!1;if(t.include_docs){if(!t.attachments)for(var o in i.doc._attachments)i.doc._attachments.hasOwnProperty(o)&&(i.doc._attachments[o].stub=!0)}else delete i.doc;return!0}}function dt(t){for(var n=[],e=0,i=t.length;e<i;e++)n=n.concat(t[e]);return n}function vt(t){var n;if(t?"string"!=typeof t?n=ft(z):/^_/.test(t)&&!/^_(design|local)/.test(t)&&(n=ft(Q)):n=ft(I),n)throw n}function pt(t){return"boolean"==typeof t._remote?t._remote:"function"==typeof t.type&&(J("warn","db.type() is deprecated and will be removed in a future version of PouchDB"),"http"===t.type())}function yt(t){if(!t)return null;var n=t.split("/");return 2===n.length?n:1===n.length?[t,t]:null}function gt(t){var n=yt(t);return n?n.join("/"):null}var bt=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],wt="queryKey",mt=/(?:^|&)([^&=]*)=?([^&]*)/g,_t=/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/;function kt(t){for(var n=_t.exec(t),e={},i=14;i--;){var r=bt[i],o=n[i]||"",u=-1!==["user","password"].indexOf(r);e[r]=u?decodeURIComponent(o):o}return e[wt]={},e[bt[12]].replace(mt,function(t,n,i){n&&(e[wt][n]=i)}),e}function At(t,n){var e=[],i=[];for(var r in n)n.hasOwnProperty(r)&&(e.push(r),i.push(n[r]));return e.push(t),Function.apply(null,e).apply(null,i)}function xt(t,n,e){return new m(function(i,r){t.get(n,function(o,u){if(o){if(404!==o.status)return r(o);u={}}var a=u._rev,c=e(u);if(!c)return i({updated:!1,rev:a});c._id=n,c._rev=a,i(function(t,n,e){return t.put(n).then(function(t){return{updated:!0,rev:t.rev}},function(i){if(409!==i.status)throw i;return xt(t,n._id,e)})}(t,c,e))})})}function Et(){return d.a.v4().replace(/-/g,"").toLowerCase()}var Lt=d.a.v4;function Ot(t){for(var n,e,i,r,o=t.rev_tree.slice();r=o.pop();){var u=r.ids,a=u[2],c=r.pos;if(a.length)for(var s=0,f=a.length;s<f;s++)o.push({pos:c+1,ids:a[s]});else{var l=!!u[1].deleted,h=u[0];n&&!(i!==l?i:e!==c?e<c:n<h)||(n=h,e=c,i=l)}}return e+"-"+n}function Mt(t,n){for(var e,i=t.slice();e=i.pop();)for(var r=e.pos,o=e.ids,u=o[2],a=n(0===u.length,r,o[0],e.ctx,o[1]),c=0,s=u.length;c<s;c++)i.push({pos:r+1,ids:u[c],ctx:a})}function Tt(t,n){return t.pos-n.pos}function qt(t){var n=[];Mt(t,function(t,e,i,r,o){t&&n.push({rev:e+"-"+i,pos:e,opts:o})}),n.sort(Tt).reverse();for(var e=0,i=n.length;e<i;e++)delete n[e].pos;return n}function Pt(t){for(var n=Ot(t),e=qt(t.rev_tree),i=[],r=0,o=e.length;r<o;r++){var u=e[r];u.rev===n||u.opts.deleted||i.push(u.rev)}return i}function St(t){var n=[];return Mt(t.rev_tree,function(t,e,i,r,o){"available"!==o.status||t||(n.push(e+"-"+i),o.status="missing")}),n}function Ft(t){for(var n,e=[],i=t.slice();n=i.pop();){var r=n.pos,o=n.ids,u=o[0],a=o[1],c=o[2],s=0===c.length,f=n.history?n.history.slice():[];f.push({id:u,opts:a}),s&&e.push({pos:r+1-f.length,ids:f});for(var l=0,h=c.length;l<h;l++)i.push({pos:r+1,ids:c[l],history:f})}return e.reverse()}function jt(t,n){return t.pos-n.pos}function Ut(t,n,e){var i=function(t,n,e){for(var i,r=0,o=t.length;r<o;)e(t[i=r+o>>>1],n)<0?r=i+1:o=i;return r}(t,n,e);t.splice(i,0,n)}function Dt(t,n){for(var e,i,r=n,o=t.length;r<o;r++){var u=t[r],a=[u.id,u.opts,[]];i?(i[2].push(a),i=a):e=i=a}return e}function Rt(t,n){return t[0]<n[0]?-1:1}function Bt(t,n){for(var e=[{tree1:t,tree2:n}],i=!1;e.length>0;){var r=e.pop(),o=r.tree1,u=r.tree2;(o[1].status||u[1].status)&&(o[1].status="available"===o[1].status||"available"===u[1].status?"available":"missing");for(var a=0;a<u[2].length;a++)if(o[2][0]){for(var c=!1,s=0;s<o[2].length;s++)o[2][s][0]===u[2][a][0]&&(e.push({tree1:o[2][s],tree2:u[2][a]}),c=!0);c||(i="new_branch",Ut(o[2],u[2][a],Rt))}else i="new_leaf",o[2][0]=u[2][a]}return{conflicts:i,tree:t}}function Ct(t,n,e){var i,r=[],o=!1,u=!1;if(!t.length)return{tree:[n],conflicts:"new_leaf"};for(var a=0,c=t.length;a<c;a++){var s=t[a];if(s.pos===n.pos&&s.ids[0]===n.ids[0])i=Bt(s.ids,n.ids),r.push({pos:s.pos,ids:i.tree}),o=o||i.conflicts,u=!0;else if(!0!==e){var f=s.pos<n.pos?s:n,l=s.pos<n.pos?n:s,h=l.pos-f.pos,d=[],v=[];for(v.push({ids:f.ids,diff:h,parent:null,parentIdx:null});v.length>0;){var p=v.pop();if(0!==p.diff)for(var y=p.ids[2],g=0,b=y.length;g<b;g++)v.push({ids:y[g],diff:p.diff-1,parent:p.ids,parentIdx:g});else p.ids[0]===l.ids[0]&&d.push(p)}var w=d[0];w?(i=Bt(w.ids,l.ids),w.parent[2][w.parentIdx]=i.tree,r.push({pos:f.pos,ids:f.ids}),o=o||i.conflicts,u=!0):r.push(s)}else r.push(s)}return u||r.push(n),r.sort(jt),{tree:r,conflicts:o||"internal_node"}}function Wt(t,n,e){var i=Ct(t,n),r=function(t,n){for(var e,i,r=Ft(t),o=0,u=r.length;o<u;o++){var a,c=r[o],s=c.ids;if(s.length>n){e||(e={});var f=s.length-n;a={pos:c.pos+f,ids:Dt(s,f)};for(var l=0;l<f;l++){var h=c.pos+l+"-"+s[l].id;e[h]=!0}}else a={pos:c.pos,ids:Dt(s,0)};i=i?Ct(i,a,!0).tree:[a]}return e&&Mt(i,function(t,n,i){delete e[n+"-"+i]}),{tree:i,revs:e?Object.keys(e):[]}}(i.tree,e);return{tree:r.tree,stemmedRevs:r.revs,conflicts:i.conflicts}}function Nt(t){return t.ids}function $t(t,n){n||(n=Ot(t));for(var e,i=n.substring(n.indexOf("-")+1),r=t.rev_tree.map(Nt);e=r.pop();){if(e[0]===i)return!!e[1].deleted;r=r.concat(e[2])}}function Jt(t){return/^_local/.test(t)}function Ht(t,n){for(var e,i=n.rev_tree.slice();e=i.pop();){var r=e.pos,o=e.ids,u=o[0],a=o[1],c=o[2],s=0===c.length,f=e.history?e.history.slice():[];if(f.push({id:u,pos:r,opts:a}),s)for(var l=0,h=f.length;l<h;l++){var d=f[l];if(d.pos+"-"+d.id===t)return r+"-"+u}for(var v=0,p=c.length;v<p;v++)i.push({pos:r+1,ids:c[v],history:f})}throw new Error("Unable to resolve latest revision for id "+n.id+", rev "+t)}function Xt(t,n,e){s.EventEmitter.call(this);var i=this;this.db=t;var r=(n=n?L(n):{}).complete=O(function(n,e){var r,u;n?(u="error",("listenerCount"in(r=i)?r.listenerCount(u):s.EventEmitter.listenerCount(r,u))>0&&i.emit("error",n)):i.emit("complete",e),i.removeAllListeners(),t.removeListener("destroyed",o)});function o(){i.cancel()}e&&(i.on("complete",function(t){e(null,t)}),i.on("error",e)),t.once("destroyed",o),n.onChange=function(t,n,e){i.isCancelled||function(t,n,e,i){try{t.emit("change",n,e,i)}catch(t){J("error",'Error in .on("change", function):',t)}}(i,t,n,e)};var u=new m(function(t,e){n.complete=function(n,i){n?e(n):t(i)}});i.once("cancel",function(){t.removeListener("destroyed",o),n.complete(null,{status:"cancelled"})}),this.then=u.then.bind(u),this.catch=u.catch.bind(u),this.then(function(t){r(null,t)},r),t.taskqueue.isReady?i.validateChanges(n):t.taskqueue.addTask(function(t){t?n.complete(t):i.isCancelled?i.emit("cancel"):i.validateChanges(n)})}function Kt(t,n,e){var i=[{rev:t._rev}];"all_docs"===e.style&&(i=qt(n.rev_tree).map(function(t){return{rev:t.rev}}));var r={id:n.id,changes:i,doc:t};return $t(n,t._rev)&&(r.deleted=!0),e.conflicts&&(r.doc._conflicts=Pt(n),r.doc._conflicts.length||delete r.doc._conflicts),r}function Gt(t,n){return t<n?-1:t>n?1:0}function Zt(t,n){return function(e,i){e||i[0]&&i[0].error?((e=e||i[0]).docId=n,t(e)):t(null,i.length?i[0]:i)}}function Vt(t,n){var e=Gt(t._id,n._id);return 0!==e?e:Gt(t._revisions?t._revisions.start:0,n._revisions?n._revisions.start:0)}function Yt(){s.EventEmitter.call(this)}function zt(){this.isReady=!1,this.failed=!1,this.queue=[]}function It(t,n){if(!(this instanceof It))return new It(t,n);var e=this;if(n=n||{},t&&"object"==typeof t&&(t=(n=t).name,delete n.name),this.__opts=n=L(n),e.auto_compaction=n.auto_compaction,e.prefix=It.prefix,"string"!=typeof t)throw new Error("Missing/invalid DB name");var i=function(t,n){var e=t.match(/([a-z-]*):\/\/(.*)/);if(e)return{name:/https?/.test(e[1])?e[1]+"://"+e[2]:e[2],adapter:e[1]};var i=It.adapters,r=It.preferredAdapters,o=It.prefix,u=n.adapter;if(!u)for(var a=0;a<r.length&&"idb"===(u=r[a])&&"websql"in i&&N()&&localStorage["_pouch__websqldb_"+o+t];++a)J("log",'PouchDB is downgrading "'+t+'" to WebSQL to avoid data loss, because it was already opened with WebSQL.');var c=i[u];return{name:c&&"use_prefix"in c&&!c.use_prefix?t:o+t,adapter:u}}((n.prefix||"")+t,n);if(n.name=i.name,n.adapter=n.adapter||i.adapter,e.name=t,e._adapter=n.adapter,It.emit("debug",["adapter","Picked adapter: ",n.adapter]),!It.adapters[n.adapter]||!It.adapters[n.adapter].valid())throw new Error("Invalid Adapter: "+n.adapter);Yt.call(e),e.taskqueue=new zt,e.adapter=n.adapter,It.adapters[n.adapter].call(e,n,function(t){if(t)return e.taskqueue.fail(t);!function(t){function n(n){t.removeListener("closed",e),n||t.constructor.emit("destroyed",t.name)}function e(){t.removeListener("destroyed",n),t.constructor.emit("unref",t)}t.once("destroyed",n),t.once("closed",e),t.constructor.emit("ref",t)}(e),e.emit("created",e),It.emit("created",e.name),e.taskqueue.ready(e)})}l()(Xt,s.EventEmitter),Xt.prototype.cancel=function(){this.isCancelled=!0,this.db.taskqueue.isReady&&this.emit("cancel")},Xt.prototype.validateChanges=function(t){var n=t.complete,e=this;It._changesFilterPlugin?It._changesFilterPlugin.validate(t,function(i){if(i)return n(i);e.doChanges(t)}):e.doChanges(t)},Xt.prototype.doChanges=function(t){var n=this,e=t.complete;if("live"in(t=L(t))&&!("continuous"in t)&&(t.continuous=t.live),t.processChange=Kt,"latest"===t.since&&(t.since="now"),t.since||(t.since=0),"now"!==t.since){if(It._changesFilterPlugin){if(It._changesFilterPlugin.normalize(t),It._changesFilterPlugin.shouldFilter(this,t))return It._changesFilterPlugin.filter(this,t)}else["doc_ids","filter","selector","view"].forEach(function(n){n in t&&J("warn",'The "'+n+'" option was passed in to changes/replicate, but pouchdb-changes-filter plugin is not installed, so it was ignored. Please install the plugin to enable filtering.')});"descending"in t||(t.descending=!1),t.limit=0===t.limit?1:t.limit,t.complete=e;var i=this.db._changes(t);if(i&&"function"==typeof i.cancel){var r=n.cancel;n.cancel=u()(function(t){i.cancel(),r.apply(this,t)})}}else this.db.info().then(function(i){n.isCancelled?e(null,{status:"cancelled"}):(t.since=i.update_seq,n.doChanges(t))},e)},l()(Yt,s.EventEmitter),Yt.prototype.post=T("post",function(t,n,e){if("function"==typeof n&&(e=n,n={}),"object"!=typeof t||Array.isArray(t))return e(ft(ot));this.bulkDocs({docs:[t]},n,Zt(e,t._id))}),Yt.prototype.put=T("put",function(t,n,e){if("function"==typeof n&&(e=n,n={}),"object"!=typeof t||Array.isArray(t))return e(ft(ot));if(vt(t._id),Jt(t._id)&&"function"==typeof this._putLocal)return t._deleted?this._removeLocal(t,e):this._putLocal(t,e);var i,r,o,u,a=this;function c(e){"function"==typeof a._put&&!1!==n.new_edits?a._put(t,n,e):a.bulkDocs({docs:[t]},n,Zt(e,t._id))}n.force&&t._rev?(i=t._rev.split("-"),r=i[1],o=parseInt(i[0],10)+1,u=Et(),t._revisions={start:o,ids:[u,r]},t._rev=o+"-"+u,n.new_edits=!1,c(function(n){var i=n?null:{ok:!0,id:t._id,rev:t._rev};e(n,i)})):c(e)}),Yt.prototype.putAttachment=T("putAttachment",function(t,n,e,i,r){var o=this;function u(t){var e="_rev"in t?parseInt(t._rev,10):0;return t._attachments=t._attachments||{},t._attachments[n]={content_type:r,data:i,revpos:++e},o.put(t)}return"function"==typeof r&&(r=i,i=e,e=null),void 0===r&&(r=i,i=e,e=null),r||J("warn","Attachment",n,"on document",t,"is missing content_type"),o.get(t).then(function(t){if(t._rev!==e)throw ft(Y);return u(t)},function(n){if(n.reason===V.message)return u({_id:t});throw n})}),Yt.prototype.removeAttachment=T("removeAttachment",function(t,n,e,i){var r=this;r.get(t,function(t,o){if(t)i(t);else if(o._rev===e){if(!o._attachments)return i();delete o._attachments[n],0===Object.keys(o._attachments).length&&delete o._attachments,r.put(o,i)}else i(ft(Y))})}),Yt.prototype.remove=T("remove",function(t,n,e,i){var r;"string"==typeof n?(r={_id:t,_rev:n},"function"==typeof e&&(i=e,e={})):(r=t,"function"==typeof n?(i=n,e={}):(i=e,e=n)),(e=e||{}).was_delete=!0;var o={_id:r._id,_rev:r._rev||e.rev,_deleted:!0};if(Jt(o._id)&&"function"==typeof this._removeLocal)return this._removeLocal(r,i);this.bulkDocs({docs:[o]},e,Zt(i,o._id))}),Yt.prototype.revsDiff=T("revsDiff",function(t,n,e){"function"==typeof n&&(e=n,n={});var i=Object.keys(t);if(!i.length)return e(null,{});var r=0,o=new A;function u(t,n){o.has(t)||o.set(t,{missing:[]}),o.get(t).missing.push(n)}i.map(function(n){this._getRevisionTree(n,function(a,c){if(a&&404===a.status&&"missing"===a.message)o.set(n,{missing:t[n]});else{if(a)return e(a);!function(n,e){var i=t[n].slice(0);Mt(e,function(t,e,r,o,a){var c=e+"-"+r,s=i.indexOf(c);-1!==s&&(i.splice(s,1),"available"!==a.status&&u(n,c))}),i.forEach(function(t){u(n,t)})}(n,c)}if(++r===i.length){var s={};return o.forEach(function(t,n){s[n]=t}),e(null,s)}})},this)}),Yt.prototype.bulkGet=T("bulkGet",function(t,n){C(this,t,n)}),Yt.prototype.compactDocument=T("compactDocument",function(t,n,e){var i=this;this._getRevisionTree(t,function(r,o){if(r)return e(r);var u=function(t){var n={},e=[];return Mt(t,function(t,i,r,o){var u=i+"-"+r;return t&&(n[u]=0),void 0!==o&&e.push({from:o,to:u}),u}),e.reverse(),e.forEach(function(t){void 0===n[t.from]?n[t.from]=1+n[t.to]:n[t.from]=Math.min(n[t.from],1+n[t.to])}),n}(o),a=[],c=[];Object.keys(u).forEach(function(t){u[t]>n&&a.push(t)}),Mt(o,function(t,n,e,i,r){var o=n+"-"+e;"available"===r.status&&-1!==a.indexOf(o)&&c.push(o)}),i._doCompaction(t,c,e)})}),Yt.prototype.compact=T("compact",function(t,n){"function"==typeof t&&(n=t,t={});t=t||{},this._compactionQueue=this._compactionQueue||[],this._compactionQueue.push({opts:t,callback:n}),1===this._compactionQueue.length&&function t(n){var e=n._compactionQueue[0],i=e.opts,r=e.callback;n.get("_local/compaction").catch(function(){return!1}).then(function(e){e&&e.last_seq&&(i.last_seq=e.last_seq),n._compact(i,function(e,i){e?r(e):r(null,i),c()(function(){n._compactionQueue.shift(),n._compactionQueue.length&&t(n)})})})}(this)}),Yt.prototype._compact=function(t,n){var e=this,i={return_docs:!1,last_seq:t.last_seq||0},r=[];e.changes(i).on("change",function(t){r.push(e.compactDocument(t.id,0))}).on("complete",function(t){var i=t.last_seq;m.all(r).then(function(){return xt(e,"_local/compaction",function(t){return(!t.last_seq||t.last_seq<i)&&(t.last_seq=i,t)})}).then(function(){n(null,{ok:!0})}).catch(n)}).on("error",n)},Yt.prototype.get=T("get",function(t,n,e){if("function"==typeof n&&(e=n,n={}),"string"!=typeof t)return e(ft(z));if(Jt(t)&&"function"==typeof this._getLocal)return this._getLocal(t,e);var i=[],r=this;function o(){var o=[],u=i.length;if(!u)return e(null,o);i.forEach(function(i){r.get(t,{rev:i,revs:n.revs,latest:n.latest,attachments:n.attachments,binary:n.binary},function(t,n){if(t)o.push({missing:i});else{for(var r,a=0,c=o.length;a<c;a++)if(o[a].ok&&o[a].ok._rev===n._rev){r=!0;break}r||o.push({ok:n})}--u||e(null,o)})})}if(!n.open_revs)return this._get(t,n,function(i,o){if(i)return i.docId=t,e(i);var u=o.doc,a=o.metadata,c=o.ctx;if(n.conflicts){var s=Pt(a);s.length&&(u._conflicts=s)}if($t(a,u._rev)&&(u._deleted=!0),n.revs||n.revs_info){for(var f=u._rev.split("-"),l=parseInt(f[0],10),h=f[1],d=Ft(a.rev_tree),v=null,p=0;p<d.length;p++){var y=d[p],g=y.ids.map(function(t){return t.id}).indexOf(h);(g===l-1||!v&&-1!==g)&&(v=y)}var b=v.ids.map(function(t){return t.id}).indexOf(u._rev.split("-")[1])+1,w=v.ids.length-b;if(v.ids.splice(b,w),v.ids.reverse(),n.revs&&(u._revisions={start:v.pos+v.ids.length-1,ids:v.ids.map(function(t){return t.id})}),n.revs_info){var m=v.pos+v.ids.length;u._revs_info=v.ids.map(function(t){return{rev:--m+"-"+t.id,status:t.opts.status}})}}if(n.attachments&&u._attachments){var _=u._attachments,k=Object.keys(_).length;if(0===k)return e(null,u);Object.keys(_).forEach(function(t){this._getAttachment(u._id,t,_[t],{rev:u._rev,binary:n.binary,ctx:c},function(n,i){var r=u._attachments[t];r.data=i,delete r.stub,delete r.length,--k||e(null,u)})},r)}else{if(u._attachments)for(var A in u._attachments)u._attachments.hasOwnProperty(A)&&(u._attachments[A].stub=!0);e(null,u)}});if("all"===n.open_revs)this._getRevisionTree(t,function(t,n){if(t)return e(t);i=qt(n).map(function(t){return t.rev}),o()});else{if(!Array.isArray(n.open_revs))return e(ft(tt,"function_clause"));i=n.open_revs;for(var u=0;u<i.length;u++){var a=i[u];if("string"!=typeof a||!/^\d+-/.test(a))return e(ft(ct))}o()}}),Yt.prototype.getAttachment=T("getAttachment",function(t,n,e,i){var r=this;e instanceof Function&&(i=e,e={}),this._get(t,e,function(o,u){return o?i(o):u.doc._attachments&&u.doc._attachments[n]?(e.ctx=u.ctx,e.binary=!0,void r._getAttachment(t,n,u.doc._attachments[n],e,i)):i(ft(V))})}),Yt.prototype.allDocs=T("allDocs",function(t,n){if("function"==typeof t&&(n=t,t={}),t.skip=void 0!==t.skip?t.skip:0,t.start_key&&(t.startkey=t.start_key),t.end_key&&(t.endkey=t.end_key),"keys"in t){if(!Array.isArray(t.keys))return n(new TypeError("options.keys must be an array"));var e=["startkey","endkey","key"].filter(function(n){return n in t})[0];if(e)return void n(ft(et,"Query parameter `"+e+"` is not compatible with multi-get"));if(!pt(this)&&(function(t){var n="limit"in t?t.keys.slice(t.skip,t.limit+t.skip):t.skip>0?t.keys.slice(t.skip):t.keys;t.keys=n,t.skip=0,delete t.limit,t.descending&&(n.reverse(),t.descending=!1)}(t),0===t.keys.length))return this._allDocs({limit:0},n)}return this._allDocs(t,n)}),Yt.prototype.changes=function(t,n){return"function"==typeof t&&(n=t,t={}),new Xt(this,t,n)},Yt.prototype.close=T("close",function(t){return this._closed=!0,this.emit("closed"),this._close(t)}),Yt.prototype.info=T("info",function(t){var n=this;this._info(function(e,i){if(e)return t(e);i.db_name=i.db_name||n.name,i.auto_compaction=!(!n.auto_compaction||pt(n)),i.adapter=n.adapter,t(null,i)})}),Yt.prototype.id=T("id",function(t){return this._id(t)}),Yt.prototype.type=function(){return"function"==typeof this._type?this._type():this.adapter},Yt.prototype.bulkDocs=T("bulkDocs",function(t,n,e){if("function"==typeof n&&(e=n,n={}),n=n||{},Array.isArray(t)&&(t={docs:t}),!t||!t.docs||!Array.isArray(t.docs))return e(ft(Z));for(var i=0;i<t.docs.length;++i)if("object"!=typeof t.docs[i]||Array.isArray(t.docs[i]))return e(ft(ot));var r;if(t.docs.forEach(function(t){t._attachments&&Object.keys(t._attachments).forEach(function(n){r=r||function(t){return"_"===t.charAt(0)&&t+" is not a valid attachment name, attachment names cannot start with '_'"}(n),t._attachments[n].content_type||J("warn","Attachment",n,"on document",t._id,"is missing content_type")})}),r)return e(ft(rt,r));"new_edits"in n||(n.new_edits=!("new_edits"in t)||t.new_edits);var o=this;n.new_edits||pt(o)||t.docs.sort(Vt),function(t){for(var n=0;n<t.length;n++){var e=t[n];if(e._deleted)delete e._attachments;else if(e._attachments)for(var i=Object.keys(e._attachments),r=0;r<i.length;r++){var o=i[r];e._attachments[o]=j(e._attachments[o],["data","digest","content_type","length","revpos","stub"])}}}(t.docs);var u=t.docs.map(function(t){return t._id});return this._bulkDocs(t,n,function(t,i){if(t)return e(t);if(n.new_edits||(i=i.filter(function(t){return t.error})),!pt(o))for(var r=0,a=i.length;r<a;r++)i[r].id=i[r].id||u[r];e(null,i)})}),Yt.prototype.registerDependentDatabase=T("registerDependentDatabase",function(t,n){var e=new this.constructor(t,this.__opts);xt(this,"_local/_pouch_dependentDbs",function(n){return n.dependentDbs=n.dependentDbs||{},!n.dependentDbs[t]&&(n.dependentDbs[t]=!0,n)}).then(function(){n(null,{db:e})}).catch(n)}),Yt.prototype.destroy=T("destroy",function(t,n){"function"==typeof t&&(n=t,t={});var e=this,i=!("use_prefix"in e)||e.use_prefix;function r(){e._destroy(t,function(t,i){if(t)return n(t);e._destroyed=!0,e.emit("destroyed"),n(null,i||{ok:!0})})}if(pt(e))return r();e.get("_local/_pouch_dependentDbs",function(t,o){if(t)return 404!==t.status?n(t):r();var u=o.dependentDbs,a=e.constructor,c=Object.keys(u).map(function(t){var n=i?t.replace(new RegExp("^"+a.prefix),""):t;return new a(n,e.__opts).destroy()});m.all(c).then(r,n)})}),zt.prototype.execute=function(){var t;if(this.failed)for(;t=this.queue.shift();)t(this.failed);else for(;t=this.queue.shift();)t()},zt.prototype.fail=function(t){this.failed=t,this.execute()},zt.prototype.ready=function(t){this.isReady=!0,this.db=t,this.execute()},zt.prototype.addTask=function(t){this.queue.push(t),this.failed&&this.execute()},l()(It,Yt),It.adapters={},It.preferredAdapters=[],It.prefix="_pouch_";var Qt=new s.EventEmitter;!function(t){Object.keys(s.EventEmitter.prototype).forEach(function(n){"function"==typeof s.EventEmitter.prototype[n]&&(t[n]=Qt[n].bind(Qt))});var n=t._destructionListeners=new A;t.on("ref",function(t){n.has(t.name)||n.set(t.name,[]),n.get(t.name).push(t)}),t.on("unref",function(t){if(n.has(t.name)){var e=n.get(t.name),i=e.indexOf(t);i<0||(e.splice(i,1),e.length>1?n.set(t.name,e):n.delete(t.name))}}),t.on("destroyed",function(t){if(n.has(t)){var e=n.get(t);n.delete(t),e.forEach(function(t){t.emit("destroyed",!0)})}})}(It),It.adapter=function(t,n,e){n.valid()&&(It.adapters[t]=n,e&&It.preferredAdapters.push(t))},It.plugin=function(t){if("function"==typeof t)t(It);else{if("object"!=typeof t||0===Object.keys(t).length)throw new Error('Invalid plugin: got "'+t+'", expected an object or a function');Object.keys(t).forEach(function(n){It.prototype[n]=t[n]})}return this.__defaults&&(It.__defaults=K({},this.__defaults)),It},It.defaults=function(t){function n(t,e){if(!(this instanceof n))return new n(t,e);e=e||{},t&&"object"==typeof t&&(t=(e=t).name,delete e.name),e=K({},n.__defaults,e),It.call(this,t,e)}return l()(n,It),n.preferredAdapters=It.preferredAdapters.slice(),Object.keys(It).forEach(function(t){t in n||(n[t]=It[t])}),n.__defaults=K({},this.__defaults,t),n};function tn(t,n){for(var e=t,i=0,r=n.length;i<r;i++){if(!(e=e[n[i]]))break}return e}function nn(t){for(var n=[],e="",i=0,r=t.length;i<r;i++){var o=t[i];"."===o?i>0&&"\\"===t[i-1]?e=e.substring(0,e.length-1)+".":(n.push(e),e=""):e+=o}return n.push(e),n}var en=["$or","$nor","$not"];function rn(t){return en.indexOf(t)>-1}function on(t){return Object.keys(t)[0]}function un(t){var n={};return t.forEach(function(t){Object.keys(t).forEach(function(e){var i=t[e];if("object"!=typeof i&&(i={$eq:i}),rn(e))i instanceof Array?n[e]=i.map(function(t){return un([t])}):n[e]=un([i]);else{var r=n[e]=n[e]||{};Object.keys(i).forEach(function(t){var n=i[t];return"$gt"===t||"$gte"===t?function(t,n,e){if(void 0!==e.$eq)return;void 0!==e.$gte?"$gte"===t?n>e.$gte&&(e.$gte=n):n>=e.$gte&&(delete e.$gte,e.$gt=n):void 0!==e.$gt?"$gte"===t?n>e.$gt&&(delete e.$gt,e.$gte=n):n>e.$gt&&(e.$gt=n):e[t]=n}(t,n,r):"$lt"===t||"$lte"===t?function(t,n,e){if(void 0!==e.$eq)return;void 0!==e.$lte?"$lte"===t?n<e.$lte&&(e.$lte=n):n<=e.$lte&&(delete e.$lte,e.$lt=n):void 0!==e.$lt?"$lte"===t?n<e.$lt&&(delete e.$lt,e.$lte=n):n<e.$lt&&(e.$lt=n):e[t]=n}(t,n,r):"$ne"===t?function(t,n){"$ne"in n?n.$ne.push(t):n.$ne=[t]}(n,r):"$eq"===t?function(t,n){delete n.$gt,delete n.$gte,delete n.$lt,delete n.$lte,delete n.$ne,n.$eq=t}(n,r):void(r[t]=n)})}})}),n}var an=-324,cn=3,sn="";function fn(t,n){if(t===n)return 0;t=ln(t),n=ln(n);var e=yn(t),i=yn(n);if(e-i!=0)return e-i;switch(typeof t){case"number":return t-n;case"boolean":return t<n?-1:1;case"string":return function(t,n){return t===n?0:t>n?1:-1}(t,n)}return Array.isArray(t)?function(t,n){for(var e=Math.min(t.length,n.length),i=0;i<e;i++){var r=fn(t[i],n[i]);if(0!==r)return r}return t.length===n.length?0:t.length>n.length?1:-1}(t,n):function(t,n){for(var e=Object.keys(t),i=Object.keys(n),r=Math.min(e.length,i.length),o=0;o<r;o++){var u=fn(e[o],i[o]);if(0!==u)return u;if(0!==(u=fn(t[e[o]],n[i[o]])))return u}return e.length===i.length?0:e.length>i.length?1:-1}(t,n)}function ln(t){switch(typeof t){case"undefined":return null;case"number":return t===1/0||t===-1/0||isNaN(t)?null:t;case"object":var n=t;if(Array.isArray(t)){var e=t.length;t=new Array(e);for(var i=0;i<e;i++)t[i]=ln(n[i])}else{if(t instanceof Date)return t.toJSON();if(null!==t)for(var r in t={},n)if(n.hasOwnProperty(r)){var o=n[r];void 0!==o&&(t[r]=ln(o))}}}return t}function hn(t){if(null!==t)switch(typeof t){case"boolean":return t?1:0;case"number":return function(t){if(0===t)return"1";var n=t.toExponential().split(/e\+?/),e=parseInt(n[1],10),i=t<0,r=i?"0":"2",o=(u=((i?-e:e)-an).toString(),a="0",c=cn,function(t,n,e){for(var i="",r=e-t.length;i.length<r;)i+=n;return i}(u,a,c)+u);var u,a,c;r+=sn+o;var s=Math.abs(parseFloat(n[0]));i&&(s=10-s);var f=s.toFixed(20);return f=f.replace(/\.?0+$/,""),r+=sn+f}(t);case"string":return t.replace(/\u0002/g,"").replace(/\u0001/g,"").replace(/\u0000/g,"");case"object":var n=Array.isArray(t),e=n?t:Object.keys(t),i=-1,r=e.length,o="";if(n)for(;++i<r;)o+=dn(e[i]);else for(;++i<r;){var u=e[i];o+=dn(u)+dn(t[u])}return o}return""}function dn(t){return yn(t=ln(t))+sn+hn(t)+"\0"}function vn(t,n){var e,i=n;if("1"===t[n])e=0,n++;else{var r="0"===t[n];n++;var o="",u=t.substring(n,n+cn),a=parseInt(u,10)+an;for(r&&(a=-a),n+=cn;;){var c=t[n];if("\0"===c)break;o+=c,n++}e=1===(o=o.split(".")).length?parseInt(o,10):parseFloat(o[0]+"."+o[1]),r&&(e-=10),0!==a&&(e=parseFloat(e+"e"+a))}return{num:e,length:n-i}}function pn(t,n){var e=t.pop();if(n.length){var i=n[n.length-1];e===i.element&&(n.pop(),i=n[n.length-1]);var r=i.element,o=i.index;if(Array.isArray(r))r.push(e);else if(o===t.length-2){r[t.pop()]=e}else t.push(e)}}function yn(t){var n=["boolean","number","string","object"].indexOf(typeof t);return~n?null===t?1:Array.isArray(t)?5:n<3?n+2:n+3:Array.isArray(t)?5:void 0}function gn(t,n,e){if(t=t.filter(function(t){return bn(t.doc,n.selector,e)}),n.sort){var i=function(t){function n(n){return t.map(function(t){var e=nn(on(t));return tn(n,e)})}return function(t,e){var i,r,o=fn(n(t.doc),n(e.doc));return 0!==o?o:(i=t.doc._id,r=e.doc._id,i<r?-1:i>r?1:0)}}(n.sort);t=t.sort(i),"string"!=typeof n.sort[0]&&"desc"===(r=n.sort[0])[on(r)]&&(t=t.reverse())}var r;if("limit"in n||"skip"in n){var o=n.skip||0,u=("limit"in n?n.limit:t.length)+o;t=t.slice(o,u)}return t}function bn(t,n,e){return e.every(function(e){var i=n[e],r=nn(e),o=tn(t,r);return rn(e)?function(t,n,e){if("$or"===t)return n.some(function(t){return bn(e,t,Object.keys(t))});if("$not"===t)return!bn(e,n,Object.keys(n));return!n.find(function(t){return bn(e,t,Object.keys(t))})}(e,i,t):wn(i,t,r,o)})}function wn(t,n,e,i){return!t||Object.keys(t).every(function(r){var o=t[r];return function(t,n,e,i,r){if(!An[t])throw new Error('unknown operator "'+t+'" - should be one of $eq, $lte, $lt, $gt, $gte, $exists, $ne, $in, $nin, $size, $mod, $regex, $elemMatch, $type, $allMatch or $all');return An[t](n,e,i,r)}(r,n,o,e,i)})}function mn(t){return null!=t}function _n(t){return void 0!==t}function kn(t,n){return n.some(function(n){return t instanceof Array?t.indexOf(n)>-1:t===n})}var An={$elemMatch:function(t,n,e,i){return!!Array.isArray(i)&&(0!==i.length&&("object"==typeof i[0]?i.some(function(t){return bn(t,n,Object.keys(n))}):i.some(function(i){return wn(n,t,e,i)})))},$allMatch:function(t,n,e,i){return!!Array.isArray(i)&&(0!==i.length&&("object"==typeof i[0]?i.every(function(t){return bn(t,n,Object.keys(n))}):i.every(function(i){return wn(n,t,e,i)})))},$eq:function(t,n,e,i){return _n(i)&&0===fn(i,n)},$gte:function(t,n,e,i){return _n(i)&&fn(i,n)>=0},$gt:function(t,n,e,i){return _n(i)&&fn(i,n)>0},$lte:function(t,n,e,i){return _n(i)&&fn(i,n)<=0},$lt:function(t,n,e,i){return _n(i)&&fn(i,n)<0},$exists:function(t,n,e,i){return n?_n(i):!_n(i)},$mod:function(t,n,e,i){return mn(i)&&function(t,n){var e=n[0],i=n[1];if(0===e)throw new Error("Bad divisor, cannot divide by zero");if(parseInt(e,10)!==e)throw new Error("Divisor is not an integer");if(parseInt(i,10)!==i)throw new Error("Modulus is not an integer");return parseInt(t,10)===t&&t%e===i}(i,n)},$ne:function(t,n,e,i){return n.every(function(t){return 0!==fn(i,t)})},$in:function(t,n,e,i){return mn(i)&&kn(i,n)},$nin:function(t,n,e,i){return mn(i)&&!kn(i,n)},$size:function(t,n,e,i){return mn(i)&&function(t,n){return t.length===n}(i,n)},$all:function(t,n,e,i){return Array.isArray(i)&&function(t,n){return n.every(function(n){return t.indexOf(n)>-1})}(i,n)},$regex:function(t,n,e,i){return mn(i)&&function(t,n){return new RegExp(n).test(t)}(i,n)},$type:function(t,n,e,i){return function(t,n){switch(n){case"null":return null===t;case"boolean":return"boolean"==typeof t;case"number":return"number"==typeof t;case"string":return"string"==typeof t;case"array":return t instanceof Array;case"object":return"[object Object]"==={}.toString.call(t)}throw new Error(n+" not supported as a type.Please use one of object, string, array, number, boolean or null.")}(i,n)}};function xn(t,n){if("object"!=typeof n)throw new Error("Selector error: expected a JSON object");var e=gn([{doc:t}],{selector:n=function(t){var n=L(t),e=!1;"$and"in n&&(n=un(n.$and),e=!0),["$or","$nor"].forEach(function(t){t in n&&n[t].forEach(function(t){for(var n=Object.keys(t),e=0;e<n.length;e++){var i=n[e],r=t[i];"object"==typeof r&&null!==r||(t[i]={$eq:r})}})}),"$not"in n&&(n.$not=un([n.$not]));for(var i=Object.keys(n),r=0;r<i.length;r++){var o=i[r],u=n[o];"object"!=typeof u||null===u?u={$eq:u}:"$ne"in u&&!e&&(u.$ne=[u.$ne]),n[o]=u}return n}(n)},Object.keys(n));return e&&1===e.length}function En(t,n){if(t.selector&&t.filter&&"_selector"!==t.filter){var e="string"==typeof t.filter?t.filter:"function";return n(new Error('selector invalid for filter "'+e+'"'))}n()}function Ln(t){t.view&&!t.filter&&(t.filter="_view"),t.selector&&!t.filter&&(t.filter="_selector"),t.filter&&"string"==typeof t.filter&&("_view"===t.filter?t.view=gt(t.view):t.filter=gt(t.filter))}function On(t,n){return n.filter&&"string"==typeof n.filter&&!n.doc_ids&&!pt(t.db)}function Mn(t,n){var e=n.complete;if("_view"===n.filter){if(!n.view||"string"!=typeof n.view){var i=ft(rt,"`view` filter parameter not found or invalid.");return e(i)}var r=yt(n.view);t.db.get("_design/"+r[0],function(i,o){if(t.isCancelled)return e(null,{status:"cancelled"});if(i)return e(lt(i));var u=o&&o.views&&o.views[r[1]]&&o.views[r[1]].map;if(!u)return e(ft(V,o.views?"missing json key: "+r[1]:"missing json key: views"));n.filter=At(["return function(doc) {",'  "use strict";',"  var emitted = false;","  var emit = function (a, b) {","    emitted = true;","  };","  var view = "+u+";","  view(doc);","  if (emitted) {","    return true;","  }","};"].join("\n"),{}),t.doChanges(n)})}else if(n.selector)n.filter=function(t){return xn(t,n.selector)},t.doChanges(n);else{var o=yt(n.filter);t.db.get("_design/"+o[0],function(i,r){if(t.isCancelled)return e(null,{status:"cancelled"});if(i)return e(lt(i));var u=r&&r.filters&&r.filters[o[1]];if(!u)return e(ft(V,r&&r.filters?"missing json key: "+o[1]:"missing json key: filters"));n.filter=At('"use strict";\nreturn '+u+";",{}),t.doChanges(n)})}}function Tn(t){return t.reduce(function(t,n){return t[n]=!0,t},{})}It.plugin(function(t){t.debug=p.a;var n={};t.on("debug",function(t){var e=t[0],i=t.slice(1);n[e]||(n[e]=p()("pouchdb:"+e)),n[e].apply(null,i)})}),It.plugin(function(t){t._changesFilterPlugin={validate:En,normalize:Ln,shouldFilter:On,filter:Mn}}),It.version="6.4.3";var qn=Tn(["_id","_rev","_attachments","_deleted","_revisions","_revs_info","_conflicts","_deleted_conflicts","_local_seq","_rev_tree","_replication_id","_replication_state","_replication_state_time","_replication_state_reason","_replication_stats","_removed"]),Pn=Tn(["_attachments","_replication_id","_replication_state","_replication_state_time","_replication_state_reason","_replication_stats"]);function Sn(t){if(!/^\d+-./.test(t))return ft(ct);var n=t.indexOf("-"),e=t.substring(0,n),i=t.substring(n+1);return{prefix:parseInt(e,10),id:i}}function Fn(t,n){var e,i,r,o={status:"available"};if(t._deleted&&(o.deleted=!0),n)if(t._id||(t._id=Lt()),i=Et(),t._rev){if((r=Sn(t._rev)).error)return r;t._rev_tree=[{pos:r.prefix,ids:[r.id,{status:"missing"},[[i,o,[]]]]}],e=r.prefix+1}else t._rev_tree=[{pos:1,ids:[i,o,[]]}],e=1;else if(t._revisions&&(t._rev_tree=function(t,n){for(var e=t.start-t.ids.length+1,i=t.ids,r=[i[0],n,[]],o=1,u=i.length;o<u;o++)r=[i[o],{status:"missing"},[r]];return[{pos:e,ids:r}]}(t._revisions,o),e=t._revisions.start,i=t._revisions.ids[0]),!t._rev_tree){if((r=Sn(t._rev)).error)return r;e=r.prefix,i=r.id,t._rev_tree=[{pos:e,ids:[i,o,[]]}]}vt(t._id),t._rev=e+"-"+i;var u={metadata:{},data:{}};for(var a in t)if(Object.prototype.hasOwnProperty.call(t,a)){var c="_"===a[0];if(c&&!qn[a]){var s=ft(it,a);throw s.message=it.message+": "+a,s}c&&!Pn[a]?u.metadata[a.slice(1)]=t[a]:u.data[a]=t[a]}return u}var jn=function(t){return atob(t)},Un=function(t){return btoa(t)};function Dn(t,n){t=t||[],n=n||{};try{return new Blob(t,n)}catch(r){if("TypeError"!==r.name)throw r;for(var e=new("undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof MSBlobBuilder?MSBlobBuilder:"undefined"!=typeof MozBlobBuilder?MozBlobBuilder:WebKitBlobBuilder),i=0;i<t.length;i+=1)e.append(t[i]);return e.getBlob(n.type)}}function Rn(t){for(var n=t.length,e=new ArrayBuffer(n),i=new Uint8Array(e),r=0;r<n;r++)i[r]=t.charCodeAt(r);return e}function Bn(t,n){return Dn([Rn(t)],{type:n})}function Cn(t,n){return Bn(jn(t),n)}function Wn(t){for(var n="",e=new Uint8Array(t),i=e.byteLength,r=0;r<i;r++)n+=String.fromCharCode(e[r]);return n}function Nn(t,n){if("undefined"==typeof FileReader)return n(Wn((new FileReaderSync).readAsArrayBuffer(t)));var e=new FileReader,i="function"==typeof e.readAsBinaryString;e.onloadend=function(t){var e=t.target.result||"";if(i)return n(e);n(Wn(e))},i?e.readAsBinaryString(t):e.readAsArrayBuffer(t)}function $n(t,n){Nn(t,function(t){n(t)})}function Jn(t,n){$n(t,function(t){n(Un(t))})}function Hn(t,n){if("undefined"==typeof FileReader)return n((new FileReaderSync).readAsArrayBuffer(t));var e=new FileReader;e.onloadend=function(t){var e=t.target.result||new ArrayBuffer(0);n(e)},e.readAsArrayBuffer(t)}var Xn=t.setImmediate||t.setTimeout,Kn=32768;function Gn(t,n,e,i,r){(e>0||i<n.size)&&(n=function(t,n,e){return t.webkitSlice?t.webkitSlice(n,e):t.slice(n,e)}(n,e,i)),Hn(n,function(n){t.append(n),r()})}function Zn(t,n,e,i,r){(e>0||i<n.length)&&(n=n.substring(e,i)),t.appendBinary(n),r()}function Vn(t,n){var e="string"==typeof t,i=e?t.length:t.size,r=Math.min(Kn,i),o=Math.ceil(i/r),u=0,a=e?new g.a:new g.a.ArrayBuffer,c=e?Zn:Gn;function s(){Xn(l)}function f(){var t=function(t){return Un(t)}(a.end(!0));n(t),a.destroy()}function l(){var n=u*r,e=n+r;c(a,t,n,e,++u<o?s:f)}l()}function Yn(t,n,e){var i=function(t){try{return jn(t)}catch(t){return{error:ft(nt,"Attachment is not a valid base64 string")}}}(t.data);if(i.error)return e(i.error);t.length=i.length,t.data="blob"===n?Bn(i,t.content_type):"base64"===n?Un(i):i,Vn(i,function(n){t.digest="md5-"+n,e()})}function zn(t,n,e){if(t.stub)return e();"string"==typeof t.data?Yn(t,n,e):function(t,n,e){Vn(t.data,function(i){t.digest="md5-"+i,t.length=t.data.size||t.data.length||0,"binary"===n?$n(t.data,function(n){t.data=n,e()}):"base64"===n?Jn(t.data,function(n){t.data=n,e()}):e()})}(t,n,e)}function In(t,n,e){if(!t.length)return e();var i,r=0;function o(){r++,t.length===r&&(i?e(i):e())}t.forEach(function(t){var e=t.data&&t.data._attachments?Object.keys(t.data._attachments):[],r=0;if(!e.length)return o();function u(t){i=t,++r===e.length&&o()}for(var a in t.data._attachments)t.data._attachments.hasOwnProperty(a)&&zn(t.data._attachments[a],n,u)})}function Qn(t,n,e,i,r,o,u,a){if(function(t,n){for(var e,i=t.slice(),r=n.split("-"),o=parseInt(r[0],10),u=r[1];e=i.pop();){if(e.pos===o&&e.ids[0]===u)return!0;for(var a=e.ids[2],c=0,s=a.length;c<s;c++)i.push({pos:e.pos+1,ids:a[c]})}return!1}(n.rev_tree,e.metadata.rev))return i[r]=e,o();var c=n.winningRev||Ot(n),s="deleted"in n?n.deleted:$t(n,c),f="deleted"in e.metadata?e.metadata.deleted:$t(e.metadata),l=/^1-/.test(e.metadata.rev);if(s&&!f&&a&&l){var h=e.data;h._rev=c,h._id=e.metadata.id,e=Fn(h,a)}var d=Wt(n.rev_tree,e.metadata.rev_tree[0],t);if(a&&(s&&f&&"new_leaf"!==d.conflicts||!s&&"new_leaf"!==d.conflicts||s&&!f&&"new_branch"===d.conflicts)){var v=ft(Y);return i[r]=v,o()}var p=e.metadata.rev;e.metadata.rev_tree=d.tree,e.stemmedRevs=d.stemmedRevs||[],n.rev_map&&(e.metadata.rev_map=n.rev_map);var y=Ot(e.metadata),g=$t(e.metadata,y),b=s===g?0:s<g?-1:1;u(e,y,g,p===y?g:$t(e.metadata,p),!0,b,r,o)}function te(t,n,e,i,r,o,u,a,c){t=t||1e3;var s=a.new_edits,f=new A,l=0,h=n.length;function d(){++l===h&&c&&c()}n.forEach(function(t,n){if(t._id&&Jt(t._id)){var i=t._deleted?"_removeLocal":"_putLocal";e[i](t,{ctx:r},function(t,e){o[n]=t||e,d()})}else{var u=t.metadata.id;f.has(u)?(h--,f.get(u).push([t,n])):f.set(u,[[t,n]])}}),f.forEach(function(n,e){var r=0;function c(){++r<n.length?f():d()}function f(){var f=n[r],l=f[0],h=f[1];if(i.has(e))Qn(t,i.get(e),l,o,h,c,u,s);else{var d=Wt([],l.metadata.rev_tree[0],t);l.metadata.rev_tree=d.tree,l.stemmedRevs=d.stemmedRevs||[],function(t,n,e){var i=Ot(t.metadata),r=$t(t.metadata,i);if("was_delete"in a&&r)return o[n]=ft(V,"deleted"),e();if(s&&function(t){return"missing"===t.metadata.rev_tree[0].ids[1].status}(t)){var c=ft(Y);return o[n]=c,e()}u(t,i,r,r,!1,r?0:1,n,e)}(l,h,c)}}f()})}var ne=5,ee="document-store",ie="by-sequence",re="attach-store",oe="attach-seq-store",ue="meta-store",ae="local-store",ce="detect-blob-support";function se(t){try{return JSON.parse(t)}catch(n){return w.a.parse(t)}}function fe(t){try{return JSON.stringify(t)}catch(n){return w.a.stringify(t)}}function le(t){return function(n){var e="unknown_error";n.target&&n.target.error&&(e=n.target.error.name||n.target.error.message),t(ft(ut,e,n.type))}}function he(t,n,e){return{data:fe(t),winningRev:n,deletedOrLocal:e?"1":"0",seq:t.seq,id:t.id}}function de(t){if(!t)return null;var n=se(t.data);return n.winningRev=t.winningRev,n.deleted="1"===t.deletedOrLocal,n.seq=t.seq,n}function ve(t){if(!t)return t;var n=t._doc_id_rev.lastIndexOf(":");return t._id=t._doc_id_rev.substring(0,n-1),t._rev=t._doc_id_rev.substring(n+1),delete t._doc_id_rev,t}function pe(t,n,e,i){e?i(t?"string"!=typeof t?t:Cn(t,n):Dn([""],{type:n})):t?"string"!=typeof t?Nn(t,function(t){i(Un(t))}):i(t):i("")}function ye(t,n,e,i){var r=Object.keys(t._attachments||{});if(!r.length)return i&&i();var o=0;function u(){++o===r.length&&i&&i()}r.forEach(function(i){n.attachments&&n.include_docs?function(t,n){var i=t._attachments[n],r=i.digest;e.objectStore(re).get(r).onsuccess=function(t){i.body=t.target.result.body,u()}}(t,i):(t._attachments[i].stub=!0,u())})}function ge(t,n){return m.all(t.map(function(t){if(t.doc&&t.doc._attachments){var e=Object.keys(t.doc._attachments);return m.all(e.map(function(e){var i=t.doc._attachments[e];if("body"in i){var r=i.body,o=i.content_type;return new m(function(u){pe(r,o,n,function(n){t.doc._attachments[e]=K(j(i,["digest","content_type"]),{data:n}),u()})})}}))}}))}function be(t,n,e){var i=[],r=e.objectStore(ie),o=e.objectStore(re),u=e.objectStore(oe),a=t.length;function c(){--a||function(){if(!i.length)return;i.forEach(function(t){var n=u.index("digestSeq").count(IDBKeyRange.bound(t+"::",t+"::￿",!1,!1));n.onsuccess=function(n){var e=n.target.result;e||o.delete(t)}})}()}t.forEach(function(t){var e=r.index("_doc_id_rev"),o=n+"::"+t;e.getKey(o).onsuccess=function(t){var n=t.target.result;if("number"!=typeof n)return c();r.delete(n),u.index("seq").openCursor(IDBKeyRange.only(n)).onsuccess=function(t){var n=t.target.result;if(n){var e=n.value.digestSeq.split("::")[0];i.push(e),u.delete(n.primaryKey),n.continue()}else c()}}})}function we(t,n,e){try{return{txn:t.transaction(n,e)}}catch(t){return{error:t}}}var me=new $;function _e(t,n,e,i,r,o){for(var u,a,c,s,f,l,h,d,v=n.docs,p=0,y=v.length;p<y;p++){var g=v[p];g._id&&Jt(g._id)||(g=v[p]=Fn(g,e.new_edits)).error&&!h&&(h=g)}if(h)return o(h);var b=!1,w=0,m=new Array(v.length),_=new A,k=!1,x=i._meta.blobSupport?"blob":"base64";function E(){b=!0,L()}function L(){d&&b&&(d.docCount+=w,l.put(d))}function O(){k||(me.notify(i._meta.name),o(null,m))}function M(t,n,e,i,r,o,u,a){t.metadata.winningRev=n,t.metadata.deleted=e;var c=t.data;if(c._id=t.metadata.id,c._rev=t.metadata.rev,i&&(c._deleted=!0),c._attachments&&Object.keys(c._attachments).length)return function(t,n,e,i,r,o){var u=t.data,a=0,c=Object.keys(u._attachments);function f(){a===c.length&&T(t,n,e,i,r,o)}function l(){a++,f()}c.forEach(function(e){var i=t.data._attachments[e];if(i.stub)a++,f();else{var r=i.data;delete i.data,i.revpos=parseInt(n,10);var o=i.digest;!function(t,n,e){s.count(t).onsuccess=function(i){var r=i.target.result;if(r)return e();var o={digest:t,body:n},u=s.put(o);u.onsuccess=e}}(o,r,l)}})}(t,n,e,r,u,a);w+=o,L(),T(t,n,e,r,u,a)}function T(t,n,e,r,o,s){var l=t.data,h=t.metadata;function d(o){var c=t.stemmedRevs||[];r&&i.auto_compaction&&(c=c.concat(St(t.metadata))),c&&c.length&&be(c,t.metadata.id,u),h.seq=o.target.result;var s=he(h,n,e);a.put(s).onsuccess=v}function v(){m[o]={ok:!0,id:h.id,rev:h.rev},_.set(t.metadata.id,t.metadata),function(t,n,e){var i=0,r=Object.keys(t.data._attachments||{});if(!r.length)return e();function o(){++i===r.length&&e()}function u(e){var i=t.data._attachments[e].digest,r=f.put({seq:n,digestSeq:i+"::"+n});r.onsuccess=o,r.onerror=function(t){t.preventDefault(),t.stopPropagation(),o()}}for(var a=0;a<r.length;a++)u(r[a])}(t,h.seq,s)}l._doc_id_rev=h.id+"::"+h.rev,delete l._id,delete l._rev;var p=c.put(l);p.onsuccess=d,p.onerror=function(t){t.preventDefault(),t.stopPropagation(),c.index("_doc_id_rev").getKey(l._doc_id_rev).onsuccess=function(t){c.put(l,t.target.result).onsuccess=d}}}In(v,x,function(n){if(n)return o(n);!function(){var n=we(r,[ee,ie,re,ae,oe,ue],"readwrite");if(n.error)return o(n.error);(u=n.txn).onabort=le(o),u.ontimeout=le(o),u.oncomplete=O,a=u.objectStore(ee),c=u.objectStore(ie),s=u.objectStore(re),f=u.objectStore(oe),(l=u.objectStore(ue)).get(ue).onsuccess=function(t){d=t.target.result,L()},function(t){var n=[];if(v.forEach(function(t){t.data&&t.data._attachments&&Object.keys(t.data._attachments).forEach(function(e){var i=t.data._attachments[e];i.stub&&n.push(i.digest)})}),!n.length)return t();var e,i=0;n.forEach(function(r){!function(t,n){s.get(t).onsuccess=function(e){if(e.target.result)n();else{var i=ft(st,"unknown stub attachment with digest "+t);i.status=412,n(i)}}}(r,function(r){r&&!e&&(e=r),++i===n.length&&t(e)})})}(function(n){if(n)return k=!0,o(n);!function(){if(!v.length)return;var n=0;function r(){++n===v.length&&te(t.revs_limit,v,i,_,u,m,M,e,E)}function o(t){var n=de(t.target.result);n&&_.set(n.id,n),r()}for(var c=0,s=v.length;c<s;c++){var f=v[c];if(f._id&&Jt(f._id))r();else{var l=a.get(f.metadata.id);l.onsuccess=o}}}()})}()})}function ke(t,n,e,i,r){var o,u,a;function c(t){u=t.target.result,o&&r(o,u,a)}function s(t){o=t.target.result,u&&r(o,u,a)}function f(t){var n=t.target.result;if(!n)return r();r([n.key],[n.value],n)}"function"==typeof t.getAll&&"function"==typeof t.getAllKeys&&i>1&&!e?(a={continue:function(){if(!o.length)return r();var e,a=o[o.length-1];if(n&&n.upper)try{e=IDBKeyRange.bound(a,n.upper,!0,n.upperOpen)}catch(t){if("DataError"===t.name&&0===t.code)return r()}else e=IDBKeyRange.lowerBound(a,!0);n=e,o=null,u=null,t.getAll(n,i).onsuccess=c,t.getAllKeys(n,i).onsuccess=s}},t.getAll(n,i).onsuccess=c,t.getAllKeys(n,i).onsuccess=s):e?t.openCursor(n,"prev").onsuccess=f:t.openCursor(n).onsuccess=f}function Ae(t,n,e){var i,r,o="startkey"in t&&t.startkey,u="endkey"in t&&t.endkey,a="key"in t&&t.key,c="keys"in t&&t.keys,s=t.skip||0,f="number"==typeof t.limit?t.limit:-1,l=!1!==t.inclusive_end;if(!c&&(r=(i=function(t,n,e,i,r){try{if(t&&n)return r?IDBKeyRange.bound(n,t,!e,!1):IDBKeyRange.bound(t,n,!1,!e);if(t)return r?IDBKeyRange.upperBound(t):IDBKeyRange.lowerBound(t);if(n)return r?IDBKeyRange.lowerBound(n,!e):IDBKeyRange.upperBound(n,!e);if(i)return IDBKeyRange.only(i)}catch(t){return{error:t}}return null}(o,u,l,a,t.descending))&&i.error)&&("DataError"!==r.name||0!==r.code))return e(ft(ut,r.name,r.message));var h=[ee,ie,ue];t.attachments&&h.push(re);var d=we(n,h,"readonly");if(d.error)return e(d.error);var v=d.txn;v.oncomplete=function(){t.attachments?ge(_,t.binary).then(E):E()},v.onabort=le(e);var p,y,g=v.objectStore(ee),b=v.objectStore(ie),w=v.objectStore(ue),m=b.index("_doc_id_rev"),_=[];function k(n,e){var i={id:e.id,key:e.id,value:{rev:n}};e.deleted?c&&(_.push(i),i.value.deleted=!0,i.doc=null):s--<=0&&(_.push(i),t.include_docs&&function(n,e,i){var r=n.id+"::"+i;m.get(r).onsuccess=function(i){if(e.doc=ve(i.target.result),t.conflicts){var r=Pt(n);r.length&&(e.doc._conflicts=r)}ye(e.doc,t,v)}}(e,i,n))}function A(t){for(var n=0,e=t.length;n<e&&_.length!==f;n++){var i=t[n];if(i.error&&c)_.push(i);else{var r=de(i);k(r.winningRev,r)}}}function x(t,n,e){e&&(A(n),_.length<f&&e.continue())}function E(){var n={total_rows:p,offset:t.skip,rows:_};t.update_seq&&void 0!==y&&(n.update_seq=y),e(null,n)}return w.get(ue).onsuccess=function(t){p=t.target.result.docCount},t.update_seq&&function(t,n){t.openCursor(null,"prev").onsuccess=function(t){var e=t.target.result,i=void 0;e&&e.key&&(i=e.key);return n({target:{result:[i]}})}}(b,function(t){t.target.result&&t.target.result.length>0&&(y=t.target.result[0])}),r||0===f?void 0:c?function(t,n,e){var i=[],r=0;t.forEach(function(o,u){n.get(o).onsuccess=function(n){n.target.result?i[u]=n.target.result:i[u]={key:o,error:"not_found"},++r===t.length&&e(t,i,{})}})}(t.keys,g,x):-1===f?function(t,n,e){if("function"!=typeof t.getAll){var i=[];t.openCursor(n).onsuccess=function(t){var n=t.target.result;n?(i.push(n.value),n.continue()):e({target:{result:i}})}}else t.getAll(n).onsuccess=e}(g,i,function(n){var e=n.target.result;t.descending&&(e=e.reverse()),A(e)}):void ke(g,i,t.descending,f+s,x)}var xe=!1,Ee=[];function Le(){!xe&&Ee.length&&(xe=!0,Ee.shift()())}function Oe(t,n,e,i){if((t=L(t)).continuous){var r=e+":"+Lt();return me.addListener(e,r,n,t),me.notify(e),{cancel:function(){me.removeListener(e,r)}}}var o=t.doc_ids&&new k(t.doc_ids);t.since=t.since||0;var u,a=t.since,c="limit"in t?t.limit:-1;0===c&&(c=1),u="return_docs"in t?t.return_docs:!("returnDocs"in t)||t.returnDocs;var s,f,l,h,d=[],v=0,p=ht(t),y=new A;function g(t,n,e,i){if(e.seq!==n)return i();if(e.winningRev===t._rev)return i(e,t);var r=t._id+"::"+e.winningRev;h.get(r).onsuccess=function(t){i(e,ve(t.target.result))}}function b(){t.complete(null,{results:d,last_seq:a})}var w=[ee,ie];t.attachments&&w.push(re);var m=we(i,w,"readonly");if(m.error)return t.complete(m.error);(s=m.txn).onabort=le(t.complete),s.oncomplete=function(){!t.continuous&&t.attachments?ge(d).then(b):b()},f=s.objectStore(ie),l=s.objectStore(ee),h=f.index("_doc_id_rev"),ke(f,t.since&&!t.descending?IDBKeyRange.lowerBound(t.since,!0):null,t.descending,c,function(n,e,i){if(i&&n.length){var r=new Array(n.length),f=new Array(n.length),h=0;e.forEach(function(t,e){!function(t,n,e){if(o&&!o.has(t._id))return e();var i=y.get(t._id);if(i)return g(t,n,i,e);l.get(t._id).onsuccess=function(r){i=de(r.target.result),y.set(t._id,i),g(t,n,i,e)}}(ve(t),n[e],function(t,o){f[e]=t,r[e]=o,++h===n.length&&function(){for(var t=0,n=r.length;t<n&&v!==c;t++){var e=r[t];e&&b(f[t],e)}v!==c&&i.continue()}()})})}function b(n,e){var i=t.processChange(e,n,t);a=i.seq=n.seq;var r=p(i);if("object"==typeof r)return t.complete(r);r&&(v++,u&&d.push(i),t.attachments&&t.include_docs?ye(e,t,s,function(){ge([i],t.binary).then(function(){t.onChange(i)})}):t.onChange(i))}})}var Me,Te=new A,qe=new A;function Pe(t,n){var e=this;!function(t,n,e){Ee.push(function(){t(function(t,i){!function(t,n,e,i){try{t(n,e)}catch(n){i.emit("error",n)}}(n,t,i,e),xe=!1,c()(function(){Le()})})}),Le()}(function(n){!function(t,n,e){var i=n.name,r=null;function o(t,n){var e=t.objectStore(ee);e.createIndex("deletedOrLocal","deletedOrLocal",{unique:!1}),e.openCursor().onsuccess=function(t){var i=t.target.result;if(i){var r=i.value,o=$t(r);r.deletedOrLocal=o?"1":"0",e.put(r),i.continue()}else n()}}function u(t,n){var e=t.objectStore(ae),i=t.objectStore(ee),r=t.objectStore(ie),o=i.openCursor();o.onsuccess=function(t){var o=t.target.result;if(o){var u=o.value,a=u.id,c=Jt(a),s=Ot(u);if(c){var f=a+"::"+s,l=a+"::",h=a+"::~",d=r.index("_doc_id_rev"),v=IDBKeyRange.bound(l,h,!1,!1),p=d.openCursor(v);p.onsuccess=function(t){if(p=t.target.result){var n=p.value;n._doc_id_rev===f&&e.put(n),r.delete(p.primaryKey),p.continue()}else i.delete(o.primaryKey),o.continue()}}else o.continue()}else n&&n()}}function a(t,n){var e=t.objectStore(ie),i=t.objectStore(re),r=t.objectStore(oe),o=i.count();o.onsuccess=function(t){var i=t.target.result;if(!i)return n();e.openCursor().onsuccess=function(t){var e=t.target.result;if(!e)return n();for(var i=e.value,o=e.primaryKey,u=Object.keys(i._attachments||{}),a={},c=0;c<u.length;c++){var s=i._attachments[u[c]];a[s.digest]=!0}var f=Object.keys(a);for(c=0;c<f.length;c++){var l=f[c];r.put({seq:o,digestSeq:l+"::"+o})}e.continue()}}}function s(t){var n=t.objectStore(ie),e=t.objectStore(ee),i=e.openCursor();i.onsuccess=function(t){var i=t.target.result;if(i){var r,o,u,a,c=function(t){if(!t.data)return t.deleted="1"===t.deletedOrLocal,t;return de(t)}(i.value);if(c.winningRev=c.winningRev||Ot(c),c.seq)return s();r=c.id+"::",o=c.id+"::￿",u=n.index("_doc_id_rev").openCursor(IDBKeyRange.bound(r,o)),a=0,u.onsuccess=function(t){var n=t.target.result;if(!n)return c.seq=a,s();var e=n.primaryKey;e>a&&(a=e),n.continue()}}function s(){var t=he(c,c.winningRev,c.deleted),n=e.put(t);n.onsuccess=function(){i.continue()}}}}t._meta=null,t._remote=!1,t.type=function(){return"idb"},t._id=M(function(n){n(null,t._meta.instanceId)}),t._bulkDocs=function(e,i,o){_e(n,e,i,t,r,o)},t._get=function(t,n,e){var i,o,u,a=n.ctx;if(!a){var c=we(r,[ee,ie,re],"readonly");if(c.error)return e(c.error);a=c.txn}function s(){e(u,{doc:i,metadata:o,ctx:a})}a.objectStore(ee).get(t).onsuccess=function(t){if(!(o=de(t.target.result)))return u=ft(V,"missing"),s();var e;if(n.rev)e=n.latest?Ht(n.rev,o):n.rev;else{e=o.winningRev;var r=$t(o);if(r)return u=ft(V,"deleted"),s()}var c=a.objectStore(ie),f=o.id+"::"+e;c.index("_doc_id_rev").get(f).onsuccess=function(t){if((i=t.target.result)&&(i=ve(i)),!i)return u=ft(V,"missing"),s();s()}}},t._getAttachment=function(t,n,e,i,o){var u;if(i.ctx)u=i.ctx;else{var a=we(r,[ee,ie,re],"readonly");if(a.error)return o(a.error);u=a.txn}var c=e.digest,s=e.content_type;u.objectStore(re).get(c).onsuccess=function(t){var n=t.target.result.body;pe(n,s,i.binary,function(t){o(null,t)})}},t._info=function(n){var e,i,o=we(r,[ue,ie],"readonly");if(o.error)return n(o.error);var u=o.txn;u.objectStore(ue).get(ue).onsuccess=function(t){i=t.target.result.docCount},u.objectStore(ie).openCursor(null,"prev").onsuccess=function(t){var n=t.target.result;e=n?n.key:0},u.oncomplete=function(){n(null,{doc_count:i,update_seq:e,idb_attachment_format:t._meta.blobSupport?"binary":"base64"})}},t._allDocs=function(t,n){Ae(t,r,n)},t._changes=function(n){return Oe(n,t,i,r)},t._close=function(t){r.close(),Te.delete(i),t()},t._getRevisionTree=function(t,n){var e=we(r,[ee],"readonly");if(e.error)return n(e.error);var i=e.txn,o=i.objectStore(ee).get(t);o.onsuccess=function(t){var e=de(t.target.result);e?n(null,e.rev_tree):n(ft(V))}},t._doCompaction=function(t,n,e){var i=[ee,ie,re,oe],o=we(r,i,"readwrite");if(o.error)return e(o.error);var u=o.txn,a=u.objectStore(ee);a.get(t).onsuccess=function(e){var i=de(e.target.result);Mt(i.rev_tree,function(t,e,i,r,o){var u=e+"-"+i;-1!==n.indexOf(u)&&(o.status="missing")}),be(n,t,u);var r=i.winningRev,o=i.deleted;u.objectStore(ee).put(he(i,r,o))},u.onabort=le(e),u.oncomplete=function(){e()}},t._getLocal=function(t,n){var e=we(r,[ae],"readonly");if(e.error)return n(e.error);var i=e.txn,o=i.objectStore(ae).get(t);o.onerror=le(n),o.onsuccess=function(t){var e=t.target.result;e?(delete e._doc_id_rev,n(null,e)):n(ft(V))}},t._putLocal=function(t,n,e){"function"==typeof n&&(e=n,n={}),delete t._revisions;var i=t._rev,o=t._id;t._rev=i?"0-"+(parseInt(i.split("-")[1],10)+1):"0-1";var u,a=n.ctx;if(!a){var c=we(r,[ae],"readwrite");if(c.error)return e(c.error);(a=c.txn).onerror=le(e),a.oncomplete=function(){u&&e(null,u)}}var s,f=a.objectStore(ae);i?(s=f.get(o)).onsuccess=function(r){var o=r.target.result;if(o&&o._rev===i){var a=f.put(t);a.onsuccess=function(){u={ok:!0,id:t._id,rev:t._rev},n.ctx&&e(null,u)}}else e(ft(Y))}:((s=f.add(t)).onerror=function(t){e(ft(Y)),t.preventDefault(),t.stopPropagation()},s.onsuccess=function(){u={ok:!0,id:t._id,rev:t._rev},n.ctx&&e(null,u)})},t._removeLocal=function(t,n,e){"function"==typeof n&&(e=n,n={});var i,o=n.ctx;if(!o){var u=we(r,[ae],"readwrite");if(u.error)return e(u.error);(o=u.txn).oncomplete=function(){i&&e(null,i)}}var a=t._id,c=o.objectStore(ae),s=c.get(a);s.onerror=le(e),s.onsuccess=function(r){var o=r.target.result;o&&o._rev===t._rev?(c.delete(a),i={ok:!0,id:a,rev:"0-0"},n.ctx&&e(null,i)):e(ft(V))}},t._destroy=function(t,n){me.removeAllListeners(i);var e=qe.get(i);e&&e.result&&(e.result.close(),Te.delete(i));var r=indexedDB.deleteDatabase(i);r.onsuccess=function(){qe.delete(i),N()&&i in localStorage&&delete localStorage[i],n(null,{ok:!0})},r.onerror=le(n)};var f,l=Te.get(i);if(l)return r=l.idb,t._meta=l.global,c()(function(){e(null,t)});f=n.storage?function(t,n){try{return indexedDB.open(t,{version:ne,storage:n})}catch(n){return indexedDB.open(t,ne)}}(i,n.storage):indexedDB.open(i,ne);qe.set(i,f),f.onupgradeneeded=function(t){var n=t.target.result;if(t.oldVersion<1)return function(t){var n=t.createObjectStore(ee,{keyPath:"id"});t.createObjectStore(ie,{autoIncrement:!0}).createIndex("_doc_id_rev","_doc_id_rev",{unique:!0}),t.createObjectStore(re,{keyPath:"digest"}),t.createObjectStore(ue,{keyPath:"id",autoIncrement:!1}),t.createObjectStore(ce),n.createIndex("deletedOrLocal","deletedOrLocal",{unique:!1}),t.createObjectStore(ae,{keyPath:"_id"});var e=t.createObjectStore(oe,{autoIncrement:!0});e.createIndex("seq","seq"),e.createIndex("digestSeq","digestSeq",{unique:!0})}(n);var e=t.currentTarget.transaction;t.oldVersion<3&&function(t){t.createObjectStore(ae,{keyPath:"_id"}).createIndex("_doc_id_rev","_doc_id_rev",{unique:!0})}(n),t.oldVersion<4&&function(t){var n=t.createObjectStore(oe,{autoIncrement:!0});n.createIndex("seq","seq"),n.createIndex("digestSeq","digestSeq",{unique:!0})}(n);var i=[o,u,a,s],r=t.oldVersion;!function t(){var n=i[r-1];r++;n&&n(e,t)}()},f.onsuccess=function(n){(r=n.target.result).onversionchange=function(){r.close(),Te.delete(i)},r.onabort=function(t){J("error","Database has a global failure",t.target.error),r.close(),Te.delete(i)};var o,u,a,c,s=r.transaction([ue,ce,ee],"readwrite"),f=!1;function l(){void 0!==a&&f&&(t._meta={name:i,instanceId:c,blobSupport:a},Te.set(i,{idb:r,global:t._meta}),e(null,t))}function h(){if(void 0!==u&&void 0!==o){var t=i+"_id";t in o?c=o[t]:o[t]=c=Lt(),o.docCount=u,s.objectStore(ue).put(o)}}s.objectStore(ue).get(ue).onsuccess=function(t){o=t.target.result||{id:ue},h()},function(t,n){t.objectStore(ee).index("deletedOrLocal").count(IDBKeyRange.only("0")).onsuccess=function(t){n(t.target.result)}}(s,function(t){u=t,h()}),Me||(Me=function(t){return new m(function(n){var e=Dn([""]);t.objectStore(ce).put(e,"key").onsuccess=function(){var t=navigator.userAgent.match(/Chrome\/(\d+)/),e=navigator.userAgent.match(/Edge\//);n(e||!t||parseInt(t[1],10)>=43)},t.onabort=function(t){t.preventDefault(),t.stopPropagation(),n(!1)}}).catch(function(){return!1})}(s)),Me.then(function(t){a=t,l()}),s.oncomplete=function(){f=!0,l()},s.onabort=le(e)},f.onerror=function(){var t="Failed to open indexedDB, are you in private browsing mode?";J("error",t),e(ft(ut,t))}}(e,t,n)},n,e.constructor)}function Se(t){return t<65?t-48:t-55}function Fe(t,n){return"UTF-8"===n?function(t){return decodeURIComponent(escape(t))}(function(t,n,e){for(var i="";n<e;)i+=String.fromCharCode(Se(t.charCodeAt(n++))<<4|Se(t.charCodeAt(n++)));return i}(t,0,t.length)):function(t,n,e){for(var i="";n<e;)i+=String.fromCharCode(Se(t.charCodeAt(n+2))<<12|Se(t.charCodeAt(n+3))<<8|Se(t.charCodeAt(n))<<4|Se(t.charCodeAt(n+1))),n+=4;return i}(t,0,t.length)}function je(t){return"'"+t+"'"}Pe.valid=function(){var t="undefined"!=typeof openDatabase&&/(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&!/BlackBerry/.test(navigator.platform),n="function"==typeof fetch&&-1!==fetch.toString().indexOf("[native code");try{return(!t||n)&&"undefined"!=typeof indexedDB&&"undefined"!=typeof IDBKeyRange}catch(t){return!1}};var Ue=7,De=je("document-store"),Re=je("by-sequence"),Be=je("attach-store"),Ce=je("local-store"),We=je("metadata-store"),Ne=je("attach-seq-store");function $e(t){return delete t._id,delete t._rev,JSON.stringify(t)}function Je(t,n,e){return(t=JSON.parse(t))._id=n,t._rev=e,t}function He(t){for(var n="(";t--;)n+="?",t&&(n+=",");return n+")"}function Xe(t,n,e,i,r){return"SELECT "+t+" FROM "+("string"==typeof n?n:n.join(" JOIN "))+(e?" ON "+e:"")+(i?" WHERE "+("string"==typeof i?i:i.join(" AND ")):"")+(r?" ORDER BY "+r:"")}function Ke(t,n,e){if(t.length){var i=0,r=[];t.forEach(function(t){var i="SELECT seq FROM "+Re+" WHERE doc_id=? AND rev=?";e.executeSql(i,[n,t],function(t,n){if(!n.rows.length)return o();var e=n.rows.item(0).seq;r.push(e),t.executeSql("DELETE FROM "+Re+" WHERE seq=?",[e],o)})})}function o(){++i===t.length&&function(){if(!r.length)return;var t="SELECT DISTINCT digest AS digest FROM "+Ne+" WHERE seq IN "+He(r.length);e.executeSql(t,r,function(t,n){for(var e=[],i=0;i<n.rows.length;i++)e.push(n.rows.item(i).digest);if(e.length){var o="DELETE FROM "+Ne+" WHERE seq IN ("+r.map(function(){return"?"}).join(",")+")";t.executeSql(o,r,function(t){var n="SELECT digest FROM "+Ne+" WHERE digest IN ("+e.map(function(){return"?"}).join(",")+")";t.executeSql(n,e,function(t,n){for(var i=new k,r=0;r<n.rows.length;r++)i.add(n.rows.item(r).digest);e.forEach(function(n){i.has(n)||(t.executeSql("DELETE FROM "+Ne+" WHERE digest=?",[n]),t.executeSql("DELETE FROM "+Be+" WHERE digest=?",[n]))})})})}})}()}}function Ge(t){return function(n){J("error","WebSQL threw an error",n);var e=n&&n.constructor.toString().match(/function ([^(]+)/),i=(e&&e[1]||n.type,n.target||n.message);t(ft(at,i))}}function Ze(t,n,e,i,r,o,u){var a,c=e.new_edits,s=n.docs.map(function(t){return t._id&&Jt(t._id)?t:Fn(t,c)}),f=s.filter(function(t){return t.error});if(f.length)return u(f[0]);var l,h=new Array(s.length),d=new A;function v(){if(l)return u(l);o.notify(i._name),u(null,h)}function p(t){var n=[];if(s.forEach(function(t){t.data&&t.data._attachments&&Object.keys(t.data._attachments).forEach(function(e){var i=t.data._attachments[e];i.stub&&n.push(i.digest)})}),!n.length)return t();var e,i=0;n.forEach(function(r){!function(t,n){var e="SELECT count(*) as cnt FROM "+Be+" WHERE digest=?";a.executeSql(e,[t],function(e,i){if(0===i.rows.item(0).cnt){var r=ft(st,"unknown stub attachment with digest "+t);n(r)}else n()})}(r,function(r){r&&!e&&(e=r),++i===n.length&&t(e)})})}function y(t,n,e,r,o,u,c,s){function f(){var n=t.data,e=r?1:0,i=n._id,o=n._rev,u=$e(n),c="INSERT INTO "+Re+" (doc_id, rev, json, deleted) VALUES (?, ?, ?, ?);",s=[i,o,u,e];function f(t,e){var i,r,o,u=0,c=Object.keys(n._attachments||{});if(!c.length)return e();function s(){return++u===c.length&&e(),!1}for(var f=0;f<c.length;f++)i=c[f],r=void 0,o=void 0,r="INSERT INTO "+Ne+" (digest, seq) VALUES (?,?)",o=[n._attachments[i].digest,t],a.executeSql(r,o,s,s)}a.executeSql(c,s,function(t,n){var e=n.insertId;f(e,function(){b(t,e)})},function(){var t=Xe("seq",Re,null,"doc_id=? AND rev=?");return a.executeSql(t,[i,o],function(t,n){var r=n.rows.item(0).seq,a="UPDATE "+Re+" SET json=?, deleted=? WHERE doc_id=? AND rev=?;",c=[u,e,i,o];t.executeSql(a,c,function(t){f(r,function(){b(t,r)})})}),!1})}function l(t){v||(t?s(v=t):p===y.length&&f())}var v=null,p=0;t.data._id=t.metadata.id,t.data._rev=t.metadata.rev;var y=Object.keys(t.data._attachments||{});function g(t){p++,l(t)}function b(e,r){var u=t.metadata.id,a=t.stemmedRevs||[];o&&i.auto_compaction&&(a=St(t.metadata).concat(a)),a.length&&Ke(a,u,e),t.metadata.seq=r;var f=t.metadata.rev;delete t.metadata.rev;var l=o?"UPDATE "+De+" SET json=?, max_seq=?, winningseq=(SELECT seq FROM "+Re+" WHERE doc_id="+De+".id AND rev=?) WHERE id=?":"INSERT INTO "+De+" (id, winningseq, max_seq, json) VALUES (?,?,?,?);",v=fe(t.metadata),p=o?[v,r,n,u]:[u,r,r,v];e.executeSql(l,p,function(){h[c]={ok:!0,id:t.metadata.id,rev:f},d.set(u,t.metadata),s()})}r&&(t.data._deleted=!0),y.forEach(function(e){var i=t.data._attachments[e];if(i.stub)p++,l();else{var r=i.data;delete i.data,i.revpos=parseInt(n,10),function(t,n,e){var i="SELECT digest FROM "+Be+" WHERE digest=?";a.executeSql(i,[t],function(r,o){if(o.rows.length)return e();var u;i="INSERT INTO "+Be+" (digest, body, escaped) VALUES (?,?,1)",r.executeSql(i,[t,(u=n,u.replace(/\u0002/g,"").replace(/\u0001/g,"").replace(/\u0000/g,""))],function(){e()},function(){return e(),!1})})}(i.digest,r,g)}}),y.length||f()}function g(){te(t.revs_limit,s,i,d,a,h,y,e)}In(s,"binary",function(t){if(t)return u(t);r.transaction(function(t){a=t,p(function(t){t?l=t:function(t){if(!s.length)return t();var n=0;function e(){++n===s.length&&t()}s.forEach(function(t){if(t._id&&Jt(t._id))return e();var n=t.metadata.id;a.executeSql("SELECT json FROM "+De+" WHERE id = ?",[n],function(t,i){if(i.rows.length){var r=se(i.rows.item(0).json);d.set(n,r)}e()})})}(g)})},Ge(u),v)})}var Ve=new A;function Ye(t){return t.websql(t.name,t.version,t.description,t.size)}function ze(t){var n=Ve.get(t.name);return n||(n=function(t){try{return{db:Ye(t)}}catch(t){return{error:t}}}(t),Ve.set(t.name,n)),n}var Ie=new $;function Qe(t,n,e,i,r){var o=Object.keys(t._attachments||{});if(!o.length)return r&&r();var u=0;function a(){++u===o.length&&r&&r()}o.forEach(function(r){n.attachments&&n.include_docs?function(t,r){var o=t._attachments[r],u={binary:n.binary,ctx:i};e._getAttachment(t._id,r,o,u,function(n,e){t._attachments[r]=K(j(o,["digest","content_type"]),{data:e}),a()})}(t,r):(t._attachments[r].stub=!0,a())})}var ti=1,ni="CREATE INDEX IF NOT EXISTS 'by-seq-deleted-idx' ON "+Re+" (seq, deleted)",ei="CREATE UNIQUE INDEX IF NOT EXISTS 'by-seq-doc-id-rev' ON "+Re+" (doc_id, rev)",ii="CREATE INDEX IF NOT EXISTS 'doc-winningseq-idx' ON "+De+" (winningseq)",ri="CREATE INDEX IF NOT EXISTS 'attach-seq-seq-idx' ON "+Ne+" (seq)",oi="CREATE UNIQUE INDEX IF NOT EXISTS 'attach-seq-digest-idx' ON "+Ne+" (digest, seq)",ui=Re+".seq = "+De+".winningseq",ai=Re+".seq AS seq, "+Re+".deleted AS deleted, "+Re+".json AS data, "+Re+".rev AS rev, "+De+".json AS metadata";function ci(t,n){var e,i=this,r=null,o=function(t){return"size"in t?1e6*t.size:"undefined"!=typeof navigator&&/Android/.test(navigator.userAgent)?5e6:1}(t),u=[];i._name=t.name;var a=ze(K({},t,{version:ti,description:t.name,size:o}));if(a.error)return Ge(n)(a.error);var c=a.db;function s(){N()&&(window.localStorage["_pouch__websqldb_"+i._name]=!0),n(null,i)}function f(t,n){t.executeSql(ii),t.executeSql("ALTER TABLE "+Re+" ADD COLUMN deleted TINYINT(1) DEFAULT 0",[],function(){t.executeSql(ni),t.executeSql("ALTER TABLE "+De+" ADD COLUMN local TINYINT(1) DEFAULT 0",[],function(){t.executeSql("CREATE INDEX IF NOT EXISTS 'doc-store-local-idx' ON "+De+" (local, id)");var e="SELECT "+De+".winningseq AS seq, "+De+".json AS metadata FROM "+Re+" JOIN "+De+" ON "+Re+".seq = "+De+".winningseq";t.executeSql(e,[],function(t,e){for(var i=[],r=[],o=0;o<e.rows.length;o++){var u=e.rows.item(o),a=u.seq,c=JSON.parse(u.metadata);$t(c)&&i.push(a),Jt(c.id)&&r.push(c.id)}t.executeSql("UPDATE "+De+"SET local = 1 WHERE id IN "+He(r.length),r,function(){t.executeSql("UPDATE "+Re+" SET deleted = 1 WHERE seq IN "+He(i.length),i,n)})})})})}function l(t,n){var e="CREATE TABLE IF NOT EXISTS "+Ce+" (id UNIQUE, rev, json)";t.executeSql(e,[],function(){var e="SELECT "+De+".id AS id, "+Re+".json AS data FROM "+Re+" JOIN "+De+" ON "+Re+".seq = "+De+".winningseq WHERE local = 1";t.executeSql(e,[],function(t,e){for(var i=[],r=0;r<e.rows.length;r++)i.push(e.rows.item(r));!function e(){if(!i.length)return n(t);var r=i.shift(),o=JSON.parse(r.data)._rev;t.executeSql("INSERT INTO "+Ce+" (id, rev, json) VALUES (?,?,?)",[r.id,o,r.data],function(t){t.executeSql("DELETE FROM "+De+" WHERE id=?",[r.id],function(t){t.executeSql("DELETE FROM "+Re+" WHERE seq=?",[r.seq],function(){e()})})})}()})})}function h(t,n){function i(i){!function r(){if(!i.length)return n(t);var o=Fe(i.shift().hex,e),u=o.lastIndexOf("::"),a=o.substring(0,u),c=o.substring(u+2),s="UPDATE "+Re+" SET doc_id=?, rev=? WHERE doc_id_rev=?";t.executeSql(s,[a,c,o],function(){r()})}()}var r="ALTER TABLE "+Re+" ADD COLUMN doc_id";t.executeSql(r,[],function(t){var n="ALTER TABLE "+Re+" ADD COLUMN rev";t.executeSql(n,[],function(t){t.executeSql(ei,[],function(t){var n="SELECT hex(doc_id_rev) as hex FROM "+Re;t.executeSql(n,[],function(t,n){for(var e=[],r=0;r<n.rows.length;r++)e.push(n.rows.item(r));i(e)})})})})}function d(t,n){function e(t){var e="SELECT COUNT(*) AS cnt FROM "+Be;t.executeSql(e,[],function(t,e){if(!e.rows.item(0).cnt)return n(t);var i=0,r=10;!function e(){var o=Xe(ai+", "+De+".id AS id",[De,Re],ui,null,De+".id ");o+=" LIMIT "+r+" OFFSET "+i,i+=r,t.executeSql(o,[],function(t,i){if(!i.rows.length)return n(t);for(var r,o,u,a={},c=0;c<i.rows.length;c++)for(var s=i.rows.item(c),f=Je(s.data,s.id,s.rev),l=Object.keys(f._attachments||{}),h=0;h<l.length;h++){var d=f._attachments[l[h]];r=d.digest,o=s.seq,u=void 0,-1===(u=a[r]=a[r]||[]).indexOf(o)&&u.push(o)}var v=[];if(Object.keys(a).forEach(function(t){a[t].forEach(function(n){v.push([t,n])})}),!v.length)return e();var p=0;v.forEach(function(n){var i="INSERT INTO "+Ne+" (digest, seq) VALUES (?,?)";t.executeSql(i,n,function(){++p===v.length&&e()})})})}()})}var i="CREATE TABLE IF NOT EXISTS "+Ne+" (digest, seq INTEGER)";t.executeSql(i,[],function(t){t.executeSql(oi,[],function(t){t.executeSql(ri,[],e)})})}function v(t,n){var e="ALTER TABLE "+Be+" ADD COLUMN escaped TINYINT(1) DEFAULT 0";t.executeSql(e,[],n)}function p(t,n){var e="ALTER TABLE "+De+" ADD COLUMN max_seq INTEGER";t.executeSql(e,[],function(t){var e="UPDATE "+De+" SET max_seq=(SELECT MAX(seq) FROM "+Re+" WHERE doc_id=id)";t.executeSql(e,[],function(t){var e="CREATE UNIQUE INDEX IF NOT EXISTS 'doc-max-seq-idx' ON "+De+" (max_seq)";t.executeSql(e,[],n)})})}function y(){for(;u.length>0;){u.pop()(null,r)}}function g(t,n){if(0===n){var e="CREATE TABLE IF NOT EXISTS "+We+" (dbid, db_version INTEGER)",i="CREATE TABLE IF NOT EXISTS "+Be+" (digest UNIQUE, escaped TINYINT(1), body BLOB)",o="CREATE TABLE IF NOT EXISTS "+Ne+" (digest, seq INTEGER)",u="CREATE TABLE IF NOT EXISTS "+De+" (id unique, json, winningseq, max_seq INTEGER UNIQUE)",a="CREATE TABLE IF NOT EXISTS "+Re+" (seq INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT, json, deleted TINYINT(1), doc_id, rev)",c="CREATE TABLE IF NOT EXISTS "+Ce+" (id UNIQUE, rev, json)";t.executeSql(i),t.executeSql(c),t.executeSql(o,[],function(){t.executeSql(ri),t.executeSql(oi)}),t.executeSql(u,[],function(){t.executeSql(ii),t.executeSql(a,[],function(){t.executeSql(ni),t.executeSql(ei),t.executeSql(e,[],function(){var n="INSERT INTO "+We+" (db_version, dbid) VALUES (?,?)";r=Lt();var e=[Ue,r];t.executeSql(n,e,function(){y()})})})})}else{var s=[f,l,h,d,v,p,function(){n<Ue&&t.executeSql("UPDATE "+We+" SET db_version = "+Ue);var e="SELECT dbid FROM "+We;t.executeSql(e,[],function(t,n){r=n.rows.item(0).dbid,y()})}],g=n,b=function(t){s[g-1](t,b),g++};b(t)}}function b(t,n){var e="SELECT MAX(seq) AS seq FROM "+Re;t.executeSql(e,[],function(t,e){var i=e.rows.item(0).seq||0;n(i)})}function w(t,n){var e=Xe("COUNT("+De+".id) AS 'num'",[De,Re],ui,Re+".deleted=0");t.executeSql(e,[],function(t,e){n(e.rows.item(0).num)})}"function"!=typeof c.readTransaction&&(c.readTransaction=c.transaction),c.transaction(function(t){!function(t,n){t.executeSql('SELECT HEX("a") AS hex',[],function(t,i){var r=i.rows.item(0).hex;e=2===r.length?"UTF-8":"UTF-16",n()})}(t,function(){!function(t){var n="SELECT sql FROM sqlite_master WHERE tbl_name = "+We;t.executeSql(n,[],function(t,n){n.rows.length?/db_version/.test(n.rows.item(0).sql)?t.executeSql("SELECT db_version FROM "+We,[],function(t,n){var e=n.rows.item(0).db_version;g(t,e)}):t.executeSql("ALTER TABLE "+We+" ADD COLUMN db_version INTEGER",[],function(){g(t,1)}):g(t,0)})}(t)})},Ge(n),s),i._remote=!1,i.type=function(){return"websql"},i._id=M(function(t){t(null,r)}),i._info=function(t){var n,i;c.readTransaction(function(t){b(t,function(t){n=t}),w(t,function(t){i=t})},Ge(t),function(){t(null,{doc_count:i,update_seq:n,websql_encoding:e})})},i._bulkDocs=function(n,e,r){Ze(t,n,e,i,c,Ie,r)},i._get=function(t,n,e){var r,o,u,a,s=n.ctx;if(!s)return c.readTransaction(function(r){i._get(t,K({ctx:r},n),e)});function f(t){e(t,{doc:r,metadata:o,ctx:s})}if(n.rev){if(n.latest)return void function(t,n,e,i,r){var o=Xe(ai,[De,Re],ui,De+".id=?"),u=[n];t.executeSql(o,u,function(t,n){if(!n.rows.length){var o=ft(V,"missing");return r(o)}var u=se(n.rows.item(0).metadata);i(Ht(e,u))})}(s,t,n.rev,function(r){n.latest=!1,n.rev=r,i._get(t,n,e)},f);u=Xe(ai,[De,Re],De+".id="+Re+".doc_id",[Re+".doc_id=?",Re+".rev=?"]),a=[t,n.rev]}else u=Xe(ai,[De,Re],ui,De+".id=?"),a=[t];s.executeSql(u,a,function(t,e){if(!e.rows.length)return f(ft(V,"missing"));var i=e.rows.item(0);if(o=se(i.metadata),i.deleted&&!n.rev)return f(ft(V,"deleted"));r=Je(i.data,o.id,i.rev),f()})},i._allDocs=function(t,n){var e,r,o=[],u="startkey"in t&&t.startkey,a="endkey"in t&&t.endkey,s="key"in t&&t.key,f="keys"in t&&t.keys,l="descending"in t&&t.descending,h="limit"in t?t.limit:-1,d="skip"in t?t.skip:0,v=!1!==t.inclusive_end,p=[],y=[];if(f){var g=[],m="";f.forEach(function(t){-1===g.indexOf(t)&&(g.push(t),m+="?,")}),m=m.substring(0,m.length-1),y.push(De+".id IN ("+m+")"),p=p.concat(g)}else if(!1!==s)y.push(De+".id = ?"),p.push(s);else if(!1!==u||!1!==a){if(!1!==u&&(y.push(De+".id "+(l?"<=":">=")+" ?"),p.push(u)),!1!==a){var _=l?">":"<";v&&(_+="="),y.push(De+".id "+_+" ?"),p.push(a)}!1!==s&&(y.push(De+".id = ?"),p.push(s))}f||y.push(Re+".deleted = 0"),c.readTransaction(function(n){if(w(n,function(t){e=t}),t.update_seq&&b(n,function(t){r=t}),0!==h){var u=Xe(ai,[De,Re],ui,y,De+".id "+(l?"DESC":"ASC"));u+=" LIMIT "+h+" OFFSET "+d,n.executeSql(u,p,function(n,e){for(var r=0,u=e.rows.length;r<u;r++){var a=e.rows.item(r),c=se(a.metadata),s=c.id,l=Je(a.data,s,a.rev),h=l._rev,d={id:s,key:s,value:{rev:h}};if(t.include_docs){if(d.doc=l,d.doc._rev=h,t.conflicts){var v=Pt(c);v.length&&(d.doc._conflicts=v)}Qe(d.doc,t,i,n)}if(a.deleted){if(!f)continue;d.value.deleted=!0,d.doc=null}if(f){var p=f.indexOf(s,p);do{o[p]=d,p=f.indexOf(s,p+1)}while(p>-1&&p<f.length)}else o.push(d)}f&&f.forEach(function(t,n){o[n]||(o[n]={key:t,error:"not_found"})})})}},Ge(n),function(){var i={total_rows:e,offset:t.skip,rows:o};t.update_seq&&(i.update_seq=r),n(null,i)})},i._changes=function(t){if((t=L(t)).continuous){var n=i._name+":"+Lt();return Ie.addListener(i._name,n,i,t),Ie.notify(i._name),{cancel:function(){Ie.removeListener(i._name,n)}}}var e=t.descending;t.since=t.since&&!e?t.since:0;var r,o="limit"in t?t.limit:-1;0===o&&(o=1),r="return_docs"in t?t.return_docs:!("returnDocs"in t)||t.returnDocs;var u=[],a=0;!function(){var n=De+".json AS metadata, "+De+".max_seq AS maxSeq, "+Re+".json AS winningDoc, "+Re+".rev AS winningRev ",s=De+" JOIN "+Re,f=De+".id="+Re+".doc_id AND "+De+".winningseq="+Re+".seq",l=["maxSeq > ?"],h=[t.since];t.doc_ids&&(l.push(De+".id IN "+He(t.doc_ids.length)),h=h.concat(t.doc_ids));var d=Xe(n,s,f,l,"maxSeq "+(e?"DESC":"ASC")),v=ht(t);t.view||t.filter||(d+=" LIMIT "+o);var p=t.since||0;c.readTransaction(function(n){n.executeSql(d,h,function(n,e){function c(n){return function(){t.onChange(n)}}for(var s=0,f=e.rows.length;s<f;s++){var l=e.rows.item(s),h=se(l.metadata);p=l.maxSeq;var d=Je(l.winningDoc,h.id,l.winningRev),y=t.processChange(d,h,t);y.seq=l.maxSeq;var g=v(y);if("object"==typeof g)return t.complete(g);if(g&&(a++,r&&u.push(y),t.attachments&&t.include_docs?Qe(d,t,i,n,c(y)):c(y)()),a===o)break}})},Ge(t.complete),function(){t.continuous||t.complete(null,{results:u,last_seq:p})})}()},i._close=function(t){t()},i._getAttachment=function(t,n,i,r,o){var u,a=r.ctx,c=i.digest,s=i.content_type,f="SELECT escaped, CASE WHEN escaped = 1 THEN body ELSE HEX(body) END AS body FROM "+Be+" WHERE digest=?";a.executeSql(f,[c],function(t,n){var i=n.rows.item(0),a=i.escaped?i.body.replace(/\u0001\u0001/g,"\0").replace(/\u0001\u0002/g,"").replace(/\u0002\u0002/g,""):Fe(i.body,e);u=r.binary?Bn(a,s):Un(a),o(null,u)})},i._getRevisionTree=function(t,n){c.readTransaction(function(e){var i="SELECT json AS metadata FROM "+De+" WHERE id = ?";e.executeSql(i,[t],function(t,e){if(e.rows.length){var i=se(e.rows.item(0).metadata);n(null,i.rev_tree)}else n(ft(V))})})},i._doCompaction=function(t,n,e){if(!n.length)return e();c.transaction(function(e){var i="SELECT json AS metadata FROM "+De+" WHERE id = ?";e.executeSql(i,[t],function(e,i){var r=se(i.rows.item(0).metadata);Mt(r.rev_tree,function(t,e,i,r,o){var u=e+"-"+i;-1!==n.indexOf(u)&&(o.status="missing")});var o="UPDATE "+De+" SET json = ? WHERE id = ?";e.executeSql(o,[fe(r),t])}),Ke(n,t,e)},Ge(e),function(){e()})},i._getLocal=function(t,n){c.readTransaction(function(e){var i="SELECT json, rev FROM "+Ce+" WHERE id=?";e.executeSql(i,[t],function(e,i){if(i.rows.length){var r=i.rows.item(0),o=Je(r.json,t,r.rev);n(null,o)}else n(ft(V))})})},i._putLocal=function(t,n,e){"function"==typeof n&&(e=n,n={}),delete t._revisions;var i,r=t._rev,o=t._id;i=t._rev=r?"0-"+(parseInt(r.split("-")[1],10)+1):"0-1";var u,a=$e(t);function s(t){var c,s;r?(c="UPDATE "+Ce+" SET rev=?, json=? WHERE id=? AND rev=?",s=[i,a,o,r]):(c="INSERT INTO "+Ce+" (id, rev, json) VALUES (?,?,?)",s=[o,i,a]),t.executeSql(c,s,function(t,r){r.rowsAffected?(u={ok:!0,id:o,rev:i},n.ctx&&e(null,u)):e(ft(Y))},function(){return e(ft(Y)),!1})}n.ctx?s(n.ctx):c.transaction(s,Ge(e),function(){u&&e(null,u)})},i._removeLocal=function(t,n,e){var i;function r(r){var o="DELETE FROM "+Ce+" WHERE id=? AND rev=?",u=[t._id,t._rev];r.executeSql(o,u,function(r,o){if(!o.rowsAffected)return e(ft(V));i={ok:!0,id:t._id,rev:"0-0"},n.ctx&&e(null,i)})}"function"==typeof n&&(e=n,n={}),n.ctx?r(n.ctx):c.transaction(r,Ge(e),function(){i&&e(null,i)})},i._destroy=function(t,n){Ie.removeAllListeners(i._name),c.transaction(function(t){[De,Re,Be,We,Ce,Ne].forEach(function(n){t.executeSql("DROP TABLE IF EXISTS "+n,[])})},Ge(n),function(){N()&&(delete window.localStorage["_pouch__websqldb_"+i._name],delete window.localStorage[i._name]),n(null,{ok:!0})})}}function si(){if("undefined"==typeof indexedDB||null===indexedDB||!/iP(hone|od|ad)/.test(navigator.userAgent))return!0;var t=N(),n="_pouch__websqldb_valid_"+navigator.userAgent;if(t&&localStorage[n])return"1"===localStorage[n];var e=function(){try{return openDatabase("_pouch_validate_websql",1,"",1),!0}catch(t){return!1}}();return t&&(localStorage[n]=e?"1":"0"),e}function fi(t,n,e,i){return openDatabase(t,n,e,i)}function li(t,n){J("warn","WebSQL is deprecated and will be removed in future releases of PouchDB. Please migrate to IndexedDB: https://pouchdb.com/2018/01/23/pouchdb-6.4.2.html");var e=K({websql:fi},t);ci.call(this,e,n)}function hi(t,n){var e,i,r,o=new Headers,u={method:t.method,credentials:"include",headers:o};return t.json&&(o.set("Accept","application/json"),o.set("Content-Type",t.headers["Content-Type"]||"application/json")),t.body&&t.processData&&"string"!=typeof t.body?u.body=JSON.stringify(t.body):u.body="body"in t?t.body:null,Object.keys(t.headers).forEach(function(n){t.headers.hasOwnProperty(n)&&o.set(n,t.headers[n])}),e=function(){for(var t={},n=new m(function(n,e){t.resolve=n,t.reject=e}),e=new Array(arguments.length),i=0;i<e.length;i++)e[i]=arguments[i];return t.promise=n,m.resolve().then(function(){return fetch.apply(null,e)}).then(function(n){t.resolve(n)}).catch(function(n){t.reject(n)}),t}(t.url,u),t.timeout>0&&(i=setTimeout(function(){e.reject(new Error("Load timeout for resource: "+t.url))},t.timeout)),e.promise.then(function(n){return r={statusCode:n.status},t.timeout>0&&clearTimeout(i),r.statusCode>=200&&r.statusCode<300?t.binary?n.blob():n.text():n.json()}).then(function(t){r.statusCode>=200&&r.statusCode<300?n(null,r,t):(t.status=r.statusCode,n(t))}).catch(function(t){t||(t=new Error("canceled")),n(t)}),{abort:e.reject}}li.valid=function(){return"function"==typeof openDatabase&&si()},li.use_prefix=!0;var di=function(){try{return new XMLHttpRequest,!0}catch(t){return!1}}();function vi(t,n){return di||t.xhr?function(t,n){var e,i,r=!1,o=function(){r=!0,e.abort(),a()},u={abort:function(){e.abort(),a()}},a=function(){clearTimeout(i),u.abort=function(){},e&&(e.onprogress=void 0,e.upload&&(e.upload.onprogress=void 0),e.onreadystatechange=void 0,e=void 0)};e=t.xhr?new t.xhr:new XMLHttpRequest;try{e.open(t.method,t.url)}catch(t){return n(new Error(t.name||"Url is invalid"))}for(var c in e.withCredentials=!("withCredentials"in t)||t.withCredentials,"GET"===t.method?delete t.headers["Content-Type"]:t.json&&(t.headers.Accept="application/json",t.headers["Content-Type"]=t.headers["Content-Type"]||"application/json",t.body&&t.processData&&"string"!=typeof t.body&&(t.body=JSON.stringify(t.body))),t.binary&&(e.responseType="arraybuffer"),"body"in t||(t.body=null),t.headers)t.headers.hasOwnProperty(c)&&e.setRequestHeader(c,t.headers[c]);return t.timeout>0&&(i=setTimeout(o,t.timeout),e.onprogress=function(){clearTimeout(i),4!==e.readyState&&(i=setTimeout(o,t.timeout))},void 0!==e.upload&&(e.upload.onprogress=e.onprogress)),e.onreadystatechange=function(){if(4===e.readyState){var i={statusCode:e.status};if(e.status>=200&&e.status<300){var o;o=t.binary?Dn([e.response||""],{type:e.getResponseHeader("Content-Type")}):e.responseText,n(null,i,o)}else{var u={};if(r)(u=new Error("ETIMEDOUT")).code="ETIMEDOUT";else if("string"==typeof e.response&&""!==e.response)try{u=JSON.parse(e.response)}catch(t){}u.status=e.status,n(u)}a()}},t.body&&t.body instanceof Blob?Hn(t.body,function(t){e.send(t)}):e.send(t.body),u}(t,n):hi(t,n)}function pi(t,n){t=L(t);return(t=K({method:"GET",headers:{},json:!0,processData:!0,timeout:1e4,cache:!1},t)).json&&(t.binary||(t.headers.Accept="application/json"),t.headers["Content-Type"]=t.headers["Content-Type"]||"application/json"),t.binary&&(t.encoding=null,t.json=!1),t.processData||(t.json=!1),vi(t,function(e,i,r){if(e)return n(lt(e));var o,u=i.headers&&i.headers["content-type"],a=r||"";if(!t.binary&&(t.json||!t.processData)&&"object"!=typeof a&&(/json/.test(u)||/^[\s]*\{/.test(a)&&/\}[\s]*$/.test(a)))try{a=JSON.parse(a.toString())}catch(t){}i.statusCode>=200&&i.statusCode<300?function(n,e,i){if(!t.binary&&t.json&&"string"==typeof n)try{n=JSON.parse(n)}catch(t){return i(t)}Array.isArray(n)&&(n=n.map(function(t){return t.error||t.missing?lt(t):t})),t.binary,i(null,n,e)}(a,i,n):((o=lt(a)).status=i.statusCode,n(o))})}function yi(t,n){var e=navigator&&navigator.userAgent?navigator.userAgent.toLowerCase():"",i=-1!==e.indexOf("safari")&&-1===e.indexOf("chrome"),r=-1!==e.indexOf("msie"),o=-1!==e.indexOf("trident"),u=-1!==e.indexOf("edge"),a=i||(r||o||u)&&"GET"===t.method,c=!("cache"in t)||t.cache;if(!/^blob:/.test(t.url)&&(a||!c)){var s=-1!==t.url.indexOf("?");t.url+=(s?"&":"?")+"_nonce="+Date.now()}return pi(t,n)}var gi=25,bi=50,wi=5e3,mi=1e4,_i={};function ki(t){var n=(t.doc||t.ok)._attachments;n&&Object.keys(n).forEach(function(t){var e=n[t];e.data=Cn(e.data,e.content_type)})}function Ai(t){return/^_design/.test(t)?"_design/"+encodeURIComponent(t.slice(8)):/^_local/.test(t)?"_local/"+encodeURIComponent(t.slice(7)):encodeURIComponent(t)}function xi(t){return t._attachments&&Object.keys(t._attachments)?m.all(Object.keys(t._attachments).map(function(n){var e=t._attachments[n];if(e.data&&"string"!=typeof e.data)return new m(function(t){Jn(e.data,t)}).then(function(t){e.data=t})})):m.resolve()}function Ei(t,n){if(function(t){if(!t.prefix)return!1;var n=kt(t.prefix).protocol;return"http"===n||"https"===n}(n)){var e=n.name.substr(n.prefix.length);t=n.prefix+encodeURIComponent(e)}var i=kt(t);(i.user||i.password)&&(i.auth={username:i.user,password:i.password});var r=i.path.replace(/(^\/|\/$)/g,"").split("/");return i.db=r.pop(),-1===i.db.indexOf("%")&&(i.db=encodeURIComponent(i.db)),i.path=r.join("/"),i}function Li(t,n){return Oi(t,t.db+"/"+n)}function Oi(t,n){var e=t.path?"/":"";return t.protocol+"://"+t.host+(t.port?":"+t.port:"")+"/"+t.path+e+n}function Mi(t){return"?"+Object.keys(t).map(function(n){return n+"="+encodeURIComponent(t[n])}).join("&")}function Ti(t,n){var e,i=this,r=Ei(t.name,t),o=Li(r,""),a=(t=L(t)).ajax||{};if(t.auth||r.auth){var s=t.auth||r.auth,f=s.username+":"+s.password,l=Un(unescape(encodeURIComponent(f)));a.headers=a.headers||{},a.headers.Authorization="Basic "+l}function h(t,n,e){var r=(t||{}).ajax||{},o=K(L(a),r,n),u=L(a.headers||{});return o.headers=K(u,r.headers,n.headers||{}),i.constructor.listeners("debug").length&&i.constructor.emit("debug",["http",o.method,o.url]),i._ajax(o,e)}function d(t,n){return new m(function(e,i){h(t,n,function(t,n){if(t)return i(t);e(n)})})}function v(t,n){return T(t,u()(function(t){p().then(function(){return n.apply(this,t)}).catch(function(n){t.pop()(n)})}))}function p(){return t.skipSetup||t.skip_setup?m.resolve():e||((e=d({},{method:"GET",url:o}).catch(function(t){return t&&t.status&&404===t.status?(X(404,"PouchDB is just detecting if the remote exists."),d({},{method:"PUT",url:o})):m.reject(t)}).catch(function(t){return!(!t||!t.status||412!==t.status)||m.reject(t)})).catch(function(){e=null}),e)}function y(t){return t.split("/").map(encodeURIComponent).join("/")}i._ajax=yi,c()(function(){n(null,i)}),i._remote=!0,i.type=function(){return"http"},i.id=v("id",function(t){h({},{method:"GET",url:Oi(r,"")},function(n,e){var i=e&&e.uuid?e.uuid+r.db:Li(r,"");t(null,i)})}),i.request=v("request",function(t,n){t.url=Li(r,t.url),h({},t,n)}),i.compact=v("compact",function(t,n){"function"==typeof t&&(n=t,t={}),h(t=L(t),{url:Li(r,"_compact"),method:"POST"},function(){!function e(){i.info(function(i,r){r&&!r.compact_running?n(null,{ok:!0}):setTimeout(e,t.interval||200)})}()})}),i.bulkGet=T("bulkGet",function(t,n){var e=this;function i(n){var e={};t.revs&&(e.revs=!0),t.attachments&&(e.attachments=!0),t.latest&&(e.latest=!0),h(t,{url:Li(r,"_bulk_get"+Mi(e)),method:"POST",body:{docs:t.docs}},function(e,i){!e&&t.attachments&&t.binary&&i.results.forEach(function(t){t.docs.forEach(ki)}),n(e,i)})}function o(){var i=bi,r=Math.ceil(t.docs.length/i),o=0,u=new Array(r);function c(t){return function(e,i){u[t]=i.results,++o===r&&n(null,{results:dt(u)})}}for(var s=0;s<r;s++){var f=j(t,["revs","attachments","binary","latest"]);f.ajax=a,f.docs=t.docs.slice(s*i,Math.min(t.docs.length,(s+1)*i)),C(e,f,c(s))}}var u=Oi(r,""),c=_i[u];"boolean"!=typeof c?i(function(t,e){t?(_i[u]=!1,X(t.status,"PouchDB is just detecting if the remote supports the _bulk_get API."),o()):(_i[u]=!0,n(null,e))}):c?i(n):o()}),i._info=function(t){p().then(function(){h({},{method:"GET",url:Li(r,"")},function(n,e){if(n)return t(n);e.host=Li(r,""),t(null,e)})}).catch(t)},i.get=v("get",function(t,n,e){"function"==typeof n&&(e=n,n={});var i={};(n=L(n)).revs&&(i.revs=!0),n.revs_info&&(i.revs_info=!0),n.latest&&(i.latest=!0),n.open_revs&&("all"!==n.open_revs&&(n.open_revs=JSON.stringify(n.open_revs)),i.open_revs=n.open_revs),n.rev&&(i.rev=n.rev),n.conflicts&&(i.conflicts=n.conflicts),n.update_seq&&(i.update_seq=n.update_seq),t=Ai(t);var o={method:"GET",url:Li(r,t+Mi(i))};function u(t){var e=t._attachments,i=e&&Object.keys(e);if(e&&i.length)return function(t,n){return new m(function(e,i){var r,o=0,u=0,a=0,c=t.length;function s(){++a===c?r?i(r):e():h()}function f(){o--,s()}function l(t){o--,r=r||t,s()}function h(){for(;o<n&&u<c;)o++,t[u++]().then(f,l)}h()})}(i.map(function(i){return function(){return function(i){var o=e[i],u=Ai(t._id)+"/"+y(i)+"?rev="+t._rev;return d(n,{method:"GET",url:Li(r,u),binary:!0}).then(function(t){return n.binary?t:new m(function(n){Jn(t,n)})}).then(function(t){delete o.stub,delete o.length,o.data=t})}(i)}}),5)}d(n,o).then(function(t){return m.resolve().then(function(){if(n.attachments)return e=t,Array.isArray(e)?m.all(e.map(function(t){if(t.ok)return u(t.ok)})):u(e);var e}).then(function(){e(null,t)})}).catch(function(n){n.docId=t,e(n)})}),i.remove=v("remove",function(t,n,e,i){var o;"string"==typeof n?(o={_id:t,_rev:n},"function"==typeof e&&(i=e,e={})):(o=t,"function"==typeof n?(i=n,e={}):(i=e,e=n));var u=o._rev||e.rev;h(e,{method:"DELETE",url:Li(r,Ai(o._id))+"?rev="+u},i)}),i.getAttachment=v("getAttachment",function(t,n,e,i){"function"==typeof e&&(i=e,e={});var o=e.rev?"?rev="+e.rev:"";h(e,{method:"GET",url:Li(r,Ai(t))+"/"+y(n)+o,binary:!0},i)}),i.removeAttachment=v("removeAttachment",function(t,n,e,i){h({},{method:"DELETE",url:Li(r,Ai(t)+"/"+y(n))+"?rev="+e},i)}),i.putAttachment=v("putAttachment",function(t,n,e,i,o,u){"function"==typeof o&&(u=o,o=i,i=e,e=null);var c=Ai(t)+"/"+y(n),s=Li(r,c);if(e&&(s+="?rev="+e),"string"==typeof i){var f;try{f=jn(i)}catch(t){return u(ft(nt,"Attachment is not a valid base64 string"))}i=f?Bn(f,o):""}h({},{headers:{"Content-Type":o},method:"PUT",url:s,processData:!1,body:i,timeout:a.timeout||6e4},u)}),i._bulkDocs=function(t,n,e){t.new_edits=n.new_edits,p().then(function(){return m.all(t.docs.map(xi))}).then(function(){h(n,{method:"POST",url:Li(r,"_bulk_docs"),timeout:n.timeout,body:t},function(t,n){if(t)return e(t);n.forEach(function(t){t.ok=!0}),e(null,n)})}).catch(e)},i._put=function(t,n,e){p().then(function(){return xi(t)}).then(function(){h(n,{method:"PUT",url:Li(r,Ai(t._id)),body:t},function(n,i){if(n)return n.docId=t&&t._id,e(n);e(null,i)})}).catch(e)},i.allDocs=v("allDocs",function(t,n){"function"==typeof t&&(n=t,t={});var e,i={},o="GET";(t=L(t)).conflicts&&(i.conflicts=!0),t.update_seq&&(i.update_seq=!0),t.descending&&(i.descending=!0),t.include_docs&&(i.include_docs=!0),t.attachments&&(i.attachments=!0),t.key&&(i.key=JSON.stringify(t.key)),t.start_key&&(t.startkey=t.start_key),t.startkey&&(i.startkey=JSON.stringify(t.startkey)),t.end_key&&(t.endkey=t.end_key),t.endkey&&(i.endkey=JSON.stringify(t.endkey)),void 0!==t.inclusive_end&&(i.inclusive_end=!!t.inclusive_end),void 0!==t.limit&&(i.limit=t.limit),void 0!==t.skip&&(i.skip=t.skip);var u=Mi(i);void 0!==t.keys&&(o="POST",e={keys:t.keys}),d(t,{method:o,url:Li(r,"_all_docs"+u),body:e}).then(function(e){t.include_docs&&t.attachments&&t.binary&&e.rows.forEach(ki),n(null,e)}).catch(n)}),i._changes=function(t){var n="batch_size"in t?t.batch_size:gi;!(t=L(t)).continuous||"heartbeat"in t||(t.heartbeat=mi);var e="timeout"in t?t.timeout:"timeout"in a?a.timeout:3e4;"timeout"in t&&t.timeout&&e-t.timeout<wi&&(e=t.timeout+wi),"heartbeat"in t&&t.heartbeat&&e-t.heartbeat<wi&&(e=t.heartbeat+wi);var i={};"timeout"in t&&t.timeout&&(i.timeout=t.timeout);var o,u=void 0!==t.limit&&t.limit;o="return_docs"in t?t.return_docs:!("returnDocs"in t)||t.returnDocs;var s=u;if(t.style&&(i.style=t.style),(t.include_docs||t.filter&&"function"==typeof t.filter)&&(i.include_docs=!0),t.attachments&&(i.attachments=!0),t.continuous&&(i.feed="longpoll"),t.seq_interval&&(i.seq_interval=t.seq_interval),t.conflicts&&(i.conflicts=!0),t.descending&&(i.descending=!0),t.update_seq&&(i.update_seq=!0),"heartbeat"in t&&t.heartbeat&&(i.heartbeat=t.heartbeat),t.filter&&"string"==typeof t.filter&&(i.filter=t.filter),t.view&&"string"==typeof t.view&&(i.filter="_view",i.view=t.view),t.query_params&&"object"==typeof t.query_params)for(var f in t.query_params)t.query_params.hasOwnProperty(f)&&(i[f]=t.query_params[f]);var l,d,v,y="GET";t.doc_ids?(i.filter="_doc_ids",y="POST",l={doc_ids:t.doc_ids}):t.selector&&(i.filter="_selector",y="POST",l={selector:t.selector});var g=function(o,a){if(!t.aborted){i.since=o,"object"==typeof i.since&&(i.since=JSON.stringify(i.since)),t.descending?u&&(i.limit=s):i.limit=!u||s>n?n:s;var c={method:y,url:Li(r,"_changes"+Mi(i)),timeout:e,body:l};v=o,t.aborted||p().then(function(){d=h(t,c,a)}).catch(a)}},b={results:[]},w=function(e,i){if(!t.aborted){var r=0;if(i&&i.results){r=i.results.length,b.last_seq=i.last_seq;var a=null,f=null;"number"==typeof i.pending&&(a=i.pending),"string"!=typeof b.last_seq&&"number"!=typeof b.last_seq||(f=b.last_seq);t.query_params,i.results=i.results.filter(function(n){s--;var e=ht(t)(n);return e&&(t.include_docs&&t.attachments&&t.binary&&ki(n),o&&b.results.push(n),t.onChange(n,a,f)),e})}else if(e)return t.aborted=!0,void t.complete(e);i&&i.last_seq&&(v=i.last_seq);var l=u&&s<=0||i&&r<n||t.descending;(!t.continuous||u&&s<=0)&&l?t.complete(null,b):c()(function(){g(v,w)})}};return g(t.since||0,w),{cancel:function(){t.aborted=!0,d&&d.abort()}}},i.revsDiff=v("revsDiff",function(t,n,e){"function"==typeof n&&(e=n,n={}),h(n,{method:"POST",url:Li(r,"_revs_diff"),body:t},e)}),i._close=function(t){t()},i._destroy=function(t,n){h(t,{url:Li(r,""),method:"DELETE"},function(t,e){if(t&&t.status&&404!==t.status)return n(t);n(null,e)})}}function qi(t){this.status=400,this.name="query_parse_error",this.message=t,this.error=!0;try{Error.captureStackTrace(this,qi)}catch(t){}}function Pi(t){this.status=404,this.name="not_found",this.message=t,this.error=!0;try{Error.captureStackTrace(this,Pi)}catch(t){}}function Si(t){this.status=500,this.name="invalid_value",this.message=t,this.error=!0;try{Error.captureStackTrace(this,Si)}catch(t){}}function Fi(t,n){return n&&t.then(function(t){c()(function(){n(null,t)})},function(t){c()(function(){n(t)})}),t}function ji(t,n){return function(){var e=arguments,i=this;return t.add(function(){return n.apply(i,e)})}}function Ui(t){var n=new k(t),e=new Array(n.size),i=-1;return n.forEach(function(t){e[++i]=t}),e}function Di(t){var n=new Array(t.size),e=-1;return t.forEach(function(t,i){n[++e]=i}),n}function Ri(t){return new Si("builtin "+t+" function requires map values to be numbers or number arrays")}function Bi(t){for(var n=0,e=0,i=t.length;e<i;e++){var r=t[e];if("number"!=typeof r){if(!Array.isArray(r))throw Ri("_sum");n="number"==typeof n?[n]:n;for(var o=0,u=r.length;o<u;o++){var a=r[o];if("number"!=typeof a)throw Ri("_sum");void 0===n[o]?n.push(a):n[o]+=a}}else"number"==typeof n?n+=r:n[0]+=r}return n}Ti.valid=function(){return!0},l()(qi,Error),l()(Pi,Error),l()(Si,Error);var Ci=J.bind(null,"log"),Wi=Array.isArray,Ni=JSON.parse;function $i(t,n){return At("return ("+t.replace(/;\s*$/,"")+");",{emit:n,sum:Bi,log:Ci,isArray:Wi,toJSON:Ni})}function Ji(){this.promise=new m(function(t){t()})}function Hi(t){if(!t)return"undefined";switch(typeof t){case"function":case"string":return t.toString();default:return JSON.stringify(t)}}function Xi(t,n,e,i,r,o){var u,a=function(t,n){return Hi(t)+Hi(n)+"undefined"}(e,i);if(!r&&(u=t._cachedViews=t._cachedViews||{})[a])return u[a];var c=t.info().then(function(c){var s,f=c.db_name+"-mrview-"+(r?"temp":(s=a,g.a.hash(s)));return xt(t,"_local/"+o,function(t){t.views=t.views||{};var e=n;-1===e.indexOf("/")&&(e=n+"/"+n);var i=t.views[e]=t.views[e]||{};if(!i[f])return i[f]=!0,t}).then(function(){return t.registerDependentDatabase(f).then(function(n){var r=n.db;r.auto_compaction=!0;var o={name:f,db:r,sourceDB:t,adapter:t.adapter,mapFun:e,reduceFun:i};return o.db.get("_local/lastSeq").catch(function(t){if(404!==t.status)throw t}).then(function(t){return o.seq=t?t.seq:0,u&&o.db.once("destroyed",function(){delete u[a]}),o})})})});return u&&(u[a]=c),c}Ji.prototype.add=function(t){return this.promise=this.promise.catch(function(){}).then(function(){return t()}),this.promise},Ji.prototype.finish=function(){return this.promise};var Ki={},Gi=new Ji,Zi=50;function Vi(t){return-1===t.indexOf("/")?[t,t]:t.split("/")}function Yi(t,n){try{t.emit("error",n)}catch(t){J("error","The user's map/reduce function threw an uncaught error.\nYou can debug this error by doing:\nmyDatabase.on('error', function (err) { debugger; });\nPlease double-check your map/reduce function."),J("error",n)}}var zi={_sum:function(t,n){return Bi(n)},_count:function(t,n){return n.length},_stats:function(t,n){return{sum:Bi(n),min:Math.min.apply(null,n),max:Math.max.apply(null,n),count:n.length,sumsqr:function(t){for(var n=0,e=0,i=t.length;e<i;e++){var r=t[e];n+=r*r}return n}(n)}}};var Ii=function(t,n,e,i){function r(t,n,e){try{n(e)}catch(n){Yi(t,n)}}function o(t,n,e,i,r){try{return{output:n(e,i,r)}}catch(n){return Yi(t,n),{error:n}}}function a(t,n){var e=fn(t.key,n.key);return 0!==e?e:fn(t.value,n.value)}function s(t,n,e){return e=e||0,"number"==typeof n?t.slice(e,n+e):e>0?t.slice(e):t}function f(t){var n=t.value;return n&&"object"==typeof n&&n._id||t.id}function l(t){return function(n){return t.include_docs&&t.attachments&&t.binary&&function(t){t.rows.forEach(function(t){var n=t.doc&&t.doc._attachments;n&&Object.keys(n).forEach(function(t){var e=n[t];n[t].data=Cn(e.data,e.content_type)})})}(n),n}}function h(t,n,e,i){var r=n[t];void 0!==r&&(i&&(r=encodeURIComponent(JSON.stringify(r))),e.push(t+"="+r))}function d(t){if(void 0!==t){var n=Number(t);return isNaN(n)||n!==parseInt(t,10)?t:n}}function v(t,n){var e=t.descending?"endkey":"startkey",i=t.descending?"startkey":"endkey";if(void 0!==t[e]&&void 0!==t[i]&&fn(t[e],t[i])>0)throw new qi("No rows can match your key range, reverse your start_key and end_key or set {descending : true}");if(n.reduce&&!1!==t.reduce){if(t.include_docs)throw new qi("{include_docs:true} is invalid for reduce");if(t.keys&&t.keys.length>1&&!t.group&&!t.group_level)throw new qi("Multi-key fetches for reduce views must use {group: true}")}["group_level","limit","skip"].forEach(function(n){var e=function(t){if(t){if("number"!=typeof t)return new qi('Invalid value for integer: "'+t+'"');if(t<0)return new qi('Invalid value for positive integer: "'+t+'"')}}(t[n]);if(e)throw e})}function p(t){return function(n){if(404===n.status)return t;throw n}}function y(t,n,e){var i="_local/doc_"+t,r={_id:i,keys:[]},o=e.get(t),u=o[0];return(function(t){return 1===t.length&&/^1-/.test(t[0].rev)}(o[1])?m.resolve(r):n.db.get(i).catch(p(r))).then(function(t){return function(t){return t.keys.length?n.db.allDocs({keys:t.keys,include_docs:!0}):m.resolve({rows:[]})}(t).then(function(n){return function(t,n){for(var e=[],i=new k,r=0,o=n.rows.length;r<o;r++){var a=n.rows[r].doc;if(a&&(e.push(a),i.add(a._id),a._deleted=!u.has(a._id),!a._deleted)){var c=u.get(a._id);"value"in c&&(a.value=c.value)}}var s=Di(u);return s.forEach(function(t){if(!i.has(t)){var n={_id:t},r=u.get(t);"value"in r&&(n.value=r.value),e.push(n)}}),t.keys=Ui(s.concat(t.keys)),e.push(t),e}(t,n)})})}function g(t){var n="string"==typeof t?t:t.name,e=Ki[n];return e||(e=Ki[n]=new Ji),e}function b(t){return ji(g(t),function(){return function(t){var e,i,o=n(t.mapFun,function(t,n){var r={id:i._id,key:ln(t)};null!=n&&(r.value=ln(n)),e.push(r)}),u=t.seq||0;function c(n,e){return function(){return function(t,n,e){return t.db.get("_local/lastSeq").catch(p({_id:"_local/lastSeq",seq:0})).then(function(i){var r=Di(n);return m.all(r.map(function(e){return y(e,t,n)})).then(function(n){var r=dt(n);return i.seq=e,r.push(i),t.db.bulkDocs({docs:r})})})}(t,n,e)}}var s=new Ji;function f(){return t.sourceDB.changes({conflicts:!0,include_docs:!0,style:"all_docs",since:u,limit:Zi}).then(l)}function l(n){var l=n.results;if(l.length){var d=function(n){for(var c=new A,s=0,f=n.length;s<f;s++){var l=n[s];if("_"!==l.doc._id[0]){e=[],(i=l.doc)._deleted||r(t.sourceDB,o,i),e.sort(a);var d=h(e);c.set(l.doc._id,[d,l.changes])}u=l.seq}return c}(l);if(s.add(c(d,u)),!(l.length<Zi))return f()}}function h(t){for(var n,e=new A,i=0,r=t.length;i<r;i++){var o=t[i],u=[o.key,o.id];i>0&&0===fn(o.key,n)&&u.push(i),e.set(dn(u),o),n=o.key}return e}return f().then(function(){return s.finish()}).then(function(){t.seq=u})}(t)})()}function w(t,n){return ji(g(t),function(){return function(t,n){var i,r=t.reduceFun&&!1!==n.reduce,u=n.skip||0;function a(n){return n.include_docs=!0,t.db.allDocs(n).then(function(t){return i=t.total_rows,t.rows.map(function(t){if("value"in t.doc&&"object"==typeof t.doc.value&&null!==t.doc.value){var n=Object.keys(t.doc.value).sort(),e=["id","key","value"];if(!(n<e||n>e))return t.doc.value}var i=function(t){for(var n=[],e=[],i=0;;){var r=t[i++];if("\0"!==r)switch(r){case"1":n.push(null);break;case"2":n.push("1"===t[i]),i++;break;case"3":var o=vn(t,i);n.push(o.num),i+=o.length;break;case"4":for(var u="";;){var a=t[i];if("\0"===a)break;u+=a,i++}u=u.replace(/\u0001\u0001/g,"\0").replace(/\u0001\u0002/g,"").replace(/\u0002\u0002/g,""),n.push(u);break;case"5":var c={element:[],index:n.length};n.push(c.element),e.push(c);break;case"6":var s={element:{},index:n.length};n.push(s.element),e.push(s);break;default:throw new Error("bad collationIndex or unexpectedly reached end of input: "+r)}else{if(1===n.length)return n.pop();pn(n,e)}}}(t.doc._id);return{key:i[0],id:i[1],value:"value"in t.doc?t.doc.value:null}})})}function c(a){var c;if(c=r?function(t,n,i){0===i.group_level&&delete i.group_level;var r=i.group||i.group_level,u=e(t.reduceFun),a=[],c=isNaN(i.group_level)?Number.POSITIVE_INFINITY:i.group_level;n.forEach(function(t){var n=a[a.length-1],e=r?t.key:null;if(r&&Array.isArray(e)&&(e=e.slice(0,c)),n&&0===fn(n.groupKey,e))return n.keys.push([t.key,t.id]),void n.values.push(t.value);a.push({keys:[[t.key,t.id]],values:[t.value],groupKey:e})}),n=[];for(var f=0,l=a.length;f<l;f++){var h=a[f],d=o(t.sourceDB,u,h.keys,h.values,!1);if(d.error&&d.error instanceof Si)throw d.error;n.push({value:d.error?null:d.output,key:h.groupKey})}return{rows:s(n,i.limit,i.skip)}}(t,a,n):{total_rows:i,offset:u,rows:a},n.update_seq&&(c.update_seq=t.seq),n.include_docs){var l=Ui(a.map(f));return t.sourceDB.allDocs({keys:l,include_docs:!0,conflicts:n.conflicts,attachments:n.attachments,binary:n.binary}).then(function(t){var n=new A;return t.rows.forEach(function(t){n.set(t.id,t.doc)}),a.forEach(function(t){var e=f(t),i=n.get(e);i&&(t.doc=i)}),c})}return c}if(void 0===n.keys||n.keys.length||(n.limit=0,delete n.keys),void 0!==n.keys){var l=n.keys,h=l.map(function(t){var e={startkey:dn([t]),endkey:dn([t,{}])};return n.update_seq&&(e.update_seq=!0),a(e)});return m.all(h).then(dt).then(c)}var d,v,p={descending:n.descending};if(n.update_seq&&(p.update_seq=!0),"start_key"in n&&(d=n.start_key),"startkey"in n&&(d=n.startkey),"end_key"in n&&(v=n.end_key),"endkey"in n&&(v=n.endkey),void 0!==d&&(p.startkey=n.descending?dn([d,{}]):dn([d])),void 0!==v){var y=!1!==n.inclusive_end;n.descending&&(y=!y),p.endkey=dn(y?[v,{}]:[v])}if(void 0!==n.key){var g=dn([n.key]),b=dn([n.key,{}]);p.descending?(p.endkey=g,p.startkey=b):(p.startkey=g,p.endkey=b)}return r||("number"==typeof n.limit&&(p.limit=n.limit),p.skip=u),a(p).then(c)}(t,n)})()}function _(n,e,r){if("function"==typeof n._query)return function(t,n,e){return new m(function(i,r){t._query(n,e,function(t,n){if(t)return r(t);i(n)})})}(n,e,r);if(pt(n))return function(t,n,e){var i,r=[],o="GET";if(h("reduce",e,r),h("include_docs",e,r),h("attachments",e,r),h("limit",e,r),h("descending",e,r),h("group",e,r),h("group_level",e,r),h("skip",e,r),h("stale",e,r),h("conflicts",e,r),h("startkey",e,r,!0),h("start_key",e,r,!0),h("endkey",e,r,!0),h("end_key",e,r,!0),h("inclusive_end",e,r),h("key",e,r,!0),h("update_seq",e,r),r=""===(r=r.join("&"))?"":"?"+r,void 0!==e.keys){var u="keys="+encodeURIComponent(JSON.stringify(e.keys));u.length+r.length+1<=2e3?r+=("?"===r[0]?"&":"?")+u:(o="POST","string"==typeof n?i={keys:e.keys}:n.keys=e.keys)}if("string"==typeof n){var a=Vi(n);return t.request({method:o,url:"_design/"+a[0]+"/_view/"+a[1]+r,body:i}).then(function(t){return t.rows.forEach(function(t){if(t.value&&t.value.error&&"builtin_reduce_error"===t.value.error)throw new Error(t.reason)}),t}).then(l(e))}return i=i||{},Object.keys(n).forEach(function(t){Array.isArray(n[t])?i[t]=n[t]:i[t]=n[t].toString()}),t.request({method:"POST",url:"_temp_view"+r,body:i}).then(l(e))}(n,e,r);if("string"!=typeof e)return v(r,e),Gi.add(function(){return Xi(n,"temp_view/temp_view",e.map,e.reduce,!0,t).then(function(t){return n=b(t).then(function(){return w(t,r)}),e=function(){return t.db.destroy()},n.then(function(t){return e().then(function(){return t})},function(t){return e().then(function(){throw t})});var n,e})}),Gi.finish();var o=e,u=Vi(o),a=u[0],s=u[1];return n.get("_design/"+a).then(function(e){var u=e.views&&e.views[s];if(!u)throw new Pi("ddoc "+e._id+" has no view named "+s);return i(e,s),v(r,u),Xi(n,o,u.map,u.reduce,!1,t).then(function(t){return"ok"===r.stale||"update_after"===r.stale?("update_after"===r.stale&&c()(function(){b(t)}),w(t,r)):b(t).then(function(){return w(t,r)})})})}var x;return{query:function(t,n,e){var i=this;"function"==typeof n&&(e=n,n={}),n=n?function(t){return t.group_level=d(t.group_level),t.limit=d(t.limit),t.skip=d(t.skip),t}(n):{},"function"==typeof t&&(t={map:t});var r=m.resolve().then(function(){return _(i,t,n)});return Fi(r,e),r},viewCleanup:(x=function(){var n=this;return"function"==typeof n._viewCleanup?function(t){return new m(function(n,e){t._viewCleanup(function(t,i){if(t)return e(t);n(i)})})}(n):pt(n)?function(t){return t.request({method:"POST",url:"_view_cleanup"})}(n):function(n){return n.get("_local/"+t).then(function(t){var e=new A;Object.keys(t.views).forEach(function(t){var n=Vi(t),i="_design/"+n[0],r=n[1],o=e.get(i);o||(o=new k,e.set(i,o)),o.add(r)});var i={keys:Di(e),include_docs:!0};return n.allDocs(i).then(function(i){var r={};i.rows.forEach(function(n){var i=n.key.substring(8);e.get(n.key).forEach(function(e){var o=i+"/"+e;t.views[o]||(o=e);var u=Object.keys(t.views[o]),a=n.doc&&n.doc.views&&n.doc.views[e];u.forEach(function(t){r[t]=r[t]||a})})});var o=Object.keys(r).filter(function(t){return!r[t]}).map(function(t){return ji(g(t),function(){return new n.constructor(t,n.__opts).destroy()})()});return m.all(o).then(function(){return{ok:!0}})})},p({ok:!0}))}(n)},u()(function(t){var n=t.pop(),e=x.apply(this,t);return"function"==typeof n&&Fi(e,n),e}))}}("mrviews",function(t,n){if("function"==typeof t&&2===t.length){var e=t;return function(t){return e(t,n)}}return $i(t.toString(),n)},function(t){var n=t.toString(),e=function(t){if(/^_sum/.test(t))return zi._sum;if(/^_count/.test(t))return zi._count;if(/^_stats/.test(t))return zi._stats;if(/^_/.test(t))throw new Error(t+" is not a supported reduce function.")}(n);return e||$i(n)},function(t,n){var e=t.views&&t.views[n];if("string"!=typeof e.map)throw new Pi("ddoc "+t._id+" has no string view named "+n+", instead found object of type: "+typeof e.map)});var Qi={query:function(t,n,e){return Ii.query.call(this,t,n,e)},viewCleanup:function(t){return Ii.viewCleanup.call(this,t)}};function tr(t){return/^1-/.test(t)}function nr(t,n){var e=Object.keys(n._attachments);return m.all(e.map(function(e){return t.getAttachment(n._id,e,{rev:n._rev})}))}function er(t,n,e,i){e=L(e);var r=[],o=!0;function u(n){return t.allDocs({keys:n,include_docs:!0,conflicts:!0}).then(function(t){if(i.cancelled)throw new Error("cancelled");t.rows.forEach(function(t){var n;t.deleted||!t.doc||!tr(t.value.rev)||(n=t.doc,n._attachments&&Object.keys(n._attachments).length>0)||function(t){return t._conflicts&&t._conflicts.length>0}(t.doc)||(t.doc._conflicts&&delete t.doc._conflicts,r.push(t.doc),delete e[t.id])})})}return m.resolve().then(function(){var t=Object.keys(e).filter(function(t){var n=e[t].missing;return 1===n.length&&tr(n[0])});if(t.length>0)return u(t)}).then(function(){var u=function(t){var n=[];return Object.keys(t).forEach(function(e){t[e].missing.forEach(function(t){n.push({id:e,rev:t})})}),{docs:n,revs:!0,latest:!0}}(e);if(u.docs.length)return t.bulkGet(u).then(function(e){if(i.cancelled)throw new Error("cancelled");return m.all(e.results.map(function(e){return m.all(e.docs.map(function(e){var i=e.ok;return e.error&&(o=!1),i&&i._attachments?function(t,n,e){var i=pt(n)&&!pt(t),r=Object.keys(e._attachments);return i?t.get(e._id).then(function(i){return m.all(r.map(function(r){return function(t,n,e){return!t._attachments||!t._attachments[e]||t._attachments[e].digest!==n._attachments[e].digest}(i,e,r)?n.getAttachment(e._id,r):t.getAttachment(i._id,r)}))}).catch(function(t){if(404!==t.status)throw t;return nr(n,e)}):nr(n,e)}(n,t,i).then(function(t){var n=Object.keys(i._attachments);return t.forEach(function(t,e){var r=i._attachments[n[e]];delete r.stub,delete r.length,r.data=t}),i}):i}))})).then(function(t){r=r.concat(dt(t).filter(Boolean))})})}).then(function(){return{ok:o,docs:r}})}var ir=1,rr="pouchdb",or=5,ur=0;function ar(t,n,e,i,r){return t.get(n).catch(function(e){if(404===e.status)return"http"!==t.adapter&&"https"!==t.adapter||X(404,"PouchDB is just checking if a remote checkpoint exists."),{session_id:i,_id:n,history:[],replicator:rr,version:ir};throw e}).then(function(o){if(!r.cancelled&&o.last_seq!==e)return o.history=(o.history||[]).filter(function(t){return t.session_id!==i}),o.history.unshift({last_seq:e,session_id:i}),o.history=o.history.slice(0,or),o.version=ir,o.replicator=rr,o.session_id=i,o.last_seq=e,t.put(o).catch(function(o){if(409===o.status)return ar(t,n,e,i,r);throw o})})}function cr(t,n,e,i,r){this.src=t,this.target=n,this.id=e,this.returnValue=i,this.opts=r||{}}cr.prototype.writeCheckpoint=function(t,n){var e=this;return this.updateTarget(t,n).then(function(){return e.updateSource(t,n)})},cr.prototype.updateTarget=function(t,n){return this.opts.writeTargetCheckpoint?ar(this.target,this.id,t,n,this.returnValue):m.resolve(!0)},cr.prototype.updateSource=function(t,n){if(this.opts.writeSourceCheckpoint){var e=this;return ar(this.src,this.id,t,n,this.returnValue).catch(function(t){if(lr(t))return e.opts.writeSourceCheckpoint=!1,!0;throw t})}return m.resolve(!0)};var sr={undefined:function(t,n){return 0===fn(t.last_seq,n.last_seq)?n.last_seq:0},1:function(t,n){return function(t,n){if(t.session_id===n.session_id)return{last_seq:t.last_seq,history:t.history};return function t(n,e){var i=n[0];var r=n.slice(1);var o=e[0];var u=e.slice(1);if(!i||0===e.length)return{last_seq:ur,history:[]};var a=i.session_id;if(fr(a,e))return{last_seq:i.last_seq,history:n};var c=o.session_id;if(fr(c,r))return{last_seq:o.last_seq,history:u};return t(r,u)}(t.history,n.history)}(n,t).last_seq}};function fr(t,n){var e=n[0],i=n.slice(1);return!(!t||0===n.length)&&(t===e.session_id||fr(t,i))}function lr(t){return"number"==typeof t.status&&4===Math.floor(t.status/100)}cr.prototype.getCheckpoint=function(){var t=this;return t.opts&&t.opts.writeSourceCheckpoint&&!t.opts.writeTargetCheckpoint?t.src.get(t.id).then(function(t){return t.last_seq||ur}).catch(function(t){if(404!==t.status)throw t;return ur}):t.target.get(t.id).then(function(n){return t.opts&&t.opts.writeTargetCheckpoint&&!t.opts.writeSourceCheckpoint?n.last_seq||ur:t.src.get(t.id).then(function(t){return n.version!==t.version?ur:(e=n.version?n.version.toString():"undefined")in sr?sr[e](n,t):ur;var e},function(e){if(404===e.status&&n.last_seq)return t.src.put({_id:t.id,last_seq:ur}).then(function(){return ur},function(e){return lr(e)?(t.opts.writeSourceCheckpoint=!1,n.last_seq):ur});throw e})}).catch(function(t){if(404!==t.status)throw t;return ur})};var hr=0;function dr(t,n,e){var i=e.doc_ids?e.doc_ids.sort(fn):"",r=e.filter?e.filter.toString():"",o="",u="",a="";return e.selector&&(a=JSON.stringify(e.selector)),e.filter&&e.query_params&&(o=JSON.stringify(function(t){return Object.keys(t).sort(fn).reduce(function(n,e){return n[e]=t[e],n},{})}(e.query_params))),e.filter&&"_view"===e.filter&&(u=e.view.toString()),m.all([t.id(),n.id()]).then(function(t){var n=t[0]+t[1]+r+u+o+i+a;return new m(function(t){Vn(n,t)})}).then(function(t){return"_local/"+(t=t.replace(/\//g,".").replace(/\+/g,"_"))})}function vr(t,n,e,i,r){var o,u,a,c=[],s={seq:0,changes:[],docs:[]},f=!1,l=!1,h=!1,d=0,v=e.continuous||e.live||!1,p=e.batch_size||100,y=e.batches_limit||10,g=!1,b=e.doc_ids,w=e.selector,_=[],k=Lt(),A=e.seq_interval;r=r||{ok:!0,start_time:new Date,docs_read:0,docs_written:0,doc_write_failures:0,errors:[]};var x={};function E(){return a?m.resolve():dr(t,n,e).then(function(r){u=r;var o={};o=!1===e.checkpoint?{writeSourceCheckpoint:!1,writeTargetCheckpoint:!1}:"source"===e.checkpoint?{writeSourceCheckpoint:!0,writeTargetCheckpoint:!1}:"target"===e.checkpoint?{writeSourceCheckpoint:!1,writeTargetCheckpoint:!0}:{writeSourceCheckpoint:!0,writeTargetCheckpoint:!0},a=new cr(t,n,u,i,o)})}function O(){if(_=[],0!==o.docs.length){var t=o.docs,u={timeout:e.timeout};return n.bulkDocs({docs:t,new_edits:!1},u).then(function(n){if(i.cancelled)throw F(),new Error("cancelled");var e=Object.create(null);n.forEach(function(t){t.error&&(e[t.id]=t)});var o=Object.keys(e).length;r.doc_write_failures+=o,r.docs_written+=t.length-o,t.forEach(function(t){var n=e[t._id];if(n){r.errors.push(n);var o=(n.name||"").toLowerCase();if("unauthorized"!==o&&"forbidden"!==o)throw n;i.emit("denied",L(n))}else _.push(t)})},function(n){throw r.doc_write_failures+=t.length,n})}}function M(){if(o.error)throw new Error("There was a problem getting docs.");r.last_seq=d=o.seq;var t=L(r);return _.length&&(t.docs=_,"number"==typeof o.pending&&(t.pending=o.pending,delete o.pending),i.emit("change",t)),f=!0,a.writeCheckpoint(o.seq,k).then(function(){if(f=!1,i.cancelled)throw F(),new Error("cancelled");o=void 0,R()}).catch(function(t){throw C(t),t})}function T(){return er(t,n,o.diffs,i).then(function(t){o.error=!t.ok,t.docs.forEach(function(t){delete o.diffs[t._id],r.docs_read++,o.docs.push(t)})})}function q(){var t;i.cancelled||o||(0!==c.length?(o=c.shift(),(t={},o.changes.forEach(function(n){"_user/"!==n.id&&(t[n.id]=n.changes.map(function(t){return t.rev}))}),n.revsDiff(t).then(function(t){if(i.cancelled)throw F(),new Error("cancelled");o.diffs=t})).then(T).then(O).then(M).then(q).catch(function(t){S("batch processing terminated with error",t)})):P(!0))}function P(t){0!==s.changes.length?(t||l||s.changes.length>=p)&&(c.push(s),s={seq:0,changes:[],docs:[]},"pending"!==i.state&&"stopped"!==i.state||(i.state="active",i.emit("active")),q()):0!==c.length||o||((v&&x.live||l)&&(i.state="pending",i.emit("paused")),l&&F())}function S(t,n){h||(n.message||(n.message=t),r.ok=!1,r.status="aborting",c=[],s={seq:0,changes:[],docs:[]},F(n))}function F(o){if(!(h||i.cancelled&&(r.status="cancelled",f)))if(r.status=r.status||"complete",r.end_time=new Date,r.last_seq=d,h=!0,o){(o=ft(o)).result=r;var u=(o.name||"").toLowerCase();"unauthorized"===u||"forbidden"===u?(i.emit("error",o),i.removeAllListeners()):function(t,n,e,i){if(!1===t.retry)return n.emit("error",e),void n.removeAllListeners();if("function"!=typeof t.back_off_function&&(t.back_off_function=H),n.emit("requestError",e),"active"===n.state||"pending"===n.state){n.emit("paused",e),n.state="stopped";var r=function(){t.current_back_off=hr};n.once("paused",function(){n.removeListener("active",r)}),n.once("active",r)}t.current_back_off=t.current_back_off||hr,t.current_back_off=t.back_off_function(t.current_back_off),setTimeout(i,t.current_back_off)}(e,i,o,function(){vr(t,n,e,i)})}else i.emit("complete",r),i.removeAllListeners()}function j(t,n,r){if(i.cancelled)return F();"number"==typeof n&&(s.pending=n),ht(e)(t)&&(s.seq=t.seq||r,s.changes.push(t),P(0===c.length&&x.live))}function U(t){if(g=!1,i.cancelled)return F();if(t.results.length>0)x.since=t.last_seq,R(),P(!0);else{var n=function(){v?(x.live=!0,R()):l=!0,P(!0)};o||0!==t.results.length?n():(f=!0,a.writeCheckpoint(t.last_seq,k).then(function(){f=!1,r.last_seq=d=t.last_seq,n()}).catch(C))}}function D(t){if(g=!1,i.cancelled)return F();S("changes rejected",t)}function R(){if(!g&&!l&&c.length<y){g=!0,i._changes&&(i.removeListener("cancel",i._abortChanges),i._changes.cancel()),i.once("cancel",r);var n=t.changes(x).on("change",j);n.then(o,o),n.then(U).catch(D),e.retry&&(i._changes=n,i._abortChanges=r)}function r(){n.cancel()}function o(){i.removeListener("cancel",r)}}function B(){E().then(function(){if(!i.cancelled)return a.getCheckpoint().then(function(t){x={since:d=t,limit:p,batch_size:p,style:"all_docs",doc_ids:b,selector:w,return_docs:!0},!1!==A&&(x.seq_interval=A||p),e.filter&&("string"!=typeof e.filter?x.include_docs=!0:x.filter=e.filter),"heartbeat"in e&&(x.heartbeat=e.heartbeat),"timeout"in e&&(x.timeout=e.timeout),e.query_params&&(x.query_params=e.query_params),e.view&&(x.view=e.view),R()});F()}).catch(function(t){S("getCheckpoint rejected with ",t)})}function C(t){f=!1,S("writeCheckpoint completed with error",t)}i.ready(t,n),i.cancelled?F():(i._addedListeners||(i.once("cancel",F),"function"==typeof e.complete&&(i.once("error",e.complete),i.once("complete",function(t){e.complete(null,t)})),i._addedListeners=!0),void 0===e.since?B():E().then(function(){return f=!0,a.writeCheckpoint(e.since,k)}).then(function(){f=!1,i.cancelled?F():(d=e.since,B())}).catch(C))}function pr(){s.EventEmitter.call(this),this.cancelled=!1,this.state="pending";var t=this,n=new m(function(n,e){t.once("complete",n),t.once("error",e)});t.then=function(t,e){return n.then(t,e)},t.catch=function(t){return n.catch(t)},t.catch(function(){})}function yr(t,n){var e=n.PouchConstructor;return"string"==typeof t?new e(t,n):t}function gr(t,n,e,i){if("function"==typeof e&&(i=e,e={}),void 0===e&&(e={}),e.doc_ids&&!Array.isArray(e.doc_ids))throw ft(rt,"`doc_ids` filter parameter is not a list.");e.complete=i,(e=L(e)).continuous=e.continuous||e.live,e.retry="retry"in e&&e.retry,e.PouchConstructor=e.PouchConstructor||this;var r=new pr(e);return vr(yr(t,e),yr(n,e),e,r),r}function br(t,n,e,i){return"function"==typeof e&&(i=e,e={}),void 0===e&&(e={}),(e=L(e)).PouchConstructor=e.PouchConstructor||this,new wr(t=yr(t,e),n=yr(n,e),e,i)}function wr(t,n,e,i){var r=this;this.canceled=!1;var o=e.push?K({},e,e.push):e,u=e.pull?K({},e,e.pull):e;function a(t){r.emit("change",{direction:"pull",change:t})}function c(t){r.emit("change",{direction:"push",change:t})}function s(t){r.emit("denied",{direction:"push",doc:t})}function f(t){r.emit("denied",{direction:"pull",doc:t})}function l(){r.pushPaused=!0,r.pullPaused&&r.emit("paused")}function h(){r.pullPaused=!0,r.pushPaused&&r.emit("paused")}function d(){r.pushPaused=!1,r.pullPaused&&r.emit("active",{direction:"push"})}function v(){r.pullPaused=!1,r.pushPaused&&r.emit("active",{direction:"pull"})}this.push=gr(t,n,o),this.pull=gr(n,t,u),this.pushPaused=!0,this.pullPaused=!0;var p={};function y(t){return function(n,e){("change"===n&&(e===a||e===c)||"denied"===n&&(e===f||e===s)||"paused"===n&&(e===h||e===l)||"active"===n&&(e===v||e===d))&&(n in p||(p[n]={}),p[n][t]=!0,2===Object.keys(p[n]).length&&r.removeAllListeners(n))}}function g(t,n,e){-1==t.listeners(n).indexOf(e)&&t.on(n,e)}e.live&&(this.push.on("complete",r.pull.cancel.bind(r.pull)),this.pull.on("complete",r.push.cancel.bind(r.push))),this.on("newListener",function(t){"change"===t?(g(r.pull,"change",a),g(r.push,"change",c)):"denied"===t?(g(r.pull,"denied",f),g(r.push,"denied",s)):"active"===t?(g(r.pull,"active",v),g(r.push,"active",d)):"paused"===t&&(g(r.pull,"paused",h),g(r.push,"paused",l))}),this.on("removeListener",function(t){"change"===t?(r.pull.removeListener("change",a),r.push.removeListener("change",c)):"denied"===t?(r.pull.removeListener("denied",f),r.push.removeListener("denied",s)):"active"===t?(r.pull.removeListener("active",v),r.push.removeListener("active",d)):"paused"===t&&(r.pull.removeListener("paused",h),r.push.removeListener("paused",l))}),this.pull.on("removeListener",y("pull")),this.push.on("removeListener",y("push"));var b=m.all([this.push,this.pull]).then(function(t){var n={push:t[0],pull:t[1]};return r.emit("complete",n),i&&i(null,n),r.removeAllListeners(),n},function(t){if(r.cancel(),i?i(t):r.emit("error",t),r.removeAllListeners(),i)throw t});this.then=function(t,n){return b.then(t,n)},this.catch=function(t){return b.catch(t)}}l()(pr,s.EventEmitter),pr.prototype.cancel=function(){this.cancelled=!0,this.state="cancelled",this.emit("cancel")},pr.prototype.ready=function(t,n){var e=this;function i(){e.cancel()}e._readyCalled||(e._readyCalled=!0,t.once("destroyed",i),n.once("destroyed",i),e.once("complete",function(){t.removeListener("destroyed",i),n.removeListener("destroyed",i)}))},l()(wr,s.EventEmitter),wr.prototype.cancel=function(){this.canceled||(this.canceled=!0,this.push.cancel(),this.pull.cancel())},It.plugin(function(t){t.adapter("idb",Pe,!0)}).plugin(function(t){t.adapter("websql",li,!0)}).plugin(function(t){t.adapter("http",Ti,!1),t.adapter("https",Ti,!1)}).plugin(Qi).plugin(function(t){t.replicate=gr,t.sync=br,Object.defineProperty(t.prototype,"replicate",{get:function(){var t=this;return void 0===this.replicateMethods&&(this.replicateMethods={from:function(n,e,i){return t.constructor.replicate(n,t,e,i)},to:function(n,e,i){return t.constructor.replicate(t,n,e,i)}}),this.replicateMethods}}),t.prototype.sync=function(t,n,e){return this.constructor.sync(this,t,n,e)}}),n.a=It}).call(this,e(13))},function(t,n,e){var i=e(31),r=e(32),o=r;o.v1=i,o.v4=r,t.exports=o},function(t,n,e){(function(i){function r(){var t;try{t=n.storage.debug}catch(t){}return!t&&void 0!==i&&"env"in i&&(t=i.env.DEBUG),t}(n=t.exports=e(34)).log=function(){return"object"==typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)},n.formatArgs=function(t){var e=this.useColors;if(t[0]=(e?"%c":"")+this.namespace+(e?" %c":" ")+t[0]+(e?"%c ":" ")+"+"+n.humanize(this.diff),!e)return;var i="color: "+this.color;t.splice(1,0,i,"color: inherit");var r=0,o=0;t[0].replace(/%[a-zA-Z%]/g,function(t){"%%"!==t&&(r++,"%c"===t&&(o=r))}),t.splice(o,0,i)},n.save=function(t){try{null==t?n.storage.removeItem("debug"):n.storage.debug=t}catch(t){}},n.load=r,n.useColors=function(){if("undefined"!=typeof window&&window.process&&"renderer"===window.process.type)return!0;if("undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;return"undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},n.storage="undefined"!=typeof chrome&&void 0!==chrome.storage?chrome.storage.local:function(){try{return window.localStorage}catch(t){}}(),n.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],n.formatters.j=function(t){try{return JSON.stringify(t)}catch(t){return"[UnexpectedJSONParseError]: "+t.message}},n.enable(r())}).call(this,e(33))},function(t,n,e){"use strict";function i(t,n,e){var i=e[e.length-1];t===i.element&&(e.pop(),i=e[e.length-1]);var r=i.element,o=i.index;if(Array.isArray(r))r.push(t);else if(o===n.length-2){r[n.pop()]=t}else n.push(t)}n.stringify=function(t){var n=[];n.push({obj:t});for(var e,i,r,o,u,a,c,s,f,l,h="";e=n.pop();)if(i=e.obj,h+=e.prefix||"",r=e.val||"")h+=r;else if("object"!=typeof i)h+=void 0===i?null:JSON.stringify(i);else if(null===i)h+="null";else if(Array.isArray(i)){for(n.push({val:"]"}),o=i.length-1;o>=0;o--)u=0===o?"":",",n.push({obj:i[o],prefix:u});n.push({val:"["})}else{for(c in a=[],i)i.hasOwnProperty(c)&&a.push(c);for(n.push({val:"}"}),o=a.length-1;o>=0;o--)f=i[s=a[o]],l=o>0?",":"",l+=JSON.stringify(s)+":",n.push({obj:f,prefix:l});n.push({val:"{"})}return h},n.parse=function(t){for(var n,e,r,o,u,a,c,s,f,l=[],h=[],d=0;;)if("}"!==(n=t[d++])&&"]"!==n&&void 0!==n)switch(n){case" ":case"\t":case"\n":case":":case",":break;case"n":d+=3,i(null,l,h);break;case"t":d+=3,i(!0,l,h);break;case"f":d+=4,i(!1,l,h);break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":case"-":for(e="",d--;;){if(r=t[d++],!/[\d\.\-e\+]/.test(r)){d--;break}e+=r}i(parseFloat(e),l,h);break;case'"':for(o="",u=void 0,a=0;'"'!==(c=t[d++])||"\\"===u&&a%2==1;)o+=c,"\\"===(u=c)?a++:a=0;i(JSON.parse('"'+o+'"'),l,h);break;case"[":s={element:[],index:l.length},l.push(s.element),h.push(s);break;case"{":f={element:{},index:l.length},l.push(f.element),h.push(f);break;default:throw new Error("unexpectedly reached end of input: "+n)}else{if(1===l.length)return l.pop();i(l.pop(),l,h)}}},function(t,n,e){(function(n){t.exports=n.Mustache=e(38)}).call(this,e(13))},function(t,n){var e="undefined"!=typeof crypto&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&msCrypto.getRandomValues.bind(msCrypto);if(e){var i=new Uint8Array(16);t.exports=function(){return e(i),i}}else{var r=new Array(16);t.exports=function(){for(var t,n=0;n<16;n++)0==(3&n)&&(t=4294967296*Math.random()),r[n]=t>>>((3&n)<<3)&255;return r}}},function(t,n){for(var e=[],i=0;i<256;++i)e[i]=(i+256).toString(16).substr(1);t.exports=function(t,n){var i=n||0,r=e;return r[t[i++]]+r[t[i++]]+r[t[i++]]+r[t[i++]]+"-"+r[t[i++]]+r[t[i++]]+"-"+r[t[i++]]+r[t[i++]]+"-"+r[t[i++]]+r[t[i++]]+"-"+r[t[i++]]+r[t[i++]]+r[t[i++]]+r[t[i++]]+r[t[i++]]+r[t[i++]]}},function(t,n,e){"use strict";var i=e(8);function r(){}var o={},u=["REJECTED"],a=["FULFILLED"],c=["PENDING"];function s(t){if("function"!=typeof t)throw new TypeError("resolver must be a function");this.state=c,this.queue=[],this.outcome=void 0,t!==r&&d(this,t)}function f(t,n,e){this.promise=t,"function"==typeof n&&(this.onFulfilled=n,this.callFulfilled=this.otherCallFulfilled),"function"==typeof e&&(this.onRejected=e,this.callRejected=this.otherCallRejected)}function l(t,n,e){i(function(){var i;try{i=n(e)}catch(n){return o.reject(t,n)}i===t?o.reject(t,new TypeError("Cannot resolve promise with itself")):o.resolve(t,i)})}function h(t){var n=t&&t.then;if(t&&("object"==typeof t||"function"==typeof t)&&"function"==typeof n)return function(){n.apply(t,arguments)}}function d(t,n){var e=!1;function i(n){e||(e=!0,o.reject(t,n))}function r(n){e||(e=!0,o.resolve(t,n))}var u=v(function(){n(r,i)});"error"===u.status&&i(u.value)}function v(t,n){var e={};try{e.value=t(n),e.status="success"}catch(t){e.status="error",e.value=t}return e}t.exports=s,s.prototype.catch=function(t){return this.then(null,t)},s.prototype.then=function(t,n){if("function"!=typeof t&&this.state===a||"function"!=typeof n&&this.state===u)return this;var e=new this.constructor(r);this.state!==c?l(e,this.state===a?t:n,this.outcome):this.queue.push(new f(e,t,n));return e},f.prototype.callFulfilled=function(t){o.resolve(this.promise,t)},f.prototype.otherCallFulfilled=function(t){l(this.promise,this.onFulfilled,t)},f.prototype.callRejected=function(t){o.reject(this.promise,t)},f.prototype.otherCallRejected=function(t){l(this.promise,this.onRejected,t)},o.resolve=function(t,n){var e=v(h,n);if("error"===e.status)return o.reject(t,e.value);var i=e.value;if(i)d(t,i);else{t.state=a,t.outcome=n;for(var r=-1,u=t.queue.length;++r<u;)t.queue[r].callFulfilled(n)}return t},o.reject=function(t,n){t.state=u,t.outcome=n;for(var e=-1,i=t.queue.length;++e<i;)t.queue[e].callRejected(n);return t},s.resolve=function(t){if(t instanceof this)return t;return o.resolve(new this(r),t)},s.reject=function(t){var n=new this(r);return o.reject(n,t)},s.all=function(t){var n=this;if("[object Array]"!==Object.prototype.toString.call(t))return this.reject(new TypeError("must be an array"));var e=t.length,i=!1;if(!e)return this.resolve([]);var u=new Array(e),a=0,c=-1,s=new this(r);for(;++c<e;)f(t[c],c);return s;function f(t,r){n.resolve(t).then(function(t){u[r]=t,++a!==e||i||(i=!0,o.resolve(s,u))},function(t){i||(i=!0,o.reject(s,t))})}},s.race=function(t){var n=this;if("[object Array]"!==Object.prototype.toString.call(t))return this.reject(new TypeError("must be an array"));var e=t.length,i=!1;if(!e)return this.resolve([]);var u=-1,a=new this(r);for(;++u<e;)c=t[u],n.resolve(c).then(function(t){i||(i=!0,o.resolve(a,t))},function(t){i||(i=!0,o.reject(a,t))});var c;return a}},function(t,n,e){var i=e(2),r=e(16),o=e(36),u=e(37);function a(n){var e="function"==typeof Map?new Map:void 0;return t.exports=a=function(t){if(null===t||!o(t))return t;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==e){if(e.has(t))return e.get(t);e.set(t,n)}function n(){return u(t,arguments,i(this).constructor)}return n.prototype=Object.create(t.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),r(n,t)},a(n)}t.exports=a},function(t,n,e){var i=function(){return this||"object"==typeof self&&self}()||Function("return this")(),r=i.regeneratorRuntime&&Object.getOwnPropertyNames(i).indexOf("regeneratorRuntime")>=0,o=r&&i.regeneratorRuntime;if(i.regeneratorRuntime=void 0,t.exports=e(28),r)i.regeneratorRuntime=o;else try{delete i.regeneratorRuntime}catch(t){i.regeneratorRuntime=void 0}},function(t,n){!function(n){"use strict";var e,i=Object.prototype,r=i.hasOwnProperty,o="function"==typeof Symbol?Symbol:{},u=o.iterator||"@@iterator",a=o.asyncIterator||"@@asyncIterator",c=o.toStringTag||"@@toStringTag",s="object"==typeof t,f=n.regeneratorRuntime;if(f)s&&(t.exports=f);else{(f=n.regeneratorRuntime=s?t.exports:{}).wrap=m;var l="suspendedStart",h="suspendedYield",d="executing",v="completed",p={},y={};y[u]=function(){return this};var g=Object.getPrototypeOf,b=g&&g(g(P([])));b&&b!==i&&r.call(b,u)&&(y=b);var w=x.prototype=k.prototype=Object.create(y);A.prototype=w.constructor=x,x.constructor=A,x[c]=A.displayName="GeneratorFunction",f.isGeneratorFunction=function(t){var n="function"==typeof t&&t.constructor;return!!n&&(n===A||"GeneratorFunction"===(n.displayName||n.name))},f.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,x):(t.__proto__=x,c in t||(t[c]="GeneratorFunction")),t.prototype=Object.create(w),t},f.awrap=function(t){return{__await:t}},E(L.prototype),L.prototype[a]=function(){return this},f.AsyncIterator=L,f.async=function(t,n,e,i){var r=new L(m(t,n,e,i));return f.isGeneratorFunction(n)?r:r.next().then(function(t){return t.done?t.value:r.next()})},E(w),w[c]="Generator",w[u]=function(){return this},w.toString=function(){return"[object Generator]"},f.keys=function(t){var n=[];for(var e in t)n.push(e);return n.reverse(),function e(){for(;n.length;){var i=n.pop();if(i in t)return e.value=i,e.done=!1,e}return e.done=!0,e}},f.values=P,q.prototype={constructor:q,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(T),!t)for(var n in this)"t"===n.charAt(0)&&r.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=e)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var n=this;function i(i,r){return a.type="throw",a.arg=t,n.next=i,r&&(n.method="next",n.arg=e),!!r}for(var o=this.tryEntries.length-1;o>=0;--o){var u=this.tryEntries[o],a=u.completion;if("root"===u.tryLoc)return i("end");if(u.tryLoc<=this.prev){var c=r.call(u,"catchLoc"),s=r.call(u,"finallyLoc");if(c&&s){if(this.prev<u.catchLoc)return i(u.catchLoc,!0);if(this.prev<u.finallyLoc)return i(u.finallyLoc)}else if(c){if(this.prev<u.catchLoc)return i(u.catchLoc,!0)}else{if(!s)throw new Error("try statement without catch or finally");if(this.prev<u.finallyLoc)return i(u.finallyLoc)}}}},abrupt:function(t,n){for(var e=this.tryEntries.length-1;e>=0;--e){var i=this.tryEntries[e];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===t||"continue"===t)&&o.tryLoc<=n&&n<=o.finallyLoc&&(o=null);var u=o?o.completion:{};return u.type=t,u.arg=n,o?(this.method="next",this.next=o.finallyLoc,p):this.complete(u)},complete:function(t,n){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&n&&(this.next=n),p},finish:function(t){for(var n=this.tryEntries.length-1;n>=0;--n){var e=this.tryEntries[n];if(e.finallyLoc===t)return this.complete(e.completion,e.afterLoc),T(e),p}},catch:function(t){for(var n=this.tryEntries.length-1;n>=0;--n){var e=this.tryEntries[n];if(e.tryLoc===t){var i=e.completion;if("throw"===i.type){var r=i.arg;T(e)}return r}}throw new Error("illegal catch attempt")},delegateYield:function(t,n,i){return this.delegate={iterator:P(t),resultName:n,nextLoc:i},"next"===this.method&&(this.arg=e),p}}}function m(t,n,e,i){var r=n&&n.prototype instanceof k?n:k,o=Object.create(r.prototype),u=new q(i||[]);return o._invoke=function(t,n,e){var i=l;return function(r,o){if(i===d)throw new Error("Generator is already running");if(i===v){if("throw"===r)throw o;return S()}for(e.method=r,e.arg=o;;){var u=e.delegate;if(u){var a=O(u,e);if(a){if(a===p)continue;return a}}if("next"===e.method)e.sent=e._sent=e.arg;else if("throw"===e.method){if(i===l)throw i=v,e.arg;e.dispatchException(e.arg)}else"return"===e.method&&e.abrupt("return",e.arg);i=d;var c=_(t,n,e);if("normal"===c.type){if(i=e.done?v:h,c.arg===p)continue;return{value:c.arg,done:e.done}}"throw"===c.type&&(i=v,e.method="throw",e.arg=c.arg)}}}(t,e,u),o}function _(t,n,e){try{return{type:"normal",arg:t.call(n,e)}}catch(t){return{type:"throw",arg:t}}}function k(){}function A(){}function x(){}function E(t){["next","throw","return"].forEach(function(n){t[n]=function(t){return this._invoke(n,t)}})}function L(t){var n;this._invoke=function(e,i){function o(){return new Promise(function(n,o){!function n(e,i,o,u){var a=_(t[e],t,i);if("throw"!==a.type){var c=a.arg,s=c.value;return s&&"object"==typeof s&&r.call(s,"__await")?Promise.resolve(s.__await).then(function(t){n("next",t,o,u)},function(t){n("throw",t,o,u)}):Promise.resolve(s).then(function(t){c.value=t,o(c)},function(t){return n("throw",t,o,u)})}u(a.arg)}(e,i,n,o)})}return n=n?n.then(o,o):o()}}function O(t,n){var i=t.iterator[n.method];if(i===e){if(n.delegate=null,"throw"===n.method){if(t.iterator.return&&(n.method="return",n.arg=e,O(t,n),"throw"===n.method))return p;n.method="throw",n.arg=new TypeError("The iterator does not provide a 'throw' method")}return p}var r=_(i,t.iterator,n.arg);if("throw"===r.type)return n.method="throw",n.arg=r.arg,n.delegate=null,p;var o=r.arg;return o?o.done?(n[t.resultName]=o.value,n.next=t.nextLoc,"return"!==n.method&&(n.method="next",n.arg=e),n.delegate=null,p):o:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,p)}function M(t){var n={tryLoc:t[0]};1 in t&&(n.catchLoc=t[1]),2 in t&&(n.finallyLoc=t[2],n.afterLoc=t[3]),this.tryEntries.push(n)}function T(t){var n=t.completion||{};n.type="normal",delete n.arg,t.completion=n}function q(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(M,this),this.reset(!0)}function P(t){if(t){var n=t[u];if(n)return n.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var i=-1,o=function n(){for(;++i<t.length;)if(r.call(t,i))return n.value=t[i],n.done=!1,n;return n.value=e,n.done=!0,n};return o.next=o}}return{next:S}}function S(){return{value:e,done:!0}}}(function(){return this||"object"==typeof self&&self}()||Function("return this")())},function(t,n){function e(t){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function i(n){return"function"==typeof Symbol&&"symbol"===e(Symbol.iterator)?t.exports=i=function(t){return e(t)}:t.exports=i=function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":e(t)},i(n)}t.exports=i},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"default",function(){return Sandbox});var _SandboxException_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(17);class Sandbox{constructor(t=null,n=null){this.globalContext=n||{},this.dom=t||document,this.superDetectRegex=/super\.([^(]+)(\(?)/gm,this.ownerDocDetectRegex=/.ownerDocument/gm,this.domProxy=new Proxy(this.dom,{get:function(t,n){if("body"==n)return t;if("rootNode"==n)return t;var e;if(e="nodeName"==n||"nodeType"==n||"ownerDocument"==n||"parentElement"==n||"parentNode"==n?document[n]:n in t?t[n]:document[n],!(n in t)&&e instanceof Function)e=function(t){for(var n=[],e=0;e+1<arguments.length;e++)n[e]=arguments[e+1];return t.apply(this,n)}.bind(document,e);else if(e instanceof Function){var i=function(t){for(var n=[],e=0;e+1<arguments.length;e++)n[e]=arguments[e+1];return t.apply(this,n)}.bind(t,e);e="getElementsByTagName"==n?function(t,n){return"body"==n?[this]:t.call(this,n)}.bind(t,i):i}return e}.bind(document),set:function(t,n,e){return function(){this[n]=e}.bind(t)(),!0}}),this.globalContextProxy=new Proxy(this.globalContext,{get:function(t,n,e){if("document"==e)return t.domProxy;var i=e in n?n[e]:window[e];return!(e in n)&&i instanceof Function&&(i=function(t){for(var n=[],e=0;e+1<arguments.length;e++)n[e]=arguments[e+1];return t.apply(this,n)}.bind(window,i)),i}.bind(window,this)})}execCode(code,newcontext=this.globalContext){return code=code.replace(this.ownerDocDetectRegex,".s_ownerDocument"),function(window,document,code){var globalScopeInit="";for(var x in window)globalScopeInit+="var "+x+' = window["'+x+'"];';return Node.prototype.s_ownerDocument=document,eval(globalScopeInit+code)}.bind(newcontext)(this.globalContextProxy,this.domProxy,code)}execFunction(func,args,newcontext=this.globalContext){if(!(func instanceof Function)&&"function"!=typeof func)throw new _SandboxException_js__WEBPACK_IMPORTED_MODULE_0__.a("Object passed is not a function");return function(window,document,owDocRegEx,func,args){var globalScopeInit="";for(var x in window)globalScopeInit+="var "+x+' = window["'+x+'"];';var func_str=func.toString();return func_str.startsWith("function")||(func_str="function "+func_str),Node.prototype.s_ownerDocument=document,func_str=func_str.replace(owDocRegEx,".s_ownerDocument"),eval(globalScopeInit+"("+func_str+".bind(this)).apply(this,args)")}.bind(newcontext)(this.globalContextProxy,this.domProxy,this.ownerDocDetectRegex,func,args)}execMethod(meth,args,obj){if(!(obj[meth]instanceof Function)&&"function"!=typeof obj[meth])throw new _SandboxException_js__WEBPACK_IMPORTED_MODULE_0__.a(meth+" is not a method");var func_str=obj[meth].toString();return func_str.startsWith("function")||(func_str="function "+func_str),func_str=func_str.replace(this.superDetectRegex,function(t,n,e){return"__super__."+n+".bind(this)"+e}),func_str=func_str.replace(this.ownerDocDetectRegex,".s_ownerDocument"),function(window,document,func_str,args){var globalScopeInit="";for(var x in window)globalScopeInit+="var "+x+' = window["'+x+'"];';globalScopeInit+="var __super__ = Object.getPrototypeOf(Object.getPrototypeOf(this));";var indx=func_str.indexOf("{")+1;return Node.prototype.s_ownerDocument=document,eval("("+[func_str.slice(0,indx),globalScopeInit,func_str.slice(indx)].join("")+").apply(this,args)")}.bind(obj)(this.globalContextProxy,this.domProxy,func_str,args)}}},function(t,n,e){var i,r,o=e(23),u=e(24),a=0,c=0;t.exports=function(t,n,e){var s=n&&e||0,f=n||[],l=(t=t||{}).node||i,h=void 0!==t.clockseq?t.clockseq:r;if(null==l||null==h){var d=o();null==l&&(l=i=[1|d[0],d[1],d[2],d[3],d[4],d[5]]),null==h&&(h=r=16383&(d[6]<<8|d[7]))}var v=void 0!==t.msecs?t.msecs:(new Date).getTime(),p=void 0!==t.nsecs?t.nsecs:c+1,y=v-a+(p-c)/1e4;if(y<0&&void 0===t.clockseq&&(h=h+1&16383),(y<0||v>a)&&void 0===t.nsecs&&(p=0),p>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");a=v,c=p,r=h;var g=(1e4*(268435455&(v+=122192928e5))+p)%4294967296;f[s++]=g>>>24&255,f[s++]=g>>>16&255,f[s++]=g>>>8&255,f[s++]=255&g;var b=v/4294967296*1e4&268435455;f[s++]=b>>>8&255,f[s++]=255&b,f[s++]=b>>>24&15|16,f[s++]=b>>>16&255,f[s++]=h>>>8|128,f[s++]=255&h;for(var w=0;w<6;++w)f[s+w]=l[w];return n||u(f)}},function(t,n,e){var i=e(23),r=e(24);t.exports=function(t,n,e){var o=n&&e||0;"string"==typeof t&&(n="binary"===t?new Array(16):null,t=null);var u=(t=t||{}).random||(t.rng||i)();if(u[6]=15&u[6]|64,u[8]=63&u[8]|128,n)for(var a=0;a<16;++a)n[o+a]=u[a];return n||r(u)}},function(t,n){var e,i,r=t.exports={};function o(){throw new Error("setTimeout has not been defined")}function u(){throw new Error("clearTimeout has not been defined")}function a(t){if(e===setTimeout)return setTimeout(t,0);if((e===o||!e)&&setTimeout)return e=setTimeout,setTimeout(t,0);try{return e(t,0)}catch(n){try{return e.call(null,t,0)}catch(n){return e.call(this,t,0)}}}!function(){try{e="function"==typeof setTimeout?setTimeout:o}catch(t){e=o}try{i="function"==typeof clearTimeout?clearTimeout:u}catch(t){i=u}}();var c,s=[],f=!1,l=-1;function h(){f&&c&&(f=!1,c.length?s=c.concat(s):l=-1,s.length&&d())}function d(){if(!f){var t=a(h);f=!0;for(var n=s.length;n;){for(c=s,s=[];++l<n;)c&&c[l].run();l=-1,n=s.length}c=null,f=!1,function(t){if(i===clearTimeout)return clearTimeout(t);if((i===u||!i)&&clearTimeout)return i=clearTimeout,clearTimeout(t);try{i(t)}catch(n){try{return i.call(null,t)}catch(n){return i.call(this,t)}}}(t)}}function v(t,n){this.fun=t,this.array=n}function p(){}r.nextTick=function(t){var n=new Array(arguments.length-1);if(arguments.length>1)for(var e=1;e<arguments.length;e++)n[e-1]=arguments[e];s.push(new v(t,n)),1!==s.length||f||a(d)},v.prototype.run=function(){this.fun.apply(null,this.array)},r.title="browser",r.browser=!0,r.env={},r.argv=[],r.version="",r.versions={},r.on=p,r.addListener=p,r.once=p,r.off=p,r.removeListener=p,r.removeAllListeners=p,r.emit=p,r.prependListener=p,r.prependOnceListener=p,r.listeners=function(t){return[]},r.binding=function(t){throw new Error("process.binding is not supported")},r.cwd=function(){return"/"},r.chdir=function(t){throw new Error("process.chdir is not supported")},r.umask=function(){return 0}},function(t,n,e){function i(t){var e;function i(){if(i.enabled){var t=i,r=+new Date,o=r-(e||r);t.diff=o,t.prev=e,t.curr=r,e=r;for(var u=new Array(arguments.length),a=0;a<u.length;a++)u[a]=arguments[a];u[0]=n.coerce(u[0]),"string"!=typeof u[0]&&u.unshift("%O");var c=0;u[0]=u[0].replace(/%([a-zA-Z%])/g,function(e,i){if("%%"===e)return e;c++;var r=n.formatters[i];if("function"==typeof r){var o=u[c];e=r.call(t,o),u.splice(c,1),c--}return e}),n.formatArgs.call(t,u),(i.log||n.log||console.log.bind(console)).apply(t,u)}}return i.namespace=t,i.enabled=n.enabled(t),i.useColors=n.useColors(),i.color=function(t){var e,i=0;for(e in t)i=(i<<5)-i+t.charCodeAt(e),i|=0;return n.colors[Math.abs(i)%n.colors.length]}(t),i.destroy=r,"function"==typeof n.init&&n.init(i),n.instances.push(i),i}function r(){var t=n.instances.indexOf(this);return-1!==t&&(n.instances.splice(t,1),!0)}(n=t.exports=i.debug=i.default=i).coerce=function(t){return t instanceof Error?t.stack||t.message:t},n.disable=function(){n.enable("")},n.enable=function(t){var e;n.save(t),n.names=[],n.skips=[];var i=("string"==typeof t?t:"").split(/[\s,]+/),r=i.length;for(e=0;e<r;e++)i[e]&&("-"===(t=i[e].replace(/\*/g,".*?"))[0]?n.skips.push(new RegExp("^"+t.substr(1)+"$")):n.names.push(new RegExp("^"+t+"$")));for(e=0;e<n.instances.length;e++){var o=n.instances[e];o.enabled=n.enabled(o.namespace)}},n.enabled=function(t){if("*"===t[t.length-1])return!0;var e,i;for(e=0,i=n.skips.length;e<i;e++)if(n.skips[e].test(t))return!1;for(e=0,i=n.names.length;e<i;e++)if(n.names[e].test(t))return!0;return!1},n.humanize=e(35),n.instances=[],n.names=[],n.skips=[],n.formatters={}},function(t,n){var e=1e3,i=60*e,r=60*i,o=24*r,u=365.25*o;function a(t,n,e){if(!(t<n))return t<1.5*n?Math.floor(t/n)+" "+e:Math.ceil(t/n)+" "+e+"s"}t.exports=function(t,n){n=n||{};var c,s=typeof t;if("string"===s&&t.length>0)return function(t){if((t=String(t)).length>100)return;var n=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(t);if(!n)return;var a=parseFloat(n[1]);switch((n[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return a*u;case"days":case"day":case"d":return a*o;case"hours":case"hour":case"hrs":case"hr":case"h":return a*r;case"minutes":case"minute":case"mins":case"min":case"m":return a*i;case"seconds":case"second":case"secs":case"sec":case"s":return a*e;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return a;default:return}}(t);if("number"===s&&!1===isNaN(t))return n.long?a(c=t,o,"day")||a(c,r,"hour")||a(c,i,"minute")||a(c,e,"second")||c+" ms":function(t){if(t>=o)return Math.round(t/o)+"d";if(t>=r)return Math.round(t/r)+"h";if(t>=i)return Math.round(t/i)+"m";if(t>=e)return Math.round(t/e)+"s";return t+"ms"}(t);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(t))}},function(t,n){t.exports=function(t){return-1!==Function.toString.call(t).indexOf("[native code]")}},function(t,n,e){var i=e(16);function r(n,e,o){return!function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}()?t.exports=r=function(t,n,e){var r=[null];r.push.apply(r,n);var o=new(Function.bind.apply(t,r));return e&&i(o,e.prototype),o}:t.exports=r=Reflect.construct,r.apply(null,arguments)}t.exports=r},function(t,n,e){var i,r,o,u;
/*!
 * mustache.js - Logic-less {{mustache}} templates with JavaScript
 * http://github.com/janl/mustache.js
 */
/*!
 * mustache.js - Logic-less {{mustache}} templates with JavaScript
 * http://github.com/janl/mustache.js
 */
u=function(t){var n=Object.prototype.toString,e=Array.isArray||function(t){return"[object Array]"===n.call(t)};function i(t){return"function"==typeof t}function r(t){return t.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function o(t,n){return null!=t&&"object"==typeof t&&n in t}var u=RegExp.prototype.test,a=/\S/;function c(t){return!function(t,n){return u.call(t,n)}(a,t)}var s={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"},f=/\s*/,l=/\s+/,h=/\s*=/,d=/\s*\}/,v=/#|\^|\/|>|\{|&|=|!/;function p(t){this.string=t,this.tail=t,this.pos=0}function y(t,n){this.view=t,this.cache={".":this.view},this.parent=n}function g(){this.cache={}}p.prototype.eos=function(){return""===this.tail},p.prototype.scan=function(t){var n=this.tail.match(t);if(!n||0!==n.index)return"";var e=n[0];return this.tail=this.tail.substring(e.length),this.pos+=e.length,e},p.prototype.scanUntil=function(t){var n,e=this.tail.search(t);switch(e){case-1:n=this.tail,this.tail="";break;case 0:n="";break;default:n=this.tail.substring(0,e),this.tail=this.tail.substring(e)}return this.pos+=n.length,n},y.prototype.push=function(t){return new y(t,this)},y.prototype.lookup=function(t){var n,e=this.cache;if(e.hasOwnProperty(t))n=e[t];else{for(var r,u,a=this,c=!1;a;){if(t.indexOf(".")>0)for(n=a.view,r=t.split("."),u=0;null!=n&&u<r.length;)u===r.length-1&&(c=o(n,r[u])),n=n[r[u++]];else n=a.view[t],c=o(a.view,t);if(c)break;a=a.parent}e[t]=n}return i(n)&&(n=n.call(this.view)),n},g.prototype.clearCache=function(){this.cache={}},g.prototype.parse=function(n,i){var o=this.cache,u=o[n];return null==u&&(u=o[n]=function(n,i){if(!n)return[];var o,u,a,s=[],y=[],g=[],b=!1,w=!1;function m(){if(b&&!w)for(;g.length;)delete y[g.pop()];else g=[];b=!1,w=!1}function _(t){if("string"==typeof t&&(t=t.split(l,2)),!e(t)||2!==t.length)throw new Error("Invalid tags: "+t);o=new RegExp(r(t[0])+"\\s*"),u=new RegExp("\\s*"+r(t[1])),a=new RegExp("\\s*"+r("}"+t[1]))}_(i||t.tags);for(var k,A,x,E,L,O,M=new p(n);!M.eos();){if(k=M.pos,x=M.scanUntil(o))for(var T=0,q=x.length;T<q;++T)c(E=x.charAt(T))?g.push(y.length):w=!0,y.push(["text",E,k,k+1]),k+=1,"\n"===E&&m();if(!M.scan(o))break;if(b=!0,A=M.scan(v)||"name",M.scan(f),"="===A?(x=M.scanUntil(h),M.scan(h),M.scanUntil(u)):"{"===A?(x=M.scanUntil(a),M.scan(d),M.scanUntil(u),A="&"):x=M.scanUntil(u),!M.scan(u))throw new Error("Unclosed tag at "+M.pos);if(L=[A,x,k,M.pos],y.push(L),"#"===A||"^"===A)s.push(L);else if("/"===A){if(!(O=s.pop()))throw new Error('Unopened section "'+x+'" at '+k);if(O[1]!==x)throw new Error('Unclosed section "'+O[1]+'" at '+k)}else"name"===A||"{"===A||"&"===A?w=!0:"="===A&&_(x)}if(O=s.pop())throw new Error('Unclosed section "'+O[1]+'" at '+M.pos);return function(t){for(var n,e=[],i=e,r=[],o=0,u=t.length;o<u;++o)switch((n=t[o])[0]){case"#":case"^":i.push(n),r.push(n),i=n[4]=[];break;case"/":r.pop()[5]=n[2],i=r.length>0?r[r.length-1][4]:e;break;default:i.push(n)}return e}(function(t){for(var n,e,i=[],r=0,o=t.length;r<o;++r)(n=t[r])&&("text"===n[0]&&e&&"text"===e[0]?(e[1]+=n[1],e[3]=n[3]):(i.push(n),e=n));return i}(y))}(n,i)),u},g.prototype.render=function(t,n,e){var i=this.parse(t),r=n instanceof y?n:new y(n);return this.renderTokens(i,r,e,t)},g.prototype.renderTokens=function(t,n,e,i){for(var r,o,u,a="",c=0,s=t.length;c<s;++c)u=void 0,"#"===(o=(r=t[c])[0])?u=this.renderSection(r,n,e,i):"^"===o?u=this.renderInverted(r,n,e,i):">"===o?u=this.renderPartial(r,n,e,i):"&"===o?u=this.unescapedValue(r,n):"name"===o?u=this.escapedValue(r,n):"text"===o&&(u=this.rawValue(r)),void 0!==u&&(a+=u);return a},g.prototype.renderSection=function(t,n,r,o){var u=this,a="",c=n.lookup(t[1]);if(c){if(e(c))for(var s=0,f=c.length;s<f;++s)a+=this.renderTokens(t[4],n.push(c[s]),r,o);else if("object"==typeof c||"string"==typeof c||"number"==typeof c)a+=this.renderTokens(t[4],n.push(c),r,o);else if(i(c)){if("string"!=typeof o)throw new Error("Cannot use higher-order sections without the original template");null!=(c=c.call(n.view,o.slice(t[3],t[5]),function(t){return u.render(t,n,r)}))&&(a+=c)}else a+=this.renderTokens(t[4],n,r,o);return a}},g.prototype.renderInverted=function(t,n,i,r){var o=n.lookup(t[1]);if(!o||e(o)&&0===o.length)return this.renderTokens(t[4],n,i,r)},g.prototype.renderPartial=function(t,n,e){if(e){var r=i(e)?e(t[1]):e[t[1]];return null!=r?this.renderTokens(this.parse(r),n,e,r):void 0}},g.prototype.unescapedValue=function(t,n){var e=n.lookup(t[1]);if(null!=e)return e},g.prototype.escapedValue=function(n,e){var i=e.lookup(n[1]);if(null!=i)return t.escape(i)},g.prototype.rawValue=function(t){return t[1]},t.name="mustache.js",t.version="2.3.2",t.tags=["{{","}}"];var b=new g;return t.clearCache=function(){return b.clearCache()},t.parse=function(t,n){return b.parse(t,n)},t.render=function(t,n,i){if("string"!=typeof t)throw new TypeError('Invalid template! Template should be a "string" but "'+(e(r=t)?"array":typeof r)+'" was given as the first argument for mustache#render(template, view, partials)');var r;return b.render(t,n,i)},t.to_html=function(n,e,r,o){var u=t.render(n,e,r);if(!i(o))return u;o(u)},t.escape=function(t){return String(t).replace(/[&<>"'`=\/]/g,function(t){return s[t]})},t.Scanner=p,t.Context=y,t.Writer=g,t},n&&"string"!=typeof n.nodeName?u(n):(r=[n],void 0===(o="function"==typeof(i=u)?i.apply(n,r):i)||(t.exports=o))},function(t,n,e){var i=e(40);"string"==typeof i&&(i=[[t.i,i,""]]);var r={hmr:!0,transform:void 0,insertInto:void 0};e(42)(i,r);i.locals&&(t.exports=i.locals)},function(t,n,e){(t.exports=e(41)(!1)).push([t.i,".bbh-page{\r\n\tfloat: none;\r\n\tposition: static;\r\n}\r\n\r\n.bbh-page.bbh-new{\r\n\twidth: 100%;\r\n\tfloat: left;\r\n\tposition: absolute;\r\n}\r\n\r\n.bbh-page.bbh-vanish{\r\n\topacity: 1;\r\n\ttransition: opacity 0.5s ease-in-out, display 0.5s ease-in-out;\r\n}\r\n\r\n.bbh-page.bbh-vanish.bbh-hide{\r\n\topacity: 0;\r\n}\r\n\r\n.bbh-page.bbh-new.bbh-slide{\r\n\tz-index: 51;\r\n\tborder-radius: 15px;\r\n\twidth: 98vw;\r\n\tbox-shadow: 0 5px 20px 7px rgba(0,0,0,0.3);\r\n\tpadding: 15px;\r\n}\r\n\r\n.bbh-page.bbh-slide-under{\r\n\tz-index: 50;\r\n}\r\n\r\n.bbh-page.bbh-slide{\r\n\tleft: 1vw;\r\n\ttop: 1.5vw;\r\n\ttransition: left 2s ease-in-out;\r\n\tposition: fixed;\r\n\tmin-height: 98.5vh;\r\n\tmax-height: 98.5vh;\r\n\tbackground: #fff;\r\n}\r\n\r\n.bbh-page.bbh-slide.bbh-hide{\r\n\tleft: 100vw;\r\n}",""])},function(t,n){t.exports=function(t){var n=[];return n.toString=function(){return this.map(function(n){var e=function(t,n){var e=t[1]||"",i=t[3];if(!i)return e;if(n&&"function"==typeof btoa){var r=(u=i,"/*# sourceMappingURL=data:application/json;charset=utf-8;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(u))))+" */"),o=i.sources.map(function(t){return"/*# sourceURL="+i.sourceRoot+t+" */"});return[e].concat(o).concat([r]).join("\n")}var u;return[e].join("\n")}(n,t);return n[2]?"@media "+n[2]+"{"+e+"}":e}).join("")},n.i=function(t,e){"string"==typeof t&&(t=[[null,t,""]]);for(var i={},r=0;r<this.length;r++){var o=this[r][0];"number"==typeof o&&(i[o]=!0)}for(r=0;r<t.length;r++){var u=t[r];"number"==typeof u[0]&&i[u[0]]||(e&&!u[2]?u[2]=e:e&&(u[2]="("+u[2]+") and ("+e+")"),n.push(u))}},n}},function(t,n,e){var i,r,o={},u=(i=function(){return window&&document&&document.all&&!window.atob},function(){return void 0===r&&(r=i.apply(this,arguments)),r}),a=function(t){var n={};return function(t){if("function"==typeof t)return t();if(void 0===n[t]){var e=function(t){return document.querySelector(t)}.call(this,t);if(window.HTMLIFrameElement&&e instanceof window.HTMLIFrameElement)try{e=e.contentDocument.head}catch(t){e=null}n[t]=e}return n[t]}}(),c=null,s=0,f=[],l=e(43);function h(t,n){for(var e=0;e<t.length;e++){var i=t[e],r=o[i.id];if(r){r.refs++;for(var u=0;u<r.parts.length;u++)r.parts[u](i.parts[u]);for(;u<i.parts.length;u++)r.parts.push(b(i.parts[u],n))}else{var a=[];for(u=0;u<i.parts.length;u++)a.push(b(i.parts[u],n));o[i.id]={id:i.id,refs:1,parts:a}}}}function d(t,n){for(var e=[],i={},r=0;r<t.length;r++){var o=t[r],u=n.base?o[0]+n.base:o[0],a={css:o[1],media:o[2],sourceMap:o[3]};i[u]?i[u].parts.push(a):e.push(i[u]={id:u,parts:[a]})}return e}function v(t,n){var e=a(t.insertInto);if(!e)throw new Error("Couldn't find a style target. This probably means that the value for the 'insertInto' parameter is invalid.");var i=f[f.length-1];if("top"===t.insertAt)i?i.nextSibling?e.insertBefore(n,i.nextSibling):e.appendChild(n):e.insertBefore(n,e.firstChild),f.push(n);else if("bottom"===t.insertAt)e.appendChild(n);else{if("object"!=typeof t.insertAt||!t.insertAt.before)throw new Error("[Style Loader]\n\n Invalid value for parameter 'insertAt' ('options.insertAt') found.\n Must be 'top', 'bottom', or Object.\n (https://github.com/webpack-contrib/style-loader#insertat)\n");var r=a(t.insertInto+" "+t.insertAt.before);e.insertBefore(n,r)}}function p(t){if(null===t.parentNode)return!1;t.parentNode.removeChild(t);var n=f.indexOf(t);n>=0&&f.splice(n,1)}function y(t){var n=document.createElement("style");return void 0===t.attrs.type&&(t.attrs.type="text/css"),g(n,t.attrs),v(t,n),n}function g(t,n){Object.keys(n).forEach(function(e){t.setAttribute(e,n[e])})}function b(t,n){var e,i,r,o;if(n.transform&&t.css){if(!(o=n.transform(t.css)))return function(){};t.css=o}if(n.singleton){var u=s++;e=c||(c=y(n)),i=_.bind(null,e,u,!1),r=_.bind(null,e,u,!0)}else t.sourceMap&&"function"==typeof URL&&"function"==typeof URL.createObjectURL&&"function"==typeof URL.revokeObjectURL&&"function"==typeof Blob&&"function"==typeof btoa?(e=function(t){var n=document.createElement("link");return void 0===t.attrs.type&&(t.attrs.type="text/css"),t.attrs.rel="stylesheet",g(n,t.attrs),v(t,n),n}(n),i=function(t,n,e){var i=e.css,r=e.sourceMap,o=void 0===n.convertToAbsoluteUrls&&r;(n.convertToAbsoluteUrls||o)&&(i=l(i));r&&(i+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(r))))+" */");var u=new Blob([i],{type:"text/css"}),a=t.href;t.href=URL.createObjectURL(u),a&&URL.revokeObjectURL(a)}.bind(null,e,n),r=function(){p(e),e.href&&URL.revokeObjectURL(e.href)}):(e=y(n),i=function(t,n){var e=n.css,i=n.media;i&&t.setAttribute("media",i);if(t.styleSheet)t.styleSheet.cssText=e;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(e))}}.bind(null,e),r=function(){p(e)});return i(t),function(n){if(n){if(n.css===t.css&&n.media===t.media&&n.sourceMap===t.sourceMap)return;i(t=n)}else r()}}t.exports=function(t,n){if("undefined"!=typeof DEBUG&&DEBUG&&"object"!=typeof document)throw new Error("The style-loader cannot be used in a non-browser environment");(n=n||{}).attrs="object"==typeof n.attrs?n.attrs:{},n.singleton||"boolean"==typeof n.singleton||(n.singleton=u()),n.insertInto||(n.insertInto="head"),n.insertAt||(n.insertAt="bottom");var e=d(t,n);return h(e,n),function(t){for(var i=[],r=0;r<e.length;r++){var u=e[r];(a=o[u.id]).refs--,i.push(a)}t&&h(d(t,n),n);for(r=0;r<i.length;r++){var a;if(0===(a=i[r]).refs){for(var c=0;c<a.parts.length;c++)a.parts[c]();delete o[a.id]}}}};var w,m=(w=[],function(t,n){return w[t]=n,w.filter(Boolean).join("\n")});function _(t,n,e,i){var r=e?"":i.css;if(t.styleSheet)t.styleSheet.cssText=m(n,r);else{var o=document.createTextNode(r),u=t.childNodes;u[n]&&t.removeChild(u[n]),u.length?t.insertBefore(o,u[n]):t.appendChild(o)}}},function(t,n){t.exports=function(t){var n="undefined"!=typeof window&&window.location;if(!n)throw new Error("fixUrls requires window.location");if(!t||"string"!=typeof t)return t;var e=n.protocol+"//"+n.host,i=e+n.pathname.replace(/\/[^\/]*$/,"/");return t.replace(/url\s*\(((?:[^)(]|\((?:[^)(]+|\([^)(]*\))*\))*)\)/gi,function(t,n){var r,o=n.trim().replace(/^"(.*)"$/,function(t,n){return n}).replace(/^'(.*)'$/,function(t,n){return n});return/^(#|data:|http:\/\/|https:\/\/|file:\/\/\/|\s*$)/i.test(o)?t:(r=0===o.indexOf("//")?o:0===o.indexOf("/")?e+o:i+o.replace(/^\.\//,""),"url("+JSON.stringify(r)+")")})}},function(t,n,e){"use strict";e.r(n);var i={};e.r(i),e.d(i,"log",function(){return m}),e.d(i,"defaultCallback",function(){return _}),e.d(i,"isRemoteURIPattern",function(){return k}),e.d(i,"vidInURIPattern",function(){return A}),e.d(i,"strInURIPattern",function(){return x}),e.d(i,"getClassFromName",function(){return E}),e.d(i,"absoluteURL",function(){return L}),e.d(i,"execFuncWithArgList",function(){return O}),e.d(i,"serializeFormData",function(){return M}),e.d(i,"Heap",function(){return l}),e.d(i,"HeapNode",function(){return h}),e.d(i,"ReverseHeap",function(){return w});var r=e(0),o=e.n(r),u=e(1),a=e.n(u),c=function(){function t(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;o()(this,t),this.info=n,this.user=e}return a()(t,[{key:"getInfo",value:function(){return this.info}},{key:"getUser",value:function(){return this.user}}]),t}(),s=e(5),f=e.n(s),l=function(){function t(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;o()(this,t),n?this.build(n):this.array=[]}return a()(t,[{key:"sx",value:function(t){return 2*t}},{key:"dx",value:function(t){return 2*t+1}},{key:"father",value:function(t){return parseInt(t/2)}},{key:"heapify",value:function(t){var n=this.sx(t),e=this.dx(t),i=t;if(n<this.array.length&&this.array[n].getKey()>this.array[t].getKey()&&(i=n),e<this.array.length&&this.array[e].getKey()>this.array[i].getKey()&&(i=e),i!=t){var r=this.array[t];this.array[t]=this.array[i],this.array[i]=r,this.heapify(i)}}},{key:"build",value:function(t){this.array=t,this.reheap()}},{key:"reheap",value:function(){for(var t=parseInt(this.array.length/2);t>=0;t--)this.heapify(t)}},{key:"addNode",value:function(t){this.array.push(t),this.reheap()}},{key:"pop",value:function(){if(0==this.array.length)return null;var t=this.array[0];return this.array[0]=this.array[this.array.length-1],this.array.length=this.array.length-1,this.heapify(0),t}},{key:"getFirst",value:function(){return 0==this.array.length?null:this.array[0]}},{key:"findByValue",value:function(t){return new Promise(function(n,e){for(var i=0,r=this.array.length;i<r;i++){var o=this.array[i].getValue().equal(t);!0===o&&n(this.array[i]),o instanceof Promise&&o.then(function(t,n,e,i){if(!0===o&&n(t),!1===o&&e(),o instanceof Array)for(var r=0;r<o.length;r++)!1===o[r]&&e();n(t)}.bind(this,this.array[i],n,e))}e()}.bind(this))}},{key:"getNodes",value:f.a.mark(function t(){var n,e;return f.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:n=0,e=this.array.length;case 1:if(!(n<e)){t.next=7;break}return t.next=4,this.array[n];case 4:n++,t.next=1;break;case 7:case"end":return t.stop()}},t,this)})}]),t}(),h=function(){function t(n,e){o()(this,t),this.key=n,this.value=e}return a()(t,[{key:"getKey",value:function(){return this.key}},{key:"incKey",value:function(){this.key++}},{key:"decKey",value:function(){this.key--}},{key:"increaseKey",value:function(t){this.key+=t}},{key:"reduceKey",value:function(t){this.key-=t}},{key:"getValue",value:function(){return this.value}},{key:"setValue",value:function(t){this.value=t}}]),t}(),d=e(3),v=e.n(d),p=e(2),y=e.n(p),g=e(4),b=e.n(g),w=function(t){function n(){return o()(this,n),v()(this,y()(n).apply(this,arguments))}return b()(n,t),a()(n,[{key:"heapify",value:function(t){var n=this.sx(t),e=this.dx(t),i=t;if(n<this.array.length&&this.array[n].getKey()<this.array[t].getKey()&&(i=n),e<this.array.length&&this.array[e].getKey()<this.array[i].getKey()&&(i=e),i!=t){var r=this.array[t];this.array[t]=this.array[i],this.array[i]=r,this.heapify(i)}}}]),n}(l);function m(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(null!=n){for(var e=arguments.length,i=new Array(e>2?e-2:0),r=2;r<e;r++)i[r-2]=arguments[r];parseInt(n)>1?console.error("["+t+"] ",i):console.log("["+t+"] ",i)}else console.log(t)}function _(){arguments.length>0&&m(arguments)}var k=/^http[s]?:\/\//i,A=/^([0-9]+|back)\/?/,x=/^([\w]+)\/?/;function E(t){for(var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:window,e=t.split("."),i=0;i<e.length;i++)n=n[e[i]];return n}function L(t,n){var e=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],i=t.split("/"),r=n.split("/");e&&i.pop();for(var o=0;o<r.length;o++)"."!=r[o]&&(".."==r[o]?i.pop():i.push(r[o]));return i.join("/")}function O(t,n){var e=[t].concat(n);return t.bind.apply(t,e)}function M(t){var n=[],e=!0,i=!1,r=void 0;try{for(var o,u=t.entries()[Symbol.iterator]();!(e=(o=u.next()).done);e=!0){var a=o.value;n.push(a[0]+"="+a[1])}}catch(t){i=!0,r=t}finally{try{e||null==u.return||u.return()}finally{if(i)throw r}}return n.join("&")}var T=function(){function t(){o()(this,t)}return a()(t,null,[{key:"getUser",value:function(n){return t.users[n]}},{key:"addUser",value:function(n){try{t.users[n.username]=n}catch(t){m(t)}}}]),t}();T.users={};var q=function(){function t(n,e,i){o()(this,t),this.username=n,this.password=e,this.roles=i}return a()(t,[{key:"getRoles",value:function(){return this.roles}},{key:"hasRole",value:function(t){return-1!=this.roles.indexOf(t)}},{key:"giveRole",value:function(t){this.roles.push(t)}}]),t}(),P=function t(n){o()(this,t),this.name},S=function(){function t(){o()(this,t)}return a()(t,null,[{key:"getRole",value:function(n){return t.roles[n]||(t.roles[n]=new P(n)),t.roles[n]}}]),t}();S.roles={};var F=function t(n,e,i){o()(this,t),this.code=n,this.status=e,this.content=i},j=function(){function t(n,e,i){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},u=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;for(var a in o()(this,t),this.method=n,this.uri=e,null!=i?this.setData(i):this.data=null,this.headers=r,this.headers)this.headers[a]&&"string"!=typeof this.headers[a]&&(this.headers[a]=this.headers[a].toString());this.response_type=u&&"string"!=typeof u?u.toString():u}return a()(t,[{key:"setHeader",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;null==this.headers&&(this.headers={}),n&&"string"!=typeof n&&(n=n.toString()),this.headers[t]=n}},{key:"getData",value:function(){return this.data}},{key:"getMethod",value:function(){return this.method}},{key:"getUri",value:function(){return this.uri}},{key:"getResponseType",value:function(){return this.response_type||"json"}},{key:"getHeaders",value:f.a.mark(function t(){var n,e;return f.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:t.t0=f.a.keys(this.headers);case 1:if((t.t1=t.t0()).done){t.next=8;break}return n=t.t1.value,e=this.headers[n],t.next=6,{name:n,value:e};case 6:t.next=1;break;case 8:case"end":return t.stop()}},t,this)})}]),t}(),U=function(){function t(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};o()(this,t),this.properties=n||{}}return a()(t,[{key:"getProperties",value:f.a.mark(function t(){var n,e;return f.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:t.t0=f.a.keys(this.properties);case 1:if((t.t1=t.t0()).done){t.next=8;break}return n=t.t1.value,e=this.properties[n],t.next=6,{x:n,v:e};case 6:t.next=1;break;case 8:case"end":return t.stop()}},t,this)})},{key:"getProperty",value:function(t){return this.properties[t]||null}}]),t}(),D=function(){function t(n){o()(this,t),this.name=n}return a()(t,[{key:"fetch",value:function(t){}},{key:"get",value:function(t){}},{key:"search",value:function(t){}},{key:"update",value:function(t){}},{key:"save",value:function(t){}},{key:"destroy",value:function(t){}}]),t}(),R=function t(n,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];o()(this,t),this.id=n,this.model=e,this.change=null!=i?i.bind(this):null,this.allowEdit=r},B=function(){function t(){o()(this,t)}return a()(t,null,[{key:"getModels",value:function(){return t.models}},{key:"getModel",value:function(n){return t.models[n]}},{key:"addModel",value:function(n){try{t.models[n.name]=new Proxy(n,{get:function(t,n){return n in t?t[n]:t.get(n)}})}catch(t){m(t)}}}]),t}();B.models={};var C=function t(n){o()(this,t),this.name="FrameworkException",this.message=n},W=function(t){function n(){return o()(this,n),v()(this,y()(n).apply(this,arguments))}return b()(n,t),n}(C),N=function(){function t(n,e){if(o()(this,t),!n.startsWith("app://")||!e.startsWith("app://"))throw new W;var i={};this.uri1=new RegExp("^"+n.replace(/:[^\s\/]+/g,function(t,n){return t.i+=1,this[n.substring(1)]=t.i,"([\\w-]+)"}.bind(i,{i:0}))+"$"),this.uri2=e.replace(/:[^\s\/]+/g,function(t){var n=this[t.substring(1)];return n?"$"+n:t}.bind(i))}return a()(t,[{key:"match",value:function(t){return this.uri1.test(t)}},{key:"route",value:function(t){return this.match(t)?t.replace(this.uri1,this.uri2):null}}]),t}(),$=function(){function t(){o()(this,t)}return a()(t,null,[{key:"route",value:function(n){for(var e=t.routes,i=0;i<e.length;i++){var r=e[i].route(n);if(r)return r}return n}},{key:"addRoute",value:function(n){try{t.routes.push(n)}catch(t){m(t)}}}]),t}();$.routes=[];var J=function t(n,e,i){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,u=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,a=arguments.length>5&&void 0!==arguments[5]&&arguments[5],c=arguments.length>6&&void 0!==arguments[6]&&arguments[6],s=arguments.length>7&&void 0!==arguments[7]&&arguments[7],f=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;o()(this,t),this.path=n,this.vid=e,this.lock=i,this.configuration=r,this.modules=u,this.roles=f,this.keepLive=a,this.allowDuplicate=c,this.ghostPage=s},H=function(){function t(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};for(var e in o()(this,t),n)this[e]=n[e]}return a()(t,[{key:"clone",value:function(){return new t(this)}}],[{key:"getGlobal",value:function(){return t.globalContext||(t.globalContext=new t),t.globalContext}}]),t}();H.globalContext=null;var X=e(10),K=e.n(X),G=function t(n){o()(this,t);var e=H.getGlobal();for(var i in e)this[i]=e[i];return new K.a(n,this)},Z=e(18),V=function(){function t(){o()(this,t)}return a()(t,null,[{key:"getInstance",value:function(){return arguments.length>0&&void 0!==arguments[0]&&arguments[0]?(null==t.systemInstance&&(t.systemInstance=new Z.a("bobblehead_core")),t.systemInstance):(null==t.instance&&(t.instance=new Z.a("bobblehead")),t.instance)}}]),t}();V.instance=null,V.systemInstance=null;var Y=function(){function t(){o()(this,t),this.session=null}return a()(t,[{key:"processRequest",value:function(){arguments.length>0&&void 0!==arguments[0]&&arguments[0]}},{key:"processPage",value:function(){arguments.length>0&&void 0!==arguments[0]&&arguments[0]}},{key:"processVirtualPage",value:function(){arguments.length>0&&void 0!==arguments[0]&&arguments[0]}},{key:"getCurrentSession",value:function(){return this.session}},{key:"replaceCurrentSession",value:function(t){this.session=t}},{key:"getCurrentUser",value:function(){return this.session?this.session.getUser():null}}]),t}(),z=function(t){function n(){return o()(this,n),v()(this,y()(n).apply(this,arguments))}return b()(n,t),n}(C),I=function(){function t(){o()(this,t)}return a()(t,null,[{key:"addMethod",value:function(n,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;t.methods[n]=[e,i]}},{key:"getMethod",value:function(n){var e=t.methods[n];return e?new(O(e[0],e[1])):null}}]),t}();I.methods={},I.NoneAuthentication=function(t){function n(){return o()(this,n),v()(this,y()(n).apply(this,arguments))}return b()(n,t),n}(Y),I.addMethod("none",I.NoneAuthentication),I.BasicAuthentication=function(t){function n(){return o()(this,n),v()(this,y()(n).apply(this,arguments))}return b()(n,t),a()(n,[{key:"login",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(t.name&&t.password){var n=new q(t.name,t.password,["user"]);this.session=new c({user:n})}else m("BasicAuthentication",1,"Invalid user");return null}},{key:"logout",value:function(){return this.replaceCurrentSession(null),null}},{key:"processRequest",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(t&&this.session){var n=this.session.getInfo().user;t.setHeader("Authorization","Basic "+btoa(n.name+":"+n.password))}}},{key:"processPage",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(t&&t.roles)if(this.session){for(var n=this.session.getInfo().user,e=!1,i=0;i<t.roles.length;i++)-1!=n.roles.indexOf(t.roles[i])&&(e=!0);if(!e)throw new z}else if(t.roles.length>0)throw new z}}]),n}(Y),I.addMethod("basic",I.BasicAuthentication);var Q=function(t){function n(){return o()(this,n),v()(this,y()(n).apply(this,arguments))}return b()(n,t),n}(C),tt=e(26),nt=function(t){function n(){return o()(this,n),v()(this,y()(n).apply(this,arguments))}return b()(n,t),n}(e.n(tt)()(Event)),et=function(t){function n(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return o()(this,n),v()(this,y()(n).call(this,"acloaded",t))}return b()(n,t),n}(nt),it=function(){function t(){o()(this,t)}return a()(t,[{key:"getCurrentSession",value:function(){if(this.currentAuthMethod){var t=this.currentAuthMethod.getCurrentSession();return(this.controllerData.session&&t!=this.controllerData.session||!this.controllerData.session&&t)&&this.saveSession(t),t}return this.controllerData.session}},{key:"getCurrentUser",value:function(){return this.currentAuthMethod?this.currentAuthMethod.getCurrentUser():null}},{key:"saveSession",value:function(t){var n=V.getInstance(!0);t._id="session",this.controllerData.session&&(t._rev=this.controllerData.session._rev),this.controllerData.session=t,n.put(t,{rev:!0}).then(function(t){this.controllerData.session._rev=t.rev,m("Saved local session",0,t)}.bind(this)).catch(function(t){m("Cannot save local session",1,t)})}},{key:"processRequest",value:function(t){this.currentAuthMethod&&this.currentAuthMethod.processRequest(t)}},{key:"processPage",value:function(t){if(this.currentAuthMethod){var n=this.getCurrentUser();if(n){var e=!1;if(t.roles&&t.roles.length>0){for(var i=0;i<t.roles.length;i++)if(n.hasRole(t.roles[i])){e=!0;break}}else e=!0;if(!e)throw new z;this.currentAuthMethod.processPage(t)}else{if(t.roles&&t.roles.length>0)throw new z;this.currentAuthMethod.processPage(t)}}}},{key:"processVirtualPage",value:function(t){this.currentAuthMethod&&this.currentAuthMethod.processVirtualPage(t)}},{key:"init",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"none";return new Promise(function(n,e){if(this.currentAuthMethod=I.getMethod(t)||I.getMethod("none"),!(this.currentAuthMethod instanceof Y))throw new Q;var i=V.getInstance(!0);this.controllerData={},i.get("session").then(function(t){this.controllerData.session=new c(t.info),this.controllerData.session._id=t._id,this.controllerData.session._rev=t._rev,this.currentAuthMethod.replaceCurrentSession(this.controllerData.session),m("Fetched local session",0,this.controllerData.session),document.dispatchEvent(new et),n()}.bind(this)).catch(function(t){this.controllerData.session=null,m("Cannot retrive local session",1,t),document.dispatchEvent(new et),n()}.bind(this))}.bind(this)).catch(function(t){m(t)})}}]),t}(),rt=function(){function t(n){o()(this,t),this.name=n,this.configuration={},this.__controllers={}}return a()(t,[{key:"controller",value:function(t,n){return this.__controllers[t]=n.bind(this),this}},{key:"getController",value:function(t){return this.__controllers[t]}},{key:"init",value:function(t){this.configuration=t}},{key:"manipulate",value:function(){}}]),t}(),ot=function(){function t(){o()(this,t)}return a()(t,null,[{key:"getModules",value:f.a.mark(function n(){var e;return f.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:n.t0=f.a.keys(t.modules);case 1:if((n.t1=n.t0()).done){n.next=8;break}if(e=n.t1.value,!(t.modules[e]instanceof rt)){n.next=6;break}return n.next=6,t.modules[e];case 6:n.next=1;break;case 8:case"end":return n.stop()}},n,this)})},{key:"getModule",value:function(n){return t.modules[n]}},{key:"getModulePermissions",value:function(n){return t.modulePerms[n]}},{key:"addModule",value:function(n,e){try{t.modules[n.name]=n,t.modulePerms[n.name]=e}catch(t){m(t)}}}]),t}();ot.modules={},ot.modulePerms={};var ut=function(t){function n(){return o()(this,n),v()(this,y()(n).apply(this,arguments))}return b()(n,t),n}(C),at=function(){function t(){o()(this,t)}return a()(t,[{key:"doRequest",value:function(t){return new Promise(function(n,e){if(t.uri.startsWith("app://"))try{var i=$.route(t.uri).substring(6);if(i.startsWith("page/")){var r=A.exec(i.substring(5));if(r){var o=r[1],u=H.getGlobal();"back"==o?u.pageBuilder.pageBack():u.pageBuilder.buildPage(parseInt(o),t.getDataAsObject()).then(n).catch(e)}}else if(i.startsWith("module/")){var a=i.substring(7),c=a.indexOf("/"),s=null;s=c>=0?a.substring(0,c):a;var f=ot.getModule(s),l=a.substring(c+1);c=l.indexOf("/");var h=null;h=c>=0?l.substring(0,c):l;var d=f.getController(h);null!=d?d(t.getData(),n,e):e(new ut)}}catch(t){e(t)}})}}],[{key:"getInstance",value:function(){return t.instance||(t.instance=new t),t.instance}}]),t}();at.instance=null;var ct=e(11),st=e.n(ct),ft=e(14),lt=e.n(ft),ht=e(12),dt=e.n(ht),vt=function(t){function n(t,e,i){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},u=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;return o()(this,n),v()(this,y()(n).call(this,t,e,i,r,u))}return b()(n,t),a()(n,[{key:"getDataAsObject",value:function(){var t=null;if(null!=this.data){t={};var n=!0,e=!1,i=void 0;try{for(var r,o=this.data.entries()[Symbol.iterator]();!(n=(r=o.next()).done);n=!0){var u=r.value;t[u[0]]=u[1]}}catch(t){e=!0,i=t}finally{try{n||null==o.return||o.return()}finally{if(e)throw i}}}return t}},{key:"setData",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(null==t)this.data=null;else if(t instanceof FormData)this.data=t;else if(null!=n&&"string"==typeof t)null==this.data&&(this.data=new FormData),this.data.set(t,n);else if("string"==typeof t)this.data=t;else for(var e in t)this.setData(e,t[e])}},{key:"equal",value:function(t){if(!(t instanceof j))return!1;if(this.method!=t.getMethod())return!1;if(this.uri!=t.getUri())return!1;if(this.getResponseType()!=t.getResponseType())return!1;var e=t.getData();if(null!=e&&null!=this.data){var i=0;if(t instanceof n){var r=0,o=!0,u=!1,a=void 0;try{for(var c,s=e.keys()[Symbol.iterator]();!(o=(c=s.next()).done);o=!0){c.value;r++}}catch(t){u=!0,a=t}finally{try{o||null==s.return||s.return()}finally{if(u)throw a}}if(r!=i)return!1;var f=!0,l=!1,h=void 0;try{for(var d,v=this.data[Symbol.iterator]();!(f=(d=v.next()).done);f=!0){var p=d.value;if(e.get(p[0])!=p[1])return!1;i++}}catch(t){l=!0,h=t}finally{try{f||null==v.return||v.return()}finally{if(l)throw h}}}else if(t instanceof pt){var y=!0,g=!1,b=void 0;try{for(var w,m=this.data[Symbol.iterator]();!(y=(w=m.next()).done);y=!0){if((p=w.value)[1]instanceof Blob)null.push(new Promise(function(t,n){var i=new FileReader;i.onload=function(){t(e[p[0]]==dt()(i.result))}.bind(this),i.readAsText(p[1])}));else if(e[p[0]]!=p[1])return!1;i++}}catch(t){g=!0,b=t}finally{try{y||null==m.return||m.return()}finally{if(g)throw b}}if(Object.keys(e).length!=i)return!1}}else if(e!==this.data)return!1;return!0}},{key:"toCacherRequest",value:function(){return new pt(this.method,this.uri,this.data,this.headers,this.response_type)}}]),n}(j),pt=function(t){function n(t,e,i){var r,u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;o()(this,n);var c=(r=v()(this,y()(n).call(this,t,e,i,u,a))).promise;return delete r.promise,v()(r,c||lt()(lt()(r)))}return b()(n,t),a()(n,[{key:"setData",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(this.promise=null,t instanceof FormData){this.data={};var e=!0,i=!1,r=void 0;try{for(var o,u=t.entries()[Symbol.iterator]();!(e=(o=u.next()).done);e=!0){var a=o.value;a[1]instanceof Blob?(null==this.promise&&(this.promise=[]),this.promise.push(new Promise(function(t,n,e){var i=new FileReader;i.onload=function(){this.data[t]=dt()(i.result),n(this)}.bind(this),i.readAsText(a[1])}.bind(this,a[0])))):this.data[a[0]]=a[1]}}catch(t){i=!0,r=t}finally{try{e||null==u.return||u.return()}finally{if(i)throw r}}}else null!=n&&"string"==typeof t?(null==this.data&&(this.data={}),this.data[t]=n):this.data=t}},{key:"toRequest",value:function(){var t=null;if(null!=this.data)for(var n in t=new FormData,this.data)t.append(n,this.data[n]);return new vt(this.method,this.uri,t,this.headers,this.response_type)}},{key:"equal",value:function(t){if(!(t instanceof j))return!1;if(this.method!=t.getMethod())return!1;if(this.uri!=t.getUri())return!1;if(this.getResponseType()!=t.getResponseType())return!1;var e=t.getData();if(null!=e&&null!=this.data)if(t instanceof vt){var i=Object.keys(this.data).length,r=0,o=!0,u=!1,a=void 0;try{for(var c,s=e[Symbol.iterator]();!(o=(c=s.next()).done);o=!0){if((f=c.value)[1]instanceof Blob)null.push(new Promise(function(t,n){var e=new FileReader;e.onload=function(){t(this.data[f[0]]==dt()(e.result))}.bind(this),e.readAsText(f[1])}.bind(this)));else if(this.data[f[0]]!=f[1])return!1;r++}}catch(t){u=!0,a=t}finally{try{o||null==s.return||s.return()}finally{if(u)throw a}}if(r!=i)return!1}else if(t instanceof n){if(Object.keys(e).length!=Object.keys(this.data).length)return!1;for(var f in this.data)if(e[f]!=this.data[f])return!1}else if(e!==this.data)return!1;return!0}}],[{key:"fromObject",value:function(t){return"method"in t&&"uri"in t&&"data"in t?new n(t.method,t.uri,t.data,t.headers||void 0,t.response_type||void 0):null}}]),n}(j),yt=function(t){function n(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return o()(this,n),v()(this,y()(n).call(this,"cacherloaded",t))}return b()(n,t),n}(nt),gt=function(){function t(){o()(this,t)}return a()(t,null,[{key:"init",value:function(n,e,i){return new Promise(function(r,o){var u=V.getInstance(!0);u.get("cacheMap").then(function(n){n?t.cacheMap=n:(t.cacheMap={_id:"cacheMap",length:0},m("Cacher",0,"Cacher map not found")),u.get("cacheHeap").then(function(n){if(n){var e=[];for(var i in n.array){var o=n.array[i].value,u=new pt(o.method,o.uri,o.data,o.headers,o.response_type);e.push(new h(n.array[i].key,u))}var a=n._rev;(n=new w(e))._id="cacheHeap",n._rev=a;var c=n.getFirst();if(null!=c){var s=c.getKey()-1;if(s>0){var f=!0,l=!1,d=void 0;try{for(var v,p=n.getNodes()[Symbol.iterator]();!(f=(v=p.next()).done);f=!0){v.value.reduceKey(s)}}catch(t){l=!0,d=t}finally{try{f||null==p.return||p.return()}finally{if(l)throw d}}}}t.cacheHeap=n}else t.cacheHeap=new w,t.cacheHeap._id="cacheHeap",m("Cacher",0,"Cacher heap not found");document.dispatchEvent(new yt),r()}).catch(function(n){t.cacheHeap=new w,t.cacheHeap._id="cacheHeap",m("Cacher heap not found",1,n),document.dispatchEvent(new yt),r()})}).catch(function(n){t.cacheMap={_id:"cacheMap",length:0},t.cacheHeap=new w,t.cacheHeap._id="cacheHeap",m("Cacher map not found",1,n),document.dispatchEvent(new yt),r()}),t.whitelist=e,t.blacklist=i,t.maxCached=n}.bind(this)).catch(function(t){m(t)})}},{key:"parseUri",value:function(t){for(var n=btoa(t),e=0,i=n.length-1;i>=0&&"="==n[i];i--)e++;return e>0?n.substring(0,n.length-e):n}},{key:"cache",value:function(n,e){var i=n.toCacherRequest(),r=function(n,e){var i=e.pop();if(-1==t.blacklist.indexOf(i.uri)){var r=V.getInstance(!0),o=t.parseUri(i.uri),u=-1;if(t.cacheMap[i.method]&&t.cacheMap[i.method][o])for(var a in t.cacheMap[i.method][o])if(t.cacheMap[i.method][o][a][0]instanceof pt||(t.cacheMap[i.method][o][a][0]=pt.fromObject(t.cacheMap[i.method][o][a][0])),i.equal(t.cacheMap[i.method][o][a][0])){u=a;break}if(-1!=u){null!=(c=t.cacheHeap.findByValue(i))&&c.then(function(e,r){r.incKey(),t.cacheHeap.reheap(),e.put(t.cacheHeap,{rev:!0}).then(function(n){t.cacheHeap._rev=n.rev,m("Saved Cacher heap",0,n)}).catch(function(t){m("Cannot save Cacher heap",1,t)}),t.cacheMap[i.method][o][u][1]=n}.bind(this,r)).catch(function(){m("URL in whitelist",0,"Cannot retrive node from Cacher heap")})}else{if(t.cacheMap.length>t.maxCached)for(a=t.nodesPartNum;a>0;a--)for(var c,s=(c=t.cacheHeap.pop()).getValue(),f=t.parseUri(s.uri),l=t.cacheMap[s.method][f].length;l>0;l--){var d=t.cacheMap[s.method][f].shift();if(s.equal(d[0])){t.cacheMap.length--;break}d[0]instanceof pt||(d[0]=pt.fromObject(d[0])),t.cacheMap[s.method][f].push(d)}if(-1==t.whitelist.indexOf(i.uri)){var v=new h(1,i);t.cacheHeap.addNode(v),r.put(t.cacheHeap,{rev:!0}).then(function(n){t.cacheHeap._rev=n.rev,m("Saved Cacher heap",0,n)}).catch(function(t){m("Cannot save Cacher heap",1,t)})}t.cacheMap[i.method]||(t.cacheMap[i.method]={}),t.cacheMap[i.method][o]||(t.cacheMap[i.method][o]=[]),t.cacheMap[i.method][o].push([i,n]),t.cacheMap.length++,r.put(t.cacheMap,{rev:!0}).then(function(n){t.cacheMap._rev=n.rev,m("Saved Cacher map",0,n)}).catch(function(t){m("Cannot save Cacher map",1,t)})}}};i instanceof pt?r.bind(this)(e,[i]):Promise.all(i).then(r.bind(this,e))}},{key:"getCached",value:function(n){var e=t.parseUri(n.uri),i=[];if(t.cacheMap[n.method]&&t.cacheMap[n.method][e])for(var r in t.cacheMap[n.method][e]){t.cacheMap[n.method][e][r][0]instanceof pt||(t.cacheMap[n.method][e][r][0]=pt.fromObject(t.cacheMap[n.method][e][r][0]));var o=n.equal(t.cacheMap[n.method][e][r][0]);if(o instanceof Promise)i.push(o.then(function(t,n,e,i){return i?this[t][n][e][1]:null}.bind(t.cacheMap,n.method,e,r)));else if(1==o)return t.cacheMap[n.method][e][r][1]}return i.length>0?Promise.all(i).then(function(t){for(var n=0;n<t.length;n++)if(null!=t[n])return t[n]}):null}}]),t}();gt.cacheHeap=null,gt.cacheMap=null,gt.whitelist=null,gt.blacklist=null,gt.maxCached=1e3,gt.nodesPartNum=3;var bt=function(){function t(){o()(this,t)}return a()(t,[{key:"doRequest",value:function(t){return new Promise(function(n,e){var i=new XMLHttpRequest,r=encodeURI(t.uri);if("get"==t.method&&null!=t.getData()){var o="",u=!0,a=!1,c=void 0;try{for(var s,l=t.getData().entries()[Symbol.iterator]();!(u=(s=l.next()).done);u=!0){var h=s.value;h[0]&&(h[1]||0===h[1])&&(o+=h[0]+"="+h[1].toString().trim()+"&")}}catch(t){a=!0,c=t}finally{try{u||null==l.return||l.return()}finally{if(a)throw c}}r+="?"+(o=o.slice(0,-1))}i.open(t.getMethod(),r,!0);var d=!0,v=!1,p=void 0;try{for(var y,g=t.getHeaders()[Symbol.iterator]();!(d=(y=g.next()).done);d=!0){var b=y.value;i.setRequestHeader(b.name,b.value)}}catch(t){v=!0,p=t}finally{try{d||null==g.return||g.return()}finally{if(v)throw p}}i.responseType=t.getResponseType(),i.onreadystatechange=st()(f.a.mark(function r(){var o,u,a;return f.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(o=new F,i.readyState!==XMLHttpRequest.DONE){r.next=19;break}if(u=null,o.code=0,o.status=i.status,200===i.status){r.next=15;break}if(4==Math.floor(i.status/100)){r.next=14;break}if(!((u=gt.getCached(t))instanceof Promise)){r.next=14;break}return a=u,r.next=13,a;case 13:u=r.sent;case 14:u||(o.code=-10,o.content={error:"Connection Error"});case 15:u||(u=i.response),u?(o.code=0,o.content=u):200===i.status&&(o.code=-11,o.content={error:"No data response"}),200===i.status&&gt.cache(t,u),0==o.code?n(o):e(o);case 19:case"end":return r.stop()}},r,this)})),i.send(t.getData())})}}],[{key:"getInstance",value:function(){return t.instance||(t.instance=new t),t.instance}}]),t}();bt.instance=null;var wt=function(){function t(){o()(this,t)}return a()(t,[{key:"request",value:function(t){var n=k.test(t.uri);return H.getGlobal().accessController.processRequest(t),(n?bt.getInstance():at.getInstance()).doRequest(t)}}]),t}(),mt=function(){function t(){o()(this,t)}return a()(t,null,[{key:"getPage",value:function(n){return t.pages[n]}},{key:"addPage",value:function(n){try{t.pages[n.vid]=n}catch(t){m(t)}}}]),t}();mt.pages={};var _t=function t(n,e,i,r,u){o()(this,t),this.page=n,this.data=e,this.context=i,this.success=r,this.fail=u},kt=function(t){function n(){return o()(this,n),v()(this,y()(n).apply(this,arguments))}return b()(n,t),n}(C),At=function(t){function n(t){var e,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return o()(this,n),(e=v()(this,y()(n).call(this))).vid=t,e.data=i,e}return b()(n,t),n}(C),xt=function(t){function n(t){return o()(this,n),v()(this,y()(n).call(this,t+" model not found!"))}return b()(n,t),n}(C),Et=function(t){function n(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return o()(this,n),v()(this,y()(n).call(this,"pageready",t))}return b()(n,t),n}(nt),Lt=e(22),Ot=e.n(Lt),Mt=(e(39),function(){function t(){var n;o()(this,t),this.pageStack=[],this.container=null,this.documentProxy=null,this.currentPage=null,this.transition=null,(n=window.Node).prototype.__addEventListener=n.prototype.addEventListener,n.prototype.addEventListener=function(t,n,e){return this!=document&&(this.__listners||(this.__listners={}),t.split(" ").forEach(function(t,n,e){this.__listners[e]||(this.__listners[e]=[]),this.__listners[e].push({ls:t,uc:n})}.bind(this,n,e))),this.__addEventListener(t,n,e)},n.prototype.__removeEventListener=n.prototype.removeEventListener,n.prototype.removeEventListener=function(t,n){var e=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return this.__listners&&t.split(" ").forEach(function(t,n,e){if(this.__listners&&this.__listners[e])for(var i=this.__listners[e].length,r=0;r<i;r++){var o=this.__listners[e].shift();if(o.ls==t&&o.uc==n)break;this.__listners[e].push(o)}}.bind(this,n,e)),this.__removeEventListener(t,n,e)},n.prototype.__renewListeners=function(){if(this.hasChildNodes())for(var t=this.childNodes,n=0;n<t.length;n++)t[n].__renewListeners();if(this.__listners)for(var e in this.__listners)for(var i=0;i<this.__listners[e].length;i++)this.__addEventListener(e,this.__listners[e][i].ls,this.__listners[e][i].uc)}}return a()(t,[{key:"checkPage",value:function(t){H.getGlobal().accessController.processPage(t)}},{key:"checkVirtualPage",value:function(t){H.getGlobal().accessController.processVirtualPage(t)}},{key:"pageHop",value:function(){document.getElementById(this.container).classList.remove("bbh-new")}},{key:"setDefaultListener",value:function(t,n){if(n instanceof Element){if("A"==n.tagName.toUpperCase())var e=[n];else e=n.getElementsByTagName("a");for(var i=0;i<e.length;i++)e[i].hasAttribute("bbh-ignore")||!e[i].getAttribute("href")||"#"==e[i].getAttribute("href")||k.test(e[i].getAttribute("href"))||(e[i].onclick=function(t){var n=new vt("GET",this.getAttribute("href"),null);return t.request(n),!1}.bind(e[i],t.defaultConnector));if("FORM"==n.tagName.toUpperCase())var r=[n];else r=n.getElementsByTagName("form");for(i=0;i<r.length;i++)r[i].hasAttribute("bbh-ignore")||(r[i].onsubmit=function(t){var n=!0,e=!1,i=void 0;try{for(var r,o=this.querySelectorAll("[name]")[Symbol.iterator]();!(n=(r=o.next()).done);n=!0){var u=r.value;if(!u.checkValidity())return void u.reportValidity()}}catch(t){e=!0,i=t}finally{try{n||null==o.return||o.return()}finally{if(e)throw i}}var a=new FormData(this),c=new vt(this.getAttribute("method"),this.getAttribute("action"),a);return t.request(c),!1}.bind(r[i],t.defaultConnector))}}},{key:"makeTransition",value:function(t,n,e){var i=null;"vanish"==e?(n.classList.add("bbh-vanish"),n.classList.add("bbh-hide"),window.getComputedStyle(n).opacity,i=new Promise(function(n,e){t.classList.add("bbh-vanish"),window.getComputedStyle(t).opacity,t.addEventListener("transitionend",i=function(){t.removeEventListener("transitionend",i),n()}),t.classList.add("bbh-hide");var i=null})):"slide"==e&&(t.classList.add("bbh-slide-under"),n.classList.remove("bbh-slide-under"),n.classList.add("bbh-slide"),n.classList.add("bbh-hide"),n.style.display="block",window.getComputedStyle(t).height,i=new Promise(function(t,e){var i=null;n.addEventListener("transitionend",i=function(){n.removeEventListener("transitionend",i),n.classList.remove("bbh-slide"),t()}),n.classList.remove("bbh-hide")}));var r=null;return n.addEventListener("pageready",r=function(){"vanish"==e&&n.classList.remove("bbh-hide"),n.removeEventListener("pageready",r)}),i}},{key:"waitNremove",value:function(t,n){if(t){for(var e=n.querySelectorAll("*[id]"),i=0;i<e.length;i++)e[i].id+="-toDelete";t=t.then(function(){document.body.removeChild(n)}).catch(function(){document.body.removeChild(n)})}else document.body.removeChild(n);return t}},{key:"getNewContainer",value:function(t){var n=document.getElementById(this.container);n.setAttribute("id",this.container+"-toDelete");var e=document.createElement("div");e.setAttribute("id",this.container),e.classList.add("bbh-page"),e.classList.add("bbh-new"),document.body.appendChild(e);var i=this.makeTransition(n,e,this.transition);if(t){var r=function(){var t=document.querySelectorAll('*[id^="historyPage-"]').length;n.setAttribute("id","historyPage-"+t),n.style.display="none";for(var e=n.querySelectorAll("*[id]"),i=0;i<e.length;i++)e[i].id+="-history"+t};i?i=i.then(r):r()}else this.waitNremove(i,n);return i?i.then(function(){return e}):e}},{key:"buildPage",value:function(t,n){return new Promise(function(e,i){var r=mt.getPage(t);if(r){var o=!1,u=!1;this.currentPage&&this.currentPage.page.ghostPage&&(this.currentPage=this.pageStack.pop()||null,u=!0),r.lock||null==this.currentPage||r.vid==this.currentPage.page.vid&&!r.allowDuplicate||(!u&&this.currentPage.page.keepLive&&(o=!0),this.pageStack.push(this.currentPage)),r.lock&&(this.pageStack=[]);var a=this.getNewContainer(o),c=function(t){var o=new G(t);this.currentPage=new _t(r,n,o,e,i),this.checkVirtualPage(this.currentPage),this.buildPageByObject(r,n,o,e,i),this.pageHop()}.bind(this);a instanceof Promise?a.then(c):c(a)}else i(new kt)}.bind(this)).catch(function(t){m(t)})}},{key:"buildPageFromHistory",value:function(t,n){var e=document.getElementById(this.container);e.setAttribute("id",this.container+"-toDelete");var i=document.getElementById("historyPage-"+t);i.classList.add("bbh-new");var r=this.waitNremove(this.makeTransition(e,i,this.transition),e),o=function(){i.setAttribute("id",this.container),i.style.display="block";for(var n=i.querySelectorAll("*[id]"),e=("-history"+t).length,r=0;r<n.length;r++)n[r].id=n[r].id.substring(0,n[r].id.length-e),n[r].__renewListeners();document.dispatchEvent(new Et),i.dispatchEvent(new Et)}.bind(this);return r?r.then(o):(o(),null)}},{key:"buildPageByText",value:function(t,n,e,i,r,o,u){var a=H.getGlobal(),c=document.getElementById(this.container),s=[],l=!0,h=!1,d=void 0;try{for(var v,p=Ot.a.parse(t)[Symbol.iterator]();!(l=(v=p.next()).done);l=!0){"text"!=(b=v.value)[0]&&s.push(b)}}catch(t){h=!0,d=t}finally{try{l||null==p.return||p.return()}finally{if(h)throw d}}for(var y=[],g=B.getModels();s.length>0;){var b;if((b=s.shift())[4]instanceof Array){var w=!0,_=!1,k=void 0;try{for(var A,x=b[4][Symbol.iterator]();!(w=(A=x.next()).done);w=!0){var E=A.value;"text"!=E[0]&&"name"!=E[0]&&s.push(E)}}catch(t){_=!0,k=t}finally{try{w||null==x.return||x.return()}finally{if(_)throw k}}}if(b[1].startsWith("models.")){var L=b[1].split(".");if(!g[L[1]])throw new xt(L[1]);try{var O=i.execMethod("fetch",[L[2]],g[L[1]]);O instanceof Promise&&y.push(O)}catch(t){throw new C("Invalid access to models by Mustache on page.")}}}Promise.all(y).then(st()(f.a.mark(function u(){var s,l,h,d,v,p,y,b,w,_,k,A,x,E,L,O,M,T,q,P,S;return f.a.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:c.innerHTML=Ot.a.render(t,{pageData:n,models:g,pageConf:e.properties}),new MutationObserver(function(t,n){var e=!0,i=!1,r=void 0;try{for(var o,u=n[Symbol.iterator]();!(e=(o=u.next()).done);e=!0){var a=o.value;if("childList"==a.type){var c=!0,s=!1,f=void 0;try{for(var l,h=a.addedNodes[Symbol.iterator]();!(c=(l=h.next()).done);c=!0){var d=l.value;this.setDefaultListener(t,d)}}catch(t){s=!0,f=t}finally{try{c||null==h.return||h.return()}finally{if(s)throw f}}}}}catch(t){i=!0,r=t}finally{try{e||null==u.return||u.return()}finally{if(i)throw r}}}.bind(this,a)).observe(c,{subtree:!0,childList:!0}),s=c.getElementsByTagName("script"),l=null,h=0;case 6:if(!(h<s.length)){u.next=21;break}if(d=s[h].getAttribute("async"),""==s[h].getAttribute("src")||null==s[h].getAttribute("src")){u.next=17;break}if(v=s[h].getAttribute("src"),"true"==d||null==l){u.next=13;break}return u.next=13,l;case 13:p=new Promise(function(t,n){var e=new XMLHttpRequest;e.open("get",v,!0),e.responseType="text",e.onreadystatechange=function(n,i){if(e.readyState===XMLHttpRequest.DONE){try{n.execCode(e.response)}catch(t){m("Execution of scriptfile: "+i,3,t)}t()}}.bind(this,i,v),e.send()}).catch(function(t){m(t)}),"true"!=d&&(l=p),u.next=18;break;case 17:try{i.execCode(s[h].innerHTML)}catch(t){m("Execution of script code",3,t)}case 18:h++,u.next=6;break;case 21:this.setDefaultListener(a,c),y=null==l?[]:[l],b=!0,w=!1,_=void 0,u.prev=26,k=ot.getModules()[Symbol.iterator]();case 28:if(b=(A=k.next()).done){u.next=71;break}if(x=A.value,!(null!=r&&r.indexOf(x.name)>-1)){u.next=68;break}E=!0,L=!1,O=void 0,u.prev=34,M=c.querySelectorAll('[bbh-module*="'+x.name+'"]')[Symbol.iterator]();case 36:if(E=(T=M.next()).done){u.next=54;break}if((q=T.value).setAttribute("bbh-manipulating","true"),P=new K.a(q,a.clone()),void 0===(S=P.execMethod("manipulate",[],x))){u.next=49;break}if(!(S instanceof Promise)){u.next=46;break}S.then(function(){q.setAttribute("bbh-manipulating","false")}),u.next=47;break;case 46:throw new C(x.name+" manipulate has not returned a promise");case 47:u.next=50;break;case 49:q.setAttribute("bbh-manipulating","false");case 50:y.push(S);case 51:E=!0,u.next=36;break;case 54:u.next=60;break;case 56:u.prev=56,u.t0=u.catch(34),L=!0,O=u.t0;case 60:u.prev=60,u.prev=61,E||null==M.return||M.return();case 63:if(u.prev=63,!L){u.next=66;break}throw O;case 66:return u.finish(63);case 67:return u.finish(60);case 68:b=!0,u.next=28;break;case 71:u.next=77;break;case 73:u.prev=73,u.t1=u.catch(26),w=!0,_=u.t1;case 77:u.prev=77,u.prev=78,b||null==k.return||k.return();case 80:if(u.prev=80,!w){u.next=83;break}throw _;case 83:return u.finish(80);case 84:return u.finish(77);case 85:Promise.all(y).then(function(){document.dispatchEvent(new Et),c.dispatchEvent(new Et),o()});case 86:case"end":return u.stop()}},u,this,[[26,73,77,85],[34,56,60,68],[61,,63,67],[78,,80,84]])})).bind(this))}},{key:"buildPageByObject",value:function(t,n,e){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:_,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:_;try{this.checkPage(t);var o=new XMLHttpRequest;o.open("GET",t.path,!0),o.onreadystatechange=function(){var t=st()(f.a.mark(function t(n,e,i,r,u,a){return f.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:o.readyState===XMLHttpRequest.DONE&&404===o.status?a(new kt):o.readyState===XMLHttpRequest.DONE&&this.buildPageByText(o.response,n,e,i,r,u,a);case 1:case"end":return t.stop()}},t,this)}));return function(n,e,i,r,o,u){return t.apply(this,arguments)}}().bind(this,n,t.configuration,e,t.modules,i,r),o.send(null)}catch(t){r(t),t instanceof At&&(-1==t.vid?this.pageBack():this.buildPage(t.vid,t.data))}}},{key:"pageBack",value:function(){var t=this.pageStack.pop();if(!t)throw new kt;if(this.currentPage=t,this.checkVirtualPage(t),t.page.keepLive){var n=document.querySelectorAll('*[id^="historyPage-"]').length,e=this.buildPageFromHistory(n-1,t.page.path);e&&e.then(function(){this.pageHop()}.bind(this))}else{this.getNewContainer(!1);var i=function(){this.buildPageByObject(t.page,t.data,t.context,t.success,t.fail),this.pageHop()}.bind(this);domcontainer instanceof Promise?domcontainer.then(i):i()}}}]),t}()),Tt=function(){function t(){o()(this,t)}return a()(t,null,[{key:"getDOMParser",value:function(){return null==t.domParser&&(t.domParser=new DOMParser),t.domParser}},{key:"parseUrl",value:function(t,n){var e=new XMLHttpRequest;e.open("get",t,!0),e.responseType="text",e.onreadystatechange=function(t){e.readyState===XMLHttpRequest.DONE&&t(this.parseString(e.response))}.bind(this,n),e.send()}},{key:"parseString",value:function(n){var e=null;window.DOMParser?e=t.getDOMParser().parseFromString(n,"application/xml"):((e=new ActiveXObject("Microsoft.XMLDOM")).async=!1,e.loadXML(n));return e}}]),t}();Tt.domParser=null;var qt=function(t){function n(){return o()(this,n),v()(this,y()(n).apply(this,arguments))}return b()(n,t),n}(U),Pt=function(t){function n(){return o()(this,n),v()(this,y()(n).apply(this,arguments))}return b()(n,t),n}(U),St=function t(n){o()(this,t),this.name="FrameworkError",this.message=n},Ft=function(t){function n(){return o()(this,n),v()(this,y()(n).call(this,"Current Javascript Engine doesn't support the framework."))}return b()(n,t),n}(St),jt=function(){function t(n){o()(this,t),this.moduleOnLoad=[],this.initialization=!0,Tt.parseUrl(n,this.processConf.bind(this))}return a()(t,[{key:"registerModel",value:function(t){B.addModel(t)}},{key:"registerModule",value:function(t){this.initialization?this.moduleOnLoad.push(t):ot.addModule(t)}},{key:"registerRoute",value:function(t){$.addRoute(t)}},{key:"addToGlobalContext",value:function(t,n){var e=H.getGlobal();if(t in e)throw new C("A module tried to edit global context!");e[t]=n}},{key:"processConf",value:function(n){if(n){var e={};try{var i=n.getElementsByTagName("configuration")[0];if(e.container=i.getElementsByTagName("container")[0].textContent,i.getElementsByTagName("base_url").length>0)e.base_url=i.getElementsByTagName("base_url")[0].textContent;else{var r=document.location.pathname.split("/");r.pop(),e.base_url=document.location.protocol+"//"+document.location.host+r.join("/")}var o=i.getElementsByTagName("pageBuilder")[0],u=[],a=[],c=1e3,s=i.getElementsByTagName("cacher")[0];if(s){if(s.getAttribute("max-cached")&&(c=parseInt(s.getAttribute("max-cached"))),s.getElementsByTagName("block")){var f=!0,l=!1,h=void 0;try{for(var d,v=s.getElementsByTagName("block")[Symbol.iterator]();!(f=(d=v.next()).done);f=!0){var p=d.value;a.push(p.getAttribute("url"))}}catch(t){l=!0,h=t}finally{try{f||null==v.return||v.return()}finally{if(l)throw h}}}if(s.getElementsByTagName("persist")){var y=!0,g=!1,b=void 0;try{for(var w,_=s.getElementsByTagName("persist")[Symbol.iterator]();!(y=(w=_.next()).done);y=!0){var k=w.value;u.push(k.getAttribute("url"))}}catch(t){g=!0,b=t}finally{try{y||null==_.return||_.return()}finally{if(g)throw b}}}}var A=gt.init(c,u,a),x=i.getElementsByTagName("pages")[0],O=x.getElementsByTagName("index")[0],M=x.getAttribute("path"),T=x.getAttribute("transition")||null,q=!0,P=!1,S=void 0;try{for(var F,j=x.getElementsByTagName("page")[Symbol.iterator]();!(q=(F=j.next()).done);q=!0){k=F.value;var D=null,R=null;k.getAttribute("modulesAllowed")&&(D=k.getAttribute("modulesAllowed").split(",")),k.getAttribute("rolesAllowed")&&(R=k.getAttribute("rolesAllowed").split(","));var B={};if(k.getElementsByTagName("configuration")&&k.getElementsByTagName("configuration").length>0){var W=!0,$=!1,X=void 0;try{for(var G,Z=k.getElementsByTagName("configuration")[0].childNodes[Symbol.iterator]();!(W=(G=Z.next()).done);W=!0){var Y=G.value;Y instanceof Element&&(B[Y.tagName]=Y.textContent)}}catch(t){$=!0,X=t}finally{try{W||null==Z.return||Z.return()}finally{if($)throw X}}}var z=new qt(B),I=new J(k.getAttribute("path"),parseInt(k.getAttribute("vid")),"true"==k.getAttribute("noback"),z,D,k.hasAttribute("keepLive")?"true"==k.getAttribute("keepLive"):void 0,k.hasAttribute("allowDuplicate")?"true"==k.getAttribute("allowDuplicate"):void 0,k.hasAttribute("ghostPage")?"true"==k.getAttribute("ghostPage"):void 0,R);mt.addPage(I)}}catch(t){P=!0,S=t}finally{try{q||null==j.return||j.return()}finally{if(P)throw S}}t.configuration=new U(e);var Q=i.getElementsByTagName("routes")[0];if(Q){var tt=!0,nt=!1,et=void 0;try{for(var rt,ut=Q.getElementsByTagName("route")[Symbol.iterator]();!(tt=(rt=ut.next()).done);tt=!0){var at=rt.value;this.registerRoute(new N(at.getAttribute("entry"),at.getAttribute("destination")))}}catch(t){nt=!0,et=t}finally{try{tt||null==ut.return||ut.return()}finally{if(nt)throw et}}}var ct=i.getElementsByTagName("modules")[0],st=null;if(ct){var ft=ct.getAttribute("path");ft.startsWith(e.base_url)||(ft=L(e.base_url,ft,!1));var lt={},ht=document.createElement("iframe");for(var dt in ht.style.display="none",document.body.appendChild(ht),window)dt in ht.contentWindow||(ht.contentWindow[dt]=window[dt]);ht.contentWindow.Promise=window.Promise,ht.contentWindow.Array=window.Array,ht.contentWindow.Element=window.Element,ht.contentWindow._document=new Proxy(document,{container:document.getElementById(e.container),whiteList:["querySelector","getElementById","dispatchEvent","createElement"],get:function(t,n){var e="function"!=typeof t[n]||-1!=this.whiteList.indexOf(n)?t[n]:void 0;return"function"==typeof e&&"createElement"!=n&&(e=function(t){for(var n=[],e=1;e<arguments.length;e++)n[e-1]=arguments[e];var i=t.apply(document,n);if(i instanceof Node){for(var r=i;r=r.parentNode;)if(r==this)return i;return this}}.bind(this.container,e)),e.bind(t)},set:function(t,n,e){return!1}});var vt=!0,pt=!1,yt=void 0;try{for(var bt,_t=ct.getElementsByTagName("module")[Symbol.iterator]();!(vt=(bt=_t.next()).done);vt=!0){var kt=bt.value;if("true"==kt.getAttribute("enabled")){var At,xt=kt.getAttribute("permissions")?kt.getAttribute("permissions").split(","):[];At=function t(n){var e={},i=!0,r=!1,o=void 0;try{for(var u,a=n.childNodes[Symbol.iterator]();!(i=(u=a.next()).done);i=!0){var c=u.value;c instanceof Element&&(c.hasChildNodes()?1==c.childNodes.length&&c.childNodes[0].nodeType==Node.TEXT_NODE?e[c.tagName]=c.textContent:e[c.tagName]=t(c):e[c.tagName]=c.textContent)}}catch(t){r=!0,o=t}finally{try{i||null==a.return||a.return()}finally{if(r)throw o}}return e}(kt.getElementsByTagName("configuration")[0]);var Et=new Pt(At);st=new Promise(function(t,n,e,i,r){var o=function(t,n,e){var i=document.createElement("script");if(i.src=ft+kt.getAttribute("path"),i.type="module",i.onload=function(t,n,e,i){for(;t.length>0;){var r=t.shift();lt[r.name]=n,ot.addModule(r,e)}i()}.bind(i,this.moduleOnLoad,t,n,e),ft.startsWith("file:")){var r=new XMLHttpRequest;r.onload=function(t,n,e,i){var o=r.response,u=new Blob([o],{type:"text/javascript"});n.src=URL.createObjectURL(u),e.contentDocument.head.appendChild(n)}.bind(this,kt,i,ht),r.open("get",ft+kt.getAttribute("path")),r.responseType="blob",r.send()}else ht.contentDocument.head.appendChild(i)}.bind(this,t,n,i);null!=e?e.then(o):o()}.bind(this,Et,xt,st)).catch(function(t){m(t)})}}}catch(t){pt=!0,yt=t}finally{try{vt||null==_t.return||_t.return()}finally{if(pt)throw yt}}}var Lt=document.createElement("base");Lt.setAttribute("href",M),document.getElementsByTagName("head")[0].appendChild(Lt);var Ot=ht.contentDocument.createElement("base");Ot.setAttribute("href",e.base_url+"/"+M),ht.contentDocument.getElementsByTagName("head")[0].appendChild(Ot),Promise.all([A,st]).then(function(){var t=H.getGlobal();if(t.BobbleHead=new Proxy(BobbleHead,{whiteList:["User","Role","Session","Response","Request","ConnectorRequest","Model","ModelInstance","Route","Page","PageContext","AuthenticationMethod","AuthenticationMethods","PageFactory","VirtualPage","Exceptions","Errors","Events","Util"],get:function(t,n){return n in t&&-1!=this.whiteList.indexOf(n)?t[n]:null}}),o){o=o.textContent;try{var n=E(o)||E(o,ht.contentWindow);if(!n)throw new C(o+" isn't a valid PageBuilder");t.pageBuilder=o?new n:new Mt}catch(n){m(n),t.pageBuilder=new Mt}}else t.pageBuilder=new Mt;t.pageBuilder.container=e.container,t.pageBuilder.transition=T;var r=i.getElementsByTagName("defaultConnector")[0];if(r){r=r.textContent;try{var u=E(r)||E(r,ht.contentWindow);if(!u)throw new C(r+" isn't a valid GenericConnector");t.defaultConnector=r?new u:new wt}catch(n){m(n),t.defaultConnector=new wt}}else t.defaultConnector=new wt;var a=i.getElementsByTagName("accessController")[0],c=null;if(a){var s=a.textContent;try{if(s){var f=E(s)||E(s,ht.contentWindow);if(!f)throw new C(s+" isn't a valid AccessController")}t.accessController=s?new f:new it,c=t.accessController.init(a.getAttribute("method"))}catch(n){m(n),t.accessController=new it,c=t.accessController.init(a.getAttribute("method")||"none")}}else t.accessController=new it,c=t.accessController.init("none");t.localDatabase=V.getInstance(),c.then(function(){var n=[],i=!0,r=!1,o=void 0;try{for(var u,a=ot.getModules()[Symbol.iterator]();!(i=(u=a.next()).done);i=!0){var c=u.value,s=t.clone(),f=[],l=!0,h=!1,d=void 0;try{for(var v,p=ot.getModulePermissions(c.name)[Symbol.iterator]();!(l=(v=p.next()).done);l=!0){var y=v.value;"pages"==y?f=f.concat(["PageFactory","PageConfiguration"]):"users"==y?f=f.concat(["UserPool","RolePool"]):"models"==y&&(f=f.concat(["ModelPool"]))}}catch(t){h=!0,d=t}finally{try{l||null==p.return||p.return()}finally{if(h)throw d}}s.BobbleHead=new Proxy(BobbleHead,{whiteList:["User","Role","Session","Response","Request","ConnectorRequest","Model","ModelInstance","Route","Page","PageContext","AuthenticationMethod","AuthenticationMethods","VirtualPage","Exceptions","Errors","Events","Util","XMLParser"].concat(f),moduleName:c.name,get:function(t,n){if(n in t&&-1!=this.whiteList.indexOf(n))return t[n];throw new C("Unpermitted access to "+n+" from "+this.moduleName)}});var g=new K.a(document.getElementById(e.container),s).execMethod("init",[lt[c.name]],c);g instanceof Promise&&n.push(g)}}catch(t){r=!0,o=t}finally{try{i||null==a.return||a.return()}finally{if(r)throw o}}if(O){e.index=parseInt(O.getAttribute("vid"));var b=null;if(O.getElementsByTagName("data")[0]){b={};var w=!0,m=!1,_=void 0;try{for(var k,A=O.getElementsByTagName("data")[0].childNodes[Symbol.iterator]();!(w=(k=A.next()).done);w=!0){var x=k.value;x instanceof Element&&(b[x.tagName]=x.textContent)}}catch(t){m=!0,_=t}finally{try{w||null==A.return||A.return()}finally{if(m)throw _}}}Promise.all(n).then(function(t,n){this.pageBuilder.buildPage(t,n)}.bind(t,e.index,b))}this.initialization=!1}.bind(this))}.bind(this))}catch(t){throw m(t),new Ft}}}}],[{key:"getConf",value:function(n){return t.configuration?t.configuration.getProperty(n):null}}]),t}();jt.configuration=null;var Ut=function(t){function n(){return o()(this,n),v()(this,y()(n).apply(this,arguments))}return b()(n,t),n}(C),Dt=function(t){function n(t){return o()(this,n),v()(this,y()(n).call(this,t))}return b()(n,t),n}(C);n.default=function(){var t={};return Object.defineProperties(t,{UserPool:{value:T,writable:!1},User:{value:q,writable:!1},Role:{value:P,writable:!1},RolePool:{value:S,writable:!1},Session:{value:c,writable:!1},Response:{value:F,writable:!1},Request:{value:j,writable:!1},ConnectorRequest:{value:vt,writable:!1},CacherRequest:{value:pt,writable:!1},GenericConfiguration:{value:U,writable:!1},ModuleConfiguration:{value:Pt,writable:!1},PageConfiguration:{value:qt,writable:!1},Model:{value:D,writable:!1},ModelInstance:{value:R,writable:!1},ModelPool:{value:B,writable:!1},Route:{value:N,writable:!1},Router:{value:$,writable:!1},Page:{value:J,writable:!1},PageContext:{value:G,writable:!1},AccessController:{value:it,writable:!1},AuthenticationMethod:{value:Y,writable:!1},AuthenticationMethods:{value:I,writable:!1},InternalConnector:{value:at,writable:!1},ExternalConnector:{value:bt,writable:!1},GenericConnector:{value:wt,writable:!1},Cacher:{value:gt,writable:!1},PageBuilder:{value:Mt,writable:!1},PageFactory:{value:mt,writable:!1},Module:{value:rt,writable:!1},ModulePool:{value:ot,writable:!1},VirtualPage:{value:_t,writable:!1},Database:{value:V,writable:!1},AppController:{value:jt,writable:!1},XMLParser:{value:Tt,writable:!1},Context:{value:H,writable:!1},defaultCallback:{value:_,writable:!1},Exceptions:{value:{get FrameworkException(){return C},set FrameworkException(t){},get GenericModuleException(){return Dt},set GenericModuleException(t){},get PageNotFoundException(){return kt},set PageNotFoundException(t){},get RedirectException(){return At},set RedirectException(t){},get NotSupportedException(){return Ut},set NotSupportedException(t){},get UnauthorizedException(){return z},set UnauthorizedException(t){},get InvalidRouteException(){return W},set InvalidRouteException(t){},get ControllerNotFoundException(){return ut},set ControllerNotFoundException(t){},get ModelNotFoundException(){return xt},set ModelNotFoundException(t){},get InvalidAuthenticationMethodException(){return Q},set InvalidAuthenticationMethodException(t){}},writable:!1},Errors:{value:{FrameworkError:St,NotSupportedEngineError:Ft},writable:!1},Events:{value:{get FrameworkEvent(){return nt},set FrameworkEvent(t){},get CacherLoadedEvent(){return yt},set CacherLoadedEvent(t){},get AccessControllerLoadedEvent(){return et},set AccessControllerLoadedEvent(t){},get PageReadyEvent(){return Et},set PageReadyEvent(t){}},writable:!1},Util:{value:i,writable:!1},init:{value:function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"./app.xml";if(t.app)throw new C("BobbleHead is already running");return Object.defineProperty(t,"app",{value:new t.AppController(n),writable:!1}),t.app},writable:!1}}),t}()}]).default;